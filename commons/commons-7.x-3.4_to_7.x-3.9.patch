diff --git a/.travis.yml b/.travis.yml
index 230ccfb..fb946e7 100644
--- a/.travis.yml
+++ b/.travis.yml
@@ -8,7 +8,7 @@ php:
 
 notifications:
   email:
-    - marc.seeger@acquia.com
+    - commons-bulk@acquia.com
 
 branches:
   only:
@@ -35,7 +35,7 @@ before_install:
   - curl http://localhost:4444/wd/hub
   # For uploading error screenshots
   - "wget http://imgur.com/tools/imgurbash.sh -O $TRAVIS_BUILD_DIR/imgurbash.sh && chmod +x $TRAVIS_BUILD_DIR/imgurbash.sh"
-  
+
 before_script:
   # Grab drush
   - pear channel-discover pear.drush.org
@@ -49,7 +49,7 @@ before_script:
   - sudo a2enmod actions
   - sudo service apache2 restart
   # Install the composer packages for behat / ...
-  - composer --working-dir=tests/ install  
+  - composer --working-dir=tests/ install
 script:
   # Build distro from makefile
   - drush make build-commons.make --no-cache -y packaged
@@ -64,7 +64,7 @@ script:
   # Start running the tests
   - cd tests
   - bin/behat
-  
+
 after_failure:
   - ls -lash $TRAVIS_BUILD_DIR/fail*.png
   - $TRAVIS_BUILD_DIR/imgurbash.sh $TRAVIS_BUILD_DIR/fail*.png
diff --git a/commons.api.php b/commons.api.php
new file mode 100644
index 0000000..f137568
--- /dev/null
+++ b/commons.api.php
@@ -0,0 +1,68 @@
+<?php
+
+/**
+ * @file
+ * Hooks provided by the Commons module.
+ */
+
+/**
+ * @addtogroup hooks
+ * @{
+ */
+
+/**
+ * Define entity integrations.
+ *
+ * This hook allows modules to register entity types and/or bundles that they
+ * provide for integration with Commons functionality. For example, a webform
+ * module could use it to register a form entity type and its "Test", "Survey"
+ * and "Suggestion" bundles.
+ *
+ * @return
+ *   An associative array of entity integrations whose keys define the entity
+ *   type for each integration and whose values contain the bundles which have
+ *   been integrated. Each bundle is itself an associative array, whose keys
+ *   define the type of integration to enable and whose values contain the
+ *   status of the integration. TRUE = enabled, FALSE = disabled.
+ *
+ * For a detailed usage example, see commons_q_a.module.
+ *
+ * @see hook_commons_entity_integration_alter()
+ */
+function hook_commons_entity_integration() {
+  // Register three of the webform entity's bundles for various integrations.
+  return array(
+    'webform' => array(
+      'test' => array(
+        'exclude_rate' => TRUE,
+      ),
+      'survey' => array(
+        'exclude_topics' => TRUE,
+      ),
+      'suggestion' => array(
+        'media' => TRUE,
+      ),
+    ),
+  );
+}
+
+/**
+ * Perform alterations on entity integrations.
+ *
+ * @param $integrations
+ *   An associative array of entity integrations whose keys define the entity
+ *   type for each integration and whose values contain the bundles which have
+ *   been integrated. Each bundle is itself an associative array, whose keys
+ *   define the type of integration to enable and whose values contain the
+ *   status of the integration. TRUE = enabled, FALSE = disabled.
+ *
+ * @see hook_commons_entity_integration()
+ */
+function hook_commons_entity_integration_alter(&$integrations) {
+  // Disable Media integration for the post content type.
+  $integrations['node']['post']['media'] = FALSE;
+}
+
+/**
+ * @} End of "addtogroup hooks".
+ */
diff --git a/commons.info b/commons.info
index 3af232c..3d8e4c3 100644
--- a/commons.info
+++ b/commons.info
@@ -1,11 +1,10 @@
 name = Commons
-project = commons
-distribution_name = "Drupal Commons"
 description = Ready-to-use solution for building communities.
 core = 7.x
-php_memory_limit = 128M
+distribution_name = "Drupal Commons"
+exclusive = TRUE
 
-; Core modules.
+; Install required core modules.
 dependencies[] = block
 dependencies[] = comment
 dependencies[] = dblog
@@ -18,25 +17,36 @@ dependencies[] = menu
 dependencies[] = number
 dependencies[] = options
 dependencies[] = path
+dependencies[] = rdf
 dependencies[] = search
 dependencies[] = shortcut
 dependencies[] = taxonomy
 
-; Contributed modules.
+; Install required contributed modules.
+; For Commons 3.6, media is included, but left disabled by default.
+; Uncomment if you wish to enable on install. Alternatively, enabling the
+; commons_media module post install will enable all of the media modules.
 dependencies[] = addressfield
 dependencies[] = addressfield_tokens
 dependencies[] = breakpoints
+dependencies[] = ckeditor
 dependencies[] = ctools
 dependencies[] = custom_search
 dependencies[] = diff
+dependencies[] = elements
 dependencies[] = email_registration
 dependencies[] = entity
 dependencies[] = entityreference
 dependencies[] = entitycache
 dependencies[] = edit_profile
 dependencies[] = features
+;dependencies[] = file_entity
 dependencies[] = flag
 dependencies[] = http_client
+dependencies[] = libraries
+;dependencies[] = media
+;dependencies[] = media_internet
+;dependencies[] = media_wysiwyg
 dependencies[] = menu_attributes
 dependencies[] = message
 dependencies[] = message_notify
@@ -44,20 +54,22 @@ dependencies[] = message_subscribe
 dependencies[] = metatag
 dependencies[] = module_filter
 dependencies[] = navbar
+;dependencies[] = oembed
 dependencies[] = og
+dependencies[] = panelizer
 dependencies[] = panels
+dependencies[] = panels_ipe
 dependencies[] = paranoia
 dependencies[] = pathauto
-dependencies[] = placeholder
 dependencies[] = privatemsg
 dependencies[] = privatemsg_realname
 dependencies[] = quicktabs
 dependencies[] = r4032login
-dependencies[] = libraries
 dependencies[] = radioactivity
 dependencies[] = realname
 dependencies[] = redirect
 dependencies[] = rules
+dependencies[] = schemaorg
 dependencies[] = sharethis
 dependencies[] = strongarm
 dependencies[] = token
@@ -65,10 +77,12 @@ dependencies[] = views
 dependencies[] = views_bulk_operations
 dependencies[] = views_ui
 dependencies[] = votingapi
-dependencies[] = advancedqueue
-dependencies[] = ckeditor
+
+; Install commons specific modules
+dependencies[] = commons_activity_page
 dependencies[] = commons_activity_streams
 dependencies[] = commons_bw
+dependencies[] = commons_content_moderation
 dependencies[] = commons_events
 dependencies[] = commons_events_pages
 dependencies[] = commons_featured
@@ -76,31 +90,33 @@ dependencies[] = commons_follow
 dependencies[] = commons_follow_group
 dependencies[] = commons_follow_node
 dependencies[] = commons_follow_term
-dependencies[] = commons_follow_user
 dependencies[] = commons_follow_ui
-dependencies[] = commons_like
-dependencies[] = commons_search
-dependencies[] = commons_search_core
+dependencies[] = commons_follow_user
 dependencies[] = commons_groups
-dependencies[] = commons_groups_pages
 dependencies[] = commons_groups_directory
+dependencies[] = commons_groups_pages
+dependencies[] = commons_like
+dependencies[] = commons_location
+;dependencies[] = commons_media
+dependencies[] = commons_misc
 dependencies[] = commons_notify
-dependencies[] = commons_posts
 dependencies[] = commons_pages
-dependencies[] = commons_q_a
-dependencies[] = commons_q_a_pages
-dependencies[] = commons_wikis
 dependencies[] = commons_polls
-dependencies[] = commons_content_moderation
+dependencies[] = commons_posts
 dependencies[] = commons_profile_base
 dependencies[] = commons_profile_social
-dependencies[] = commons_utility_links
-dependencies[] = commons_user_profile_pages
+dependencies[] = commons_q_a
+dependencies[] = commons_q_a_pages
+dependencies[] = commons_search
+dependencies[] = commons_search_core
 dependencies[] = commons_site_homepage
-dependencies[] = commons_activity_page
-dependencies[] = commons_wikis_pages
-dependencies[] = commons_misc
-dependencies[] = commons_location
-dependencies[] = commons_wysiwyg
 dependencies[] = commons_social_sharing
 dependencies[] = commons_trusted_contacts
+dependencies[] = commons_user_profile_pages
+dependencies[] = commons_utility_links
+dependencies[] = commons_wikis
+dependencies[] = commons_wikis_pages
+dependencies[] = commons_wysiwyg
+
+; System Requirements.
+php_memory_limit = 128M
diff --git a/commons.install b/commons.install
index d9e3efe..10d4361 100644
--- a/commons.install
+++ b/commons.install
@@ -7,13 +7,13 @@
 
 /**
  * Implements hook_requirements().
- * Set minimum 'max_execution_time' requirement
  */
 function commons_requirements($phase) {
   $requirements = array();
   // Ensure translations don't break during installation.
   $t = get_t();
   if($phase == 'install') {
+
     // Test PHP minimum execution time
     $requirements['php_max_execution_time'] = array(
       'title' => $t('PHP Max Execution Time'),
@@ -25,20 +25,606 @@ function commons_requirements($phase) {
       $requirements['php_max_execution_time']['description'] = $t('Your PHP execution time is too low, please set it greater than or equal to %time seconds.', array('%time' => DRUPAL_MINIMUM_MAX_EXECUTION_TIME));
       $requirements['php_max_execution_time']['severity'] = REQUIREMENT_ERROR;
     }
+
+    if(ini_get('apc.shm_size') != NULL) {
+      // Check for apc.shm_size = 96mb
+      $requirements['apc_shm_size'] = array(
+        'title' => $t('APC shim size'),
+        'value' => ini_get('apc.shm_size'),
+      );
+
+      $shm_size = preg_split('/[a-zA-Z]/', ini_get('apc.shm_size'));
+      $shm_size = $shm_size[0];
+
+      // only check if APC var is being set somewhere (usually apc.ini).
+      // throw error if there is less than 96MB available
+      if ($shm_size && $shm_size < COMMONS_MINIMUM_APC_CACHE) {
+        $requirements['apc_shm_size']['description'] = $t('APC is installed but %shm_size is not enough APC cache to successfully install Drupal Commons.
+           Find your <em>apc.ini</em> file and change the <em>apc.shm_size</em> value to at least <em>%min_shm_size</em>.', array('%shm_size' => $shm_size . 'M', '%min_shm_size' => COMMONS_MINIMUM_APC_CACHE . 'M'));
+        $requirements['apc_shm_size']['severity'] = REQUIREMENT_ERROR;
+      }
+    }
   }
   return $requirements;
 }
 
 /**
- * Implements hook_install().
+ * Implements hook_install_tasks().
+ */
+function commons_install_tasks() {
+  //make sure we have more memory than 196M. if not lets try to increase it.
+  if (ini_get('memory_limit') != '-1' && ini_get('memory_limit') <= '196M' && ini_get('memory_limit') >= '128M') {
+    ini_set('memory_limit', '196M');
+  }
+
+  $demo_content = variable_get('commons_install_example_content', FALSE);
+  $acquia_connector = variable_get('commons_install_acquia_connector', FALSE);
+
+  return array(
+    'commons_acquia_connector_enable' => array(
+      'display' => FALSE,
+      'type' => '',
+      'run' => $acquia_connector ? INSTALL_TASK_RUN_IF_NOT_COMPLETED : INSTALL_TASK_SKIP,
+    ),
+    'commons_installer_palette' => array(
+      'display_name' => st('Choose site color palette'),
+      'display' => TRUE,
+      'type' => 'form',
+      'function' => 'commons_installer_palette',
+    ),
+    'commons_anonymous_message_homepage' => array(
+      'display_name' => st('Enter Homepage welcome text'),
+      'display' => TRUE,
+      'type' => 'form',
+      'function' => 'commons_anonymous_welcome_text_form'
+    ),
+    'commons_revert_features' => array(
+      'display' => FALSE,
+    ),
+    'commons_demo_content' => array(
+      'display' => FALSE,
+      'type' => '',
+      'run' => $demo_content ? INSTALL_TASK_RUN_IF_NOT_COMPLETED : INSTALL_TASK_SKIP,
+    ),
+    'commons_create_first_group' => array(
+      'display_name' => st('Create the first group'),
+      'display' => TRUE,
+      'type' => 'form',
+    ),
+    'commons_admin_permissions' => array(
+      'display' => FALSE,
+    ),
+  );
+}
+
+/**
+ * Implements hook_install_tasks_alter().
+ */
+function commons_install_tasks_alter(&$tasks, $install_state) {
+  global $install_state;
+
+  // Skip profile selection step.
+  $tasks['install_select_profile']['display'] = FALSE;
+
+  // Skip language selection install step and default language to English.
+  $tasks['install_select_locale']['display'] = FALSE;
+  $tasks['install_select_locale']['run'] = INSTALL_TASK_SKIP;
+  $install_state['parameters']['locale'] = 'en';
+
+  // Override "install_finished" task to redirect people to home page.
+  $tasks['install_finished']['function'] = 'commons_install_finished';
+}
+
+/**
+ * Override of install_finished() without the useless text.
+ */
+function commons_install_finished(&$install_state) {
+  // BEGIN copy/paste from install_finished().
+  // Remove the bookmarks flag
+  $flag = flag_get_flag('bookmarks');
+  if($flag) {
+    $flag->delete();
+    $flag->disable();
+    _flag_clear_cache();
+  }
+
+  // Flush all caches to ensure that any full bootstraps during the installer
+  // do not leave stale cached data, and that any content types or other items
+  // registered by the installation profile are registered correctly.
+  drupal_flush_all_caches();
+
+  // We make custom code for the footer here because we want people to be able to freely edit it if they wish.
+  $footer_body = '<p>'. st('A Commons Community, powered by <a href="@acquia">Acquia</a>', array('@acquia' => url('https://www.acquia.com/products-services/drupal-commons-social-business-software'))) . '</p>';
+
+  $footer_block_text = array(
+    'body' => st($footer_body),
+    'info' => st('Default Footer'),
+    'format' => 'full_html',
+  );
+
+  if (drupal_write_record('block_custom', $footer_block_text)) {
+    $footer_block = array(
+      'module' => 'block',
+      'delta' => $footer_block_text['bid'],
+      'theme' => 'commons_origins',
+      'visibility' => 0,
+      'region' => 'footer',
+      'status' => 1,
+      'pages' => 0,
+      'weight' => 1,
+      'title' => variable_get('site_name', 'Drupal Commons'),
+    );
+    drupal_write_record('block', $footer_block);
+  }
+
+  // Remember the profile which was used.
+  variable_set('install_profile', drupal_get_profile());
+
+  // Installation profiles are always loaded last
+  db_update('system')
+    ->fields(array('weight' => 1000))
+    ->condition('type', 'module')
+    ->condition('name', drupal_get_profile())
+    ->execute();
+
+  // Cache a fully-built schema.
+  drupal_get_schema(NULL, TRUE);
+
+  // Run cron to populate update status tables (if available) so that users
+  // will be warned if they've installed an out of date Drupal version.
+  // Will also trigger indexing of profile-supplied content or feeds.
+  drupal_cron_run();
+  // END copy/paste from install_finished().
+
+  if (isset($messages['error'])) {
+    $output = '<p>' . (isset($messages['error']) ? st('Review the messages above before visiting <a href="@url">your new site</a>.', array('@url' => url(''))) : st('<a href="@url">Visit your new site</a>.', array('@url' => url('')))) . '</p>';
+    return $output;
+  }
+  else {
+    // Since any module can add a drupal_set_message, this can bug the user
+    // when we redirect him to the front page. For a better user experience,
+    // remove all the message that are only "notifications" message.
+    drupal_get_messages('status', TRUE);
+    drupal_get_messages('completed', TRUE);
+
+    // If we don't install drupal using Drush, redirect the user to the front
+    // page.
+    if (!drupal_is_cli()) {
+      drupal_goto('');
+    }
+  }
+}
+
+/**
+ * Enable Acquia Connector module if selected on site configuration step.
+ */
+function commons_acquia_connector_enable() {
+  $modules = variable_get('commons_install_acquia_modules', array());
+  if (!empty($modules)) {
+    module_enable($modules, TRUE);
+  }
+}
+
+/**
+ * Allow users to select from a predefined list of color palettes during the
+ * commons installation.
+ */
+function commons_installer_palette() {
+  $form = array();
+  require_once(drupal_get_path('theme', 'commons_origins') . '/commons_origins.palettes.inc');
+
+  commons_origins_palettes_form($form);
+  $form['commons_origins_palette_fieldset']['#collapsible'] = FALSE;
+  $form['commons_origins_palette_fieldset']['#collapsed'] = FALSE;
+  $form['submit'] = array(
+    '#type' => 'submit',
+    '#value' => st('Save color palette'),
+  );
+  drupal_add_css('profiles/commons/commons_installer.css');
+
+  return $form;
+}
+
+/**
+ * Configuration form to set welcome text for the anonymous site homepage.
+ */
+function commons_anonymous_welcome_text_form() {
+  $form['commons_anonymous_welcome_explanation'] = array(
+    '#markup' => '<h2>' . st('Homepage welcome text') . '</h2>' . st("Below, enter text that will be shown on your community's homepage to help new visitors understand what your community is about and why they should join. The image below shows an example of how this text will appear. You can always change this text later."),
+    '#weight' => -1,
+  );
+  $form['commons_anonymous_welcome_example'] = array(
+    '#markup' => theme('image', array('path' => 'profiles/commons/images/commons_homepage_text_example.png', 'alt' => 'Home page example', 'alt' => 'Home page example')),
+    '#weight' => 0,
+  );
+
+  $form['commons_anonymous_welcome_title'] = array(
+    '#type' => 'textfield',
+    '#title' => st('Welcome headline'),
+    '#description' => st('A short description of the community that visitors can understand at a glance.'),
+    '#required' => TRUE,
+    '#default_value' => st('Welcome to our community'),
+  );
+
+  $form['commons_anonymous_welcome_body'] = array(
+    '#type' => 'textarea',
+    '#title' => st('Welcome body text'),
+    '#description' => st('Enter a couple of sentences elaborating about your community.'),
+    '#required' => TRUE,
+    '#default_value' => st('Share your thoughts, find answers to your questions.'),
+  );
+
+  $form['commons_install_example_content'] = array(
+    '#type' => 'checkbox',
+    '#title' => st('Install example content'),
+    '#description' => st('Install Commons with example content so that you can get a sense of what your site will look like once it becomes more active. Example content includes a group, a few users and content for that group. Example content can be modified or deleted like normal content.'),
+    '#default_value' => TRUE
+  );
+
+  $form['commons_anonymous_welcome_submit'] = array(
+    '#type'  => 'submit',
+    '#value' => st('Save and continue')
+  );
+
+  return $form;
+}
+
+/**
+ * Save the configuration form for set welcome text for anonymous users.
+ * @see commons_anonymous_welcome_text_form()
+ */
+function commons_anonymous_welcome_text_form_submit($form_id, &$form_state) {
+  variable_set('commons_anonymous_welcome_title', $form_state['values']['commons_anonymous_welcome_title']);
+  variable_set('commons_anonymous_welcome_body', $form_state['values']['commons_anonymous_welcome_body']);
+  variable_set('commons_install_example_content', $form_state['values']['commons_install_example_content']);
+}
+
+/*
+ * Revert Features after the installation.
+ */
+function commons_revert_features() {
+  // Revert Features components to ensure that they are in their default states.
+  $revert = array(
+    'commons_follow' => array('field_base'),
+    'commons_groups' => array('field_instance', 'field_base'),
+    'commons_trusted_contacts' => array('field_instance', 'field_base'),
+    'commons_wikis' => array('og_features_permission'),
+    'commons_wysiwyg' => array('user_permission', 'ckeditor_profile'),
+    'commons_events' => array('og_features_permission' , 'field_base'),
+    'commons_polls' => array('og_features_permission'),
+    'commons_q_a' => array('og_features_permission', 'field_base'),
+    'commons_posts' => array('og_features_permission'),
+  );
+
+  features_revert($revert);
+}
+
+/**
+ * This function generates demo content.
+ */
+function commons_demo_content() {
+
+  // Reset the Flag cache.
+  flag_get_flags(NULL, NULL, NULL, TRUE);
+
+  // Create demo Users
+  $demo_users = array(
+    'Jeff Noyes' => 'Jeff Noyes',
+    'Drew Robertson' => 'Drew Robertson',
+    'Lisa Rex' => 'Lisa Rex',
+    'Katelyn Fogarty' => 'Katelyn Fogarty',
+    'Dharmesh Mistry' => 'Dharmesh Mistry',
+    'Erica Ligeski' => 'Erica Ligeski',
+  );
+
+  foreach ($demo_users as $name) {
+    list($first_name, $last_name)  = explode(" ", $name);
+    $normalize_name = commons_normalize_name($name);
+    $password = user_password(8);
+
+    $fields = array(
+      'name' => $name,
+      'mail' => "{$normalize_name}@example.com",
+      'pass' => $password,
+      'status' => 1,
+      'init' => "{$normalize_name}@example.com",
+      'roles' => array(
+        DRUPAL_AUTHENTICATED_RID => 'authenticated user'
+      ),
+    );
+
+    $fields['field_name_first'][LANGUAGE_NONE][0]['value'] = $first_name;
+    $fields['field_name_last'][LANGUAGE_NONE][0]['value'] = $last_name;
+
+    $demo_users[$name] = user_save('', $fields);
+
+    // Add avatars to demo Users.
+    commons_add_user_avatar($demo_users[$name]);
+  }
+
+  // Demo Content.
+
+  // Group: Boston
+  $boston_group = new stdClass();
+  $boston_group->type = 'group';
+  node_object_prepare($boston_group);
+
+  $boston_group->title = 'Boston';
+  $boston_group->body[LANGUAGE_NONE][0]['value'] = commons_veggie_ipsum();
+  $boston_group->uid = $demo_users['Jeff Noyes']->uid;
+  $boston_group->language = LANGUAGE_NONE;
+  $boston_group->created = time() - 604800;
+  $boston_group->status = 1;
+  node_save($boston_group);
+
+  // Group: New York City
+  $nyc_group = new stdClass();
+  $nyc_group->type = 'group';
+  node_object_prepare($nyc_group);
+
+  $nyc_group->title = 'New York City';
+  $nyc_group->body[LANGUAGE_NONE][0]['value'] = commons_veggie_ipsum();
+  $nyc_group->uid = $demo_users['Drew Robertson']->uid;
+  $nyc_group->language = LANGUAGE_NONE;
+  $nyc_group->status = 1;
+  // Make the group 1 week old:
+  $nyc_group->created = time() - 604800;
+  node_save($nyc_group);
+
+
+  // Post: Best brunch places in Cambridge
+  $post = new stdClass();
+  $post->type = 'post';
+  node_object_prepare($post);
+
+  $post->title = 'Best brunch places in Cambridge';
+  $post->uid = $demo_users['Lisa Rex']->uid;
+  $post->language = LANGUAGE_NONE;
+  // 1:30 ago.
+  $post->created = time() - 5400;
+  $post->body[LANGUAGE_NONE][0]['value'] = "My aunt and I have been trying a lot of brunch places in Cambridge. Here's our favorites: <ul><li>North Street Grille for their breads
+<li>Mixtura for the souffles
+<li>The Neighborhood Restaurant for the vast quantities of food
+<li>City Girl Cafe for the ambiance <li>Bom Cafe for granola";
+  $post->body[LANGUAGE_NONE][0]['format'] = filter_default_format();
+
+  $post->og_group_ref[LANGUAGE_NONE][0]['target_id'] = $boston_group->nid;
+  $post->field_radioactivity[LANGUAGE_NONE][0]['radioactivity_energy'] = 8;
+
+  $terms = array(
+    'brunch',
+    'Cambridge',
+    'dining out'
+  );
+
+  foreach ($terms as $term) {
+    $post->field_topics[LANGUAGE_NONE][]['tid'] = commons_create_topic($term);
+  }
+
+  node_save($post);
+
+  // Wiki: How to create a veggie burger
+  $wiki = new stdClass();
+  $wiki->type = 'wiki';
+  node_object_prepare($wiki);
+  $wiki->created = time() - 604800;
+  $wiki->title = 'How to create a veggie burger';
+  $wiki->uid = $demo_users['Dharmesh Mistry']->uid;
+  $wiki->language = LANGUAGE_NONE;
+  $wiki->body[LANGUAGE_NONE][0]['value'] = "Celtuce quandong gumbo coriander avocado yarrow broccoli rabe parsnip nori mung bean watercress taro pea sprouts cress. Bush tomato water spinach radish green bean okra spinach garlic cress. Cucumber squash tigernut swiss chard celery cabbage beet greens nori groundnut grape melon seakale. Earthnut pea kakadu plum chicory potato plantain fennel gumbo chickweed gourd cauliflower wakame green bean epazote taro quandong. Celery turnip kombu lotus root lettuce sierra leone bologi kale cauliflower gumbo parsnip taro welsh onion melon asparagus green bean beet greens black-eyed pea jÃ­cama. Kohlrabi lentil turnip greens plantain bush tomato leek arugula courgette amaranth yarrow.";
+  $wiki->body[LANGUAGE_NONE][0]['format'] = filter_default_format();
+
+  $wiki->og_group_ref[LANGUAGE_NONE][0]['target_id'] = $boston_group->nid;
+  $wiki->field_radioactivity[LANGUAGE_NONE][0]['radioactivity_energy'] = 8;
+
+  $terms = array(
+    'vegetarian',
+    'casual',
+    'meal',
+    'recipe'
+  );
+
+  foreach ($terms as $term) {
+    $wiki->field_topics[LANGUAGE_NONE][]['tid'] = commons_create_topic($term);
+  }
+
+  node_save($wiki);
+
+  // Event: Ribfest Boston 2012
+  $event = new stdClass();
+  $event->type = 'event';
+  node_object_prepare($event);
+
+  $event->title = 'Ribfest Boston 2012';
+  $event->uid = $demo_users['Katelyn Fogarty']->uid;
+  $event->language = LANGUAGE_NONE;
+  $event->body[LANGUAGE_NONE][0]['value'] = "<strong>What ignited in 1999 as a community block party has exploded into one of Boston's most anticipated street festivals.</strong> Averaging 50,000 pounds of ribs and BBQ from more than 30 restaurants, Ribfest Boston 2013 is expected to draw more than 50,000 people. As a nationally recognized music festival, we host a hot blend of Indie, pop, Indie Roots, rock and alt country for one of the most unique band lineups in the city. Families can spend the whole weekend in Kids Square to enjoy live entertainment, inflatables, games and more.";
+  $event->body[LANGUAGE_NONE][0]['format'] = filter_default_format();
+  $event->og_group_ref[LANGUAGE_NONE][0]['target_id'] = $boston_group->nid;
+  $terms = array(
+    'bbq',
+    'music',
+    'festival'
+  );
+
+  foreach ($terms as $term) {
+    $event->field_topics[LANGUAGE_NONE][]['tid'] = commons_create_topic($term);
+  }
+
+  $event->field_date[LANGUAGE_NONE][0]['value'] = '2014-01-12 10:00:00';
+  $event->field_date[LANGUAGE_NONE][0]['value2'] = '2014-01-13 13:00:00';
+
+  $event->field_address[LANGUAGE_NONE][0]['thoroughfare'] = '25 Corporate Drive';
+  $event->field_address[LANGUAGE_NONE][0]['premise'] = '4th floor';
+  $event->field_address[LANGUAGE_NONE][0]['postal_code'] = '01803';
+  $event->field_address[LANGUAGE_NONE][0]['country'] = 'US';
+  $event->field_address[LANGUAGE_NONE][0]['location'] = 'Waterfront';
+  $event->field_address[LANGUAGE_NONE][0]['administrative_area']  = 'MA';
+  $event->field_address[LANGUAGE_NONE][0]['locality'] = 'Boston';
+  $event->og_group_ref[LANGUAGE_NONE][0]['target_id'] = $boston_group->nid;
+  node_save($event);
+
+  // Don't display the 'registration settings have been saved' message.
+  drupal_get_messages('status', TRUE);
+  drupal_get_messages('completed', TRUE);
+
+  // Delete the demo content variable
+  variable_del('commons_install_example_content');
+
+  // Make sure the admin user is also a group.
+  // @todo: Move to a better place.
+  $wrapper = entity_metadata_wrapper('user', 1);
+  $wrapper->{OG_GROUP_FIELD}->set(TRUE);
+  $wrapper->save();
+}
+
+/**
+ * Let the admin user create the first group as part of the installation process.
+ */
+function commons_create_first_group() {
+  $form['commons_first_group_explanation'] = array(
+    '#markup' => '<h2>' . st('Create the first group in your new community.') . '</h2>' . st("Commons uses groups to collect community members and content related to a particular interest, working goal or geographic area."),
+    '#weight' => -1,
+  );
+
+  $form['commons_fist_group_example'] = array(
+    '#markup' => theme('image', array('path' => 'profiles/commons/images/commons_group_description_sample.png', 'alt' => 'Group description page example', 'alt' => 'Group description example')),
+    '#weight' => 0,
+  );
+
+  $form['commons_first_group_title'] = array(
+    '#type' => 'textfield',
+    '#title' => st("Group name"),
+    '#description' => st('For example: "Boston food lovers" or "Engineering team."'),
+    '#required' => TRUE,
+    '#default_value' => st('Engineering team'),
+  );
+
+  $form['commons_first_group_body'] = array(
+    '#type' => 'textarea',
+    '#title' => st('Group description'),
+    '#description' => st("This text will appear on the group's homepage and helps new contributors to become familiar with the purpose of the group. You can always change this text or add another group later."),
+    '#required' => TRUE,
+    '#default_value' => st('The online home for our Engineering team'),
+  );
+
+  $form['commons_first_group_submit'] = array(
+    '#type'  => 'submit',
+    '#value' => st('Save and continue')
+  );
+
+  return $form;
+}
+
+/**
+ * Save the first group form.
  *
- * Perform actions to set up the site for this profile.
+ * @see commons_create_first_group().
+ */
+function commons_create_first_group_submit($form_id, &$form_state) {
+  $values = $form_state['values'];
+
+  $first_group = new stdClass();
+  $first_group->type = 'group';
+  node_object_prepare($first_group);
+
+  $first_group->title = $values['commons_first_group_title'];
+  $first_group->body[LANGUAGE_NONE][0]['value'] = $values['commons_first_group_body'];
+  $first_group->uid = 1;
+  $first_group->language = LANGUAGE_NONE;
+  $first_group->status = 1;
+  node_save($first_group);
+}
+
+function commons_admin_permissions() {
+  //get the administrator role, we set this in the install file
+  $admin_role = user_role_load_by_name('administrator');
+  user_role_grant_permissions($admin_role->rid, array_keys(module_invoke_all('permission')));
+}
+
+function commons_add_user_avatar($account) {
+  global $base_url;
+
+  if ($account->uid) {
+    $picture_directory =  file_default_scheme() . '://' . variable_get('user_picture_path', 'pictures');
+    if(file_prepare_directory($picture_directory, FILE_CREATE_DIRECTORY)){
+      $picture_result = drupal_http_request($base_url . '/profiles/commons/images/avatars/avatar-' . commons_normalize_name($account->name) . '.png');
+      $picture_path = file_stream_wrapper_uri_normalize($picture_directory . '/picture-' . $account->uid . '-' . REQUEST_TIME . '.jpg');
+      $picture_file = file_save_data($picture_result->data, $picture_path, FILE_EXISTS_REPLACE);
+
+      // Check to make sure the picture isn't too large for the site settings.
+      $validators = array(
+        'file_validate_is_image' => array(),
+        'file_validate_image_resolution' => array(variable_get('user_picture_dimensions', '85x85')),
+        'file_validate_size' => array(variable_get('user_picture_file_size', '30') * 1024),
+      );
+
+      // attach photo to user's account.
+      $errors = file_validate($picture_file, $validators);
+
+      if (empty($errors)) {
+        // Update the user record.
+        $picture_file->uid = $account->uid;
+        $picture_file = file_save($picture_file);
+        file_usage_add($picture_file, 'user', 'user', $account->uid);
+        db_update('users')
+          ->fields(array(
+            'picture' => $picture_file->fid,
+          ))
+          ->condition('uid', $account->uid)
+          ->execute();
+        $account->picture = $picture_file->fid;
+      }
+    }
+  }
+}
+
+/**
+ * Helper function to generate a machine name similar to the user's full name.
+ */
+function commons_normalize_name($name) {
+  return drupal_strtolower(str_replace(' ','_', $name));
+}
+
+/**
+ * Generate some filler content.
+ */
+function commons_veggie_ipsum() {
+  $content = "Veggies sunt bona vobis, proinde vos postulo esse magis spinach kale scallion lettuce cucumber black-eyed pea onion.
+
+Bamboo shoot green bean wattle seed okra kakadu plum peanut ricebean celtuce. Azuki bean desert raisin bush tomato turnip peanut sweet pepper courgette horseradish. Garlic kombu beet greens celery courgette carrot mung bean.";
+  return $content;
+}
+
+/**
+ * This function create a taxonomy topic, is used for create a demo content for
+ * a new installations of Drupal Commons.
  *
- * @see system_install()
+ * @see commons_demo_content().
+ */
+function commons_create_topic($topic_name = '') {
+  $term = new stdClass();
+  $term->name = $topic_name;
+  $term->vid = 1;
+  // Pathauto aliasing can cause a menu_rebuild(), causing the request to
+  // exceeed the max execution time. Specify a manual alias instead.
+  // http://drupal.org/node/1867172.
+  $term->path['pathauto'] = FALSE;
+  taxonomy_term_save($term);
+  $path = array(
+    'source' => 'taxonomy/term/' . $term->tid,
+    'alias' => 'topics/' . drupal_html_class($topic_name),
+  );
+  path_save($path);
+  return $term->tid;
+}
+
+/**
+ * Implements hook_install().
  */
 function commons_install() {
   // Enable the Origins theme and set it as the default.
-  theme_enable(array('adaptivetheme', 'commons_origins', 'adaptivetheme_admin'));
+  theme_enable(array('adaptivetheme', 'commons_origins'));
 
     // The Bartik theme is automatically enabled during installation. Disable it.
   db_update('system')
@@ -50,7 +636,7 @@ function commons_install() {
   // Set the default and administration themes.
   variable_set('theme_default', 'commons_origins');
   // Set a default administrative theme:
-  variable_set('admin_theme', 'adaptivetheme_admin');
+  variable_set('admin_theme', 'ember');
   variable_set('node_admin_theme', FALSE);
 
   // Do not use the administration theme when editing or creating content.
@@ -85,19 +671,6 @@ function commons_install() {
   );
   drupal_write_record('block', $search_block);
 
-  // Create a default role for site administrators, with all available permissions assigned.
-  $admin_role = new stdClass();
-  $admin_role->name = 'administrator';
-  $admin_role->weight = 2;
-  user_role_save($admin_role);
-  // Set this as the administrator role.
-  variable_set('user_admin_role', $admin_role->rid);
-
-  // Assign user 1 the "administrator" role.
-  db_insert('users_roles')
-    ->fields(array('uid' => 1, 'rid' => $admin_role->rid))
-    ->execute();
-
   // AdaptiveTheme requires that the system theme settings form
   // be submitted in order for its themes' settings to be properly set
   // and the resulting css files generated.
@@ -112,6 +685,35 @@ function commons_install() {
 }
 
 /**
+ * Set a default user avatar as a managed file object.
+ */
+function commons_set_default_avatar() {
+  global $base_url;
+  $picture_directory =  file_default_scheme() . '://' . variable_get('user_picture_path', 'pictures');
+  if(file_prepare_directory($picture_directory, FILE_CREATE_DIRECTORY)){
+    $picture_result = drupal_http_request($base_url . '/profiles/commons/images/avatars/user-avatar.png');
+    $picture_path = file_stream_wrapper_uri_normalize($picture_directory . '/picture-default.jpg');
+    $picture_file = file_save_data($picture_result->data, $picture_path, FILE_EXISTS_REPLACE);
+
+    // Check to make sure the picture isn't too large for the site settings.
+    $validators = array(
+      'file_validate_is_image' => array(),
+      'file_validate_image_resolution' => array(variable_get('user_picture_dimensions', '85x85')),
+      'file_validate_size' => array(variable_get('user_picture_file_size', '30') * 1024),
+    );
+
+    // attach photo to user's account.
+    $errors = file_validate($picture_file, $validators);
+
+    if (empty($errors)) {
+      // Update the user record.
+      $picture_file = file_save($picture_file);
+      variable_set('user_picture_default', $picture_path);
+    }
+  }
+}
+
+/**
  * Enable the Origins theme and set it as the default. *
  */
 function commons_update_3101() {
@@ -220,4 +822,39 @@ function commons_update_3108() {
   );
   features_revert($revert);
   return array();
-}
\ No newline at end of file
+}
+
+/**
+ * Replace the Placeholder module with the Elements module.
+ */
+function commons_update_3109() {
+  if (module_exists('placeholder')) {
+    module_disable(array('placeholder'));
+  }
+  module_enable(array('elements'));
+  return array();
+}
+
+/**
+ * Change the administration theme to Ember.
+ */
+function commons_update_3111() {
+  variable_set('admin_theme', 'ember');
+  return array();
+}
+
+/*
+ * Revert Message types to use the correct title field token.
+ */
+function commons_update_3112() {
+  $revert = array(
+    'commons_wikis' => array('message_type'),
+    'commons_q_a' => array('message_type'),
+    'commons_posts' => array('message_type'),
+    'commons_notify' => array('message_type'),
+    'commons_like' => array('message_type'),
+    'commons_activity_streams' => array('message_type'),
+  );
+  features_revert($revert);
+  return array();
+}
diff --git a/commons.profile b/commons.profile
index 4e3f4cf..cb67f82 100644
--- a/commons.profile
+++ b/commons.profile
@@ -1,4 +1,5 @@
 <?php
+
 /**
  * @file
  * Enables modules and site configuration for a Commons site installation.
@@ -9,6 +10,11 @@
  */
 define('DRUPAL_MINIMUM_MAX_EXECUTION_TIME', 120);
 
+/*
+ * Define commons minimum APC cache required to operate.
+ */
+define('COMMONS_MINIMUM_APC_CACHE', 96);
+
 /**
  * Implements hook_admin_paths_alter().
  */
@@ -19,21 +25,42 @@ function commons_admin_paths_alter(&$paths) {
 }
 
 /**
- * Implements hook_install_tasks_alter().
+ * Implements hook_update_projects_alter().
  */
-function commons_install_tasks_alter(&$tasks, $install_state) {
-  global $install_state;
-
-  // Skip profile selection step.
-  $tasks['install_select_profile']['display'] = FALSE;
-
-  // Skip language selection install step and default language to English.
-  $tasks['install_select_locale']['display'] = FALSE;
-  $tasks['install_select_locale']['run'] = INSTALL_TASK_SKIP;
-  $install_state['parameters']['locale'] = 'en';
+function commons_update_projects_alter(&$projects) {
+  // Enable update status for the Commons profile.
+  $modules = system_rebuild_module_data();
+  // The module object is shared in the request, so we need to clone it here.
+  $commons = clone $modules['commons'];
+  $commons->info['hidden'] = FALSE;
+  _update_process_info_list($projects, array('commons' => $commons), 'module', TRUE);
+}
 
-  // Override "install_finished" task to redirect people to home page.
-  $tasks['install_finished']['function'] = 'commons_install_finished';
+/**
+ * Get Commons entity integration information.
+ *
+ * @param $entity_type
+ *   (optional) The entity type to load, e.g. node or user.
+ *
+ * @return
+ *   An associative array of entity integrations whose keys define the entity
+ *   type for each integration and whose values contain the bundles which have
+ *   been integrated. Each bundle is itself an associative array, whose keys
+ *   define the type of integration to enable and whose values contain the
+ *   status of the integration. TRUE = enabled, FALSE = disabled.
+ */
+function commons_entity_integration_info($entity_type = NULL) {
+  $info = &drupal_static(__FUNCTION__);
+  if (!$info) {
+    $info = module_invoke_all('commons_entity_integration');
+    drupal_alter('commons_entity_integration', $info);
+  }
+  if ($entity_type) {
+    return isset($info[$entity_type]) ? $info[$entity_type] : array();
+  }
+  else {
+    return $info;
+  }
 }
 
 /**
@@ -42,8 +69,10 @@ function commons_install_tasks_alter(&$tasks, $install_state) {
  * Allows the profile to alter the site configuration form.
  */
 function commons_form_install_configure_form_alter(&$form, $form_state) {
-  // Flush all 'notification' messages, no need to show them to the user.
-  commons_clear_messages();
+  // Clear all non-error messages that might be set by enabled modules
+  drupal_get_messages('status', TRUE);
+  drupal_get_messages('completed', TRUE);
+
   // Pre-populate the site name with the server name.
   $form['site_information']['site_name']['#default_value'] = $_SERVER['SERVER_NAME'];
 
@@ -96,175 +125,6 @@ function commons_form_install_configure_form_alter(&$form, $form_state) {
   $form['#submit'][] = 'commons_check_acquia_connector';
 }
 
-
-/**
- * Implements hook_update_projects_alter().
- */
-function commons_update_projects_alter(&$projects) {
-  // Enable update status for the Commons profile.
-  $modules = system_rebuild_module_data();
-  // The module object is shared in the request, so we need to clone it here.
-  $commons = clone $modules['commons'];
-  $commons->info['hidden'] = FALSE;
-  _update_process_info_list($projects, array('commons' => $commons), 'module', TRUE);
-}
-
-/**
- * Implements hook_install_tasks().
- *
- * Allows the user to set a welcome message for anonymous users
- */
-function commons_install_tasks() {
-  // Suppress any status messages generated during batch install.
-  commons_clear_messages();
-
-  //make sure we have more memory than 196M. if not lets try to increase it.
-  if (ini_get('memory_limit') != '-1' && ini_get('memory_limit') <= '196M' && ini_get('memory_limit') >= '128M') {
-    ini_set('memory_limit', '196M');
-  }
-
-  $demo_content = variable_get('commons_install_example_content', FALSE);
-  $acquia_connector = variable_get('commons_install_acquia_connector', FALSE);
-
-  return array(
-    'commons_acquia_connector_enable' => array(
-      'display' => FALSE,
-      'type' => '',
-      'run' => $acquia_connector ? INSTALL_TASK_RUN_IF_NOT_COMPLETED : INSTALL_TASK_SKIP,
-    ),
-    'commons_installer_palette' => array(
-      'display_name' => st('Choose site color palette'),
-      'display' => TRUE,
-      'type' => 'form',
-      'function' => 'commons_installer_palette',
-    ),
-    'commons_anonymous_message_homepage' => array(
-      'display_name' => st('Enter Homepage welcome text'),
-      'display' => TRUE,
-      'type' => 'form',
-      'function' => 'commons_anonymous_welcome_text_form'
-    ),
-    'commons_revert_features' => array(
-      'display' => FALSE,
-    ),
-    'commons_demo_content' => array(
-      'display' => FALSE,
-      'type' => '',
-      'run' => $demo_content ? INSTALL_TASK_RUN_IF_NOT_COMPLETED : INSTALL_TASK_SKIP,
-    ),
-    'commons_create_first_group' => array(
-      'display_name' => st('Create the first group'),
-      'display' => TRUE,
-      'type' => 'form',
-    ),
-    'commons_admin_permissions' => array(
-      'display' => FALSE,
-    ),
-  );
-}
-
-/**
- * Allow users to select from a predefined list of color palettes during
- * the commons installation.
- */
-function commons_installer_palette() {
-  $form = array();
-  require_once(drupal_get_path('theme', 'commons_origins') . '/commons_origins.palettes.inc');
-
-  commons_origins_palettes_form($form);
-  $form['commons_origins_palette_fieldset']['#collapsible'] = FALSE;
-  $form['commons_origins_palette_fieldset']['#collapsed'] = FALSE;
-  $form['submit'] = array(
-    '#type' => 'submit',
-    '#value' => st('Save color palette'),
-  );
-  drupal_add_css('profiles/commons/commons_installer.css');
-
-  return $form;
-}
-/**
- * Let the admin user create the first group as part of the installation process
- */
-function commons_create_first_group() {
-  $form['commons_first_group_explanation'] = array(
-    '#markup' => '<h2>' . st('Create the first group in your new community.') . '</h2>' . st("Commons uses groups to collect community members and content related to a particular interest, working goal or geographic area."),
-    '#weight' => -1,
-  );
-
-  $form['commons_fist_group_example'] = array(
-    '#markup' => theme('image', array('path' => 'profiles/commons/images/commons_group_description_sample.png', 'alt' => 'Group description page example', 'alt' => 'Group description example')),
-    '#weight' => 0,
-  );
-
-  $form['commons_first_group_title'] = array(
-    '#type' => 'textfield',
-    '#title' => st("Group name"),
-    '#description' => st('For example: "Boston food lovers" or "Engineering team."'),
-    '#required' => TRUE,
-    '#default_value' => st('Engineering team'),
-  );
-
-  $form['commons_first_group_body'] = array(
-    '#type' => 'textarea',
-    '#title' => st('Group description'),
-    '#description' => st("This text will appear on the group's homepage and helps new contributors to become familiar with the purpose of the group. You can always change this text or add another group later."),
-    '#required' => TRUE,
-    '#default_value' => st('The online home for our Engineering team'),
-  );
-
-  $form['commons_first_group_submit'] = array(
-    '#type'  => 'submit',
-    '#value' => st('Save and continue')
-  );
-
-  return $form;
-}
-
-/**
- * Save the first group form
- *
- * @see commons_create_first_group().
- */
-function commons_create_first_group_submit($form_id, &$form_state) {
-  $values = $form_state['values'];
-
-  $first_group = new stdClass();
-  $first_group->type = 'group';
-  node_object_prepare($first_group);
-
-  $first_group->title = $values['commons_first_group_title'];
-  $first_group->body[LANGUAGE_NONE][0]['value'] = $values['commons_first_group_body'];
-  $first_group->uid = 1;
-  $first_group->language = LANGUAGE_NONE;
-  $first_group->status = 1;
-  node_save($first_group);
-}
-
-/*
- * Revert Features after the installation.
- */
-function commons_revert_features() {
-  // Revert Features components to ensure that they are in their default states.
-  $revert = array(
-    'commons_follow' => array('field_base'),
-    'commons_groups' => array('field_instance', 'field_base'),
-    'commons_trusted_contacts' => array('field_instance', 'field_base'),
-    'commons_wikis' => array('og_features_permission'),
-    'commons_wysiwyg' => array('user_permission', 'ckeditor_profile'),
-    'commons_events' => array('og_features_permission' , 'field_base'),
-    'commons_polls' => array('og_features_permission'),
-    'commons_q_a' => array('og_features_permission', 'field_base'),
-    'commons_posts' => array('og_features_permission'),
-  );
-  features_revert($revert);
-}
-
-function commons_admin_permissions() {
-  //get the administrator role, we set this in the install file
-  $admin_role = user_role_load_by_name('administrator');
-  user_role_grant_permissions($admin_role->rid, array_keys(module_invoke_all('permission')));
-}
-
 /**
  * Save the full name of the first user.
  */
@@ -290,441 +150,3 @@ function commons_check_acquia_connector($form_id, &$form_state) {
     variable_set('commons_install_acquia_modules', array_keys($options));
   }
 }
-
-/**
- * Configuration form to set welcome text for the anonymous site homepage.
- */
-function commons_anonymous_welcome_text_form() {
-  $form['commons_anonymous_welcome_explanation'] = array(
-    '#markup' => '<h2>' . st('Homepage welcome text') . '</h2>' . st("Below, enter text that will be shown on your community's homepage to help new visitors understand what your community is about and why they should join. The image below shows an example of how this text will appear. You can always change this text later."),
-    '#weight' => -1,
-  );
-  $form['commons_anonymous_welcome_example'] = array(
-    '#markup' => theme('image', array('path' => 'profiles/commons/images/commons_homepage_text_example.png', 'alt' => 'Home page example', 'alt' => 'Home page example')),
-    '#weight' => 0,
-  );
-
-  $form['commons_anonymous_welcome_title'] = array(
-    '#type' => 'textfield',
-    '#title' => st('Welcome headline'),
-    '#description' => st('A short description of the community that visitors can understand at a glance.'),
-    '#required' => TRUE,
-    '#default_value' => st('Welcome to our community'),
-  );
-
-  $form['commons_anonymous_welcome_body'] = array(
-    '#type' => 'textarea',
-    '#title' => st('Welcome body text'),
-    '#description' => st('Enter a couple of sentences elaborating about your community.'),
-    '#required' => TRUE,
-    '#default_value' => st('Share your thoughts, find answers to your questions.'),
-  );
-
-  $form['commons_install_example_content'] = array(
-    '#type' => 'checkbox',
-    '#title' => st('Install example content'),
-    '#description' => st('Install Commons with example content so that you can get a sense of what your site will look like once it becomes more active. Example content includes a group, a few users and content for that group. Example content can be modified or deleted like normal content.'),
-    '#default_value' => TRUE
-  );
-
-  $form['commons_anonymous_welcome_submit'] = array(
-    '#type'  => 'submit',
-    '#value' => st('Save and continue')
-  );
-
-  return $form;
-}
-
-/**
- * Save the configuration form for set welcome text for anonymous users
- * @see commons_anonymous_welcome_text_form()
- */
-function commons_anonymous_welcome_text_form_submit($form_id, &$form_state) {
-  variable_set('commons_anonymous_welcome_title', $form_state['values']['commons_anonymous_welcome_title']);
-  variable_set('commons_anonymous_welcome_body', $form_state['values']['commons_anonymous_welcome_body']);
-  variable_set('commons_install_example_content', $form_state['values']['commons_install_example_content']);
-}
-
-/**
- * Helper function to generate a machine name similar to the user's full name.
- */
-function commons_normalize_name($name) {
-  return drupal_strtolower(str_replace(' ','_', $name));
-}
-/**
- * This function generate a demo content
- */
-function commons_demo_content() {
-
-  // Reset the Flag cache.
-  flag_get_flags(NULL, NULL, NULL, TRUE);
-
-  // Create demo Users
-  $demo_users = array(
-    'Jeff Noyes' => 'Jeff Noyes',
-    'Drew Robertson' => 'Drew Robertson',
-    'Lisa Rex' => 'Lisa Rex',
-    'Katelyn Fogarty' => 'Katelyn Fogarty',
-    'Dharmesh Mistry' => 'Dharmesh Mistry',
-    'Erica Ligeski' => 'Erica Ligeski',
-  );
-
-
-  foreach ($demo_users as $name) {
-    list($first_name, $last_name)  = explode(" ", $name);
-    $normalize_name = commons_normalize_name($name);
-    $password = user_password(8);
-
-
-    $fields = array(
-      'name' => $name,
-      'mail' => "{$normalize_name}@example.com",
-      'pass' => $password,
-      'status' => 1,
-      'init' => "{$normalize_name}@example.com",
-      'roles' => array(
-        DRUPAL_AUTHENTICATED_RID => 'authenticated user'
-      ),
-    );
-
-    $fields['field_name_first'][LANGUAGE_NONE][0]['value'] = $first_name;
-    $fields['field_name_last'][LANGUAGE_NONE][0]['value'] = $last_name;
-
-    $demo_users[$name] = user_save('', $fields);
-
-    // Add avatars to demo Users.
-    commons_add_user_avatar($demo_users[$name]);
-  }
-
-  // Demo Content.
-
-  // Group: Boston
-  $boston_group = new stdClass();
-  $boston_group->type = 'group';
-  node_object_prepare($boston_group);
-
-  $boston_group->title = 'Boston';
-  $boston_group->body[LANGUAGE_NONE][0]['value'] = commons_veggie_ipsum();
-  $boston_group->uid = $demo_users['Jeff Noyes']->uid;
-  $boston_group->language = LANGUAGE_NONE;
-  $boston_group->created = time() - 604800;
-  $boston_group->status = 1;
-  node_save($boston_group);
-
-  // Group: New York City
-  $nyc_group = new stdClass();
-  $nyc_group->type = 'group';
-  node_object_prepare($nyc_group);
-
-  $nyc_group->title = 'New York City';
-  $nyc_group->body[LANGUAGE_NONE][0]['value'] = commons_veggie_ipsum();
-  $nyc_group->uid = $demo_users['Drew Robertson']->uid;
-  $nyc_group->language = LANGUAGE_NONE;
-  $nyc_group->status = 1;
-  // Make the group 1 week old:
-  $nyc_group->created = time() - 604800;
-  node_save($nyc_group);
-
-
-  // Post: Best brunch places in Cambridge
-  $post = new stdClass();
-  $post->type = 'post';
-  node_object_prepare($post);
-
-  $post->title = 'Best brunch places in Cambridge';
-  $post->uid = $demo_users['Lisa Rex']->uid;
-  $post->language = LANGUAGE_NONE;
-  // 1:30 ago.
-  $post->created = time() - 5400;
-  $post->body[LANGUAGE_NONE][0]['value'] = "My aunt and I have been trying a lot of brunch places in Cambridge. Here's our favorites: <ul><li>North Street Grille for their breads
-<li>Mixtura for the souffles
-<li>The Neighborhood Restaurant for the vast quantities of food
-<li>City Girl Cafe for the ambiance <li>Bom Cafe for granola";
-  $post->body[LANGUAGE_NONE][0]['format'] = filter_default_format();
-
-  $post->og_group_ref[LANGUAGE_NONE][0]['target_id'] = $boston_group->nid;
-  $post->field_radioactivity[LANGUAGE_NONE][0]['radioactivity_energy'] = 8;
-
-  $terms = array(
-    'brunch',
-    'Cambridge',
-    'dining out'
-  );
-
-  foreach ($terms as $term) {
-    $post->field_topics[LANGUAGE_NONE][]['tid'] = commons_create_topic($term);
-  }
-
-  node_save($post);
-
-
-  // Wiki: How to create a veggie burger
-  $wiki = new stdClass();
-  $wiki->type = 'wiki';
-  node_object_prepare($wiki);
-  $wiki->created = time() - 604800;
-  $wiki->title = 'How to create a veggie burger';
-  $wiki->uid = $demo_users['Dharmesh Mistry']->uid;
-  $wiki->language = LANGUAGE_NONE;
-  $wiki->body[LANGUAGE_NONE][0]['value'] = "Celtuce quandong gumbo coriander avocado yarrow broccoli rabe parsnip nori mung bean watercress taro pea sprouts cress. Bush tomato water spinach radish green bean okra spinach garlic cress. Cucumber squash tigernut swiss chard celery cabbage beet greens nori groundnut grape melon seakale. Earthnut pea kakadu plum chicory potato plantain fennel gumbo chickweed gourd cauliflower wakame green bean epazote taro quandong. Celery turnip kombu lotus root lettuce sierra leone bologi kale cauliflower gumbo parsnip taro welsh onion melon asparagus green bean beet greens black-eyed pea jÃ­cama. Kohlrabi lentil turnip greens plantain bush tomato leek arugula courgette amaranth yarrow.";
-  $wiki->body[LANGUAGE_NONE][0]['format'] = filter_default_format();
-
-  $wiki->og_group_ref[LANGUAGE_NONE][0]['target_id'] = $boston_group->nid;
-  $wiki->field_radioactivity[LANGUAGE_NONE][0]['radioactivity_energy'] = 8;
-
-  $terms = array(
-    'vegetarian',
-    'casual',
-    'meal',
-    'recipe'
-  );
-
-  foreach ($terms as $term) {
-    $wiki->field_topics[LANGUAGE_NONE][]['tid'] = commons_create_topic($term);
-  }
-
-  node_save($wiki);
-
-  // Event: Ribfest Boston 2012
-  $event = new stdClass();
-  $event->type = 'event';
-  node_object_prepare($event);
-
-  $event->title = 'Ribfest Boston 2012';
-  $event->uid = $demo_users['Katelyn Fogarty']->uid;
-  $event->language = LANGUAGE_NONE;
-  $event->body[LANGUAGE_NONE][0]['value'] = "<strong>What ignited in 1999 as a community block party has exploded into one of Boston's most anticipated street festivals.</strong> Averaging 50,000 pounds of ribs and BBQ from more than 30 restaurants, Ribfest Boston 2013 is expected to draw more than 50,000 people. As a nationally recognized music festival, we host a hot blend of Indie, pop, Indie Roots, rock and alt country for one of the most unique band lineups in the city. Families can spend the whole weekend in Kids Square to enjoy live entertainment, inflatables, games and more.";
-  $event->body[LANGUAGE_NONE][0]['format'] = filter_default_format();
-  $event->og_group_ref[LANGUAGE_NONE][0]['target_id'] = $boston_group->nid;
-  $terms = array(
-    'bbq',
-    'music',
-    'festival'
-  );
-
-  foreach ($terms as $term) {
-    $event->field_topics[LANGUAGE_NONE][]['tid'] = commons_create_topic($term);
-  }
-
-  $event->field_date[LANGUAGE_NONE][0]['value'] = '2014-01-12 10:00:00';
-  $event->field_date[LANGUAGE_NONE][0]['value2'] = '2014-01-13 13:00:00';
-
-  $event->field_address[LANGUAGE_NONE][0]['thoroughfare'] = '25 Corporate Drive';
-  $event->field_address[LANGUAGE_NONE][0]['premise'] = '4th floor';
-  $event->field_address[LANGUAGE_NONE][0]['postal_code'] = '01803';
-  $event->field_address[LANGUAGE_NONE][0]['country'] = 'US';
-  $event->field_address[LANGUAGE_NONE][0]['location'] = 'Waterfront';
-  $event->field_address[LANGUAGE_NONE][0]['administrative_area']  = 'MA';
-  $event->field_address[LANGUAGE_NONE][0]['locality'] = 'Boston';
-  $event->og_group_ref[LANGUAGE_NONE][0]['target_id'] = $boston_group->nid;
-  node_save($event);
-  // Don't display the 'registration settings have been saved' message.
-  commons_clear_messages();
-
-  // Delete the demo content variable
-  variable_del('commons_install_example_content');
-
-  // Make sure the admin user is also a group.
-  // @todo: Move to a better place.
-  $wrapper = entity_metadata_wrapper('user', 1);
-  $wrapper->{OG_GROUP_FIELD}->set(TRUE);
-  $wrapper->save();
-}
-
-function commons_add_user_avatar($account) {
-  global $base_url;
-
-  if ($account->uid) {
-    $picture_directory =  file_default_scheme() . '://' . variable_get('user_picture_path', 'pictures');
-    if(file_prepare_directory($picture_directory, FILE_CREATE_DIRECTORY)){
-      $picture_result = drupal_http_request($base_url . '/profiles/commons/images/avatars/avatar-' . commons_normalize_name($account->name) . '.png');
-      $picture_path = file_stream_wrapper_uri_normalize($picture_directory . '/picture-' . $account->uid . '-' . REQUEST_TIME . '.jpg');
-      $picture_file = file_save_data($picture_result->data, $picture_path, FILE_EXISTS_REPLACE);
-
-      // Check to make sure the picture isn't too large for the site settings.
-      $validators = array(
-        'file_validate_is_image' => array(),
-        'file_validate_image_resolution' => array(variable_get('user_picture_dimensions', '85x85')),
-        'file_validate_size' => array(variable_get('user_picture_file_size', '30') * 1024),
-      );
-
-      // attach photo to user's account.
-      $errors = file_validate($picture_file, $validators);
-
-      if (empty($errors)) {
-        // Update the user record.
-        $picture_file->uid = $account->uid;
-        $picture_file = file_save($picture_file);
-        file_usage_add($picture_file, 'user', 'user', $account->uid);
-        db_update('users')
-          ->fields(array(
-          'picture' => $picture_file->fid,
-          ))
-          ->condition('uid', $account->uid)
-          ->execute();
-        $account->picture = $picture_file->fid;
-      }
-    }
-  }
-}
-
-/**
-  * Generate some filler content.
- */
-function commons_veggie_ipsum() {
-  $content = "Veggies sunt bona vobis, proinde vos postulo esse magis spinach kale scallion lettuce cucumber black-eyed pea onion.
-
-Bamboo shoot green bean wattle seed okra kakadu plum peanut ricebean celtuce. Azuki bean desert raisin bush tomato turnip peanut sweet pepper courgette horseradish. Garlic kombu beet greens celery courgette carrot mung bean.";
-  return $content;
-}
-
-/**
- * This function create a taxonomy topic, is used for create a demo content
- * for a new instalations of Drupal Commons
- *
- * @see commons_demo_content().
- */
-function commons_create_topic($topic_name = '') {
-  $term = new stdClass();
-  $term->name = $topic_name;
-  $term->vid = 1;
-  // Pathauto aliasing can cause a menu_rebuild(), causing the request to
-  // exceeed the max execution time. Specify a manual alias instead.
-  // http://drupal.org/node/1867172.
-  $term->path['pathauto'] = FALSE;
-  taxonomy_term_save($term);
-  $path = array(
-    'source' => 'taxonomy/term/' . $term->tid,
-    'alias' => 'topics/' . drupal_html_class($topic_name),
-  );
-  path_save($path);
-  return $term->tid;
-}
-
-/**
- * Enable Acquia Connector module if selected on site configuration step.
- */
-function commons_acquia_connector_enable() {
-  $modules = variable_get('commons_install_acquia_modules', array());
-  if (!empty($modules)) {
-    module_enable($modules, TRUE);
-    commons_clear_messages();
-  }
-}
-
-/**
- * Override of install_finished() without the useless text.
- */
-function commons_install_finished(&$install_state) {
-  // BEGIN copy/paste from install_finished().
-  // Remove the bookmarks flag
-  $flag = flag_get_flag('bookmarks');
-  if($flag) {
-    $flag->delete();
-    $flag->disable();
-    _flag_clear_cache();
-  }
-
-  // Flush all caches to ensure that any full bootstraps during the installer
-  // do not leave stale cached data, and that any content types or other items
-  // registered by the installation profile are registered correctly.
-  drupal_flush_all_caches();
-
-  // We make custom code for the footer here because we want people to be able to freely edit it if they wish.
-  $footer_body = '<p>'. st('A Commons Community, powered by <a href="@acquia">Acquia</a>', array('@acquia' => url('https://www.acquia.com/products-services/drupal-commons-social-business-software'))) . '</p>';
-
-  $footer_block_text = array(
-    'body' => st($footer_body),
-    'info' => st('Default Footer'),
-    'format' => 'full_html',
-  );
-
-  if (drupal_write_record('block_custom', $footer_block_text)) {
-    $footer_block = array(
-      'module' => 'block',
-      'delta' => $footer_block_text['bid'],
-      'theme' => 'commons_origins',
-      'visibility' => 0,
-      'region' => 'footer',
-      'status' => 1,
-      'pages' => 0,
-      'weight' => 1,
-      'title' => variable_get('site_name', 'Drupal Commons'),
-    );
-    drupal_write_record('block', $footer_block);
-  }
-
-  // Remember the profile which was used.
-  variable_set('install_profile', drupal_get_profile());
-
-  // Installation profiles are always loaded last
-  db_update('system')
-    ->fields(array('weight' => 1000))
-    ->condition('type', 'module')
-    ->condition('name', drupal_get_profile())
-    ->execute();
-
-  // Cache a fully-built schema.
-  drupal_get_schema(NULL, TRUE);
-
-  // Run cron to populate update status tables (if available) so that users
-  // will be warned if they've installed an out of date Drupal version.
-  // Will also trigger indexing of profile-supplied content or feeds.
-  drupal_cron_run();
-  // END copy/paste from install_finished().
-
-  if (isset($messages['error'])) {
-    $output = '<p>' . (isset($messages['error']) ? st('Review the messages above before visiting <a href="@url">your new site</a>.', array('@url' => url(''))) : st('<a href="@url">Visit your new site</a>.', array('@url' => url('')))) . '</p>';
-    return $output;
-  }
-  else {
-    // Since any module can add a drupal_set_message, this can bug the user
-    // when we redirect him to the front page. For a better user experience,
-    // remove all the message that are only "notifications" message.
-    commons_clear_messages();
-    // If we don't install drupal using Drush, redirect the user to the front
-    // page.
-    if (!drupal_is_cli()) {
-      drupal_goto('');
-    }
-  }
-}
-
-/**
- * Clear all 'notification' type messages that may have been set.
- */
-function commons_clear_messages() {
-  drupal_get_messages('status', TRUE);
-  drupal_get_messages('completed', TRUE);
-  // Migrate adds its messages under the wrong type, see #1659150.
-  drupal_get_messages('ok', TRUE);
-}
-
-/**
- * Set a default user avatar as a managed file object.
- */
-function commons_set_default_avatar() {
-  global $base_url;
-  $picture_directory =  file_default_scheme() . '://' . variable_get('user_picture_path', 'pictures');
-  if(file_prepare_directory($picture_directory, FILE_CREATE_DIRECTORY)){
-    $picture_result = drupal_http_request($base_url . '/profiles/commons/images/avatars/user-avatar.png');
-    $picture_path = file_stream_wrapper_uri_normalize($picture_directory . '/picture-default.jpg');
-    $picture_file = file_save_data($picture_result->data, $picture_path, FILE_EXISTS_REPLACE);
-
-    // Check to make sure the picture isn't too large for the site settings.
-    $validators = array(
-      'file_validate_is_image' => array(),
-      'file_validate_image_resolution' => array(variable_get('user_picture_dimensions', '85x85')),
-      'file_validate_size' => array(variable_get('user_picture_file_size', '30') * 1024),
-    );
-
-    // attach photo to user's account.
-    $errors = file_validate($picture_file, $validators);
-
-    if (empty($errors)) {
-      // Update the user record.
-      $picture_file = file_save($picture_file);
-      variable_set('user_picture_default', $picture_path);
-    }
-  }
-}
diff --git a/drupal-org-core.make b/drupal-org-core.make
index 570df35..806c8ff 100644
--- a/drupal-org-core.make
+++ b/drupal-org-core.make
@@ -3,17 +3,7 @@ core = 7.x
 
 ; Download Drupal core and apply core patches if needed.
 projects[drupal][type] = "core"
-projects[drupal][version] = "7.23"
-
-; Hide the profiles under /profiles, so Commons is the only one. This allows
-; the installation to start at the Language selection screen, bypassing a
-; baffling and silly choice, especially for non-native speakers.
-; http://drupal.org/node/1780598#comment-6480088
-projects[drupal][patch][] = http://drupal.org/files/spark-install-1780598-5.patch
-; This requires a core bug fix to not show the profile selection page when only
-; one profile is visible.
-; http://drupal.org/node/1074108#comment-6463662
-projects[drupal][patch][] = http://drupal.org/files/1074108-skip-profile-16-7.x-do-not-test.patch
+projects[drupal][version] = 7.26
 
 ; This patch allows install profile to list requirements on the install page
 ; http://drupal.org/node/1971072
diff --git a/drupal-org.make b/drupal-org.make
index 1d5f311..bf2b829 100644
--- a/drupal-org.make
+++ b/drupal-org.make
@@ -3,25 +3,28 @@ core = 7.x
 
 ; Contributed modules.
 
+projects[acquia_connector][type] = "module"
+projects[acquia_connector][subdir] = "contrib"
+projects[acquia_connector][version] = "2.13"
+
 projects[addressfield][type] = "module"
 projects[addressfield][subdir] = "contrib"
-projects[addressfield][version] = "1.0-beta4"
+projects[addressfield][version] = "1.0-beta5"
 
 projects[addressfield_tokens][type] = "module"
 projects[addressfield_tokens][subdir] = "contrib"
 projects[addressfield_tokens][version] = "1.3"
 
-projects[acquia_connector][type] = "module"
-projects[acquia_connector][subdir] = "contrib"
-projects[acquia_connector][version] = "2.12"
-
-projects[advancedqueue][type] = "module"
-projects[advancedqueue][subdir] = "contrib"
-projects[advancedqueue][version] = "1.0-alpha2"
+projects[admin_icons][type] = "module"
+projects[admin_icons][subdir] = "contrib"
+projects[admin_icons][download][type] = "git"
+projects[admin_icons][download][url] = "http://git.drupal.org/project/admin_icons.git"
+projects[admin_icons][download][branch] = "7.x-1.x"
+projects[admin_icons][download][revision] = "60d9f28801533fecc92216a60d444d89d80e7611"
 
 projects[apachesolr][type] = "module"
 projects[apachesolr][subdir] = "contrib"
-projects[apachesolr][version] = "1.4"
+projects[apachesolr][version] = "1.6"
 
 projects[apachesolr_og][type] = "module"
 projects[apachesolr_og][subdir] = "contrib"
@@ -41,13 +44,16 @@ projects[apachesolr_user][download][url] = "http://git.drupal.org/project/apache
 projects[apachesolr_user][download][branch] = "7.x-1.x"
 projects[apachesolr_user][download]revision] = "a86c5aebfceaf4a3fc53544762a36ca1b70809d5"
 
-; Check the user object before trying to display a result
+; Check the user object before trying to display a result.
 ; https://drupal.org/node/2077281#comment-7807937
 projects[apachesolr_user][patch][] = "http://drupal.org/files/2077281-apache-solr-user-check-3.patch"
 
 projects[breakpoints][type] = "module"
 projects[breakpoints][subdir] = "contrib"
-projects[breakpoints][version] = "1.1"
+projects[breakpoints][download][type] = "git"
+projects[breakpoints][download][url] = "http://git.drupal.org/project/breakpoints.git"
+projects[breakpoints][download][branch] = "7.x-1.x"
+projects[breakpoints][download][revision] = "c4f3665"
 
 projects[connector][type] = "module"
 projects[connector][subdir] = "contrib"
@@ -55,18 +61,26 @@ projects[connector][version] = "1.0-beta2"
 
 projects[ckeditor][type] = "module"
 projects[ckeditor][subdir] = "contrib"
-projects[ckeditor][version] = "1.13"
+projects[ckeditor][download][type] = "git"
+projects[ckeditor][download][url] = "http://git.drupal.org/project/ckeditor.git"
+projects[ckeditor][download][branch] = "7.x-1.x"
+projects[ckeditor][download][revision] = "b69a9ac"
+
+; Only load CSS when necessary.
+; https://drupal.org/node/1370894
+projects[ckeditor][patch][] = "https://drupal.org/files/issues/attach-ckeditor-css-1370894-7.patch"
+
+; Accomodate latest Media changes.
+; https://drupal.org/node/2159403
+projects[ckeditor][patch][] = "https://drupal.org/files/issues/ckeditor-accomodate-latest-media-changes-0.patch"
+
+; Remove redundant external plugin declarations.
+; https://drupal.org/comment/8284591#comment-8284591
+projects[ckeditor][patch][] = "https://drupal.org/files/issues/ckeditor-remove-external-plugin-declarations-1-alt.patch"
 
 projects[ctools][type] = "module"
 projects[ctools][subdir] = "contrib"
-projects[ctools][download][type] = "git"
-projects[ctools][download][url] = "http://git.drupal.org/project/ctools.git"
-projects[ctools][download][branch] = "7.x-1.x"
-projects[ctools][download][revision] = "e81da7a57f63ca95d2c713afcec65a5659aada9e"
-
-; Introduce UUIDs onto panes & displays.
-; http://drupal.org/node/1277908#comment-7216356
-projects[ctools][patch][] = "http://drupal.org/files/ctools-uuids_for_exported_objects-1277908-118.patch"
+projects[ctools][version] = "1.4"
 
 projects[custom_search][type] = "module"
 projects[custom_search][subdir] = "contrib"
@@ -79,10 +93,9 @@ projects[custom_search][download][revision] = "20144e64494c83a448067d587e59df5d7
 ; https://drupal.org/node/2012210
 projects[custom_search][patch][] = "http://drupal.org/files/commons_search_js_encode.patch"
 
-
 projects[date][type] = "module"
 projects[date][subdir] = "contrib"
-projects[date][version] = "2.6"
+projects[date][version] = "2.7"
 
 projects[date_facets][type] = "module"
 projects[date_facets][subdir] = "contrib"
@@ -97,20 +110,26 @@ projects[diff][type] = "module"
 projects[diff][subdir] = "contrib"
 projects[diff][version] = "3.2"
 
+; Profile has no recommended release.
+projects[edit_profile][type] = "module"
+projects[edit_profile][subdir] = "contrib"
+projects[edit_profile][version] = "1.0-beta2"
+
+projects[elements][type] = "module"
+projects[elements][subdir] = "contrib"
+projects[elements][version] = "1.4"
+
 projects[email_registration][type] = "module"
 projects[email_registration][subdir] = "contrib"
 projects[email_registration][version] = "1.1"
 
 projects[entity][type] = "module"
 projects[entity][subdir] = "contrib"
-projects[entity][version] = "1.2"
+projects[entity][version] = "1.3"
 
 projects[entitycache][type] = "module"
 projects[entitycache][subdir] = "contrib"
-projects[entitycache][download][type] = "git"
-projects[entitycache][download][url] = "http://git.drupal.org/project/entitycache.git"
-projects[entitycache][download][branch] = "7.x-1.x"
-projects[entitycache][download][revision] = "7e390b5"
+projects[entitycache][version] = "1.2"
 
 ; Fix core translation support.
 ; http://drupal.org/node/1349566#comment-7781063
@@ -118,27 +137,27 @@ projects[entitycache][patch][] = "http://drupal.org/files/add-translation-inform
 
 projects[entityreference][type] = "module"
 projects[entityreference][subdir] = "contrib"
-projects[entityreference][download][type] = "git"
-projects[entityreference][download][url] = "http://git.drupal.org/project/entityreference.git"
-projects[entityreference][download][branch] = "7.x-1.x"
-projects[entityreference][download][revision] = "1c176daef3e7483389cbebeb34784b3af6521f7f"
+projects[entityreference][version] = "1.1"
+
+projects[entityreference_prepopulate][type] = "module"
+projects[entityreference_prepopulate][subdir] = "contrib"
+projects[entityreference_prepopulate][version] = "1.4"
 
 projects[entity_translation][type] = "module"
 projects[entity_translation][subdir] = "contrib"
 projects[entity_translation][version] = "1.0-beta3"
 
-; Profile has no recommended release
-projects[edit_profile][type] = "module"
-projects[edit_profile][subdir] = "contrib"
-projects[edit_profile][version] = "1.0-beta2"
-
-projects[entityreference_prepopulate][type] = "module"
-projects[entityreference_prepopulate][subdir] = "contrib"
-projects[entityreference_prepopulate][version] = "1.3"
+projects[facetapi][type] = "module"
+projects[facetapi][subdir] = "contrib"
+projects[facetapi][version] = "1.3"
 
 projects[features][type] = "module"
 projects[features][subdir] = "contrib"
-projects[features][version] = "2.0-rc5"
+projects[features][version] = "2.0"
+
+projects[file_entity][type] = "module"
+projects[file_entity][subdir] = "contrib"
+projects[file_entity][version] = "2.0-alpha3"
 
 projects[flag][type] = "module"
 projects[flag][subdir] = "contrib"
@@ -156,10 +175,6 @@ projects[flag_abuse][type] = "module"
 projects[flag_abuse][subdir] = "contrib"
 projects[flag_abuse][version] = "2.0-alpha1"
 
-projects[redirect][type] = "module"
-projects[redirect][subdir] = "contrib"
-projects[redirect][version] = "1.0-rc1"
-
 projects[http_client][type] = "module"
 projects[http_client][subdir] = "contrib"
 projects[http_client][version] = "2.4"
@@ -175,13 +190,6 @@ projects[i18nviews][download][url] = "http://git.drupal.org/project/i18nviews.gi
 projects[i18nviews][download][branch] = "7.x-3.x"
 projects[i18nviews][download][revision] = "26bd52c"
 
-projects[admin_icons][type] = "module"
-projects[admin_icons][subdir] = "contrib"
-projects[admin_icons][download][type] = "git"
-projects[admin_icons][download][url] = "http://git.drupal.org/project/admin_icons.git"
-projects[admin_icons][download][branch] = "7.x-1.x"
-projects[admin_icons][download][revision] = "60d9f28801533fecc92216a60d444d89d80e7611"
-
 projects[kissmetrics][type] = "module"
 projects[kissmetrics][subdir] = "contrib"
 projects[kissmetrics][version] = "1.0-rc3"
@@ -192,15 +200,26 @@ projects[l10n_update][version] = "1.0-beta3"
 
 projects[libraries][type] = "module"
 projects[libraries][subdir] = "contrib"
-projects[libraries][version] = "2.1"
+projects[libraries][version] = "2.2"
 
 projects[lingotek][type] = "module"
 projects[lingotek][subdir] = "contrib"
-projects[lingotek][version] = "4.06"
+projects[lingotek][version] = "5.02"
 
 projects[link][type] = "module"
 projects[link][subdir] = "contrib"
-projects[link][version] = "1.1"
+projects[link][version] = "1.2"
+
+projects[media][type] = "module"
+projects[media][subdir] = "contrib"
+projects[media][download][type] = "git"
+projects[media][download][url] = "http://git.drupal.org/project/media.git"
+projects[media][download][branch] = "7.x-2.x"
+projects[media][download][revision] = "6e9c99b"
+
+projects[memcache][type] = "module"
+projects[memcache][subdir] = "contrib"
+projects[memcache][version] = "1.0"
 
 projects[menu_attributes][type] = "module"
 projects[menu_attributes][subdir] = "contrib"
@@ -224,21 +243,11 @@ projects[message_notify][version] = "2.5"
 
 projects[message_subscribe][type] = "module"
 projects[message_subscribe][subdir] = "contrib"
-projects[message_subscribe][download][type] = "git"
-projects[message_subscribe][download][url] = "http://git.drupal.org/project/message_subscribe.git"
-projects[message_subscribe][download][branch] = "7.x-1.x"
-
-projects[memcache][type] = "module"
-projects[memcache][subdir] = "contrib"
-projects[memcache][version] = "1.0"
+projects[message_subscribe][version] = "1.0-rc1"
 
 projects[metatag][type] = "module"
 projects[metatag][subdir] = "contrib"
-projects[metatag][version] = "1.0-beta7"
-
-; Support for rel=author link in head.
-; http://drupal.org/node/1865228#comment-6839604
-projects[metatag][patch][] = "http://drupal.org/files/metatag-n1865228-3.patch"
+projects[metatag][version] = "1.0-beta9"
 
 projects[module_filter][type] = "module"
 projects[module_filter][subdir] = "contrib"
@@ -246,78 +255,94 @@ projects[module_filter][version] = "1.8"
 
 projects[mollom][type] = "module"
 projects[mollom][subdir] = "contrib"
-projects[mollom][version] = "2.7"
+projects[mollom][version] = "2.8"
 
 projects[navbar][type] = "module"
 projects[navbar][subdir] = "contrib"
-projects[navbar][download][type] = "git"
-projects[navbar][download][url] = "http://git.drupal.org/project/navbar.git"
-projects[navbar][download][branch] = "7.x-1.x"
-projects[navbar][download][revision] = "dd542e1a74d9c9b3a9b5bd699aad9a4b65e5c5b7"
+projects[navbar][version] = "1.4"
+
+; Change I-beam cursors in the navbar to be a pointer instead.
+; https://drupal.org/node/2173041
+projects[navbar][patch][] = "https://drupal.org/files/issues/2173041-3-i-beam-menu-hover.patch"
 
 projects[oauth][type] = "module"
 projects[oauth][subdir] = "contrib"
-projects[oauth][version] = "3.1"
+projects[oauth][version] = "3.2"
 
 projects[oauthconnector][type] = "module"
 projects[oauthconnector][subdir] = "contrib"
 projects[oauthconnector][download][type] = "git"
 projects[oauthconnector][download][url] = "http://git.drupal.org/project/oauthconnector.git"
 projects[oauthconnector][download][branch] = "7.x-1.x"
-projects[oauthconnector][download][revision] = "0ce7ac9614710c0f68d0a58cb4ae4667f8bd6fa7"
+projects[oauthconnector][download][revision] = "42c6f66"
+
+projects[oembed][type] = "module"
+projects[oembed][subdir] = "contrib"
+projects[oembed][download][type] = "git"
+projects[oembed][download][url] = "http://git.drupal.org/project/oembed.git"
+projects[oembed][download][branch] = "7.x-1.x"
+projects[oembed][download][revision] = "9aa5303"
 
 projects[og][type] = "module"
 projects[og][subdir] = "contrib"
-projects[og][version] = "2.3"
+projects[og][version] = "2.5"
 
 ; Auto-assign role to group manager broken on groups with overridden roles.
 ; https://drupal.org/node/2005800#comment-7684873
-projects[og][patch][] = "http://drupal.org/files/og-default-role-member-2005800-21.patch"
+projects[og][patch][] = "http://drupal.org/files/issues/og-default-role-member-2005800-25.patch"
 
-; og_ui should give users the theme, not admin ui when creating groups
+; og_ui should give users the theme, not admin ui when creating groups.
 ; http://drupal.org/node/1800208
 projects[og][patch][] = "http://drupal.org/files/og_ui-group_node_add_theme-1800208-5.patch"
 
-; _og_access_verify_access_field_existence() assumes node group type, throws an exception rebuilding node access.
-projects[og][patch][] = "http://drupal.org/files/og-access-rebuild-exception-group-type.patch"
-
 projects[panelizer][type] = "module"
 projects[panelizer][subdir] = "contrib"
 projects[panelizer][version] = "3.1"
 
 projects[panels][type] = "module"
 projects[panels][subdir] = "contrib"
-projects[panels][version] = "3.3"
-
-; Fatal error: Call to undefined function panels_get_layouts()
-; http://drupal.org/node/1828684#comment-6694732
-projects[panels][patch][] = "http://drupal.org/files/1828684-layout-fix-6.patch"
-
-; PHP 5.3.9 Strict Warning on Panels Empty Value
-; http://drupal.org/node/1632898#comment-6412840
-projects[panels][patch][] = "http://drupal.org/files/panels-n1632898-15.patch"
-
-; Add internationalization support.
-; http://drupal.org/node/1179034#comment-7216342
-projects[panels][patch][] = "http://drupal.org/files/panels-1179034-41_____panels-uuids-127790-100__-80.patch"
+projects[panels][version] = "3.4"
 
 projects[paranoia][type] = "module"
 projects[paranoia][subdir] = "contrib"
-projects[paranoia][version] = "1.2"
+projects[paranoia][version] = "1.3"
 
 projects[pathauto][type] = "module"
 projects[pathauto][subdir] = "contrib"
 projects[pathauto][version] = "1.2"
 
-projects[placeholder][type] = "module"
-projects[placeholder][subdir] = "contrib"
-projects[placeholder][version] = "1.0"
+projects[picture][type] = "module"
+projects[picture][subdir] = "contrib"
+projects[picture][download][type] = "git"
+projects[picture][download][url] = "http://git.drupal.org/project/picture.git"
+projects[picture][download][branch] = "7.x-1.x"
+projects[picture][download][revision] = "18b94b9"
+
+; Add ctools as a dependency
+; https://drupal.org/node/2173043
+projects[picture][patch][] = "https://drupal.org/files/issues/add-ctools-dependency-2173043-1.patch"
+
+; Allow filter tips to be translated
+; https://drupal.org/node/2139459
+projects[picture][patch][] = "https://drupal.org/files/issues/translate-filter-tips-2139459-1.patch"
+
+; Move hook_uninstall() to picture.install to fix issues on uninstall.
+; https://drupal.org/node/2173015
+projects[picture][patch][] = "https://drupal.org/files/issues/move-uninstall-hook-implementation-2173015-1.patch"
+
+; Remove implementation of hook_file_formatter_info() to remove duplicate file formatter.
+; https://drupal.org/node/2172841
+projects[picture][patch][] = "https://drupal.org/files/issues/remove-file-formatter-hook-implementation-2172831-1.patch"
+
+; Remove implementation of hook_ctools_plugin_api() to fix issues with features.
+; https://drupal.org/node/2172831
+projects[picture][patch][] = "https://drupal.org/files/issues/remove-ctools-hook-implementation-2172831-1.patch"
 
 projects[pm_existing_pages][type] = "module"
 projects[pm_existing_pages][subdir] = "contrib"
 projects[pm_existing_pages][version] = "1.4"
 
-projects[potx][type] = "module" 
+projects[potx][type] = "module"
 projects[potx][subdir] = "contrib"
 projects[potx][version] = "1.0"
 
@@ -325,11 +350,11 @@ projects[privatemsg][type] = "module"
 projects[privatemsg][subdir] = "contrib"
 projects[privatemsg][version] = "1.4"
 
-; Add preliminary Views integration
+; Add preliminary Views integration.
 ; http://drupal.org/node/1573000
 projects[privatemsg][patch][] = "http://drupal.org/files/privatemsg-1573000-64.patch"
 
-; Enable privatemsg_realname when realname is enabled
+; Enable privatemsg_realname when realname is enabled.
 ; https://drupal.org/node/2070719
 projects[privatemsg][patch][] = "http://drupal.org/files/2077223-privatemsg-realname-enabled-1.patch"
 
@@ -338,6 +363,10 @@ projects[quicktabs][subdir] = "contrib"
 projects[quicktabs][version] = "3.6"
 projects[quicktabs][patch][] = "http://drupal.org/files/2104643-revert-qt-487518-5.patch"
 
+projects[r4032login][type] = "module"
+projects[r4032login][subdir] = "contrib"
+projects[r4032login][version] = "1.7"
+
 projects[radioactivity][type] = "module"
 projects[radioactivity][subdir] = "contrib"
 projects[radioactivity][download][type] = "git"
@@ -345,36 +374,45 @@ projects[radioactivity][download][url] = "http://git.drupal.org/project/radioact
 projects[radioactivity][download][branch] = "7.x-2.x"
 projects[radioactivity][download][revision] = "aee21dbed4f54d0e626e3c19ecc550bf1ec656f6"
 
-; Radioactivity not compatible with Memcache module
+; Radioactivity not compatible with Memcache module.
 ; http://drupal.org/node/1860216
 projects[radioactivity][patch][] = "http://drupal.org/files/radioactivity-memcache.patch"
 
-projects[r4032login][type] = "module"
-projects[r4032login][subdir] = "contrib"
-projects[r4032login][version] = "1.6"
-
 projects[rate][type] = "module"
 projects[rate][subdir] = "contrib"
-projects[rate][version] = "1.6"
+projects[rate][version] = "1.7"
 
-; Add widget to node/comment $links
+; Add widget to node/comment $links.
 ; http://drupal.org/node/947516#comment-6979780
 projects[rate][patch][] = "http://drupal.org/files/947516-rate-node-links-15.patch"
 
+; Only load CSS when necessary.
+; https://drupal.org/node/2180853
+projects[rate][patch][] = "https://drupal.org/files/issues/attach-rate-css-2180853-3.patch"
+
 projects[realname][type] = "module"
 projects[realname][subdir] = "contrib"
 projects[realname][version] = "1.1"
 
+projects[redirect][type] = "module"
+projects[redirect][subdir] = "contrib"
+projects[redirect][version] = "1.0-rc1"
+
 projects[registration][subdir] = "contrib"
 projects[registration][type] = "module"
-projects[registration][version] = "1.2"
+projects[registration][version] = "1.3"
+
+projects[rich_snippets][type] = "module"
+projects[rich_snippets][subdir] = "contrib"
+projects[rich_snippets][version] = "1.0-beta3"
 
 projects[rules][type] = "module"
 projects[rules][subdir] = "contrib"
-projects[rules][download][type] = "git"
-projects[rules][download][url] = "http://git.drupal.org/project/rules.git"
-projects[rules][download][branch] = "7.x-2.x"
-projects[rules][download][revision] = "8db91e5"
+projects[rules][version] = "2.6"
+
+projects[schemaorg][type] = "module"
+projects[schemaorg][subdir] = "contrib"
+projects[schemaorg][version] = "1.0-beta4"
 
 projects[search_facetapi][type] = "module"
 projects[search_facetapi][subdir] = "contrib"
@@ -384,21 +422,9 @@ projects[sharethis][type] = "module"
 projects[sharethis][subdir] = "contrib"
 projects[sharethis][version] = "2.5"
 
-projects[facetapi][type] = "module"
-projects[facetapi][subdir] = "contrib"
-projects[facetapi][version] = "1.3"
-
-projects[rich_snippets][type] = "module"
-projects[rich_snippets][subdir] = "contrib"
-projects[rich_snippets][version] = "1.0-beta3"
-
-; Remove snippets from non-node type searches:
-; http://drupal.org/node/1923904#comment-7094488
-projects[rich_snippets][patch][] = "http://drupal.org/files/1923904-search-nodes-only.patch"
-
-projects[schemaorg][type] = "module"
-projects[schemaorg][subdir] = "contrib"
-projects[schemaorg][version] = "1.0-beta3"
+projects[smartcrop][type] = "module"
+projects[smartcrop][subdir] = "contrib"
+projects[smartcrop][version] = "1.0-beta2"
 
 projects[strongarm][type] = "module"
 projects[strongarm][subdir] = "contrib"
@@ -411,7 +437,7 @@ projects[timeago][type] = "module"
 projects[timeago][subdir] = "contrib"
 projects[timeago][version] = "2.2"
 
-; Provide a dedicated date type:
+; Provide a dedicated date type.
 ; http://drupal.org/node/1427226#comment-6638836
 projects[timeago][patch][] = "http://drupal.org/files/1427226-timeago-date-type.patch"
 
@@ -419,54 +445,46 @@ projects[title][type] = "module"
 projects[title][subdir] = "contrib"
 projects[title][version] = "1.0-alpha7"
 
-projects[translation_helpers][type] = "module"
-projects[translation_helpers][subdir] = "contrib"
-projects[translation_helpers][version] = "1.0"
-
 projects[token][type] = "module"
 projects[token][subdir] = "contrib"
 projects[token][version] = "1.5"
 
+projects[translation_helpers][type] = "module"
+projects[translation_helpers][subdir] = "contrib"
+projects[translation_helpers][version] = "1.0"
+
 projects[variable][type] = "module"
 projects[variable][subdir] = "contrib"
-projects[variable][version] = "2.3"
+projects[variable][version] = "2.4"
 
 projects[views][type] = "module"
 projects[views][subdir] = "contrib"
 projects[views][version] = "3.7"
 
+projects[views_bulk_operations][type] = "module"
+projects[views_bulk_operations][subdir] = "contrib"
+projects[views_bulk_operations][version] = "3.2"
+
 projects[views_field_view][type] = "module"
 projects[views_field_view][subdir] = "contrib"
 projects[views_field_view][version] = "1.1"
 
-projects[views_load_more][type] = "module"
-projects[views_load_more][subdir] = "contrib"
-projects[views_load_more][version] = "1.1"
-
-projects[views_bulk_operations][type] = "module"
-projects[views_bulk_operations][subdir] = "contrib"
-projects[views_bulk_operations][version] = "3.1"
-
 projects[views_litepager][type] = "module"
 projects[views_litepager][subdir] = "contrib"
 projects[views_litepager][version] = "3.0"
 
-; We have the version of voting api at the top so it doesn't get included in our dev make patch.
-projects[votingapi][version] = "2.11"
+projects[views_load_more][type] = "module"
+projects[views_load_more][subdir] = "contrib"
+projects[views_load_more][version] = "1.2"
+
 projects[votingapi][type] = "module"
 projects[votingapi][subdir] = "contrib"
+projects[votingapi][version] = "2.11"
 
 projects[voting_rules][type] = "module"
 projects[voting_rules][subdir] = "contrib"
 projects[voting_rules][version] = "1.0-alpha1"
 
-; Registry Rebuild
-; We can probably remove this later, but for now keep it included
-; See https://drupal.org/node/1983606#comment-7788313 for more information.
-projects[registry_rebuild][version] = "1.10"
-projects[registry_rebuild][type] = "module"
-projects[registry_rebuild][subdir] = "contrib"
-
 ; Contributed themes.
 
 projects[adaptivetheme][type] = "theme"
@@ -480,28 +498,37 @@ projects[adaptivetheme][download][revision] = "b4b38c3c01d066e733c2942020c51962c
 ; http://drupal.org/node/1427226#comment-6638836
 projects[adaptivetheme][patch][] = "http://drupal.org/files/remove-comment-creation-link-2018081-1.patch"
 
+; Add styling for link buttons.
+; https://drupal.org/comment/8289329#comment-8289329
+projects[adaptivetheme][patch][] = "https://drupal.org/files/issues/add-link-button-styling-2159783-1.patch"
+
+projects[ember][type] = "theme"
+projects[ember][subdir] = "contrib"
+projects[ember][version] = "2.0-alpha2"
+
 projects[sky][type] = "theme"
 projects[sky][subdir] = "contrib"
 projects[sky][version] = "3.0-rc1"
 
 ; Libraries.
 ; NOTE: These need to be listed in http://drupal.org/packaging-whitelist.
-libraries[underscore][download][type] = "get"
-libraries[underscore][type] = "libraries"
-libraries[underscore][download][url] = "https://github.com/jashkenas/underscore/archive/1.4.4.zip"
 
 libraries[backbone][download][type] = "get"
 libraries[backbone][type] = "libraries"
-libraries[backbone][download][url] = "https://github.com/jashkenas/backbone/archive/1.0.0.tar.gz"
+libraries[backbone][download][url] = "https://github.com/jashkenas/backbone/archive/1.1.0.tar.gz"
 
-libraries[ckeditor][download][type] = "get"
-libraries[ckeditor][download][url] = "http://download.cksource.com/CKEditor/CKEditor/CKEditor%204.0/ckeditor_4.0_full.tar.gz"
+libraries[ckeditor][download][type] = get
 libraries[ckeditor][type] = "libraries"
+libraries[ckeditor][download][url] = "http://download.cksource.com/CKEditor%20for%20Drupal/edit/ckeditor_4.3.2_edit.zip"
 
-libraries[placeholder][download][type] = "get"
-libraries[placeholder][type] = "libraries"
-libraries[placeholder][download][url] = "https://github.com/mathiasbynens/jquery-placeholder/archive/v2.0.7.tar.gz"
+libraries[modernizr][download][type] = "get"
+libraries[modernizr][type] = "libraries"
+libraries[modernizr][download][url] = "https://github.com/Modernizr/Modernizr/archive/v2.7.1.tar.gz"
 
 libraries[timeago][download][type] = "get"
 libraries[timeago][type] = "libraries"
-libraries[timeago][download][url] = "https://raw.github.com/rmm5t/jquery-timeago/v1.3.0/jquery.timeago.js"
+libraries[timeago][download][url] = "https://raw.github.com/rmm5t/jquery-timeago/v1.3.1/jquery.timeago.js"
+
+libraries[underscore][download][type] = "get"
+libraries[underscore][type] = "libraries"
+libraries[underscore][download][url] = "https://github.com/jashkenas/underscore/archive/1.5.2.zip"
diff --git a/modules/commons/commons_activity_streams/commons_activity_page/commons_activity_page.info b/modules/commons/commons_activity_streams/commons_activity_page/commons_activity_page.info
index c025d73..d8620ea 100644
--- a/modules/commons/commons_activity_streams/commons_activity_page/commons_activity_page.info
+++ b/modules/commons/commons_activity_streams/commons_activity_page/commons_activity_page.info
@@ -2,13 +2,10 @@ name = Commons Activity Page
 description = Allows users to view a stream of site-wide and personalized activity.
 core = 7.x
 package = Commons - Landing pages
-project = commons_activity_page
 dependencies[] = commons_activity_streams
 dependencies[] = commons_featured
 dependencies[] = ctools
 dependencies[] = page_manager
-dependencies[] = panels
-dependencies[] = panels_ipe
 features[ctools][] = page_manager:pages_default:1
 features[features_api][] = api:2
 features[page_manager_pages][] = commons_activity_streams_activity
diff --git a/modules/commons/commons_activity_streams/commons_activity_streams.features.inc b/modules/commons/commons_activity_streams/commons_activity_streams.features.inc
index e0006bb..23366ab 100644
--- a/modules/commons/commons_activity_streams/commons_activity_streams.features.inc
+++ b/modules/commons/commons_activity_streams/commons_activity_streams.features.inc
@@ -41,9 +41,9 @@ function commons_activity_streams_default_message_type() {
           "safe_value" : "[message:user:picture:35x35]"
         },
         {
-          "value" : "\\u003Ca href=\\u0022[message:user:url:absolute]\\u0022\\u003E[message:user:name]\\u003C\\/a\\u003E commented on \\u003Ca href=\\u0022[message:field-target-nodes:0:url]\\u0022\\u003E[message:field-target-nodes:0:title]\\u003C\\/a\\u003E",
+          "value" : "\\u003Ca href=\\u0022[message:user:url:absolute]\\u0022\\u003E[message:user:name]\\u003C\\/a\\u003E commented on \\u003Ca href=\\u0022[message:field-target-nodes:0:url]\\u0022\\u003E[message:field-target-nodes:0:title_field]\\u003C\\/a\\u003E",
           "format" : "full_html",
-          "safe_value" : "\\u003Ca href=\\u0022[message:user:url:absolute]\\u0022\\u003E[message:user:name]\\u003C\\/a\\u003E commented on \\u003Ca href=\\u0022[message:field-target-nodes:0:url]\\u0022\\u003E[message:field-target-nodes:0:title]\\u003C\\/a\\u003E"
+          "safe_value" : "\\u003Ca href=\\u0022[message:user:url:absolute]\\u0022\\u003E[message:user:name]\\u003C\\/a\\u003E commented on \\u003Ca href=\\u0022[message:field-target-nodes:0:url]\\u0022\\u003E[message:field-target-nodes:0:title_field]\\u003C\\/a\\u003E"
         },
         {
           "value" : "[commons-groups:in-groups-text]",
@@ -70,9 +70,9 @@ function commons_activity_streams_default_message_type() {
           "safe_value" : "[message:user:picture:35x35]"
         },
         {
-          "value" : "\\u003Ca href=\\u0022[message:user:url:absolute]\\u0022\\u003E[message:user:name]\\u003C\\/a\\u003E created \\u003Ca href=\\u0022[message:field-target-nodes:0:url]\\u0022\\u003E[message:field-target-nodes:0:title]\\u003C\\/a\\u003E",
+          "value" : "\\u003Ca href=\\u0022[message:user:url:absolute]\\u0022\\u003E[message:user:name]\\u003C\\/a\\u003E created \\u003Ca href=\\u0022[message:field-target-nodes:0:url]\\u0022\\u003E[message:field-target-nodes:0:title_field]\\u003C\\/a\\u003E",
           "format" : "full_html",
-          "safe_value" : "\\u003Ca href=\\u0022[message:user:url:absolute]\\u0022\\u003E[message:user:name]\\u003C\\/a\\u003E created \\u003Ca href=\\u0022[message:field-target-nodes:0:url]\\u0022\\u003E[message:field-target-nodes:0:title]\\u003C\\/a\\u003E"
+          "safe_value" : "\\u003Ca href=\\u0022[message:user:url:absolute]\\u0022\\u003E[message:user:name]\\u003C\\/a\\u003E created \\u003Ca href=\\u0022[message:field-target-nodes:0:url]\\u0022\\u003E[message:field-target-nodes:0:title_field]\\u003C\\/a\\u003E"
         },
         {
           "value" : "[commons-groups:in-groups-text]",
diff --git a/modules/commons/commons_activity_streams/commons_activity_streams.info b/modules/commons/commons_activity_streams/commons_activity_streams.info
index 25fecdc..665ad02 100644
--- a/modules/commons/commons_activity_streams/commons_activity_streams.info
+++ b/modules/commons/commons_activity_streams/commons_activity_streams.info
@@ -1,7 +1,6 @@
 name = Commons Activity Streams
 core = 7.x
 package = Commons - Building blocks
-project = commons_activity_streams
 dependencies[] = commons_follow
 dependencies[] = ctools
 dependencies[] = entity
@@ -14,7 +13,6 @@ dependencies[] = token
 dependencies[] = views
 dependencies[] = views_content
 dependencies[] = views_load_more
-datestamp = 1361203022
 features[ctools][] = strongarm:strongarm:1
 features[ctools][] = views:views_default:3.0
 features[features_api][] = api:2
diff --git a/modules/commons/commons_activity_streams/commons_activity_streams.module b/modules/commons/commons_activity_streams/commons_activity_streams.module
index d0bc8df..eb73f1c 100644
--- a/modules/commons/commons_activity_streams/commons_activity_streams.module
+++ b/modules/commons/commons_activity_streams/commons_activity_streams.module
@@ -54,8 +54,12 @@ function commons_activity_streams_node_insert($node) {
 function commons_activity_streams_comment_insert($comment) {
   $account = user_load($comment->uid);
   $node = node_load($comment->nid);
-
-  $message = message_create('commons_activity_streams_comment_created', array('uid' => $account->uid, 'timestamp' => $comment->created));
+  // Allow other modules to change the message type used for this event.
+  $hook = 'comment_insert';
+  $message_type = 'commons_activity_streams_comment_created';
+  drupal_alter('commons_activity_streams_message_selection', $message_type, $hook, $node);
+  $message = message_create($message_type, array('uid' => $account->uid, 'timestamp' => $comment->created));
+  
   // Save reference to the node in the node reference field, and the
   // "publish" state (i.e. if the node is published or unpublished).
   $wrapper = entity_metadata_wrapper('message', $message);
diff --git a/modules/commons/commons_activity_streams/commons_activity_streams_groups/commons_activity_streams_groups.info b/modules/commons/commons_activity_streams/commons_activity_streams_groups/commons_activity_streams_groups.info
index 9a82caf..b6b2ea0 100644
--- a/modules/commons/commons_activity_streams/commons_activity_streams_groups/commons_activity_streams_groups.info
+++ b/modules/commons/commons_activity_streams/commons_activity_streams_groups/commons_activity_streams_groups.info
@@ -2,7 +2,6 @@ name = Commons Activity Streams Groups
 description = Contains Organic Groups integration for Commons Activity Streams
 core = 7.x
 package = Commons - Building blocks
-project = commons_activity_streams_groups
 dependencies[] = commons_activity_streams
 dependencies[] = entity
 dependencies[] = views
diff --git a/modules/commons/commons_body/commons_body.info b/modules/commons/commons_body/commons_body.info
index d5b2909..03c3d20 100644
--- a/modules/commons/commons_body/commons_body.info
+++ b/modules/commons/commons_body/commons_body.info
@@ -2,7 +2,6 @@ name = Commons Body Field
 description = Provides a simple body field for re-use by various Commons content types
 core = 7.x
 package = Commons - Building blocks
-project = commons_body
 dependencies[] = features
 dependencies[] = field_sql_storage
 dependencies[] = text
diff --git a/modules/commons/commons_bw/commons_bw.info b/modules/commons/commons_bw/commons_bw.info
index a0d26df..ac6af8c 100644
--- a/modules/commons/commons_bw/commons_bw.info
+++ b/modules/commons/commons_bw/commons_bw.info
@@ -2,6 +2,7 @@ name = Commons Tabbed Browsing Widget
 core = 7.x
 package = Commons - Building blocks
 dependencies[] = features
+dependencies[] = og
 dependencies[] = quicktabs
 dependencies[] = quicktabs_tabstyles
 dependencies[] = title
diff --git a/modules/commons/commons_bw/commons_bw.module b/modules/commons/commons_bw/commons_bw.module
index 7ae7e15..0c32197 100644
--- a/modules/commons/commons_bw/commons_bw.module
+++ b/modules/commons/commons_bw/commons_bw.module
@@ -8,14 +8,14 @@ function commons_bw_system_info_alter(&$info, $file, $type) {
     foreach (node_type_get_types() as $node_type) {
       $type = $node_type->type;
       if (commons_bw_node_auto_title_instance($type)) {
-        $info['features']['field_instance'][] = "node-$type-title_field";  
+        $info['features']['field_instance'][] = "node-$type-title_field";
       }
     }
   }
 }
 
 /**
- * Implementation of hook_ctools_plugin_directory().
+ * Implements hook_ctools_plugin_directory().
  */
 function commons_bw_ctools_plugin_directory($module, $plugin) {
   if ($module == 'ctools' && $plugin == 'content_types') {
@@ -186,7 +186,7 @@ function commons_bw_partial_node_form($form, &$form_state, $bundle, $group_id =
   // Add the commons_bw after build first, in case other pre-renders needs need
   // to address fields by there CSS ID.
   array_unshift($form['#pre_render'], 'commons_bw_partial_node_form_after_build');
-
+  $form['#validate'][] = 'commons_bw_partial_node_form_validate';
   return $form;
 }
 
@@ -232,6 +232,10 @@ function commons_bw_partial_node_form_validate($form, $form_state) {
   $node = $form['#entity'];
   field_attach_validate('node', $node);
   node_validate($node, $form, $form_state);
+  if ((!module_exists('commons_trusted_contacts') || (module_exists('commons_trusted_contacts') && !module_exists('og_access'))) && empty($form_state['group_id']) && empty($form_state['values'][OG_AUDIENCE_FIELD][LANGUAGE_NONE][0])) {
+    form_set_error(OG_AUDIENCE_FIELD, t('Please enter one or more groups where this content will be posted.'));
+    return FALSE;
+  }
 }
 
 /**
@@ -282,11 +286,22 @@ function commons_bw_form_field_ui_field_edit_form_alter(&$form, &$form_state) {
     return;
   }
 
+  // See if we're building for the first time, or getting pre-saved values.
   $field_name = $form['#field']['field_name'];
+  if(!empty($form_state['field'][$field_name][LANGUAGE_NONE]['instance']['display_in_partial_form'])) {
+    $display_default = $form_state['field'][$field_name][LANGUAGE_NONE]['instance']['display_in_partial_form'];
+  }
+  else if (isset($form_state['build_info']['args'][0]['display_in_partial_form'])) {
+    $display_default = $form_state['build_info']['args'][0]['display_in_partial_form'];
+  }
+  else {
+    $display_default = FALSE;
+  }
+
   $form['instance']['display_in_partial_form'] = array(
     '#type' => 'checkbox',
     '#title' => t('Display in the browsing widget mini-form'),
-    '#default_value' => !empty($form_state['field'][$field_name][LANGUAGE_NONE]['instance']['display_in_partial_form']) ? $form_state['field'][$field_name][LANGUAGE_NONE]['instance']['display_in_partial_form'] : FALSE,
+    '#default_value' => $display_default,
   );
 }
 
@@ -307,7 +322,7 @@ function commons_bw_get_tab_definitions($widget_type = 'group') {
  * Helper function to determine whether Commons_BW should define a title
  * field instance on behalf of a content type.
  */
-function commons_bw_node_auto_title_instance($node_type) {  
+function commons_bw_node_auto_title_instance($node_type) {
   $commons_groups_entity_types = commons_groups_get_group_content_entity_types();
   $return = isset($commons_groups_entity_types['node'][$node_type]['auto_title_instance']) ? $commons_groups_entity_types['node'][$node_type]['auto_title_instance'] : TRUE;
   return $return;
diff --git a/modules/commons/commons_bw/js/partial_node_form.js b/modules/commons/commons_bw/js/partial_node_form.js
index 972b3e3..2c4d1a8 100644
--- a/modules/commons/commons_bw/js/partial_node_form.js
+++ b/modules/commons/commons_bw/js/partial_node_form.js
@@ -40,13 +40,23 @@ Drupal.behaviors.commonsBwExpandableForm = {
           }).append(toggleText),
           triggerField = form.find('.trigger-field'),
           fullFormLink = form.find('a.full-form'),
-          hideables = form.find('.hideable-field');
+          hideables = form.find('.hideable-field'),
+          errors = form.find('.error');
 
-      // Add the toggle link to the top of the form.
-      form.prepend(toggle).addClass('expandable-form compact-form');
+      // Determine if the form has any errors.
+      if (!errors.length) {
+        // Forms with errors are shown expanded, so only add the toggle link to
+        // the top of forms which are error free.
+        form.prepend(toggle).addClass('expandable-form compact-form');
 
-      // Hide the hidden fields on load.
-      hideables.addClass('element-invisible');
+        // Hide the hidden fields on load.
+        hideables.addClass('element-invisible');
+      }
+      else {
+        // The full form link is only shown on collapsed forms so it is hidden
+        // for consistency.
+        fullFormLink.addClass('element-hidden');
+      }
 
       // Make all hidden fields visible when the trigger field comes into
       // focus.
diff --git a/modules/commons/commons_content_moderation/commons_content_moderation.info b/modules/commons/commons_content_moderation/commons_content_moderation.info
index 703064f..3dd7cef 100644
--- a/modules/commons/commons_content_moderation/commons_content_moderation.info
+++ b/modules/commons/commons_content_moderation/commons_content_moderation.info
@@ -2,13 +2,11 @@ name = Commons Content moderation
 description = Commons Content moderation
 core = 7.x
 package = Commons - Building Blocks
-project = commons_content_moderation
 dependencies[] = ctools
 dependencies[] = flag
 dependencies[] = flag_abuse
 dependencies[] = strongarm
 dependencies[] = views
-datestamp = 1354747310
 features[ctools][] = strongarm:strongarm:1
 features[ctools][] = views:views_default:3.0
 features[features_api][] = api:2
diff --git a/modules/commons/commons_documents/commons_documents.features.field_instance.inc b/modules/commons/commons_documents/commons_documents.features.field_instance.inc
index c8d7138..008013d 100644
--- a/modules/commons/commons_documents/commons_documents.features.field_instance.inc
+++ b/modules/commons/commons_documents/commons_documents.features.field_instance.inc
@@ -83,7 +83,7 @@ function commons_documents_field_default_field_instances() {
     'settings' => array(
       'description_field' => 1,
       'file_directory' => '',
-      'file_extensions' => 'doc docx xls xlsx ppt pptx odt odp ods pdf',
+      'file_extensions' => 'txt doc docx xls xlsx ppt pptx odt odp ods pdf',
       'max_filesize' => '',
       'user_register_form' => FALSE,
     ),
diff --git a/modules/commons/commons_documents/commons_documents.info b/modules/commons/commons_documents/commons_documents.info
index ab82144..4ab55b1 100644
--- a/modules/commons/commons_documents/commons_documents.info
+++ b/modules/commons/commons_documents/commons_documents.info
@@ -1,7 +1,6 @@
 name = Commons Documents
 core = 7.x
 package = Commons - Content types
-project = commons_documents
 dependencies[] = commons_body
 dependencies[] = commons_groups
 dependencies[] = commons_topics
diff --git a/modules/commons/commons_documents/commons_documents.install b/modules/commons/commons_documents/commons_documents.install
index 6bfcd2a..3b00af8 100644
--- a/modules/commons/commons_documents/commons_documents.install
+++ b/modules/commons/commons_documents/commons_documents.install
@@ -43,3 +43,36 @@ function commons_documents_update_7003() {
   features_revert($revert);
   return array();
 }
+
+/**
+ * Display sticky content at top of lists.
+ */
+function commons_documents_update_7004() {
+  $revert = array(
+    'commons_documents' => array('views_view'),
+  );
+  features_revert($revert);
+  return array();
+}
+
+/**
+ * Add .txt to the list of allowed file extensions.
+ */
+function commons_documents_update_7005() {
+  $revert = array(
+    'commons_documents' => array('field_instance'),
+  );
+  features_revert($revert);
+  return array();
+}
+
+/**
+ * Add links to node teasers in the browsing widget.
+ */
+function commons_documents_update_7006() {
+  $revert = array(
+    'commons_documents' => array('views_view'),
+  );
+  features_revert($revert);
+  return array();
+}
diff --git a/modules/commons/commons_documents/commons_documents.module b/modules/commons/commons_documents/commons_documents.module
index b65e298..de94e87 100644
--- a/modules/commons/commons_documents/commons_documents.module
+++ b/modules/commons/commons_documents/commons_documents.module
@@ -85,7 +85,7 @@ function commons_documents_views_pre_render(&$view) {
 }
 
 /**
- * Implements hook_commons_entity_integration.
+ * Implements hook_commons_entity_integration().
  */
 function commons_documents_commons_entity_integration() {
   return array(
diff --git a/modules/commons/commons_documents/commons_documents.views_default.inc b/modules/commons/commons_documents/commons_documents.views_default.inc
index 4b21a2d..faa8352 100644
--- a/modules/commons/commons_documents/commons_documents.views_default.inc
+++ b/modules/commons/commons_documents/commons_documents.views_default.inc
@@ -36,7 +36,6 @@ function commons_documents_views_default_views() {
   $handler->display->display_options['pager']['options']['quantity'] = '9';
   $handler->display->display_options['style_plugin'] = 'default';
   $handler->display->display_options['row_plugin'] = 'node';
-  $handler->display->display_options['row_options']['links'] = FALSE;
   /* Header: Global: Node partial form */
   $handler->display->display_options['header']['commons_bw_node_partial_form']['id'] = 'commons_bw_node_partial_form';
   $handler->display->display_options['header']['commons_bw_node_partial_form']['table'] = 'views';
@@ -64,6 +63,7 @@ function commons_documents_views_default_views() {
   $handler->display->display_options['sorts']['sticky']['id'] = 'sticky';
   $handler->display->display_options['sorts']['sticky']['table'] = 'node';
   $handler->display->display_options['sorts']['sticky']['field'] = 'sticky';
+  $handler->display->display_options['sorts']['sticky']['order'] = 'DESC';
   /* Sort criterion: Content: Post date */
   $handler->display->display_options['sorts']['created']['id'] = 'created';
   $handler->display->display_options['sorts']['created']['table'] = 'node';
diff --git a/modules/commons/commons_events/commons_events.info b/modules/commons/commons_events/commons_events.info
index 485a8ea..cb67595 100644
--- a/modules/commons/commons_events/commons_events.info
+++ b/modules/commons/commons_events/commons_events.info
@@ -2,7 +2,6 @@ name = Commons Events
 description = Provides the Event features for Drupal Commons.
 core = 7.x
 package = Commons - Content types
-project = commons_events
 dependencies[] = addressfield
 dependencies[] = addressfield_tokens
 dependencies[] = block
@@ -29,17 +28,14 @@ dependencies[] = og
 dependencies[] = options
 dependencies[] = page_manager
 dependencies[] = radioactivity
-dependencies[] = rdf
 dependencies[] = registration
 dependencies[] = registration_views
-dependencies[] = schemaorg
 dependencies[] = strongarm
 dependencies[] = taxonomy
 dependencies[] = text
 dependencies[] = views
 dependencies[] = views_content
 dependencies[] = views_load_more
-datestamp = 1357735760
 features[ctools][] = page_manager:pages_default:1
 features[ctools][] = strongarm:strongarm:1
 features[ctools][] = views:views_default:3.0
diff --git a/modules/commons/commons_events/commons_events.module b/modules/commons/commons_events/commons_events.module
index f055a12..a8c7d44 100644
--- a/modules/commons/commons_events/commons_events.module
+++ b/modules/commons/commons_events/commons_events.module
@@ -85,7 +85,7 @@ function commons_events_theme($existing, $type, $theme, $path) {
         'attributes_end' => array(),
         'rdf_mapping' => NULL,
         'add_rdf' => NULL,
-      )
+      ),
     ),
     'commons_events_date_display_range_simple' => array(
       'variables' => array(
@@ -102,7 +102,7 @@ function commons_events_theme($existing, $type, $theme, $path) {
         'attributes_end' => array(),
         'rdf_mapping' => NULL,
         'add_rdf' => NULL,
-      )
+      ),
     ),
   );
 }
@@ -207,7 +207,7 @@ function commons_events_entity_view_alter(&$build, $type) {
 }
 
 /**
- * Implements hook_form_FORM_ID_alter();
+ * Implements hook_form_FORM_ID_alter().
  */
 function commons_events_form_node_form_alter(&$form, &$form_state) {
   if ($form_state['node']->type == 'event') {
@@ -285,7 +285,7 @@ function commons_events_form_node_form_alter(&$form, &$form_state) {
 }
 
 /**
- * Implements hook_commons_entity_integration.
+ * Implements hook_commons_entity_integration().
  */
 function commons_events_commons_entity_integration() {
   return array(
@@ -481,8 +481,9 @@ function commons_events_block_view($delta = '') {
 }
 
 /**
- * Returns specific HTML for a date element formatted with the event formatter M j Y - g:ia
- * We the do some awesome stuff with regular expressions to take all the different formats available to us and format it pretty.
+ * Returns specific HTML for a date element formatted with the event formatter M j Y - g:ia.
+ * We the do some awesome stuff with regular expressions to take all the
+ * different formats available to us and format it pretty.
  */
 function theme_commons_events_date_display_range_simple($variables) {
   // Use the regular date formatter if we are any other date format than below.
@@ -517,7 +518,8 @@ function theme_commons_events_date_display_single($variables) {
 }
 /**
  * Returns specific HTML for a date element formatted with the event formatter.
- * We parse the date segments and return it at the bottom, or use the simple formatter (above) if parts of the date are too complicated.
+ * We parse the date segments and return it at the bottom, or use the simple
+ * formatter (above) if parts of the date are too complicated.
  */
 function theme_commons_events_date_display_range_advanced($variables) {
   $timezone = $variables['timezone'];
@@ -544,7 +546,7 @@ function theme_commons_events_date_display_range_advanced($variables) {
     $date2 = $variables['dates']['value2']['db']['object']->format($variables['dates']['format'],FALSE);
   }
   else if ($variables['dates']['value']['db']['object']->difference($variables['dates']['value2']['db']['object'], 'days') > 0) {
-    // If the Day is before the month (IE Europe, etc) then switch the granularity
+    // If the Day is before the month (Europe, etc) then switch the granularity.
     if (strpos($variables['dates']['format'],'M') != 0 || strpos($variables['dates']['format'],'m') != 0 ||
        strpos($variables['dates']['format'],'F') != 0 || strpos($variables['dates']['format'],'n') != 0) {
       $variables['dates']['value']['db']['object']->limitGranularity(array('day'));
@@ -557,7 +559,8 @@ function theme_commons_events_date_display_range_advanced($variables) {
     $date1 = $variables['dates']['value']['db']['object']->format($variables['dates']['format'],FALSE);
     $date2 = $variables['dates']['value2']['db']['object']->format($variables['dates']['format'],FALSE);
 
-    // If we are match 'D' or 'l', it means we have a 'day' in there (eg: Monday), we want the whole date because it looks funky otherwise.
+    // If we are match 'D' or 'l', then we have a 'day' in there (eg Monday),
+    // we want the whole date because it looks funky otherwise.
     if (strpbrk($variables['dates']['format'], 'Dl')) {
       return theme('commons_events_date_display_range_simple',$variables);
     }
diff --git a/modules/commons/commons_events/includes/commons_events.theme.inc b/modules/commons/commons_events/includes/commons_events.theme.inc
index 4b75e52..0a45515 100644
--- a/modules/commons/commons_events/includes/commons_events.theme.inc
+++ b/modules/commons/commons_events/includes/commons_events.theme.inc
@@ -11,9 +11,7 @@ function theme_commons_events_attending_event($variables = array()) {
   global $user;
   $event = $variables['event'];
   $attendee_count = $variables['attendee_count'];
-  if (!registration_status('node', $event->nid, TRUE)) {
-    return "";
-  }
+
   $registration_type = registration_get_entity_registration_type('node', $event);
   $registration = entity_get_controller('registration')->create(array(
     'entity_type' => 'node',
@@ -21,15 +19,18 @@ function theme_commons_events_attending_event($variables = array()) {
     'type' => $registration_type,
     'author_uid' => $user->uid,
   ));
+
   if (!function_exists('commons_events_attend_event_form')
     || !function_exists('commons_events_cancel_event_form')) {
     module_load_include('inc', 'commons_events', 'includes/commons_events.forms');
   }
   if (!registration_is_registered($registration, NULL, $user->uid)
-    && registration_access('create', $registration, $user, $registration->type)) {
+    && registration_access('create', $registration, $user, $registration->type)
+    && registration_status('node', $event->nid, TRUE)) {
     return drupal_get_form('commons_events_attend_event_form_' . $event->nid, $event, $registration, $attendee_count);
   }
-  else if (registration_access('delete', $registration, $user, $registration->type)) {
+  else if (registration_is_registered($registration, NULL, $user->uid) &&
+    registration_access('delete', $registration, $user, $registration->type)) {
     return drupal_get_form('commons_events_cancel_event_form_' . $event->nid, $event);
   }
   return "";
diff --git a/modules/commons/commons_events/modules/commons_events_pages/commons_events_pages.info b/modules/commons/commons_events/modules/commons_events_pages/commons_events_pages.info
index 4ecdb47..d2db9b5 100644
--- a/modules/commons/commons_events/modules/commons_events_pages/commons_events_pages.info
+++ b/modules/commons/commons_events/modules/commons_events_pages/commons_events_pages.info
@@ -2,11 +2,9 @@ name = Commons Events Pages
 description = Provides the panelized Event page feature.
 core = 7.x
 package = Commons - Landing pages
-project = commons_events_pages
 dependencies[] = commons_events
 dependencies[] = panelizer
 dependencies[] = strongarm
-datestamp = 1357735760
 features[ctools][] = panelizer:panelizer:1
 features[ctools][] = strongarm:strongarm:1
 features[features_api][] = api:2
diff --git a/modules/commons/commons_events/modules/commons_events_solr/commons_events_solr.info b/modules/commons/commons_events/modules/commons_events_solr/commons_events_solr.info
index 1d22fab..4cc30fb 100644
--- a/modules/commons/commons_events/modules/commons_events_solr/commons_events_solr.info
+++ b/modules/commons/commons_events/modules/commons_events_solr/commons_events_solr.info
@@ -2,7 +2,6 @@ name = Commons Events - Solr
 description = Provides the Solr based faceted search for events
 core = 7.x
 package = Commons - Search
-project = commons_events_solr
 dependencies[] = apachesolr_search
 dependencies[] = commons_events
 dependencies[] = ctools
diff --git a/modules/commons/commons_featured/commons_featured.info b/modules/commons/commons_featured/commons_featured.info
index cbd43cc..5edbd0e 100644
--- a/modules/commons/commons_featured/commons_featured.info
+++ b/modules/commons/commons_featured/commons_featured.info
@@ -2,10 +2,8 @@ name = Commons Featured Content
 description = Allows community managers to display certain pieces of content more prominently on the site.
 core = 7.x
 package = Commons - Building blocks
-project = commons_featured
 dependencies[] = views
 dependencies[] = views_content
-datestamp = 1354747305
 features[ctools][] = views:views_default:3.0
 features[features_api][] = api:2
 features[views_view][] = commons_featured
diff --git a/modules/commons/commons_follow/commons-follow-otheruser-flag.tpl.php b/modules/commons/commons_follow/commons-follow-otheruser-flag.tpl.php
new file mode 100644
index 0000000..7a028bd
--- /dev/null
+++ b/modules/commons/commons_follow/commons-follow-otheruser-flag.tpl.php
@@ -0,0 +1,3 @@
+<span class="<?php print $flag_wrapper_classes; ?>">
+   <span class="<?php print $flag_classes ?>"><?php print $link_text; ?></span>
+</span>
diff --git a/modules/commons/commons_follow/commons_follow.info b/modules/commons/commons_follow/commons_follow.info
index 884315a..b76b195 100644
--- a/modules/commons/commons_follow/commons_follow.info
+++ b/modules/commons/commons_follow/commons_follow.info
@@ -2,14 +2,12 @@ name = Commons Follow
 description = Views and Field integration for Commons Following functionality.
 core = 7.x
 package = Commons - Building blocks
-project = commons_follow
 dependencies[] = ctools
 dependencies[] = entityreference
 dependencies[] = features
 dependencies[] = field_sql_storage
 dependencies[] = message_subscribe
 dependencies[] = strongarm
-datestamp = 1354747305
 features[ctools][] = strongarm:strongarm:1
 features[features_api][] = api:2
 features[field_base][] = field_target_comments
@@ -24,3 +22,4 @@ files[] = includes/views/handlers/commons_follow_plugin_argument_default_node.in
 files[] = includes/views/handlers/commons_follow_plugin_argument_default_message.inc
 files[] = includes/views/handlers/commons_follow_user_follow_filter.inc
 files[] = includes/views/handlers/commons_follow_user_follow_filter_message.inc
+files[] = includes/views/handlers/commons_follow_handler_field_ops.inc
\ No newline at end of file
diff --git a/modules/commons/commons_follow/commons_follow.module b/modules/commons/commons_follow/commons_follow.module
index ed60c9a..e301be2 100644
--- a/modules/commons/commons_follow/commons_follow.module
+++ b/modules/commons/commons_follow/commons_follow.module
@@ -2,7 +2,22 @@
 
 include_once 'commons_follow.features.inc';
 
-
+/**
+ * Implements hook_theme().
+ */
+function commons_follow_theme() {
+  return array(
+    'commons_follow_otheruser_flag' => array(
+      'variables' => array(
+        'is_flagged' => NULL,
+        'link_text' => NULL,
+        'flag_wrapper_classes' => NULL,
+        'flag_classes' => NULL,
+      ),
+      'template' => 'commons-follow-otheruser-flag',
+    ),
+  );
+}
 
 /**
  * Implements hook_features_pipe_alter().
@@ -104,7 +119,7 @@ function commons_follow_flag_export_alter(&$flag) {
  * Implements hook_flag_alter().
  */
 function commons_follow_flag_alter(&$flag) {
-  $commons_entity_integrations = module_invoke_all('commons_entity_integration');
+  $commons_entity_integrations = commons_entity_integration_info();
   // Find Commons node types that should have follow integration and alter
   // the commons_follow_node flag to allow following these node types.
   // This is currently hard-coded to node entities and the
@@ -198,10 +213,8 @@ function commons_follow_get_subscription_flags_ids($content_type = NULL, $conten
   return $flag_ids;
 }
 
-///////////////////
-
 /**
- * Implementation of hook_views_api().
+ * Implements hook_views_api().
  */
 function commons_follow_views_api() {
   return array(
@@ -283,3 +296,27 @@ function commons_follow_get_followed_message_ids($account = NULL) {
   }
   return $followed_mids;
 }
+
+function commons_follow_views_data_alter(&$data) {
+  $data['flag_content']['ops']['field']['handler'] = 'commons_follow_handler_field_ops';
+}
+
+function commons_follow_views_query_alter(&$view, &$query) {
+  global $user;
+  $prefix = variable_get('message_subscribe_flag_prefix', 'subscribe') . '_';
+  if(strpos($view->name, $prefix) === 0 && isset($view->args[0]) && $user->uid != $view->args[0]) {
+    $flag_content_keys = array_keys($query->table_queue);
+    foreach($flag_content_keys AS $key) {
+      if(strpos($key, 'flag_content') === 0) {
+        //Convert the Send Email Query
+        $join = $query->table_queue[$key]['join'];
+        $join->extra[1] = array(
+          'field' => 'uid',
+          'value' => $view->args[0],
+          'numeric' => TRUE,
+        );
+        $query->table_queue[$key]['join'] = $join;
+      }
+    }
+  }
+}
\ No newline at end of file
diff --git a/modules/commons/commons_follow/commons_follow_group/commons_follow_group.info b/modules/commons/commons_follow/commons_follow_group/commons_follow_group.info
index 68503a2..aacc282 100644
--- a/modules/commons/commons_follow/commons_follow_group/commons_follow_group.info
+++ b/modules/commons/commons_follow/commons_follow_group/commons_follow_group.info
@@ -2,12 +2,10 @@ name = Commons Follow (Groups)
 description = Lets users follow individual organic groups.
 core = 7.x
 package = Commons - Building blocks
-project = commons_follow
 dependencies[] = ctools
 dependencies[] = flag
 dependencies[] = og
 dependencies[] = strongarm
-datestamp = 1352387638
 features[ctools][] = strongarm:strongarm:1
 features[features_api][] = api:2
 features[flag][] = commons_follow_group
diff --git a/modules/commons/commons_follow/commons_follow_group/commons_follow_group.module b/modules/commons/commons_follow/commons_follow_group/commons_follow_group.module
index bff49f2..f203a47 100644
--- a/modules/commons/commons_follow/commons_follow_group/commons_follow_group.module
+++ b/modules/commons/commons_follow/commons_follow_group/commons_follow_group.module
@@ -104,3 +104,50 @@ function commons_follow_group_node_insert($node) {
   $flag = flag_get_flag('commons_follow_group');
   $flag->flag('flag', $node->nid, $account);
 }
+
+
+/**
+ * Implements hook_og_membership_insert().
+ * Invoked from hook_entity_insert().
+ */
+function commons_follow_group_og_membership_insert(OgMembership $og_membership) {
+  commons_follow_group_sync_flag_to_group_membership($og_membership);
+}
+
+/**
+ * Implements hook_og_membership_update().
+ * Invoked from hook_entity_update().
+ */
+function commons_follow_group_og_membership_update(OgMembership $og_membership) {
+  commons_follow_group_sync_flag_to_group_membership($og_membership);
+}
+
+/**
+ * Implements hook_og_membership_delete().
+ * Invoked from hook_entity_delete().
+ */
+function commons_follow_group_og_membership_delete(OgMembership $og_membership) {
+  // The user should unfollow the group when her membership is deleted.
+  if ($og_membership->entity_type == 'user' && $og_membership->field_name == 'og_user_node') {
+    $account = user_load($og_membership->etid);
+    flag('unflag', 'commons_follow_group', $og_membership->gid, $account);    
+  }
+}
+
+// function flag($action, $flag_name, $content_id, $account = NULL) {
+
+function commons_follow_group_sync_flag_to_group_membership($og_membership) {
+  if ($og_membership->entity_type == 'user' && $og_membership->field_name == 'og_user_node') {
+    $account = user_load($og_membership->etid);
+    // The membership is approved. The user should follow the group.
+    if ($og_membership->state == 1) {
+      flag('flag', 'commons_follow_group', $og_membership->gid, $account);    
+    }
+    // The membership is not approved. The user should not follow the group.
+    else {
+      flag('unflag', 'commons_follow_group', $og_membership->gid, $account);    
+    }
+  }
+}
+  
+
diff --git a/modules/commons/commons_follow/commons_follow_node/commons_follow_node.info b/modules/commons/commons_follow/commons_follow_node/commons_follow_node.info
index a22ad5f..91d481d 100644
--- a/modules/commons/commons_follow/commons_follow_node/commons_follow_node.info
+++ b/modules/commons/commons_follow/commons_follow_node/commons_follow_node.info
@@ -2,11 +2,9 @@ name = Commons Follow (Individual nodes)
 description = Lets users follow individual nodes.
 core = 7.x
 package = Commons - Building blocks
-project = commons_follow
 dependencies[] = ctools
 dependencies[] = flag
 dependencies[] = views_litepager
-datestamp = 1356630025
 features[ctools][] = views:views_default:3.0
 features[features_api][] = api:2
 features[flag][] = commons_follow_node
diff --git a/modules/commons/commons_follow/commons_follow_node/commons_follow_node.install b/modules/commons/commons_follow/commons_follow_node/commons_follow_node.install
index fbbcb99..6d08f0c 100644
--- a/modules/commons/commons_follow/commons_follow_node/commons_follow_node.install
+++ b/modules/commons/commons_follow/commons_follow_node/commons_follow_node.install
@@ -6,4 +6,16 @@
 function commons_follow_node_update_3101() {
   features_revert(array('commons_follow_node' => array('flag')));
   return array();
+}
+
+/**
+ * Update profile notification page to show an account's following views
+ * Not the current users following view.
+ */
+function commons_follow_node_update_3501() {
+  $revert = array(
+    'commons_follow_node' => array('views_view'),
+  );
+  features_revert($revert);
+  return array();
 }
\ No newline at end of file
diff --git a/modules/commons/commons_follow/commons_follow_node/commons_follow_node.views_default.inc b/modules/commons/commons_follow/commons_follow_node/commons_follow_node.views_default.inc
index 4598cfc..8db8038 100644
--- a/modules/commons/commons_follow/commons_follow_node/commons_follow_node.views_default.inc
+++ b/modules/commons/commons_follow/commons_follow_node/commons_follow_node.views_default.inc
@@ -27,6 +27,7 @@ function commons_follow_node_views_default_views() {
   $handler->display->display_options['access']['type'] = 'perm';
   $handler->display->display_options['cache']['type'] = 'none';
   $handler->display->display_options['query']['type'] = 'views_query';
+  $handler->display->display_options['query']['options']['distinct'] = TRUE;
   $handler->display->display_options['exposed_form']['type'] = 'basic';
   $handler->display->display_options['pager']['type'] = 'lite';
   $handler->display->display_options['pager']['options']['items_per_page'] = '20';
@@ -72,6 +73,7 @@ function commons_follow_node_views_default_views() {
   $handler->display->display_options['relationships']['flag_content_rel']['table'] = 'node';
   $handler->display->display_options['relationships']['flag_content_rel']['field'] = 'flag_content_rel';
   $handler->display->display_options['relationships']['flag_content_rel']['flag'] = 'commons_follow_node';
+  $handler->display->display_options['relationships']['flag_content_rel']['user_scope'] = 'any';
   /* Relationship: Flags: email_node */
   $handler->display->display_options['relationships']['flag_content_rel_1']['id'] = 'flag_content_rel_1';
   $handler->display->display_options['relationships']['flag_content_rel_1']['table'] = 'node';
@@ -79,6 +81,12 @@ function commons_follow_node_views_default_views() {
   $handler->display->display_options['relationships']['flag_content_rel_1']['label'] = 'email_flag';
   $handler->display->display_options['relationships']['flag_content_rel_1']['required'] = 0;
   $handler->display->display_options['relationships']['flag_content_rel_1']['flag'] = 'email_node';
+  $handler->display->display_options['relationships']['flag_content_rel_1']['user_scope'] = 'any';
+  /* Relationship: Flags: User */
+  $handler->display->display_options['relationships']['uid']['id'] = 'uid';
+  $handler->display->display_options['relationships']['uid']['table'] = 'flag_content';
+  $handler->display->display_options['relationships']['uid']['field'] = 'uid';
+  $handler->display->display_options['relationships']['uid']['relationship'] = 'flag_content_rel';
   /* Field: Content: Title */
   $handler->display->display_options['fields']['title']['id'] = 'title';
   $handler->display->display_options['fields']['title']['table'] = 'node';
@@ -106,6 +114,19 @@ function commons_follow_node_views_default_views() {
   $handler->display->display_options['sorts']['timestamp']['field'] = 'timestamp';
   $handler->display->display_options['sorts']['timestamp']['relationship'] = 'flag_content_rel';
   $handler->display->display_options['sorts']['timestamp']['order'] = 'DESC';
+  /* Contextual filter: User: Uid */
+  $handler->display->display_options['arguments']['uid']['id'] = 'uid';
+  $handler->display->display_options['arguments']['uid']['table'] = 'users';
+  $handler->display->display_options['arguments']['uid']['field'] = 'uid';
+  $handler->display->display_options['arguments']['uid']['relationship'] = 'uid';
+  $handler->display->display_options['arguments']['uid']['default_action'] = 'default';
+  $handler->display->display_options['arguments']['uid']['default_argument_type'] = 'user';
+  $handler->display->display_options['arguments']['uid']['default_argument_options']['user'] = FALSE;
+  $handler->display->display_options['arguments']['uid']['summary']['number_of_records'] = '0';
+  $handler->display->display_options['arguments']['uid']['summary']['format'] = 'default_summary';
+  $handler->display->display_options['arguments']['uid']['summary_options']['items_per_page'] = '25';
+  $handler->display->display_options['arguments']['uid']['specify_validation'] = TRUE;
+  $handler->display->display_options['arguments']['uid']['validate']['type'] = 'user';
   /* Filter criterion: Content: Published */
   $handler->display->display_options['filters']['status']['id'] = 'status';
   $handler->display->display_options['filters']['status']['table'] = 'node';
@@ -113,6 +134,12 @@ function commons_follow_node_views_default_views() {
   $handler->display->display_options['filters']['status']['value'] = 1;
   $handler->display->display_options['filters']['status']['group'] = 1;
   $handler->display->display_options['filters']['status']['expose']['operator'] = FALSE;
+  /* Filter criterion: Content: Type */
+  $handler->display->display_options['filters']['type']['id'] = 'type';
+  $handler->display->display_options['filters']['type']['table'] = 'node';
+  $handler->display->display_options['filters']['type']['field'] = 'type';
+  $handler->display->display_options['filters']['type']['operator'] = 'not empty';
+  $handler->display->display_options['filters']['type']['value'] = array();
   $translatables['commons_follow_node'] = array(
     t('Master'),
     t('more'),
diff --git a/modules/commons/commons_follow/commons_follow_term/commons_follow_term.info b/modules/commons/commons_follow/commons_follow_term/commons_follow_term.info
index 795de81..cc99417 100644
--- a/modules/commons/commons_follow/commons_follow_term/commons_follow_term.info
+++ b/modules/commons/commons_follow/commons_follow_term/commons_follow_term.info
@@ -2,11 +2,9 @@ name = Commons Follow (Taxonomy terms)
 description = Lets users follow individual taxonomy terms
 core = 7.x
 package = Commons - Building blocks
-project = commons_follow
 dependencies[] = flag
 dependencies[] = views
 dependencies[] = views_litepager
-datestamp = 1356630025
 features[ctools][] = views:views_default:3.0
 features[features_api][] = api:2
 features[flag][] = commons_follow_term
diff --git a/modules/commons/commons_follow/commons_follow_term/commons_follow_term.install b/modules/commons/commons_follow/commons_follow_term/commons_follow_term.install
index 31bda83..77c4c76 100644
--- a/modules/commons/commons_follow/commons_follow_term/commons_follow_term.install
+++ b/modules/commons/commons_follow/commons_follow_term/commons_follow_term.install
@@ -15,3 +15,15 @@ function commons_follow_term_update_3102() {
   features_revert(array('commons_follow_term' => array('flag')));
   return array();
 }
+
+/**
+ * Update profile notification page to show an account's following views
+ * Not the current users following view.
+ */
+function commons_follow_term_update_3501() {
+  $revert = array(
+    'commons_follow_term' => array('views_view'),
+  );
+  features_revert($revert);
+  return array();
+}
\ No newline at end of file
diff --git a/modules/commons/commons_follow/commons_follow_term/commons_follow_term.views_default.inc b/modules/commons/commons_follow/commons_follow_term/commons_follow_term.views_default.inc
index be1fa62..21e785a 100644
--- a/modules/commons/commons_follow/commons_follow_term/commons_follow_term.views_default.inc
+++ b/modules/commons/commons_follow/commons_follow_term/commons_follow_term.views_default.inc
@@ -72,6 +72,7 @@ function commons_follow_term_views_default_views() {
   $handler->display->display_options['relationships']['flag_content_rel']['table'] = 'taxonomy_term_data';
   $handler->display->display_options['relationships']['flag_content_rel']['field'] = 'flag_content_rel';
   $handler->display->display_options['relationships']['flag_content_rel']['flag'] = 'commons_follow_term';
+  $handler->display->display_options['relationships']['flag_content_rel']['user_scope'] = 'any';
   /* Relationship: Flags: email_term */
   $handler->display->display_options['relationships']['flag_content_rel_1']['id'] = 'flag_content_rel_1';
   $handler->display->display_options['relationships']['flag_content_rel_1']['table'] = 'taxonomy_term_data';
@@ -79,6 +80,12 @@ function commons_follow_term_views_default_views() {
   $handler->display->display_options['relationships']['flag_content_rel_1']['label'] = 'email_flag';
   $handler->display->display_options['relationships']['flag_content_rel_1']['required'] = 0;
   $handler->display->display_options['relationships']['flag_content_rel_1']['flag'] = 'email_term';
+  $handler->display->display_options['relationships']['flag_content_rel_1']['user_scope'] = 'any';
+  /* Relationship: Flags: User */
+  $handler->display->display_options['relationships']['uid']['id'] = 'uid';
+  $handler->display->display_options['relationships']['uid']['table'] = 'flag_content';
+  $handler->display->display_options['relationships']['uid']['field'] = 'uid';
+  $handler->display->display_options['relationships']['uid']['relationship'] = 'flag_content_rel';
   /* Field: Taxonomy term: Name */
   $handler->display->display_options['fields']['name']['id'] = 'name';
   $handler->display->display_options['fields']['name']['table'] = 'taxonomy_term_data';
@@ -107,6 +114,7 @@ function commons_follow_term_views_default_views() {
   $handler->display->display_options['sorts']['timestamp']['relationship'] = 'flag_content_rel';
   $handler->display->display_options['sorts']['timestamp']['order'] = 'DESC';
   $translatables['commons_follow_taxonomy_term'] = array(
+  /* Contextual filter: User: Uid */
     t('Master'),
     t('more'),
     t('Apply'),
@@ -127,6 +135,19 @@ function commons_follow_term_views_default_views() {
     t('Topic'),
     t('Send email?'),
   );
+  $handler->display->display_options['arguments']['uid']['id'] = 'uid';
+  $handler->display->display_options['arguments']['uid']['table'] = 'users';
+  $handler->display->display_options['arguments']['uid']['field'] = 'uid';
+  $handler->display->display_options['arguments']['uid']['relationship'] = 'uid';
+  $handler->display->display_options['arguments']['uid']['default_action'] = 'default';
+  $handler->display->display_options['arguments']['uid']['default_argument_type'] = 'user';
+  $handler->display->display_options['arguments']['uid']['default_argument_options']['user'] = FALSE;
+  $handler->display->display_options['arguments']['uid']['summary']['number_of_records'] = '0';
+  $handler->display->display_options['arguments']['uid']['summary']['format'] = 'default_summary';
+  $handler->display->display_options['arguments']['uid']['summary_options']['items_per_page'] = '25';
+  $handler->display->display_options['arguments']['uid']['specify_validation'] = TRUE;
+  $handler->display->display_options['arguments']['uid']['validate']['type'] = 'user';
+  $handler->display->display_options['arguments']['uid']['validate_options']['type'] = 'either';
   $export['commons_follow_taxonomy_term'] = $view;
 
   return $export;
diff --git a/modules/commons/commons_follow/commons_follow_ui/commons_follow_ui.commons_utility_links.inc b/modules/commons/commons_follow/commons_follow_ui/commons_follow_ui.commons_utility_links.inc
new file mode 100644
index 0000000..172c3cb
--- /dev/null
+++ b/modules/commons/commons_follow/commons_follow_ui/commons_follow_ui.commons_utility_links.inc
@@ -0,0 +1,25 @@
+<?php
+
+/**
+ * @file
+ * Commons Utility Links hooks implemented by the Commons Follow UI module.
+ */
+
+/**
+ * Implements hook_commons_utility_links().
+ */
+function commons_follow_ui_commons_utility_links() {
+  $links = array();
+
+  if (user_is_logged_in()) {
+    global $user;
+    $account = $user;
+    $links['settings']= array(
+      'href' => 'user/' . $account->uid . '/notification-settings',
+      'title' => t('Settings'),
+      'weight' => 10,
+    );
+  }
+
+  return $links;
+}
diff --git a/modules/commons/commons_follow/commons_follow_ui/commons_follow_ui.module b/modules/commons/commons_follow/commons_follow_ui/commons_follow_ui.module
index f8ebd9b..18c46c5 100644
--- a/modules/commons/commons_follow/commons_follow_ui/commons_follow_ui.module
+++ b/modules/commons/commons_follow/commons_follow_ui/commons_follow_ui.module
@@ -48,23 +48,9 @@ function commons_follow_ui_form_alter(&$form, &$form_state, $form_id) {
   }
 }
 
-/**
- * Implements hook_commons_utility_links().
- */
-function commons_follow_ui_commons_utility_links_alter(&$links) {
-  global $user;
-  $account = $user;
-  if ($account->uid > 0) {
-    $links['settings']= array(
-      'href' => 'user/' . $account->uid . '/notification-settings',
-      'title' => t('Settings'),
-    );
-  }
-}
-
 function commons_follow_ui_notification_settings_form($form, &$form_state, $account) {
+  global $user;
   if (empty($account)) {
-    global $user;
     $account = $user;
   }
   drupal_set_title(t('Notification settings'));
@@ -88,6 +74,9 @@ function commons_follow_ui_notification_settings_form($form, &$form_state, $acco
     '#default_value' => isset($account->message_subscribe_email[LANGUAGE_NONE][0]['value']) ? $account->message_subscribe_email[LANGUAGE_NONE][0]['value'] : FALSE,
     '#weight' => 1,
   );
+  if($account != $user) {
+    $form['message_subscribe_email']['#disabled'] = TRUE;
+  }
 
   $form['submit'] = array(
     '#type' => 'submit',
diff --git a/modules/commons/commons_follow/commons_follow_user/commons_follow_user.info b/modules/commons/commons_follow/commons_follow_user/commons_follow_user.info
index 27dd695..947d59d 100644
--- a/modules/commons/commons_follow/commons_follow_user/commons_follow_user.info
+++ b/modules/commons/commons_follow/commons_follow_user/commons_follow_user.info
@@ -2,7 +2,6 @@ name = Commons Follow (Users)
 description = Lets users follow other users.
 core = 7.x
 package = Commons - Building blocks
-project = commons_follow
 dependencies[] = commons_follow
 dependencies[] = entityreference
 dependencies[] = flag
@@ -11,7 +10,6 @@ dependencies[] = views
 dependencies[] = views_content
 dependencies[] = views_litepager
 dependencies[] = views_load_more
-datestamp = 1356630025
 features[ctools][] = views:views_default:3.0
 features[features_api][] = api:2
 features[field_instance][] = message-commons_follow_user_user_followed-field_target_users
diff --git a/modules/commons/commons_follow/commons_follow_user/commons_follow_user.install b/modules/commons/commons_follow/commons_follow_user/commons_follow_user.install
index 157ef4e..e5e35a5 100644
--- a/modules/commons/commons_follow/commons_follow_user/commons_follow_user.install
+++ b/modules/commons/commons_follow/commons_follow_user/commons_follow_user.install
@@ -6,4 +6,24 @@
 function commons_follow_user_update_3101() {
   features_revert(array('commons_follow_user' => array('flag')));
   return array();
+}
+
+/**
+ * Correct a typo in the title of the follows view.
+ */
+function commons_follow_user_update_3102() {
+  features_revert(array('commons_follow_user' => array('views_view')));
+  return array();
+}
+
+/**
+ * Update profile notification page to show an account's following views
+ * Not the current users following view.
+ */
+function commons_follow_user_update_3501() {
+  $revert = array(
+    'commons_follow_user' => array('views_view'),
+  );
+  features_revert($revert);
+  return array();
 }
\ No newline at end of file
diff --git a/modules/commons/commons_follow/commons_follow_user/commons_follow_user.views_default.inc b/modules/commons/commons_follow/commons_follow_user/commons_follow_user.views_default.inc
index da6b6cd..fa18e54 100644
--- a/modules/commons/commons_follow/commons_follow_user/commons_follow_user.views_default.inc
+++ b/modules/commons/commons_follow/commons_follow_user/commons_follow_user.views_default.inc
@@ -73,6 +73,7 @@ function commons_follow_user_views_default_views() {
   $handler->display->display_options['relationships']['flag_content_rel']['table'] = 'users';
   $handler->display->display_options['relationships']['flag_content_rel']['field'] = 'flag_content_rel';
   $handler->display->display_options['relationships']['flag_content_rel']['flag'] = 'commons_follow_user';
+  $handler->display->display_options['relationships']['flag_content_rel']['user_scope'] = 'any';
   /* Relationship: Flags: email_user */
   $handler->display->display_options['relationships']['flag_content_rel_1']['id'] = 'flag_content_rel_1';
   $handler->display->display_options['relationships']['flag_content_rel_1']['table'] = 'users';
@@ -80,6 +81,12 @@ function commons_follow_user_views_default_views() {
   $handler->display->display_options['relationships']['flag_content_rel_1']['label'] = 'flag_user';
   $handler->display->display_options['relationships']['flag_content_rel_1']['required'] = 0;
   $handler->display->display_options['relationships']['flag_content_rel_1']['flag'] = 'email_user';
+  $handler->display->display_options['relationships']['flag_content_rel_1']['user_scope'] = 'any';
+  /* Relationship: Flags: User */
+  $handler->display->display_options['relationships']['uid']['id'] = 'uid';
+  $handler->display->display_options['relationships']['uid']['table'] = 'flag_content';
+  $handler->display->display_options['relationships']['uid']['field'] = 'uid';
+  $handler->display->display_options['relationships']['uid']['relationship'] = 'flag_content_rel';
   /* Field: User: Name */
   $handler->display->display_options['fields']['name']['id'] = 'name';
   $handler->display->display_options['fields']['name']['table'] = 'users';
@@ -106,6 +113,20 @@ function commons_follow_user_views_default_views() {
   $handler->display->display_options['sorts']['timestamp']['field'] = 'timestamp';
   $handler->display->display_options['sorts']['timestamp']['relationship'] = 'flag_content_rel';
   $handler->display->display_options['sorts']['timestamp']['order'] = 'DESC';
+  /* Contextual filter: User: Uid */
+  $handler->display->display_options['arguments']['uid']['id'] = 'uid';
+  $handler->display->display_options['arguments']['uid']['table'] = 'users';
+  $handler->display->display_options['arguments']['uid']['field'] = 'uid';
+  $handler->display->display_options['arguments']['uid']['relationship'] = 'uid';
+  $handler->display->display_options['arguments']['uid']['default_action'] = 'default';
+  $handler->display->display_options['arguments']['uid']['default_argument_type'] = 'user';
+  $handler->display->display_options['arguments']['uid']['default_argument_options']['user'] = FALSE;
+  $handler->display->display_options['arguments']['uid']['summary']['number_of_records'] = '0';
+  $handler->display->display_options['arguments']['uid']['summary']['format'] = 'default_summary';
+  $handler->display->display_options['arguments']['uid']['summary_options']['items_per_page'] = '25';
+  $handler->display->display_options['arguments']['uid']['specify_validation'] = TRUE;
+  $handler->display->display_options['arguments']['uid']['validate']['type'] = 'user';
+  $handler->display->display_options['arguments']['uid']['validate_options']['type'] = 'either';
   /* Filter criterion: User: Active */
   $handler->display->display_options['filters']['status']['id'] = 'status';
   $handler->display->display_options['filters']['status']['table'] = 'users';
@@ -369,7 +390,7 @@ function commons_follow_user_views_default_views() {
   /* Display: Page */
   $handler = $view->new_display('page', 'Page', 'page_1');
   $handler->display->display_options['defaults']['title'] = FALSE;
-  $handler->display->display_options['title'] = 'People %1 fllows';
+  $handler->display->display_options['title'] = 'People %1 follows';
   $handler->display->display_options['defaults']['hide_admin_links'] = FALSE;
   $handler->display->display_options['defaults']['use_more'] = FALSE;
   $handler->display->display_options['defaults']['use_more_always'] = FALSE;
@@ -401,7 +422,7 @@ function commons_follow_user_views_default_views() {
     t('more'),
     t('Commons'),
     t('Page'),
-    t('People %1 fllows'),
+    t('People %1 follows'),
     t('Items per page'),
     t('- All -'),
     t('Offset'),
diff --git a/modules/commons/commons_follow/includes/views/handlers/commons_follow_handler_field_ops.inc b/modules/commons/commons_follow/includes/views/handlers/commons_follow_handler_field_ops.inc
new file mode 100644
index 0000000..3770782
--- /dev/null
+++ b/modules/commons/commons_follow/includes/views/handlers/commons_follow_handler_field_ops.inc
@@ -0,0 +1,62 @@
+<?php
+
+/**
+ * @file
+ * Contains the flag Ops field handler.
+ */
+
+/**
+ * Views field handler for the Flag operations links (flag/unflag).
+ *
+ * @ingroup views
+ */
+class commons_follow_handler_field_ops extends flag_handler_field_ops {
+
+  function render($values) {
+    global $user;
+    //If the passed in user doesn't match the current user
+    if(isset($this->view->args[0]) && $user->uid != $this->view->args[0]) {
+
+      if (!($flag = $this->get_flag())) {
+        // get_flag() itself will print a more detailed message.
+        return t('Missing flag');
+      }
+      $content_id = $values->{$this->aliases['content_id']};
+      $is_flagged = $values->{$this->aliases['is_flagged']};
+
+      if (empty($this->flag_applies[$content_id])) {
+        // Flag does not apply to this content.
+        return;
+      }
+
+      if (!empty($this->options['link_type'])) {
+        $flag->link_type = $this->options['link_type'];
+      }
+
+      $variables = array();
+      $action = $is_flagged ? 'unflag' : 'flag';
+      $variables['flag_css_name'] = str_replace('_', '-', $flag->name);
+
+      $flag_wrapper_classes_array = array();
+      $flag_wrapper_classes_array[] = 'flag-wrapper';
+      $flag_wrapper_classes_array[] = 'flag-' . $variables['flag_css_name'];
+      $flag_wrapper_classes_array[] = 'flag-' . $variables['flag_css_name'] . '-' . $content_id;
+      $variables['flag_wrapper_classes'] = implode(' ',$flag_wrapper_classes_array);
+
+      $flag_classes_array = array();
+      $flag_classes_array[] = 'flag';
+      $flag_classes_array[] = $action . '-action';
+      $flag_classes_array[] = 'flag-link-' . $flag->link_type;
+      $variables['flag_classes'] = implode(' ', $flag_classes_array);
+      $variables['is_flagged'] = $action;
+      $variables['link_text'] = $flag->get_label($action . '_short', $content_id);
+
+      return theme('commons_follow_otheruser_flag', $variables);
+    }
+    else {
+      return parent::render($values);
+    }
+
+//    return $flag->theme($is_flagged ? 'unflag' : 'flag', $content_id);
+  }
+}
diff --git a/modules/commons/commons_groups/commons_groups.info b/modules/commons/commons_groups/commons_groups.info
index 7804603..59a4f2a 100644
--- a/modules/commons/commons_groups/commons_groups.info
+++ b/modules/commons/commons_groups/commons_groups.info
@@ -2,8 +2,6 @@ name = Commons Groups
 description = Commons Organic Groups Functionality
 core = 7.x
 package = Commons - Building blocks
-version = 7.x-3.0
-project = commons_groups
 dependencies[] = commons_body
 dependencies[] = commons_bw
 dependencies[] = commons_topics
diff --git a/modules/commons/commons_groups/commons_groups.install b/modules/commons/commons_groups/commons_groups.install
index f526d52..f4ec12b 100644
--- a/modules/commons/commons_groups/commons_groups.install
+++ b/modules/commons/commons_groups/commons_groups.install
@@ -177,3 +177,14 @@ function commons_groups_update_3113() {
   features_revert($revert);
   return array();
 }
+
+/**
+ * Display sticky content at top of lists.
+ */
+function commons_groups_update_3114() {
+  $revert = array(
+    'commons_groups' => array('views_view'),
+  );
+  features_revert($revert);
+  return array();
+}
diff --git a/modules/commons/commons_groups/commons_groups.module b/modules/commons/commons_groups/commons_groups.module
index 46e8b15..c122918 100644
--- a/modules/commons/commons_groups/commons_groups.module
+++ b/modules/commons/commons_groups/commons_groups.module
@@ -62,7 +62,7 @@ function commons_groups_help($path, $arg) {
       }
     }
     if (user_access('edit any group content')) {
-      $message = t("Group privacy settings !updated.", array('!updated' => l('need to be updated', 'admin/content/groups/update'),));
+      $message = t("Group privacy settings !updated.", array('!updated' => l('need to be updated', 'admin/content/groups/update')));
       drupal_set_message($message, 'warning', FALSE);
     }
   }
@@ -97,7 +97,7 @@ function commons_groups_form_group_node_form_alter(&$form, &$form_state) {
   $form['field_og_subscribe_settings'][LANGUAGE_NONE]['#required'] = FALSE;
 
   if (module_exists('og_access')) {
-    // Display the private content checkbox only when "Joining requires approval"
+    // Display private content checkbox only when "Joining requires approval"
     // is selected.
     $form['field_og_access_default_value']['#states'] = array(
       'visible' => array(
@@ -297,7 +297,7 @@ function commons_groups_group_contributors_count_topics($group) {
     $contributors_count = $view->total_rows;
     $output .= l(t('@contributors_count @contributors', array(
       '@contributors_count' => $contributors_count,
-      '@contributors' => format_plural($contributors_count, 'contributor', 'contributors')
+      '@contributors' => format_plural($contributors_count, 'contributor', 'contributors'),
     )), 'node/' . $group->nid . '/contributors');
   }
   // Format the list of topics:
@@ -378,6 +378,22 @@ function commons_groups_form_alter(&$form, &$form_state, $form_id) {
       drupal_set_message(t($message), 'warning');
     }
   }
+  // Hide internal fields that the user should not be able to edit directly.
+  if ($form_id == 'edit_profile_user_profile_form' || substr($form_id, -10) === '_node_form') {
+    $internal_fields = array('field_unread_invitations', 'field_unread_messages', 'user_trusted_contacts', 'og_user_group_ref', 'group_access');
+    foreach ($internal_fields as $field_name) {
+      if(isset($form[$field_name])) {
+        $form[$field_name]['#access'] = FALSE;
+      }
+    }
+  }
+  // Disable Trusted Contacts field if commons_trusted_contacts is disabled.
+  $group_content_entity_types = commons_groups_get_group_content_entity_types();
+  if (isset($form['#node']->type) && isset($group_content_entity_types['node'][$form['#node']->type])) {
+    if (isset($form['og_user_group_ref']) && !module_exists('commons_trusted_contacts')) {
+      $form['og_user_group_ref']['#access'] = FALSE;
+    }
+  }
 }
 
 /**
@@ -583,14 +599,14 @@ function commons_groups_message_partial_default() {
 function commons_groups_related_groups_text($related_groups) {
   // In 1 group: "in the x group"
   if (count($related_groups) == 1) {
-    return t(' in the !group group', array('!group' => l($related_groups[0]->title, 'node/' . $related_groups[0]->nid)));
+    return ' ' . t('in the !group group', array('!group' => l($related_groups[0]->title, 'node/' . $related_groups[0]->nid)));
   }
 
   // In 2 groups: "in the x and y groups"
   if (count($related_groups) == 2) {
-    return t(' in the !group-0 and !group-1 groups', array(
+    return ' ' . t('in the !group-0 and !group-1 groups', array(
       '!group-0' => l($related_groups[0]->title, 'node/' . $related_groups[0]->nid),
-      '!group-1' => l($related_groups[1]->title, 'node/' . $related_groups[1]->nid)
+      '!group-1' => l($related_groups[1]->title, 'node/' . $related_groups[1]->nid),
     ));
   }
 
@@ -674,20 +690,6 @@ function commons_groups_default_rules_configuration_alter(&$configs) {
 }
 
 /**
- * Implements hook_node_validate().
- */
-function commons_groups_node_validate($node, $form, &$form_state) {
-  // Ensure that group content is always posted to one or more groups.
-  // When the Commons Trusted Contacts module is enabled, we defer to its
-  // own form validation which ensures that group content nodes are posted
-  // either to a node group via the og_group_ref field or to a user group
-  // via the og_user_group_ref field.
-  if (!module_exists('commons_truste_contacts') && og_is_group_content_type('node', $node->type) && empty($form_state['values']['og_group_ref'][LANGUAGE_NONE][0]['target_id'])) {
-    form_set_error('og_group_ref', t('Please enter one more groups where this content will be posted.'));
-  }
-}
-
-/**
  * Implements hook_node_presave().
  *
  * When the node's group is private, force the group content to be private.
@@ -809,7 +811,7 @@ function commons_groups_set_group_permissions($node) {
  */
 function commons_groups_get_group_content_entity_types() {
   // Find all Commons Entity integrations.
-  $commons_entity_integrations = module_invoke_all('commons_entity_integration');
+  $commons_entity_integrations = commons_entity_integration_info();
   if (empty($commons_entity_integrations)) {
     return array();
   }
diff --git a/modules/commons/commons_groups/commons_groups.views_default.inc b/modules/commons/commons_groups/commons_groups.views_default.inc
index b123b4f..d7d4671 100644
--- a/modules/commons/commons_groups/commons_groups.views_default.inc
+++ b/modules/commons/commons_groups/commons_groups.views_default.inc
@@ -64,6 +64,7 @@ function commons_groups_views_default_views() {
   $handler->display->display_options['sorts']['sticky']['id'] = 'sticky';
   $handler->display->display_options['sorts']['sticky']['table'] = 'node';
   $handler->display->display_options['sorts']['sticky']['field'] = 'sticky';
+  $handler->display->display_options['sorts']['sticky']['order'] = 'DESC';
   /* Sort criterion: Content: Post date */
   $handler->display->display_options['sorts']['created']['id'] = 'created';
   $handler->display->display_options['sorts']['created']['table'] = 'node';
diff --git a/modules/commons/commons_groups/modules/commons_groups_directory/commons_groups_directory.features.inc b/modules/commons/commons_groups/modules/commons_groups_directory/commons_groups_directory.features.inc
index ad3cadb..41a3f22 100644
--- a/modules/commons/commons_groups/modules/commons_groups_directory/commons_groups_directory.features.inc
+++ b/modules/commons/commons_groups/modules/commons_groups_directory/commons_groups_directory.features.inc
@@ -11,9 +11,6 @@ function commons_groups_directory_ctools_plugin_api($module = NULL, $api = NULL)
   if ($module == "page_manager" && $api == "pages_default") {
     return array("version" => "1");
   }
-  if ($module == "panelizer" && $api == "panelizer") {
-    return array("version" => "1");
-  }
 }
 
 /**
diff --git a/modules/commons/commons_groups/modules/commons_groups_directory/commons_groups_directory.info b/modules/commons/commons_groups/modules/commons_groups_directory/commons_groups_directory.info
index 785a491..5bb77a3 100644
--- a/modules/commons/commons_groups/modules/commons_groups_directory/commons_groups_directory.info
+++ b/modules/commons/commons_groups/modules/commons_groups_directory/commons_groups_directory.info
@@ -2,17 +2,12 @@ name = Commons Groups Directory
 description = The site-wide directory of groups
 core = 7.x
 package = Commons - Landing pages
-project = commons_groups
 dependencies[] = commons_activity_streams_groups
 dependencies[] = commons_radioactivity_groups
 dependencies[] = ctools
 dependencies[] = page_manager
-dependencies[] = panelizer
-dependencies[] = panels_ipe
 dependencies[] = views_content
-datestamp = 1354346062
 features[ctools][] = page_manager:pages_default:1
-features[ctools][] = panelizer:panelizer:1
 features[ctools][] = views:views_default:3.0
 features[features_api][] = api:2
 features[page_manager_pages][] = groups_directory
diff --git a/modules/commons/commons_groups/modules/commons_groups_pages/commons_groups_pages.info b/modules/commons/commons_groups/modules/commons_groups_pages/commons_groups_pages.info
index 07d2dd0..fdcc25f 100644
--- a/modules/commons/commons_groups/modules/commons_groups_pages/commons_groups_pages.info
+++ b/modules/commons/commons_groups/modules/commons_groups_pages/commons_groups_pages.info
@@ -2,7 +2,6 @@ name = Commons Group Homepages
 description = Provides a default home page for groups
 core = 7.x
 package = Commons - Landing pages
-project = commons_groups
 dependencies[] = commons_activity_streams
 dependencies[] = commons_bw
 dependencies[] = commons_follow_group
@@ -10,7 +9,6 @@ dependencies[] = commons_radioactivity_groups
 dependencies[] = ctools
 dependencies[] = panelizer
 dependencies[] = strongarm
-datestamp = 1354346062
 features[ctools][] = panelizer:panelizer:1
 features[ctools][] = strongarm:strongarm:1
 features[features_api][] = api:2
diff --git a/modules/commons/commons_images/commons_images.default_breakpoint_group.inc b/modules/commons/commons_images/commons_images.default_breakpoint_group.inc
new file mode 100644
index 0000000..a5492eb
--- /dev/null
+++ b/modules/commons/commons_images/commons_images.default_breakpoint_group.inc
@@ -0,0 +1,90 @@
+<?php
+/**
+ * @file
+ * commons_images.default_breakpoint_group.inc
+ */
+
+/**
+ * Implements hook_default_breakpoint_group().
+ */
+function commons_images_default_breakpoint_group() {
+  $export = array();
+
+  // Breakpoints.
+  $breakpoints = array();
+  $breakpoints[] = 'breakpoints.theme.commons_origins.commons small portrait';
+  $breakpoints[] = 'breakpoints.theme.commons_origins.commons small landscape';
+  $breakpoints[] = 'breakpoints.theme.commons_origins.commons medium portrait';
+  $breakpoints[] = 'breakpoints.theme.commons_origins.commons medium landscape';
+  $breakpoints[] = 'breakpoints.theme.commons_origins.commons large';
+
+  // Breakpoint group.
+  $breakpoint_group = new stdClass();
+  $breakpoint_group->disabled = FALSE; /* Edit this to true to make a default breakpoint_group disabled initially */
+  $breakpoint_group->api_version = 1;
+  $breakpoint_group->machine_name = 'commons_default';
+  $breakpoint_group->name = 'Commons default';
+  $breakpoint_group->breakpoints = $breakpoints;
+  $breakpoint_group->type = 'module';
+  $breakpoint_group->overridden = 0;
+  $export['commons_default'] = $breakpoint_group;
+
+  // Breakpoints.
+  $breakpoints = array();
+  $breakpoints[] = 'breakpoints.theme.commons_origins.commons small portrait';
+  $breakpoints[] = 'breakpoints.theme.commons_origins.commons small landscape';
+  $breakpoints[] = 'breakpoints.theme.commons_origins.commons medium portrait';
+  $breakpoints[] = 'breakpoints.theme.commons_origins.commons medium landscape';
+  $breakpoints[] = 'breakpoints.theme.commons_origins.commons large';
+
+  // Breakpoint group.
+  $breakpoint_group = new stdClass();
+  $breakpoint_group->disabled = FALSE; /* Edit this to true to make a default breakpoint_group disabled initially */
+  $breakpoint_group->api_version = 1;
+  $breakpoint_group->machine_name = 'commons_full';
+  $breakpoint_group->name = 'Commons full';
+  $breakpoint_group->breakpoints = $breakpoints;
+  $breakpoint_group->type = 'module';
+  $breakpoint_group->overridden = 0;
+  $export['commons_full'] = $breakpoint_group;
+
+  // Breakpoints.
+  $breakpoints = array();
+  $breakpoints[] = 'breakpoints.theme.commons_origins.commons small portrait';
+  $breakpoints[] = 'breakpoints.theme.commons_origins.commons small landscape';
+  $breakpoints[] = 'breakpoints.theme.commons_origins.commons medium portrait';
+  $breakpoints[] = 'breakpoints.theme.commons_origins.commons medium landscape';
+  $breakpoints[] = 'breakpoints.theme.commons_origins.commons large';
+
+  // Breakpoint group.
+  $breakpoint_group = new stdClass();
+  $breakpoint_group->disabled = FALSE; /* Edit this to true to make a default breakpoint_group disabled initially */
+  $breakpoint_group->api_version = 1;
+  $breakpoint_group->machine_name = 'commons_origins';
+  $breakpoint_group->name = 'Commons Origins';
+  $breakpoint_group->breakpoints = $breakpoints;
+  $breakpoint_group->type = 'theme';
+  $breakpoint_group->overridden = 0;
+  $export['commons_origins'] = $breakpoint_group;
+
+  // Breakpoints.
+  $breakpoints = array();
+  $breakpoints[] = 'breakpoints.theme.commons_origins.commons small portrait';
+  $breakpoints[] = 'breakpoints.theme.commons_origins.commons small landscape';
+  $breakpoints[] = 'breakpoints.theme.commons_origins.commons medium portrait';
+  $breakpoints[] = 'breakpoints.theme.commons_origins.commons medium landscape';
+  $breakpoints[] = 'breakpoints.theme.commons_origins.commons large';
+
+  // Breakpoint group.
+  $breakpoint_group = new stdClass();
+  $breakpoint_group->disabled = FALSE; /* Edit this to true to make a default breakpoint_group disabled initially */
+  $breakpoint_group->api_version = 1;
+  $breakpoint_group->machine_name = 'commons_teaser';
+  $breakpoint_group->name = 'Commons teaser';
+  $breakpoint_group->breakpoints = $breakpoints;
+  $breakpoint_group->type = 'module';
+  $breakpoint_group->overridden = 0;
+  $export['commons_teaser'] = $breakpoint_group;
+
+  return $export;
+}
diff --git a/modules/commons/commons_images/commons_images.default_breakpoints.inc b/modules/commons/commons_images/commons_images.default_breakpoints.inc
new file mode 100644
index 0000000..fbda730
--- /dev/null
+++ b/modules/commons/commons_images/commons_images.default_breakpoints.inc
@@ -0,0 +1,89 @@
+<?php
+/**
+ * @file
+ * commons_images.default_breakpoints.inc
+ */
+
+/**
+ * Implements hook_default_breakpoints().
+ */
+function commons_images_default_breakpoints() {
+  $export = array();
+
+  $breakpoint = new stdClass();
+  $breakpoint->disabled = FALSE; /* Edit this to true to make a default breakpoint disabled initially */
+  $breakpoint->api_version = 1;
+  $breakpoint->machine_name = 'breakpoints.theme.commons_origins.commons large';
+  $breakpoint->name = 'Commons large';
+  $breakpoint->breakpoint = 'only screen and (min-width:935px)';
+  $breakpoint->source = 'commons_origins';
+  $breakpoint->source_type = 'theme';
+  $breakpoint->status = 1;
+  $breakpoint->weight = 4;
+  $breakpoint->multipliers = array(
+    '1x' => '1x',
+  );
+  $export['breakpoints.theme.commons_origins.commons large'] = $breakpoint;
+
+  $breakpoint = new stdClass();
+  $breakpoint->disabled = FALSE; /* Edit this to true to make a default breakpoint disabled initially */
+  $breakpoint->api_version = 1;
+  $breakpoint->machine_name = 'breakpoints.theme.commons_origins.commons medium landscape';
+  $breakpoint->name = 'Commons medium landscape';
+  $breakpoint->breakpoint = 'only screen and (min-width:769px) and (max-width:934px';
+  $breakpoint->source = 'commons_origins';
+  $breakpoint->source_type = 'theme';
+  $breakpoint->status = 1;
+  $breakpoint->weight = 3;
+  $breakpoint->multipliers = array(
+    '1x' => '1x',
+  );
+  $export['breakpoints.theme.commons_origins.commons medium landscape'] = $breakpoint;
+
+  $breakpoint = new stdClass();
+  $breakpoint->disabled = FALSE; /* Edit this to true to make a default breakpoint disabled initially */
+  $breakpoint->api_version = 1;
+  $breakpoint->machine_name = 'breakpoints.theme.commons_origins.commons medium portrait';
+  $breakpoint->name = 'Commons medium portrait';
+  $breakpoint->breakpoint = 'only screen and (min-width:481px) and (max-width:768px)';
+  $breakpoint->source = 'commons_origins';
+  $breakpoint->source_type = 'theme';
+  $breakpoint->status = 1;
+  $breakpoint->weight = 2;
+  $breakpoint->multipliers = array(
+    '1x' => '1x',
+  );
+  $export['breakpoints.theme.commons_origins.commons medium portrait'] = $breakpoint;
+
+  $breakpoint = new stdClass();
+  $breakpoint->disabled = FALSE; /* Edit this to true to make a default breakpoint disabled initially */
+  $breakpoint->api_version = 1;
+  $breakpoint->machine_name = 'breakpoints.theme.commons_origins.commons small landscape';
+  $breakpoint->name = 'Commons small landscape';
+  $breakpoint->breakpoint = 'only screen and (min-width:321px) and (max-width:480px)';
+  $breakpoint->source = 'commons_origins';
+  $breakpoint->source_type = 'theme';
+  $breakpoint->status = 1;
+  $breakpoint->weight = 1;
+  $breakpoint->multipliers = array(
+    '1x' => '1x',
+  );
+  $export['breakpoints.theme.commons_origins.commons small landscape'] = $breakpoint;
+
+  $breakpoint = new stdClass();
+  $breakpoint->disabled = FALSE; /* Edit this to true to make a default breakpoint disabled initially */
+  $breakpoint->api_version = 1;
+  $breakpoint->machine_name = 'breakpoints.theme.commons_origins.commons small portrait';
+  $breakpoint->name = 'Commons small portrait';
+  $breakpoint->breakpoint = 'only screen and (max-width:320px)';
+  $breakpoint->source = 'commons_origins';
+  $breakpoint->source_type = 'theme';
+  $breakpoint->status = 1;
+  $breakpoint->weight = 0;
+  $breakpoint->multipliers = array(
+    '1x' => '1x',
+  );
+  $export['breakpoints.theme.commons_origins.commons small portrait'] = $breakpoint;
+
+  return $export;
+}
diff --git a/modules/commons/commons_images/commons_images.default_picture_mapping.inc b/modules/commons/commons_images/commons_images.default_picture_mapping.inc
new file mode 100644
index 0000000..e91e30f
--- /dev/null
+++ b/modules/commons/commons_images/commons_images.default_picture_mapping.inc
@@ -0,0 +1,101 @@
+<?php
+/**
+ * @file
+ * commons_images.default_picture_mapping.inc
+ */
+
+/**
+ * Implements hook_default_picture_mapping().
+ */
+function commons_images_default_picture_mapping() {
+  $export = array();
+
+  $picture_mapping = new stdClass();
+  $picture_mapping->disabled = FALSE; /* Edit this to true to make a default picture_mapping disabled initially */
+  $picture_mapping->api_version = 1;
+  $picture_mapping->machine_name = 'commons_default';
+  $picture_mapping->breakpoint_group = 'commons_default';
+  $picture_mapping->mapping = array(
+    'breakpoints.theme.commons_origins.commons small portrait' => array(
+      '1x' => 'commons-default-small',
+      '1.5x' => 'commons-default-small-1_5x',
+    ),
+    'breakpoints.theme.commons_origins.commons small landscape' => array(
+      '1x' => 'commons-default-small',
+      '1.5x' => 'commons-default-small-1_5x',
+    ),
+    'breakpoints.theme.commons_origins.commons medium portrait' => array(
+      '1x' => 'commons-default-medium',
+      '1.5x' => 'commons-default-medium-1_5x',
+    ),
+    'breakpoints.theme.commons_origins.commons medium landscape' => array(
+      '1x' => 'commons-default-medium',
+      '1.5x' => 'commons-default-medium-1_5x',
+    ),
+    'breakpoints.theme.commons_origins.commons large' => array(
+      '1x' => 'commons-default-large',
+      '1.5x' => 'commons-default-large-1_5x',
+    ),
+  );
+  $export['commons_default'] = $picture_mapping;
+
+  $picture_mapping = new stdClass();
+  $picture_mapping->disabled = FALSE; /* Edit this to true to make a default picture_mapping disabled initially */
+  $picture_mapping->api_version = 1;
+  $picture_mapping->machine_name = 'commons_full';
+  $picture_mapping->breakpoint_group = 'commons_full';
+  $picture_mapping->mapping = array(
+    'breakpoints.theme.commons_origins.commons small portrait' => array(
+      '1x' => 'commons-full-small',
+      '1.5x' => 'commons-full-small-1_5x',
+    ),
+    'breakpoints.theme.commons_origins.commons small landscape' => array(
+      '1x' => 'commons-full-small',
+      '1.5x' => 'commons-full-small-1_5x',
+    ),
+    'breakpoints.theme.commons_origins.commons medium portrait' => array(
+      '1x' => 'commons-full-medium',
+      '1.5x' => 'commons-full-medium-1_5x',
+    ),
+    'breakpoints.theme.commons_origins.commons medium landscape' => array(
+      '1x' => 'commons-full-medium',
+      '1.5x' => 'commons-full-medium-1_5x',
+    ),
+    'breakpoints.theme.commons_origins.commons large' => array(
+      '1x' => 'commons-full-large',
+      '1.5x' => 'commons-full-large-1_5x',
+    ),
+  );
+  $export['commons_full'] = $picture_mapping;
+
+  $picture_mapping = new stdClass();
+  $picture_mapping->disabled = FALSE; /* Edit this to true to make a default picture_mapping disabled initially */
+  $picture_mapping->api_version = 1;
+  $picture_mapping->machine_name = 'commons_teaser';
+  $picture_mapping->breakpoint_group = 'commons_teaser';
+  $picture_mapping->mapping = array(
+    'breakpoints.theme.commons_origins.commons small portrait' => array(
+      '1x' => 'commons-teaser-small',
+      '1.5x' => 'commons-teaser-small-1_5x',
+    ),
+    'breakpoints.theme.commons_origins.commons small landscape' => array(
+      '1x' => 'commons-teaser-small',
+      '1.5x' => 'commons-teaser-small-1_5x',
+    ),
+    'breakpoints.theme.commons_origins.commons medium portrait' => array(
+      '1x' => 'commons-teaser-medium',
+      '1.5x' => 'commons-teaser-medium-1_5',
+    ),
+    'breakpoints.theme.commons_origins.commons medium landscape' => array(
+      '1x' => 'commons-teaser-medium',
+      '1.5x' => 'commons-teaser-medium-1_5',
+    ),
+    'breakpoints.theme.commons_origins.commons large' => array(
+      '1x' => 'commons-teaser-large',
+      '1.5x' => 'commons-teaser-large-1_5x',
+    ),
+  );
+  $export['commons_teaser'] = $picture_mapping;
+
+  return $export;
+}
diff --git a/modules/commons/commons_images/commons_images.features.inc b/modules/commons/commons_images/commons_images.features.inc
new file mode 100644
index 0000000..48d70d2
--- /dev/null
+++ b/modules/commons/commons_images/commons_images.features.inc
@@ -0,0 +1,455 @@
+<?php
+/**
+ * @file
+ * commons_images.features.inc
+ */
+
+/**
+ * Implements hook_ctools_plugin_api().
+ */
+function commons_images_ctools_plugin_api($module = NULL, $api = NULL) {
+  if ($module == "breakpoints" && $api == "default_breakpoint_group") {
+    return array("version" => "1");
+  }
+  if ($module == "breakpoints" && $api == "default_breakpoints") {
+    return array("version" => "1");
+  }
+  if ($module == "picture" && $api == "default_picture_mapping") {
+    return array("version" => "1");
+  }
+}
+
+/**
+ * Implements hook_image_default_styles().
+ */
+function commons_images_image_default_styles() {
+  $styles = array();
+
+  // Exported image style: commons-default-large.
+  $styles['commons-default-large'] = array(
+    'name' => 'commons-default-large',
+    'label' => 'Commons default large',
+    'effects' => array(
+      18 => array(
+        'label' => 'Scale',
+        'help' => 'Scaling will maintain the aspect-ratio of the original image. If only a single dimension is specified, the other dimension will be calculated.',
+        'effect callback' => 'image_scale_effect',
+        'dimensions callback' => 'image_scale_dimensions',
+        'form callback' => 'image_scale_form',
+        'summary theme' => 'image_scale_summary',
+        'module' => 'image',
+        'name' => 'image_scale',
+        'data' => array(
+          'width' => 536,
+          'height' => 600,
+          'upscale' => 0,
+        ),
+        'weight' => 1,
+      ),
+    ),
+  );
+
+  // Exported image style: commons-default-large-1_5x.
+  $styles['commons-default-large-1_5x'] = array(
+    'name' => 'commons-default-large-1_5x',
+    'label' => 'Commons default large 1.5x',
+    'effects' => array(
+      19 => array(
+        'label' => 'Scale',
+        'help' => 'Scaling will maintain the aspect-ratio of the original image. If only a single dimension is specified, the other dimension will be calculated.',
+        'effect callback' => 'image_scale_effect',
+        'dimensions callback' => 'image_scale_dimensions',
+        'form callback' => 'image_scale_form',
+        'summary theme' => 'image_scale_summary',
+        'module' => 'image',
+        'name' => 'image_scale',
+        'data' => array(
+          'width' => 804,
+          'height' => 900,
+          'upscale' => 0,
+        ),
+        'weight' => 1,
+      ),
+    ),
+  );
+
+  // Exported image style: commons-default-medium.
+  $styles['commons-default-medium'] = array(
+    'name' => 'commons-default-medium',
+    'label' => 'Commons default medium',
+    'effects' => array(
+      18 => array(
+        'label' => 'Scale',
+        'help' => 'Scaling will maintain the aspect-ratio of the original image. If only a single dimension is specified, the other dimension will be calculated.',
+        'effect callback' => 'image_scale_effect',
+        'dimensions callback' => 'image_scale_dimensions',
+        'form callback' => 'image_scale_form',
+        'summary theme' => 'image_scale_summary',
+        'module' => 'image',
+        'name' => 'image_scale',
+        'data' => array(
+          'width' => 536,
+          'height' => 600,
+          'upscale' => 0,
+        ),
+        'weight' => 1,
+      ),
+    ),
+  );
+
+  // Exported image style: commons-default-medium-1_5x.
+  $styles['commons-default-medium-1_5x'] = array(
+    'name' => 'commons-default-medium-1_5x',
+    'label' => 'Commons default medium 1.5x',
+    'effects' => array(
+      19 => array(
+        'label' => 'Scale',
+        'help' => 'Scaling will maintain the aspect-ratio of the original image. If only a single dimension is specified, the other dimension will be calculated.',
+        'effect callback' => 'image_scale_effect',
+        'dimensions callback' => 'image_scale_dimensions',
+        'form callback' => 'image_scale_form',
+        'summary theme' => 'image_scale_summary',
+        'module' => 'image',
+        'name' => 'image_scale',
+        'data' => array(
+          'width' => 804,
+          'height' => 900,
+          'upscale' => 0,
+        ),
+        'weight' => 1,
+      ),
+    ),
+  );
+
+  // Exported image style: commons-default-small.
+  $styles['commons-default-small'] = array(
+    'name' => 'commons-default-small',
+    'label' => 'Commons default small',
+    'effects' => array(
+      20 => array(
+        'label' => 'Scale',
+        'help' => 'Scaling will maintain the aspect-ratio of the original image. If only a single dimension is specified, the other dimension will be calculated.',
+        'effect callback' => 'image_scale_effect',
+        'dimensions callback' => 'image_scale_dimensions',
+        'form callback' => 'image_scale_form',
+        'summary theme' => 'image_scale_summary',
+        'module' => 'image',
+        'name' => 'image_scale',
+        'data' => array(
+          'width' => 456,
+          'height' => 500,
+          'upscale' => 0,
+        ),
+        'weight' => 1,
+      ),
+    ),
+  );
+
+  // Exported image style: commons-default-small-1_5x.
+  $styles['commons-default-small-1_5x'] = array(
+    'name' => 'commons-default-small-1_5x',
+    'label' => 'Commons default small 1.5x',
+    'effects' => array(
+      21 => array(
+        'label' => 'Scale',
+        'help' => 'Scaling will maintain the aspect-ratio of the original image. If only a single dimension is specified, the other dimension will be calculated.',
+        'effect callback' => 'image_scale_effect',
+        'dimensions callback' => 'image_scale_dimensions',
+        'form callback' => 'image_scale_form',
+        'summary theme' => 'image_scale_summary',
+        'module' => 'image',
+        'name' => 'image_scale',
+        'data' => array(
+          'width' => 684,
+          'height' => 750,
+          'upscale' => 0,
+        ),
+        'weight' => 1,
+      ),
+    ),
+  );
+
+  // Exported image style: commons-full-large.
+  $styles['commons-full-large'] = array(
+    'name' => 'commons-full-large',
+    'label' => 'Commons full large',
+    'effects' => array(
+      22 => array(
+        'label' => 'Scale',
+        'help' => 'Scaling will maintain the aspect-ratio of the original image. If only a single dimension is specified, the other dimension will be calculated.',
+        'effect callback' => 'image_scale_effect',
+        'dimensions callback' => 'image_scale_dimensions',
+        'form callback' => 'image_scale_form',
+        'summary theme' => 'image_scale_summary',
+        'module' => 'image',
+        'name' => 'image_scale',
+        'data' => array(
+          'width' => 916,
+          'height' => '',
+          'upscale' => 0,
+        ),
+        'weight' => 1,
+      ),
+    ),
+  );
+
+  // Exported image style: commons-full-large-1_5x.
+  $styles['commons-full-large-1_5x'] = array(
+    'name' => 'commons-full-large-1_5x',
+    'label' => 'Commons full large 1.5x',
+    'effects' => array(
+      23 => array(
+        'label' => 'Scale',
+        'help' => 'Scaling will maintain the aspect-ratio of the original image. If only a single dimension is specified, the other dimension will be calculated.',
+        'effect callback' => 'image_scale_effect',
+        'dimensions callback' => 'image_scale_dimensions',
+        'form callback' => 'image_scale_form',
+        'summary theme' => 'image_scale_summary',
+        'module' => 'image',
+        'name' => 'image_scale',
+        'data' => array(
+          'width' => 1374,
+          'height' => '',
+          'upscale' => 0,
+        ),
+        'weight' => 1,
+      ),
+    ),
+  );
+
+  // Exported image style: commons-full-medium.
+  $styles['commons-full-medium'] = array(
+    'name' => 'commons-full-medium',
+    'label' => 'Commons full medium',
+    'effects' => array(
+      24 => array(
+        'label' => 'Scale',
+        'help' => 'Scaling will maintain the aspect-ratio of the original image. If only a single dimension is specified, the other dimension will be calculated.',
+        'effect callback' => 'image_scale_effect',
+        'dimensions callback' => 'image_scale_dimensions',
+        'form callback' => 'image_scale_form',
+        'summary theme' => 'image_scale_summary',
+        'module' => 'image',
+        'name' => 'image_scale',
+        'data' => array(
+          'width' => 768,
+          'height' => '',
+          'upscale' => 0,
+        ),
+        'weight' => 1,
+      ),
+    ),
+  );
+
+  // Exported image style: commons-full-medium-1_5.
+  $styles['commons-full-medium-1_5'] = array(
+    'name' => 'commons-full-medium-1_5',
+    'label' => 'Commons full medium 1.5',
+    'effects' => array(
+      25 => array(
+        'label' => 'Scale',
+        'help' => 'Scaling will maintain the aspect-ratio of the original image. If only a single dimension is specified, the other dimension will be calculated.',
+        'effect callback' => 'image_scale_effect',
+        'dimensions callback' => 'image_scale_dimensions',
+        'form callback' => 'image_scale_form',
+        'summary theme' => 'image_scale_summary',
+        'module' => 'image',
+        'name' => 'image_scale',
+        'data' => array(
+          'width' => 1152,
+          'height' => '',
+          'upscale' => 0,
+        ),
+        'weight' => 1,
+      ),
+    ),
+  );
+
+  // Exported image style: commons-full-small.
+  $styles['commons-full-small'] = array(
+    'name' => 'commons-full-small',
+    'label' => 'Commons full small',
+    'effects' => array(
+      20 => array(
+        'label' => 'Scale',
+        'help' => 'Scaling will maintain the aspect-ratio of the original image. If only a single dimension is specified, the other dimension will be calculated.',
+        'effect callback' => 'image_scale_effect',
+        'dimensions callback' => 'image_scale_dimensions',
+        'form callback' => 'image_scale_form',
+        'summary theme' => 'image_scale_summary',
+        'module' => 'image',
+        'name' => 'image_scale',
+        'data' => array(
+          'width' => 456,
+          'height' => 500,
+          'upscale' => 0,
+        ),
+        'weight' => 1,
+      ),
+    ),
+  );
+
+  // Exported image style: commons-full-small-1_5x.
+  $styles['commons-full-small-1_5x'] = array(
+    'name' => 'commons-full-small-1_5x',
+    'label' => 'Commons full small 1.5x',
+    'effects' => array(
+      21 => array(
+        'label' => 'Scale',
+        'help' => 'Scaling will maintain the aspect-ratio of the original image. If only a single dimension is specified, the other dimension will be calculated.',
+        'effect callback' => 'image_scale_effect',
+        'dimensions callback' => 'image_scale_dimensions',
+        'form callback' => 'image_scale_form',
+        'summary theme' => 'image_scale_summary',
+        'module' => 'image',
+        'name' => 'image_scale',
+        'data' => array(
+          'width' => 684,
+          'height' => 750,
+          'upscale' => 0,
+        ),
+        'weight' => 1,
+      ),
+    ),
+  );
+
+  // Exported image style: commons-teaser-large.
+  $styles['commons-teaser-large'] = array(
+    'name' => 'commons-teaser-large',
+    'label' => 'Commons teaser large',
+    'effects' => array(
+      16 => array(
+        'label' => 'Scale and Smart Crop',
+        'help' => 'Similar to "Scale And Crop", but preserves the portion of the image with the most entropy.',
+        'effect callback' => 'smartcrop_scale_effect',
+        'form callback' => 'image_scale_form',
+        'summary theme' => 'image_scale_summary',
+        'module' => 'smartcrop',
+        'name' => 'smartcrop_scale_and_crop',
+        'data' => array(
+          'width' => 124,
+          'height' => 124,
+          'upscale' => 1,
+        ),
+        'weight' => 1,
+      ),
+    ),
+  );
+
+  // Exported image style: commons-teaser-large-1_5x.
+  $styles['commons-teaser-large-1_5x'] = array(
+    'name' => 'commons-teaser-large-1_5x',
+    'label' => 'Commons teaser large 1.5x',
+    'effects' => array(
+      17 => array(
+        'label' => 'Scale and Smart Crop',
+        'help' => 'Similar to "Scale And Crop", but preserves the portion of the image with the most entropy.',
+        'effect callback' => 'smartcrop_scale_effect',
+        'form callback' => 'image_scale_form',
+        'summary theme' => 'image_scale_summary',
+        'module' => 'smartcrop',
+        'name' => 'smartcrop_scale_and_crop',
+        'data' => array(
+          'width' => 186,
+          'height' => 186,
+          'upscale' => 1,
+        ),
+        'weight' => 1,
+      ),
+    ),
+  );
+
+  // Exported image style: commons-teaser-medium.
+  $styles['commons-teaser-medium'] = array(
+    'name' => 'commons-teaser-medium',
+    'label' => 'Commons teaser medium',
+    'effects' => array(
+      14 => array(
+        'label' => 'Scale and Smart Crop',
+        'help' => 'Similar to "Scale And Crop", but preserves the portion of the image with the most entropy.',
+        'effect callback' => 'smartcrop_scale_effect',
+        'form callback' => 'image_scale_form',
+        'summary theme' => 'image_scale_summary',
+        'module' => 'smartcrop',
+        'name' => 'smartcrop_scale_and_crop',
+        'data' => array(
+          'width' => 72,
+          'height' => 72,
+          'upscale' => 1,
+        ),
+        'weight' => 1,
+      ),
+    ),
+  );
+
+  // Exported image style: commons-teaser-medium-1_5x.
+  $styles['commons-teaser-medium-1_5x'] = array(
+    'name' => 'commons-teaser-medium-1_5x',
+    'label' => 'Commons teaser medium 1.5x',
+    'effects' => array(
+      15 => array(
+        'label' => 'Scale and Smart Crop',
+        'help' => 'Similar to "Scale And Crop", but preserves the portion of the image with the most entropy.',
+        'effect callback' => 'smartcrop_scale_effect',
+        'form callback' => 'image_scale_form',
+        'summary theme' => 'image_scale_summary',
+        'module' => 'smartcrop',
+        'name' => 'smartcrop_scale_and_crop',
+        'data' => array(
+          'width' => 108,
+          'height' => 108,
+          'upscale' => 1,
+        ),
+        'weight' => 1,
+      ),
+    ),
+  );
+
+  // Exported image style: commons-teaser-small.
+  $styles['commons-teaser-small'] = array(
+    'name' => 'commons-teaser-small',
+    'label' => 'Commons teaser small',
+    'effects' => array(
+      12 => array(
+        'label' => 'Scale and Smart Crop',
+        'help' => 'Similar to "Scale And Crop", but preserves the portion of the image with the most entropy.',
+        'effect callback' => 'smartcrop_scale_effect',
+        'form callback' => 'image_scale_form',
+        'summary theme' => 'image_scale_summary',
+        'module' => 'smartcrop',
+        'name' => 'smartcrop_scale_and_crop',
+        'data' => array(
+          'width' => 54,
+          'height' => 54,
+          'upscale' => 1,
+        ),
+        'weight' => 1,
+      ),
+    ),
+  );
+
+  // Exported image style: commons-teaser-small-1_5x.
+  $styles['commons-teaser-small-1_5x'] = array(
+    'name' => 'commons-teaser-small-1_5x',
+    'label' => 'Commons teaser small 1.5x',
+    'effects' => array(
+      13 => array(
+        'label' => 'Scale and Smart Crop',
+        'help' => 'Similar to "Scale And Crop", but preserves the portion of the image with the most entropy.',
+        'effect callback' => 'smartcrop_scale_effect',
+        'form callback' => 'image_scale_form',
+        'summary theme' => 'image_scale_summary',
+        'module' => 'smartcrop',
+        'name' => 'smartcrop_scale_and_crop',
+        'data' => array(
+          'width' => 81,
+          'height' => 81,
+          'upscale' => 1,
+        ),
+        'weight' => 1,
+      ),
+    ),
+  );
+
+  return $styles;
+}
diff --git a/modules/commons/commons_images/commons_images.info b/modules/commons/commons_images/commons_images.info
new file mode 100644
index 0000000..6afb9f2
--- /dev/null
+++ b/modules/commons/commons_images/commons_images.info
@@ -0,0 +1,45 @@
+name = Commons Images
+description = Image styles used in the Commons distribution
+core = 7.x
+package = Commons - Building blocks
+project = commons_images
+dependencies[] = breakpoints
+dependencies[] = ctools
+dependencies[] = file_entity
+dependencies[] = image
+dependencies[] = picture
+dependencies[] = smartcrop
+features[breakpoint_group][] = commons_default
+features[breakpoint_group][] = commons_full
+features[breakpoint_group][] = commons_origins
+features[breakpoint_group][] = commons_teaser
+features[breakpoints][] = breakpoints.theme.commons_origins.commons large
+features[breakpoints][] = breakpoints.theme.commons_origins.commons medium landscape
+features[breakpoints][] = breakpoints.theme.commons_origins.commons medium portrait
+features[breakpoints][] = breakpoints.theme.commons_origins.commons small landscape
+features[breakpoints][] = breakpoints.theme.commons_origins.commons small portrait
+features[ctools][] = breakpoints:default_breakpoint_group:1
+features[ctools][] = breakpoints:default_breakpoints:1
+features[ctools][] = picture:default_picture_mapping:1
+features[features_api][] = api:2
+features[image][] = commons-default-large
+features[image][] = commons-default-large-1_5x
+features[image][] = commons-default-medium
+features[image][] = commons-default-medium-1_5x
+features[image][] = commons-default-small
+features[image][] = commons-default-small-1_5x
+features[image][] = commons-full-large
+features[image][] = commons-full-large-1_5x
+features[image][] = commons-full-medium
+features[image][] = commons-full-medium-1_5
+features[image][] = commons-full-small
+features[image][] = commons-full-small-1_5x
+features[image][] = commons-teaser-large
+features[image][] = commons-teaser-large-1_5x
+features[image][] = commons-teaser-medium
+features[image][] = commons-teaser-medium-1_5x
+features[image][] = commons-teaser-small
+features[image][] = commons-teaser-small-1_5x
+features[picture_mapping][] = commons_default
+features[picture_mapping][] = commons_full
+features[picture_mapping][] = commons_teaser
diff --git a/modules/commons/commons_images/commons_images.module b/modules/commons/commons_images/commons_images.module
new file mode 100644
index 0000000..f3ec52e
--- /dev/null
+++ b/modules/commons/commons_images/commons_images.module
@@ -0,0 +1,76 @@
+<?php
+/**
+ * @file
+ * Code for the Commons Images feature.
+ */
+
+include_once 'commons_images.features.inc';
+
+/**
+ * Implements hook_file_default_displays_alter().
+ */
+function commons_images_file_default_displays_alter(&$file_displays) {
+  // Copy all default image formatters to full image formatters.
+  foreach ($file_displays as $file_display) {
+    if (strpos($file_display->name, 'image__default__') !== false) {
+      $display = clone $file_display;
+      $name = str_replace('image__default__', 'image__full__', $display->name);
+      $display->name = $name;
+      $file_displays[$name] = $display;
+    }
+  }
+
+  // Default images should be displayed using the 'default' picture group.
+  if (isset($file_displays['image__default__file_field_image'])) {
+    $file_displays['image__default__file_field_image']->status = FALSE;
+  }
+
+  $file_display = new stdClass();
+  $file_display->api_version = 1;
+  $file_display->name = 'image__default__file_field_picture';
+  $file_display->weight = 1;
+  $file_display->status = TRUE;
+  $file_display->settings = array(
+    'picture_group' => 'commons_default',
+    'fallback_image_style' => 'commons-default-small',
+    'image_link' => 'content',
+    'colorbox' => 'commons_default',
+  );
+  $file_displays['image__default__file_field_picture'] = $file_display;
+
+  // Full images should be displayed using the 'full' picture group.
+  if (isset($file_displays['image__full__file_field_image'])) {
+    $file_displays['image__full__file_field_image']->status = FALSE;
+  }
+
+  $file_display = new stdClass();
+  $file_display->api_version = 1;
+  $file_display->name = 'image__full__file_field_picture';
+  $file_display->weight = 1;
+  $file_display->status = TRUE;
+  $file_display->settings = array(
+    'picture_group' => 'commons_full',
+    'fallback_image_style' => 'commons-full-small',
+    'image_link' => '',
+    'colorbox' => 'commons_full',
+  );
+  $file_displays['image__full__file_field_picture'] = $file_display;
+
+  // Teaser images should be displayed using the 'teaser' picture group.
+  if (isset($file_displays['image__teaser__file_field_image'])) {
+    $file_displays['image__teaser__file_field_image']->status = FALSE;
+  }
+
+  $file_display = new stdClass();
+  $file_display->api_version = 1;
+  $file_display->name = 'image__teaser__file_field_picture';
+  $file_display->weight = -1;
+  $file_display->status = TRUE;
+  $file_display->settings = array(
+    'picture_group' => 'commons_teaser',
+    'fallback_image_style' => 'commons-teaser-small',
+    'image_link' => '',
+    'colorbox' => 'commons_teaser',
+  );
+  $file_displays['image__teaser__file_field_picture'] = $file_display;
+}
diff --git a/modules/commons/commons_kissmetrics/commons_kissmetrics.rules_defaults.inc b/modules/commons/commons_kissmetrics/commons_kissmetrics.rules_defaults.inc
index 645aef7..7d64ab8 100644
--- a/modules/commons/commons_kissmetrics/commons_kissmetrics.rules_defaults.inc
+++ b/modules/commons/commons_kissmetrics/commons_kissmetrics.rules_defaults.inc
@@ -12,6 +12,7 @@ function commons_kissmetrics_default_rules_configuration() {
   $items['rules_commons_kissmetrics_collect_referenced_groups'] = entity_import('rules_config', '{ "rules_commons_kissmetrics_collect_referenced_groups" : {
       "LABEL" : "Commons KISSmetrics: Collect Referenced Groups",
       "PLUGIN" : "rule",
+      "OWNER" : "rules",
       "TAGS" : [ "Commons KISSmetrics" ],
       "REQUIRES" : [ "rules" ],
       "USES VARIABLES" : {
@@ -45,6 +46,7 @@ function commons_kissmetrics_default_rules_configuration() {
   $items['rules_commons_kissmetrics_user_adds_a_trusted_contact'] = entity_import('rules_config', '{ "rules_commons_kissmetrics_user_adds_a_trusted_contact" : {
       "LABEL" : "Commons KISSmetrics: User Adds A Trusted Contact",
       "PLUGIN" : "reaction rule",
+      "OWNER" : "rules",
       "TAGS" : [ "Commons KISSmetrics" ],
       "REQUIRES" : [ "rules", "kissmetrics", "og" ],
       "ON" : { "og_user_insert" : [] },
@@ -61,6 +63,7 @@ function commons_kissmetrics_default_rules_configuration() {
   $items['rules_commons_kissmetrics_user_approves_a_trusted_contact'] = entity_import('rules_config', '{ "rules_commons_kissmetrics_user_approves_a_trusted_contact" : {
       "LABEL" : "Commons KISSmetrics: User Approves A Trusted Contact",
       "PLUGIN" : "reaction rule",
+      "OWNER" : "rules",
       "TAGS" : [ "Commons KISSmetrics" ],
       "REQUIRES" : [ "rules", "kissmetrics", "og" ],
       "ON" : { "og_user_approved" : [] },
@@ -77,6 +80,7 @@ function commons_kissmetrics_default_rules_configuration() {
   $items['rules_commons_kissmetrics_user_creates_content'] = entity_import('rules_config', '{ "rules_commons_kissmetrics_user_creates_content" : {
       "LABEL" : "Commons KISSmetrics: User Creates Content",
       "PLUGIN" : "reaction rule",
+      "OWNER" : "rules",
       "TAGS" : [ "Commons KISSmetrics" ],
       "REQUIRES" : [ "rules", "kissmetrics" ],
       "ON" : { "node_insert" : [] },
@@ -97,6 +101,7 @@ function commons_kissmetrics_default_rules_configuration() {
   $items['rules_commons_kissmetrics_user_edits_profile'] = entity_import('rules_config', '{ "rules_commons_kissmetrics_user_edits_profile" : {
       "LABEL" : "Commons KISSmetrics: User Edits Profile",
       "PLUGIN" : "reaction rule",
+      "OWNER" : "rules",
       "TAGS" : [ "Commons KISSmetrics" ],
       "REQUIRES" : [ "rules", "kissmetrics" ],
       "ON" : { "user_update" : [] },
@@ -108,6 +113,7 @@ function commons_kissmetrics_default_rules_configuration() {
   $items['rules_commons_kissmetrics_user_edits_wiki'] = entity_import('rules_config', '{ "rules_commons_kissmetrics_user_edits_wiki" : {
       "LABEL" : "Commons KISSmetrics: User Edits Wiki",
       "PLUGIN" : "reaction rule",
+      "OWNER" : "rules",
       "TAGS" : [ "Commons KISSmetrics" ],
       "REQUIRES" : [ "rules", "kissmetrics" ],
       "ON" : { "node_update" : [] },
@@ -131,6 +137,7 @@ function commons_kissmetrics_default_rules_configuration() {
   $items['rules_commons_kissmetrics_user_flags_content_as_inappropriate'] = entity_import('rules_config', '{ "rules_commons_kissmetrics_user_flags_content_as_inappropriate" : {
       "LABEL" : "Commons KISSmetrics: User Flags Content As Inappropriate",
       "PLUGIN" : "reaction rule",
+      "OWNER" : "rules",
       "TAGS" : [ "Commons KISSmetrics" ],
       "REQUIRES" : [ "rules", "kissmetrics", "flag" ],
       "ON" : { "flag_flagged_inappropriate_node" : [] },
@@ -146,6 +153,7 @@ function commons_kissmetrics_default_rules_configuration() {
   $items['rules_commons_kissmetrics_user_follows_content'] = entity_import('rules_config', '{ "rules_commons_kissmetrics_user_follows_content" : {
       "LABEL" : "Commons KISSmetrics: User Follows Content",
       "PLUGIN" : "reaction rule",
+      "OWNER" : "rules",
       "TAGS" : [ "Commons KISSmetrics" ],
       "REQUIRES" : [ "rules", "kissmetrics", "flag" ],
       "ON" : { "flag_flagged_commons_follow_node" : [] },
@@ -166,6 +174,7 @@ function commons_kissmetrics_default_rules_configuration() {
   $items['rules_commons_kissmetrics_user_follows_group'] = entity_import('rules_config', '{ "rules_commons_kissmetrics_user_follows_group" : {
       "LABEL" : "Commons KISSmetrics: User Follows Group",
       "PLUGIN" : "reaction rule",
+      "OWNER" : "rules",
       "TAGS" : [ "Commons KISSmetrics" ],
       "REQUIRES" : [ "rules", "kissmetrics", "flag" ],
       "ON" : { "flag_flagged_commons_follow_group" : [] },
@@ -181,6 +190,7 @@ function commons_kissmetrics_default_rules_configuration() {
   $items['rules_commons_kissmetrics_user_follows_topic'] = entity_import('rules_config', '{ "rules_commons_kissmetrics_user_follows_topic" : {
       "LABEL" : "Commons KISSmetrics: User Follows Topic",
       "PLUGIN" : "reaction rule",
+      "OWNER" : "rules",
       "TAGS" : [ "Commons KISSmetrics" ],
       "REQUIRES" : [ "rules", "kissmetrics", "flag" ],
       "ON" : { "flag_flagged_commons_follow_term" : [] },
@@ -196,6 +206,7 @@ function commons_kissmetrics_default_rules_configuration() {
   $items['rules_commons_kissmetrics_user_follows_user'] = entity_import('rules_config', '{ "rules_commons_kissmetrics_user_follows_user" : {
       "LABEL" : "Commons KISSmetrics: User Follows User",
       "PLUGIN" : "reaction rule",
+      "OWNER" : "rules",
       "TAGS" : [ "Commons KISSmetrics" ],
       "REQUIRES" : [ "rules", "kissmetrics", "flag" ],
       "ON" : { "flag_flagged_commons_follow_user" : [] },
@@ -211,6 +222,7 @@ function commons_kissmetrics_default_rules_configuration() {
   $items['rules_commons_kissmetrics_user_likes_content'] = entity_import('rules_config', '{ "rules_commons_kissmetrics_user_likes_content" : {
       "LABEL" : "Commons KISSmetrics: User Likes Content",
       "PLUGIN" : "reaction rule",
+      "OWNER" : "rules",
       "TAGS" : [ "Commons KISSmetrics" ],
       "REQUIRES" : [ "rules", "kissmetrics", "voting_rules" ],
       "ON" : { "voting_rules_insert_node" : [] },
@@ -222,6 +234,7 @@ function commons_kissmetrics_default_rules_configuration() {
   $items['rules_commons_kissmetrics_user_logs_in'] = entity_import('rules_config', '{ "rules_commons_kissmetrics_user_logs_in" : {
       "LABEL" : "Commons KISSmetrics: User Logs In",
       "PLUGIN" : "reaction rule",
+      "OWNER" : "rules",
       "TAGS" : [ "Commons KISSmetrics" ],
       "REQUIRES" : [ "rules", "kissmetrics" ],
       "ON" : { "user_login" : [] },
@@ -233,6 +246,7 @@ function commons_kissmetrics_default_rules_configuration() {
   $items['rules_commons_kissmetrics_user_logs_out'] = entity_import('rules_config', '{ "rules_commons_kissmetrics_user_logs_out" : {
       "LABEL" : "Commons KISSmetrics: User Logs Out",
       "PLUGIN" : "reaction rule",
+      "OWNER" : "rules",
       "TAGS" : [ "Commons KISSmetrics" ],
       "REQUIRES" : [ "rules", "kissmetrics" ],
       "ON" : { "user_logout" : [] },
@@ -244,6 +258,7 @@ function commons_kissmetrics_default_rules_configuration() {
   $items['rules_commons_kissmetrics_user_posts_comment'] = entity_import('rules_config', '{ "rules_commons_kissmetrics_user_posts_comment" : {
       "LABEL" : "Commons KISSmetrics: User Posts Comment",
       "PLUGIN" : "reaction rule",
+      "OWNER" : "rules",
       "TAGS" : [ "Commons KISSmetrics" ],
       "REQUIRES" : [ "rules", "kissmetrics", "comment" ],
       "ON" : { "comment_insert" : [] },
@@ -264,6 +279,7 @@ function commons_kissmetrics_default_rules_configuration() {
   $items['rules_commons_kissmetrics_user_registers'] = entity_import('rules_config', '{ "rules_commons_kissmetrics_user_registers" : {
       "LABEL" : "Commons KISSmetrics: User Registers",
       "PLUGIN" : "reaction rule",
+      "OWNER" : "rules",
       "TAGS" : [ "Commons KISSmetrics" ],
       "REQUIRES" : [ "rules", "kissmetrics" ],
       "ON" : { "user_insert" : [] },
@@ -275,6 +291,7 @@ function commons_kissmetrics_default_rules_configuration() {
   $items['rules_commons_kissmetrics_user_replies_to_private_message_thread'] = entity_import('rules_config', '{ "rules_commons_kissmetrics_user_replies_to_private_message_thread" : {
       "LABEL" : "Commons KISSmetrics: User Replies To Private Message Thread",
       "PLUGIN" : "reaction rule",
+      "OWNER" : "rules",
       "TAGS" : [ "Commons KISSmetrics" ],
       "REQUIRES" : [ "rules", "kissmetrics", "privatemsg_rules" ],
       "ON" : { "privatemsg_insert" : [] },
@@ -293,6 +310,7 @@ function commons_kissmetrics_default_rules_configuration() {
   $items['rules_commons_kissmetrics_user_starts_new_private_message_thread'] = entity_import('rules_config', '{ "rules_commons_kissmetrics_user_starts_new_private_message_thread" : {
       "LABEL" : "Commons KISSmetrics: User Starts New Private Message Thread",
       "PLUGIN" : "reaction rule",
+      "OWNER" : "rules",
       "TAGS" : [ "Commons KISSmetrics" ],
       "REQUIRES" : [ "rules", "kissmetrics", "privatemsg_rules" ],
       "ON" : { "privatemsg_insert" : [] },
diff --git a/modules/commons/commons_like/commons_like.features.inc b/modules/commons/commons_like/commons_like.features.inc
index d5ecfdb..16f1761 100644
--- a/modules/commons/commons_like/commons_like.features.inc
+++ b/modules/commons/commons_like/commons_like.features.inc
@@ -34,9 +34,9 @@ function commons_like_default_message_type() {
           "safe_value" : "[message:user:picture]"
         },
         {
-          "value" : "\\u003Ca href=\\u0022[message:user:url:absolute]\\u0022\\u003E[message:user:name]\\u003C\\/a\\u003E liked the [message:field-target-nodes:0:type] \\u003Ca href=\\u0022[message:field-target-nodes:0:url]\\u0022\\u003E[message:field-target-nodes:0:title]\\u003C\\/a\\u003E",
+          "value" : "\\u003Ca href=\\u0022[message:user:url:absolute]\\u0022\\u003E[message:user:name]\\u003C\\/a\\u003E liked the [message:field-target-nodes:0:type] \\u003Ca href=\\u0022[message:field-target-nodes:0:url]\\u0022\\u003E[message:field-target-nodes:0:title_field]\\u003C\\/a\\u003E",
           "format" : "full_html",
-          "safe_value" : "\\u003Ca href=\\u0022[message:user:url:absolute]\\u0022\\u003E[message:user:name]\\u003C\\/a\\u003E liked the [message:field-target-nodes:0:type] \\u003Ca href=\\u0022[message:field-target-nodes:0:url]\\u0022\\u003E[message:field-target-nodes:0:title]\\u003C\\/a\\u003E"
+          "safe_value" : "\\u003Ca href=\\u0022[message:user:url:absolute]\\u0022\\u003E[message:user:name]\\u003C\\/a\\u003E liked the [message:field-target-nodes:0:type] \\u003Ca href=\\u0022[message:field-target-nodes:0:url]\\u0022\\u003E[message:field-target-nodes:0:title_field]\\u003C\\/a\\u003E"
         }
       ]
     },
diff --git a/modules/commons/commons_like/commons_like.info b/modules/commons/commons_like/commons_like.info
index c2b7997..a40f432 100644
--- a/modules/commons/commons_like/commons_like.info
+++ b/modules/commons/commons_like/commons_like.info
@@ -2,7 +2,6 @@ name = Commons Like
 description = Community members can indicate that they like content and comments.
 core = 7.x
 package = Commons - Building blocks
-project = commons_like
 dependencies[] = entityreference
 dependencies[] = features
 dependencies[] = message
diff --git a/modules/commons/commons_like/commons_like.module b/modules/commons/commons_like/commons_like.module
index 5ed5021..49f6f2e 100644
--- a/modules/commons/commons_like/commons_like.module
+++ b/modules/commons/commons_like/commons_like.module
@@ -25,7 +25,7 @@ function commons_like_features_export_alter(&$export, $module_name) {
   if (!empty($items['rate_widgets']->value)) {
     foreach($items['rate_widgets']->value as $key => $widget) {
       if ($widget->name == 'commons_like') {
-        $commons_entity_integrations = module_invoke_all('commons_entity_integration');
+        $commons_entity_integrations = commons_entity_integration_info();
         if (!empty($commons_entity_integrations['node'])) {
           foreach ($commons_entity_integrations['node'] as $bundle => $options) {
             if (!isset($options['exclude_rate']) || $options['exclude_rate'] != TRUE) {
diff --git a/modules/commons/commons_media/commons_media.css b/modules/commons/commons_media/commons_media.css
new file mode 100644
index 0000000..e8e96ab
--- /dev/null
+++ b/modules/commons/commons_media/commons_media.css
@@ -0,0 +1,22 @@
+video {
+  height: auto;
+  max-width: 100%;
+}
+
+.oembed {
+  height: 0;
+  overflow: hidden;
+  padding-bottom: 56.25%;
+  padding-top: 30px;
+  position: relative;
+}
+
+.oembed iframe,
+.oembed object,
+.oembed embed {
+  height: 100%;
+  left: 0;
+  position: absolute;
+  top: 0;
+  width: 100%;
+}
diff --git a/modules/commons/commons_media/commons_media.features.field_base.inc b/modules/commons/commons_media/commons_media.features.field_base.inc
new file mode 100644
index 0000000..3a93532
--- /dev/null
+++ b/modules/commons/commons_media/commons_media.features.field_base.inc
@@ -0,0 +1,45 @@
+<?php
+/**
+ * @file
+ * commons_media.features.field_base.inc
+ */
+
+/**
+ * Implements hook_field_default_field_bases().
+ */
+function commons_media_field_default_field_bases() {
+  $field_bases = array();
+
+  // Exported field_base: 'field_media'
+  $field_bases['field_media'] = array(
+    'active' => 1,
+    'cardinality' => -1,
+    'deleted' => 0,
+    'entity_types' => array(),
+    'field_name' => 'field_media',
+    'foreign keys' => array(
+      'fid' => array(
+        'columns' => array(
+          'fid' => 'fid',
+        ),
+        'table' => 'file_managed',
+      ),
+    ),
+    'indexes' => array(
+      'fid' => array(
+        0 => 'fid',
+      ),
+    ),
+    'locked' => 0,
+    'module' => 'file',
+    'settings' => array(
+      'display_default' => 0,
+      'display_field' => 0,
+      'uri_scheme' => 'public',
+    ),
+    'translatable' => 0,
+    'type' => 'file',
+  );
+
+  return $field_bases;
+}
diff --git a/modules/commons/commons_media/commons_media.features.field_instance.inc b/modules/commons/commons_media/commons_media.features.field_instance.inc
new file mode 100644
index 0000000..91e86d0
--- /dev/null
+++ b/modules/commons/commons_media/commons_media.features.field_instance.inc
@@ -0,0 +1,98 @@
+<?php
+/**
+ * @file
+ * commons_media.features.field_instance.inc
+ */
+
+/**
+ * Implements hook_field_default_field_instances().
+ */
+function commons_media_field_default_field_instances() {
+  $field_instances = array();
+
+  $commons_groups_entity_types = commons_groups_get_group_content_entity_types();
+  if (!empty($commons_groups_entity_types)) {
+    foreach ($commons_groups_entity_types as $entity_type => $bundles) {
+      foreach ($bundles as $bundle => $integrations) {
+        if (!empty($integrations['media'])) {
+          commons_media_field_definition($field_instances, $entity_type, $bundle);
+        }
+      }
+    }
+  }
+
+  return $field_instances;
+}
+
+function commons_media_field_definition(&$field_instances, $entity_type, $bundle) {
+  // Exported field_instance: 'entity-bundle-field_media'
+  $field_instances["$entity_type-$bundle-field_media"] = array(
+    'bundle' => $bundle,
+    'deleted' => 0,
+    'description' => 'Attach an image or video.',
+    'display' => array(
+      'default' => array(
+        'label' => 'hidden',
+        'module' => 'file_entity',
+        'settings' => array(
+          'file_view_mode' => 'default',
+        ),
+        'type' => 'file_rendered',
+        'weight' => 0,
+      ),
+      'teaser' => array(
+        'label' => 'hidden',
+        'module' => 'file_entity',
+        'settings' => array(
+          'file_view_mode' => 'teaser',
+        ),
+        'type' => 'file_rendered',
+        'weight' => 0,
+      ),
+    ),
+    'display_in_partial_form' => 1,
+    'entity_type' => 'node',
+    'field_name' => 'field_media',
+    'label' => 'Media',
+    'required' => 0,
+    'settings' => array(
+      'description_field' => 0,
+      'file_directory' => 'media',
+      'file_extensions' => 'jpg jpeg gif png oembed mov mp4 m4v mpeg avi ogv webp webm',
+      'max_filesize' => '',
+      'user_register_form' => FALSE,
+    ),
+    'widget' => array(
+      'active' => 1,
+      'module' => 'media',
+      'settings' => array(
+        'allowed_schemes' => array(
+          'oembed' => 'oembed',
+          'public' => 'public',
+        ),
+        'allowed_types' => array(
+          'audio' => 0,
+          'document' => 0,
+          'image' => 'image',
+          'video' => 'video',
+        ),
+        'browser_plugins' => array(
+          'media_default--media_browser_1' => 0,
+          'media_default--media_browser_my_files' => 0,
+          'media_internet' => 'media_internet',
+          'upload' => 'upload',
+        ),
+        'progress_indicator' => 'throbber',
+      ),
+      'type' => 'media_generic',
+      'weight' => 2,
+    ),
+  );
+
+  // Translatables
+  // Included for use with string extractors like potx.
+  t('Attach an image or video.');
+  t('Media');
+
+  return $field_instances;
+}
diff --git a/modules/commons/commons_media/commons_media.features.inc b/modules/commons/commons_media/commons_media.features.inc
new file mode 100644
index 0000000..b77b46f
--- /dev/null
+++ b/modules/commons/commons_media/commons_media.features.inc
@@ -0,0 +1,14 @@
+<?php
+/**
+ * @file
+ * commons_media.features.inc
+ */
+
+/**
+ * Implements hook_ctools_plugin_api().
+ */
+function commons_media_ctools_plugin_api($module = NULL, $api = NULL) {
+  if ($module == "strongarm" && $api == "strongarm") {
+    return array("version" => "1");
+  }
+}
diff --git a/modules/commons/commons_media/commons_media.features.user_permission.inc b/modules/commons/commons_media/commons_media.features.user_permission.inc
new file mode 100644
index 0000000..84af5ff
--- /dev/null
+++ b/modules/commons/commons_media/commons_media.features.user_permission.inc
@@ -0,0 +1,34 @@
+<?php
+/**
+ * @file
+ * commons_media.features.user_permission.inc
+ */
+
+/**
+ * Implements hook_user_default_permissions().
+ */
+function commons_media_user_default_permissions() {
+  $permissions = array();
+
+  // Exported permission: 'add media from remote sources'.
+  $permissions['add media from remote sources'] = array(
+    'name' => 'add media from remote sources',
+    'roles' => array(
+      'administrator' => 'administrator',
+      'authenticated user' => 'authenticated user',
+    ),
+    'module' => 'media_internet',
+  );
+
+  // Exported permission: 'create files'.
+  $permissions['create files'] = array(
+    'name' => 'create files',
+    'roles' => array(
+      'administrator' => 'administrator',
+      'authenticated user' => 'authenticated user',
+    ),
+    'module' => 'file_entity',
+  );
+
+  return $permissions;
+}
diff --git a/modules/commons/commons_media/commons_media.info b/modules/commons/commons_media/commons_media.info
new file mode 100644
index 0000000..e5999ca
--- /dev/null
+++ b/modules/commons/commons_media/commons_media.info
@@ -0,0 +1,18 @@
+name = Commons Media
+description = Provides media handling capabilities.
+core = 7.x
+package = Commons - Building blocks
+dependencies[] = ctools
+dependencies[] = features
+dependencies[] = file
+dependencies[] = file_entity
+dependencies[] = media
+dependencies[] = media_internet
+dependencies[] = oembed
+dependencies[] = strongarm
+features[ctools][] = strongarm:strongarm:1
+features[features_api][] = api:2
+features[field_base][] = field_media
+features[user_permission][] = add media from remote sources
+features[user_permission][] = create files
+features[variable][] = media__dialog_theme
diff --git a/modules/commons/commons_media/commons_media.module b/modules/commons/commons_media/commons_media.module
new file mode 100644
index 0000000..6179ba2
--- /dev/null
+++ b/modules/commons/commons_media/commons_media.module
@@ -0,0 +1,174 @@
+<?php
+/**
+ * @file
+ * Code for the Commons Media feature.
+ */
+
+include_once 'commons_media.features.inc';
+
+/**
+ * Implements hook_system_info_alter().
+ */
+function commons_media_system_info_alter(&$info, $file, $type) {
+  if ($file->name == 'commons_media') {
+    $entity_integrations = commons_entity_integration_info();
+
+    if (!empty($entity_integrations)) {
+      foreach ($entity_integrations as $entity_type => $bundles) {
+        foreach ($bundles as $bundle => $integrations) {
+          if (!empty($integrations['media'])) {
+            $info['features']['field_instance'][] = "$entity_type-$bundle-field_media";
+          }
+        }
+      }
+    }
+  }
+}
+
+/**
+ * Implements hook_menu_alter().
+ */
+function commons_media_menu_alter(&$items) {
+  // Use a tweaked AJAX page callback for managed_file and media elements in
+  // order to bypass a core issue that occurs when more than one browsing widget
+  // tab contains a managed_file or media file field widget.
+  if (isset($items['file/ajax'])) {
+    $items['file/ajax']['page callback'] = 'commons_ajax_upload';
+  }
+  if (isset($items['media/ajax'])) {
+    $items['media/ajax']['page callback'] = 'commons_ajax_upload';
+  }
+}
+
+/**
+ * Menu callback; Shared Ajax callback for managed_file and media elements.
+ *
+ * Identical to the Ajax callback used by file.module and media.module except
+ * with the $form_build_id != $_POST['form_build_id'] check removed in order to
+ * prevent errors when more than one browsing widget tab contains a managed_file
+ * or media file field widget.
+ *
+ * @see file_ajax_upload()
+ * @see media_ajax_upload()
+ */
+function commons_ajax_upload() {
+  $form_parents = func_get_args();
+  $form_build_id = (string) array_pop($form_parents);
+
+  if (empty($_POST['form_build_id'])) {
+    // Invalid request.
+    drupal_set_message(t('An unrecoverable error occurred. The uploaded file likely exceeded the maximum file size (@size) that this server supports.', array('@size' => format_size(file_upload_max_size()))), 'error');
+    $commands = array();
+    $commands[] = ajax_command_replace(NULL, theme('status_messages'));
+    return array('#type' => 'ajax', '#commands' => $commands);
+  }
+
+  list($form, $form_state) = ajax_get_form();
+
+  if (!$form) {
+    // Invalid form_build_id.
+    drupal_set_message(t('An unrecoverable error occurred. Use of this form has expired. Try reloading the page and submitting again.'), 'error');
+    $commands = array();
+    $commands[] = ajax_command_replace(NULL, theme('status_messages'));
+    return array('#type' => 'ajax', '#commands' => $commands);
+  }
+
+  // Get the current element and count the number of files.
+  $current_element = $form;
+  foreach ($form_parents as $parent) {
+    $current_element = $current_element[$parent];
+  }
+  $current_file_count = isset($current_element['#file_upload_delta']) ? $current_element['#file_upload_delta'] : 0;
+
+  // Process user input. $form and $form_state are modified in the process.
+  drupal_process_form($form['#form_id'], $form, $form_state);
+
+  // Retrieve the element to be rendered.
+  foreach ($form_parents as $parent) {
+    $form = $form[$parent];
+  }
+
+  // Add the special Ajax class if a new file was added.
+  if (isset($form['#file_upload_delta']) && $current_file_count < $form['#file_upload_delta']) {
+    $form[$current_file_count]['#attributes']['class'][] = 'ajax-new-content';
+  }
+  // Otherwise just add the new content class on a placeholder.
+  else {
+    $form['#suffix'] .= '<span class="ajax-new-content"></span>';
+  }
+
+  $output = theme('status_messages') . drupal_render($form);
+  $js = drupal_add_js();
+  $settings = call_user_func_array('array_merge_recursive', $js['settings']['data']);
+
+  $commands = array();
+  $commands[] = ajax_command_replace(NULL, $output, $settings);
+  return array('#type' => 'ajax', '#commands' => $commands);
+}
+
+/**
+ * Implements hook_file_view_alter().
+ */
+function commons_media_file_view_alter(&$build) {
+  $file_type = $build['#bundle'];
+
+  // Add responsive CSS to image and video files.
+  if ($file_type == 'image' || $file_type == 'video') {
+    $build['#attached']['css'][] = drupal_get_path('module', 'commons_media') . '/commons_media.css';
+  }
+}
+
+/**
+ * Implements hook_preprocess_oembed().
+ */
+function commons_media_preprocess_oembed(&$variables) {
+  $embed = $variables['embed'];
+
+  // Video and rich type must have HTML content.
+  // Wrap the HTML content in a <div> to allow it to be made responsive.
+  if (in_array($embed['type'], array('video', 'rich'))) {
+    $embed['html'] = '<div class="oembed">' . $embed['html'] . '</div>';
+  }
+
+  $variables['embed'] = $embed;
+}
+
+/**
+ * Implements hook_filter_default_formats_alter().
+ */
+function commons_media_filter_default_formats_alter(&$formats) {
+  if (module_exists('media_wysiwyg')) {
+    // Enable the media filter.
+    $formats['filtered_html']['filters'] += array(
+      'media_filter' => array(
+        'status' => 1,
+        'weight' => 2,
+      ),
+    );
+  }
+}
+
+/**
+ * Implements hook_ckeditor_profile_defaults().
+ */
+function commons_media_ckeditor_profile_defaults_alter(&$profiles) {
+  if (module_exists('media_wysiwyg')) {
+    // Add the media button.
+    $profiles['Advanced']['settings']['toolbar'] = '[
+    [\'Format\'],
+    [\'Bold\',\'Italic\',\'Strike\'],
+    [\'NumberedList\',\'BulletedList\',\'Indent\',\'Outdent\',\'Blockquote\'],
+    [\'Link\',\'Unlink\',\'Media\']
+    ]';
+
+    // Load the media plugin.
+    $profiles['Advanced']['settings']['loadPlugins'] += array(
+      'media' => array(
+        'default' => 'f',
+        'desc' => 'Plugin for inserting images from Drupal media module',
+        'name' => 'media',
+        'path' => '%plugin_dir%media/',
+      ),
+    );
+  }
+}
diff --git a/modules/commons/commons_media/commons_media.strongarm.inc b/modules/commons/commons_media/commons_media.strongarm.inc
new file mode 100644
index 0000000..501c614
--- /dev/null
+++ b/modules/commons/commons_media/commons_media.strongarm.inc
@@ -0,0 +1,21 @@
+<?php
+/**
+ * @file
+ * commons_media.strongarm.inc
+ */
+
+/**
+ * Implements hook_strongarm().
+ */
+function commons_media_strongarm() {
+  $export = array();
+
+  $strongarm = new stdClass();
+  $strongarm->disabled = FALSE; /* Edit this to true to make a default strongarm disabled initially */
+  $strongarm->api_version = 1;
+  $strongarm->name = 'media__dialog_theme';
+  $strongarm->value = 'ember';
+  $export['media__dialog_theme'] = $strongarm;
+
+  return $export;
+}
diff --git a/modules/commons/commons_misc/commons_misc.features.user_role.inc b/modules/commons/commons_misc/commons_misc.features.user_role.inc
new file mode 100644
index 0000000..354ec88
--- /dev/null
+++ b/modules/commons/commons_misc/commons_misc.features.user_role.inc
@@ -0,0 +1,20 @@
+<?php
+/**
+ * @file
+ * commons_misc.features.user_role.inc
+ */
+
+/**
+ * Implements hook_user_default_roles().
+ */
+function commons_misc_user_default_roles() {
+  $roles = array();
+
+  // Exported role: administrator.
+  $roles['administrator'] = array(
+    'name' => 'administrator',
+    'weight' => 10,
+  );
+
+  return $roles;
+}
diff --git a/modules/commons/commons_misc/commons_misc.info b/modules/commons/commons_misc/commons_misc.info
index d7b88d0..c6d9557 100644
--- a/modules/commons/commons_misc/commons_misc.info
+++ b/modules/commons/commons_misc/commons_misc.info
@@ -2,14 +2,12 @@ name = Commons Miscellaneous Configuration
 description = Various suggested bits of configuration for Commons sites.
 core = 7.x
 package = Commons - Building blocks
-project = commons_misc
 dependencies[] = comment
 dependencies[] = ctools
 dependencies[] = features
 dependencies[] = node
 dependencies[] = strongarm
 dependencies[] = user
-datestamp = 1355530534
 features[ctools][] = page_manager:pages_default:1
 features[ctools][] = strongarm:strongarm:1
 features[features_api][] = api:2
@@ -20,6 +18,8 @@ features[user_permission][] = access user profiles
 features[user_permission][] = post comments
 features[user_permission][] = skip comment approval
 features[user_permission][] = view own unpublished content
+features[user_role][] = administrator
+features[variable][] = navbar_libraries_variants
 features[variable][] = theme_adaptivetheme_settings
 features[variable][] = theme_commons_origins_settings
 features[variable][] = user_register
diff --git a/modules/commons/commons_misc/commons_misc.install b/modules/commons/commons_misc/commons_misc.install
index ab93fe7..b8ab941 100644
--- a/modules/commons/commons_misc/commons_misc.install
+++ b/modules/commons/commons_misc/commons_misc.install
@@ -5,6 +5,27 @@
  */
 
 /**
+ * Implements hook_install().
+ */
+function commons_misc_install() {
+  // While the administrator role will be created by Features, it will not be
+  // available yet when hook_install() is run, so we need to test for and create
+  // it here.
+  if (!$role = user_role_load_by_name('administrator')) {
+    $role = new stdClass();
+    $role->name = 'administrator';
+    $role->weight = 10;
+    user_role_save($role);
+  }
+
+  // Grant user 1 the 'administrator' role.
+  user_multiple_role_edit(array(1), 'add_role', $role->rid);
+
+  // Set the 'administrator' role as the 'administrator role'.
+  variable_set('user_admin_role', $role->rid);
+}
+
+/**
  * Enable legacy IE settings for Commons Origins.
  */
 function commons_misc_update_7000() {
@@ -21,3 +42,26 @@ function commons_misc_update_7000() {
   // Save the new Commons Origins settings.
   variable_set('theme_commons_origins_settings', $settings);
 }
+
+/**
+ * Assign the administrator role a larger weight.
+ */
+function commons_misc_update_7001() {
+  $revert = array(
+    'commons_misc' => array('user_role'),
+  );
+  features_revert($revert);
+  return array();
+}
+
+/**
+ * Configure navbar to use the source version of Modernizr since it isn't
+ * currently possible to include a minified version of the library.
+ */
+function commons_misc_update_7002() {
+  $revert = array(
+    'commons_misc' => array('variable'),
+  );
+  features_revert($revert);
+  return array();
+}
diff --git a/modules/commons/commons_misc/commons_misc.module b/modules/commons/commons_misc/commons_misc.module
index 32fbc63..5027494 100644
--- a/modules/commons/commons_misc/commons_misc.module
+++ b/modules/commons/commons_misc/commons_misc.module
@@ -44,4 +44,31 @@ function commons_misc_form_system_theme_settings_alter(&$form, &$form_state, $fo
     require_once(drupal_get_path('theme', 'commons_origins') . '/commons_origins.palettes.inc');
     commons_origins_palettes_form($form);
   }
+}
+
+/*
+ * Render a link to the official commons documentation located at
+ * https://docs.acquia.com/commons
+ */
+function commons_misc_navbar() {
+  $items = array();
+
+  $items['documentation'] = array(
+    '#type' => 'navbar_item',
+    'tab' => array(
+      '#type' => 'link',
+      '#title' => t('Documentation'),
+      '#href' => 'https://docs.acquia.com/commons',
+      '#options' => array(
+        'attributes' => array(
+          'title' => t('Commons Documentation'),
+          'class' => array('icon', 'icon-help'),
+          'target' => '_blank',
+        ),
+      ),
+    ),
+    '#weight' => 20,
+  );
+
+  return $items;
 }
\ No newline at end of file
diff --git a/modules/commons/commons_misc/commons_misc.strongarm.inc b/modules/commons/commons_misc/commons_misc.strongarm.inc
index 4fe438d..53ef917 100644
--- a/modules/commons/commons_misc/commons_misc.strongarm.inc
+++ b/modules/commons/commons_misc/commons_misc.strongarm.inc
@@ -307,6 +307,15 @@ function commons_misc_strongarm() {
   $strongarm = new stdClass();
   $strongarm->disabled = FALSE; /* Edit this to true to make a default strongarm disabled initially */
   $strongarm->api_version = 1;
+  $strongarm->name = 'navbar_libraries_variants';
+  $strongarm->value = array(
+    'modernizr' => 'source',
+  );
+  $export['navbar_libraries_variants'] = $strongarm;
+
+  $strongarm = new stdClass();
+  $strongarm->disabled = FALSE; /* Edit this to true to make a default strongarm disabled initially */
+  $strongarm->api_version = 1;
   $strongarm->name = 'user_register';
   $strongarm->value = '1';
   $export['user_register'] = $strongarm;
diff --git a/modules/commons/commons_notify/commons_notify.features.field_instance.inc b/modules/commons/commons_notify/commons_notify.features.field_instance.inc
index 57ff66e..d03df1f 100644
--- a/modules/commons/commons_notify/commons_notify.features.field_instance.inc
+++ b/modules/commons/commons_notify/commons_notify.features.field_instance.inc
@@ -211,6 +211,208 @@ function commons_notify_field_default_field_instances() {
     ),
   );
 
+  // Exported field_instance: 'message-commons_notify_comment_created_no_groups-field_message_rendered_body'
+  $field_instances['message-commons_notify_comment_created_no_groups-field_message_rendered_body'] = array(
+    'bundle' => 'commons_notify_comment_created_no_groups',
+    'default_value' => NULL,
+    'deleted' => 0,
+    'description' => '',
+    'display' => array(
+      'default' => array(
+        'label' => 'above',
+        'module' => 'text',
+        'settings' => array(),
+        'type' => 'text_default',
+        'weight' => 2,
+      ),
+      'message_notify_email_body' => array(
+        'label' => 'above',
+        'settings' => array(),
+        'type' => 'hidden',
+        'weight' => 4,
+      ),
+      'message_notify_email_subject' => array(
+        'label' => 'above',
+        'settings' => array(),
+        'type' => 'hidden',
+        'weight' => 4,
+      ),
+    ),
+    'entity_type' => 'message',
+    'field_name' => 'field_message_rendered_body',
+    'label' => 'Body',
+    'required' => 0,
+    'settings' => array(
+      'text_processing' => 0,
+      'user_register_form' => FALSE,
+    ),
+    'widget' => array(
+      'active' => 1,
+      'module' => 'text',
+      'settings' => array(
+        'rows' => 5,
+      ),
+      'type' => 'text_textarea',
+      'weight' => 6,
+    ),
+  );
+
+  // Exported field_instance: 'message-commons_notify_comment_created_no_groups-field_message_rendered_subject'
+  $field_instances['message-commons_notify_comment_created_no_groups-field_message_rendered_subject'] = array(
+    'bundle' => 'commons_notify_comment_created_no_groups',
+    'default_value' => NULL,
+    'deleted' => 0,
+    'description' => '',
+    'display' => array(
+      'default' => array(
+        'label' => 'above',
+        'module' => 'text',
+        'settings' => array(),
+        'type' => 'text_default',
+        'weight' => 3,
+      ),
+      'message_notify_email_body' => array(
+        'label' => 'above',
+        'settings' => array(),
+        'type' => 'hidden',
+        'weight' => 3,
+      ),
+      'message_notify_email_subject' => array(
+        'label' => 'above',
+        'settings' => array(),
+        'type' => 'hidden',
+        'weight' => 3,
+      ),
+    ),
+    'entity_type' => 'message',
+    'field_name' => 'field_message_rendered_subject',
+    'label' => 'Subject',
+    'required' => FALSE,
+    'settings' => array(
+      'text_processing' => 0,
+      'user_register_form' => FALSE,
+    ),
+    'widget' => array(
+      'module' => 'text',
+      'settings' => array(
+        'size' => 60,
+      ),
+      'type' => 'text_textfield',
+      'weight' => 8,
+    ),
+  );
+
+
+  // Exported field_instance: 'message-commons_notify_comment_created_no_groups-field_target_comments'
+  $field_instances['message-commons_notify_comment_created_no_groups-field_target_comments'] = array(
+    'bundle' => 'commons_notify_comment_created_no_groups',
+    'default_value' => NULL,
+    'default_value_function' => '',
+    'deleted' => 0,
+    'description' => '',
+    'display' => array(
+      'default' => array(
+        'label' => 'above',
+        'module' => 'entityreference',
+        'settings' => array(
+          'link' => FALSE,
+        ),
+        'type' => 'entityreference_label',
+        'weight' => 1,
+      ),
+      'message_notify_email_body' => array(
+        'label' => 'above',
+        'settings' => array(),
+        'type' => 'hidden',
+        'weight' => 5,
+      ),
+      'message_notify_email_subject' => array(
+        'label' => 'above',
+        'settings' => array(),
+        'type' => 'hidden',
+        'weight' => 5,
+      ),
+    ),
+    'entity_type' => 'message',
+    'field_name' => 'field_target_comments',
+    'label' => 'Target comment',
+    'required' => 1,
+    'settings' => array(
+      'behaviors' => array(
+        'prepopulate' => array(
+          'status' => 0,
+        ),
+      ),
+      'user_register_form' => FALSE,
+    ),
+    'widget' => array(
+      'active' => 1,
+      'module' => 'entityreference',
+      'settings' => array(
+        'match_operator' => 'CONTAINS',
+        'path' => '',
+        'size' => 60,
+      ),
+      'type' => 'entityreference_autocomplete',
+      'weight' => 4,
+    ),
+  );
+
+  // Exported field_instance: 'message-commons_notify_comment_created_no_groups-field_target_nodes'
+  $field_instances['message-commons_notify_comment_created_no_groups-field_target_nodes'] = array(
+    'bundle' => 'commons_notify_comment_created_no_groups',
+    'default_value' => NULL,
+    'default_value_function' => '',
+    'deleted' => 0,
+    'description' => '',
+    'display' => array(
+      'default' => array(
+        'label' => 'above',
+        'module' => 'entityreference',
+        'settings' => array(
+          'link' => FALSE,
+        ),
+        'type' => 'entityreference_label',
+        'weight' => 0,
+      ),
+      'message_notify_email_body' => array(
+        'label' => 'above',
+        'settings' => array(),
+        'type' => 'hidden',
+        'weight' => 6,
+      ),
+      'message_notify_email_subject' => array(
+        'label' => 'above',
+        'settings' => array(),
+        'type' => 'hidden',
+        'weight' => 6,
+      ),
+    ),
+    'entity_type' => 'message',
+    'field_name' => 'field_target_nodes',
+    'label' => 'Target nodes',
+    'required' => 0,
+    'settings' => array(
+      'behaviors' => array(
+        'prepopulate' => array(
+          'status' => 0,
+        ),
+      ),
+      'user_register_form' => FALSE,
+    ),
+    'widget' => array(
+      'active' => 1,
+      'module' => 'entityreference',
+      'settings' => array(
+        'match_operator' => 'CONTAINS',
+        'path' => '',
+        'size' => 60,
+      ),
+      'type' => 'entityreference_autocomplete',
+      'weight' => 2,
+    ),
+  );
+
   // Exported field_instance: 'message-commons_notify_node_created-field_message_rendered_body'
   $field_instances['message-commons_notify_node_created-field_message_rendered_body'] = array(
     'bundle' => 'commons_notify_node_created',
@@ -444,61 +646,6 @@ function commons_notify_field_default_field_instances() {
     ),
   );
 
-  // Exported field_instance: 'message-commons_notify_node_created_no_groups-field_target_comments'
-  $field_instances['message-commons_notify_node_created_no_groups-field_target_comments'] = array(
-    'bundle' => 'commons_notify_node_created_no_groups',
-    'default_value' => NULL,
-    'default_value_function' => '',
-    'deleted' => 0,
-    'description' => '',
-    'display' => array(
-      'default' => array(
-        'label' => 'above',
-        'module' => 'entityreference',
-        'settings' => array(
-          'link' => FALSE,
-        ),
-        'type' => 'entityreference_label',
-        'weight' => 3,
-      ),
-      'message_notify_email_body' => array(
-        'label' => 'above',
-        'settings' => array(),
-        'type' => 'hidden',
-        'weight' => 0,
-      ),
-      'message_notify_email_subject' => array(
-        'label' => 'above',
-        'settings' => array(),
-        'type' => 'hidden',
-        'weight' => 0,
-      ),
-    ),
-    'entity_type' => 'message',
-    'field_name' => 'field_target_comments',
-    'label' => 'Target comment',
-    'required' => 0,
-    'settings' => array(
-      'behaviors' => array(
-        'prepopulate' => array(
-          'status' => 0,
-        ),
-      ),
-      'user_register_form' => FALSE,
-    ),
-    'widget' => array(
-      'active' => 1,
-      'module' => 'entityreference',
-      'settings' => array(
-        'match_operator' => 'CONTAINS',
-        'path' => '',
-        'size' => 60,
-      ),
-      'type' => 'entityreference_autocomplete',
-      'weight' => 1,
-    ),
-  );
-
   // Exported field_instance: 'message-commons_notify_node_created_no_groups-field_target_nodes'
   $field_instances['message-commons_notify_node_created_no_groups-field_target_nodes'] = array(
     'bundle' => 'commons_notify_node_created_no_groups',
diff --git a/modules/commons/commons_notify/commons_notify.features.inc b/modules/commons/commons_notify/commons_notify.features.inc
index 58233d0..529cbef 100644
--- a/modules/commons/commons_notify/commons_notify.features.inc
+++ b/modules/commons/commons_notify/commons_notify.features.inc
@@ -29,14 +29,41 @@ function commons_notify_default_message_type() {
     "arguments" : null,
     "message_text" : { "und" : [
         {
-          "value" : "New comment on [message:field-target-nodes:0:title] in [message:field-target-nodes:0:og-group-ref:0:title]: [message:field-target-nodes:0:title]",
+          "value" : "New comment on [message:field-target-nodes:0:title_field] in [message:field-target-nodes:0:og-group-ref:0:title]: [message:field-target-nodes:0:title_field]",
           "format" : "plain_text",
-          "safe_value" : "\\u003Cp\\u003ENew comment on [message:field-target-nodes:0:title] in [message:field-target-nodes:0:og-group-ref:0:title]: [message:field-target-nodes:0:title]\\u003C\\/p\\u003E\\n"
+          "safe_value" : "\\u003Cp\\u003ENew comment on [message:field-target-nodes:0:title_field] in [message:field-target-nodes:0:og-group-ref:0:title]: [message:field-target-nodes:0:title_field]\\u003C\\/p\\u003E\\n"
         },
         {
-          "value" : "Hi [message:user:name],\\r\\n\\r\\n[message:field-target-comments:0:author] commented on [message:field-target-nodes:0:title] [commons-groups:in-groups-text]:\\r\\n\\r\\n[message:field-target-comments:0:body]\\r\\n\\r\\nRead \\u0026 respond: [message:field-target-comments:0:url]\\r\\nUpdate your notification settings: [site:url]\\/user\\/[message:user:uid]\\/notification-settings",
+          "value" : "Hi [message:user:name],\\r\\n\\r\\n[message:field-target-comments:0:author] commented on [message:field-target-nodes:0:title_field] [commons-groups:in-groups-text]:\\r\\n\\r\\n[message:field-target-comments:0:body]\\r\\n\\r\\nRead \\u0026 respond: [message:field-target-comments:0:url]\\r\\nUpdate your notification settings: [site:url]\\/user\\/[message:user:uid]\\/notification-settings",
           "format" : "plain_text",
-          "safe_value" : "\\u003Cp\\u003EHi [message:user:name],\\u003C\\/p\\u003E\\n\\u003Cp\\u003E[message:field-target-comments:0:author] commented on [message:field-target-nodes:0:title] [commons-groups:in-groups-text]:\\u003C\\/p\\u003E\\n\\u003Cp\\u003E[message:field-target-comments:0:body]\\u003C\\/p\\u003E\\n\\u003Cp\\u003ERead \\u0026amp; respond: [message:field-target-comments:0:url]\\u003Cbr \\/\\u003E\\nUpdate your notification settings: [site:url]\\/user\\/[message:user:uid]\\/notification-settings\\u003C\\/p\\u003E\\n"
+          "safe_value" : "\\u003Cp\\u003EHi [message:user:name],\\u003C\\/p\\u003E\\n\\u003Cp\\u003E[message:field-target-comments:0:author] commented on [message:field-target-nodes:0:title_field] [commons-groups:in-groups-text]:\\u003C\\/p\\u003E\\n\\u003Cp\\u003E[message:field-target-comments:0:body]\\u003C\\/p\\u003E\\n\\u003Cp\\u003ERead \\u0026amp; respond: [message:field-target-comments:0:url]\\u003Cbr \\/\\u003E\\nUpdate your notification settings: [site:url]\\/user\\/[message:user:uid]\\/notification-settings\\u003C\\/p\\u003E\\n"
+        }
+      ]
+    },
+    "rdf_mapping" : []
+  }');
+  $items['commons_notify_comment_created_no_groups'] = entity_import('message_type', '{
+    "name" : "commons_notify_comment_created_no_groups",
+    "description" : "Commons Notify: Comment created no groups",
+    "argument_keys" : [],
+    "argument" : [],
+    "category" : "commons_notify",
+    "data" : {
+      "token options" : { "clear" : 0 },
+      "purge" : { "override" : 0, "enabled" : 0, "quota" : "", "days" : "" }
+    },
+    "language" : "",
+    "arguments" : null,
+    "message_text" : { "und" : [
+        {
+          "value" : "New comment on [message:field-target-nodes:0:title_field] ",
+          "format" : "plain_text",
+          "safe_value" : "\\u003Cp\\u003ENew comment on [message:field-target-nodes:0:title_field]\\u003C\\/p\\u003E\\n"
+        },
+        {
+          "value" : "Hi [message:user:name],\\r\\n\\r\\n[message:field-target-comments:0:author] commented on [message:field-target-nodes:0:title_field]:\\r\\n\\r\\n[message:field-target-comments:0:body]\\r\\n\\r\\nRead \\u0026 respond: [message:field-target-comments:0:url]\\r\\nUpdate your notification settings: [site:url]\\/notification-settings",
+          "format" : "plain_text",
+          "safe_value" : "\\u003Cp\\u003EHi [message:user:name],\\u003C\\/p\\u003E\\n\\u003Cp\\u003E[message:field-target-comments:0:author] commented on [message:field-target-nodes:0:title_field]:\\u003C\\/p\\u003E\\n\\u003Cp\\u003E[message:field-target-comments:0:body]\\u003C\\/p\\u003E\\n\\u003Cp\\u003ERead \\u0026amp; respond: [message:field-target-comments:0:url]\\u003Cbr \\/\\u003E\\nUpdate your notification settings: [site:url]\\/notification-settings\\u003C\\/p\\u003E\\n"
         }
       ]
     },
@@ -53,14 +80,14 @@ function commons_notify_default_message_type() {
     "arguments" : null,
     "message_text" : { "und" : [
         {
-          "value" : "New [message:field-target-nodes:0:content-type] in [message:field-target-nodes:0:og-group-ref:0:title]: [message:field-target-nodes:0:title]",
+          "value" : "New [message:field-target-nodes:0:content-type] in [message:field-target-nodes:0:og-group-ref:0:title]: [message:field-target-nodes:0:title_field]",
           "format" : "plain_text",
-          "safe_value" : "\\u003Cp\\u003ENew [message:field-target-nodes:0:content-type] in [message:field-target-nodes:0:og-group-ref:0:title]: [message:field-target-nodes:0:title]\\u003C\\/p\\u003E\\n"
+          "safe_value" : "\\u003Cp\\u003ENew [message:field-target-nodes:0:content-type] in [message:field-target-nodes:0:og-group-ref:0:title]: [message:field-target-nodes:0:title_field]\\u003C\\/p\\u003E\\n"
         },
         {
-          "value" : "Hi [message:user:name],\\r\\n\\r\\n[message:field-target-nodes:0:author] created the [message:field-target-nodes:0:content-type] \\u201c[message:field-target-nodes:0:title]\\u201d on [site:name] [commons-groups:in-groups-text] on [message:field-target-nodes:0:created]:\\r\\n\\r\\n[message:field-target-nodes:0:body]\\r\\n\\r\\n\\r\\nPermalink: [message:field-target-nodes:0:url]\\r\\nAdd a comment at [message:field-target-nodes:0:url]#comment-form\\r\\n\\r\\nChange email notifications at [site:url]user\\/[message:user:uid]\\/notification-settings",
+          "value" : "Hi [message:user:name],\\r\\n\\r\\n[message:field-target-nodes:0:author] created the [message:field-target-nodes:0:content-type] \\u201c[message:field-target-nodes:0:title_field]\\u201d on [site:name] [commons-groups:in-groups-text] on [message:field-target-nodes:0:created]:\\r\\n\\r\\n[message:field-target-nodes:0:body]\\r\\n\\r\\n\\r\\nPermalink: [message:field-target-nodes:0:url]\\r\\nAdd a comment at [message:field-target-nodes:0:url]#comment-form\\r\\n\\r\\nChange email notifications at [site:url]user\\/[message:user:uid]\\/notification-settings",
           "format" : "plain_text",
-          "safe_value" : "\\u003Cp\\u003EHi [message:user:name],\\u003C\\/p\\u003E\\n\\u003Cp\\u003E[message:field-target-nodes:0:author] created the [message:field-target-nodes:0:content-type] \\u201c[message:field-target-nodes:0:title]\\u201d on [site:name] [commons-groups:in-groups-text] on [message:field-target-nodes:0:created]:\\u003C\\/p\\u003E\\n\\u003Cp\\u003E[message:field-target-nodes:0:body]\\u003C\\/p\\u003E\\n\\u003Cp\\u003EPermalink: [message:field-target-nodes:0:url]\\u003Cbr \\/\\u003E\\nAdd a comment at [message:field-target-nodes:0:url]#comment-form\\u003C\\/p\\u003E\\n\\u003Cp\\u003EChange email notifications at [site:url]user\\/[message:user:uid]\\/notification-settings\\u003C\\/p\\u003E\\n"
+          "safe_value" : "\\u003Cp\\u003EHi [message:user:name],\\u003C\\/p\\u003E\\n\\u003Cp\\u003E[message:field-target-nodes:0:author] created the [message:field-target-nodes:0:content-type] \\u201c[message:field-target-nodes:0:title_field]\\u201d on [site:name] [commons-groups:in-groups-text] on [message:field-target-nodes:0:created]:\\u003C\\/p\\u003E\\n\\u003Cp\\u003E[message:field-target-nodes:0:body]\\u003C\\/p\\u003E\\n\\u003Cp\\u003EPermalink: [message:field-target-nodes:0:url]\\u003Cbr \\/\\u003E\\nAdd a comment at [message:field-target-nodes:0:url]#comment-form\\u003C\\/p\\u003E\\n\\u003Cp\\u003EChange email notifications at [site:url]user\\/[message:user:uid]\\/notification-settings\\u003C\\/p\\u003E\\n"
         }
       ]
     },
@@ -77,14 +104,14 @@ function commons_notify_default_message_type() {
     "arguments" : null,
     "message_text" : { "und" : [
         {
-          "value" : "New [message:field-target-nodes:0:content-type] on [site:name]: [message:field-target-nodes:0:title]",
+          "value" : "New [message:field-target-nodes:0:content-type] on [site:name]: [message:field-target-nodes:0:title_field]",
           "format" : "plain_text",
-          "safe_value" : "\\u003Cp\\u003ENew [message:field-target-nodes:0:content-type] on [site:name]: [message:field-target-nodes:0:title]\\u003C\\/p\\u003E\\n"
+          "safe_value" : "\\u003Cp\\u003ENew [message:field-target-nodes:0:content-type] on [site:name]: [message:field-target-nodes:0:title_field]\\u003C\\/p\\u003E\\n"
         },
         {
-          "value" : "Hi [message:user:name],\\r\\n\\r\\n[message:field-target-nodes:0:author] created the [message:field-target-nodes:0:content-type] \\u201c[message:field-target-nodes:0:title]\\u201d on [site:name] [commons-groups:in-groups-text] on [message:field-target-nodes:0:created]:\\r\\n\\r\\n[message:field-target-nodes:0:body]\\r\\n\\r\\n\\r\\nPermalink: [message:field-target-nodes:0:url]\\r\\nAdd a comment at [message:field-target-nodes:0:url]#comment-form\\r\\n\\r\\nChange email notifications at [site:url]user\\/[message:user:uid]\\/notification-settings",
+          "value" : "Hi [message:user:name],\\r\\n\\r\\n[message:field-target-nodes:0:author] created the [message:field-target-nodes:0:content-type] \\u201c[message:field-target-nodes:0:title_field]\\u201d on [site:name] [commons-groups:in-groups-text] on [message:field-target-nodes:0:created]:\\r\\n\\r\\n[message:field-target-nodes:0:body]\\r\\n\\r\\n\\r\\nPermalink: [message:field-target-nodes:0:url]\\r\\nAdd a comment at [message:field-target-nodes:0:url]#comment-form\\r\\n\\r\\nChange email notifications at [site:url]user\\/[message:user:uid]\\/notification-settings",
           "format" : "plain_text",
-          "safe_value" : "\\u003Cp\\u003EHi [message:user:name],\\u003C\\/p\\u003E\\n\\u003Cp\\u003E[message:field-target-nodes:0:author] created the [message:field-target-nodes:0:content-type] \\u201c[message:field-target-nodes:0:title]\\u201d on [site:name] [commons-groups:in-groups-text] on [message:field-target-nodes:0:created]:\\u003C\\/p\\u003E\\n\\u003Cp\\u003E[message:field-target-nodes:0:body]\\u003C\\/p\\u003E\\n\\u003Cp\\u003EPermalink: [message:field-target-nodes:0:url]\\u003Cbr \\/\\u003E\\nAdd a comment at [message:field-target-nodes:0:url]#comment-form\\u003C\\/p\\u003E\\n\\u003Cp\\u003EChange email notifications at [site:url]user\\/[message:user:uid]\\/notification-settings\\u003C\\/p\\u003E\\n"
+          "safe_value" : "\\u003Cp\\u003EHi [message:user:name],\\u003C\\/p\\u003E\\n\\u003Cp\\u003E[message:field-target-nodes:0:author] created the [message:field-target-nodes:0:content-type] \\u201c[message:field-target-nodes:0:title_field]\\u201d on [site:name] [commons-groups:in-groups-text] on [message:field-target-nodes:0:created]:\\u003C\\/p\\u003E\\n\\u003Cp\\u003E[message:field-target-nodes:0:body]\\u003C\\/p\\u003E\\n\\u003Cp\\u003EPermalink: [message:field-target-nodes:0:url]\\u003Cbr \\/\\u003E\\nAdd a comment at [message:field-target-nodes:0:url]#comment-form\\u003C\\/p\\u003E\\n\\u003Cp\\u003EChange email notifications at [site:url]user\\/[message:user:uid]\\/notification-settings\\u003C\\/p\\u003E\\n"
         }
       ]
     },
diff --git a/modules/commons/commons_notify/commons_notify.info b/modules/commons/commons_notify/commons_notify.info
index 7900e88..1e5688a 100644
--- a/modules/commons/commons_notify/commons_notify.info
+++ b/modules/commons/commons_notify/commons_notify.info
@@ -1,7 +1,6 @@
 name = Commons Notify
 core = 7.x
 package = Commons - Building blocks
-project = commons_notify
 dependencies[] = commons_follow
 dependencies[] = ctools
 dependencies[] = entity
@@ -15,7 +14,6 @@ dependencies[] = number
 dependencies[] = options
 dependencies[] = strongarm
 dependencies[] = text
-datestamp = 1354747303
 features[ctools][] = strongarm:strongarm:1
 features[features_api][] = api:2
 features[field_base][] = field_message_rendered_body
@@ -25,20 +23,25 @@ features[field_instance][] = message-commons_notify_comment_created-field_messag
 features[field_instance][] = message-commons_notify_comment_created-field_message_rendered_subject
 features[field_instance][] = message-commons_notify_comment_created-field_target_comments
 features[field_instance][] = message-commons_notify_comment_created-field_target_nodes
+features[field_instance][] = message-commons_notify_comment_created_no_groups-field_message_rendered_body
+features[field_instance][] = message-commons_notify_comment_created_no_groups-field_message_rendered_subject
+features[field_instance][] = message-commons_notify_comment_created_no_groups-field_target_comments
+features[field_instance][] = message-commons_notify_comment_created_no_groups-field_target_nodes
 features[field_instance][] = message-commons_notify_node_created-field_message_rendered_body
 features[field_instance][] = message-commons_notify_node_created-field_message_rendered_subject
 features[field_instance][] = message-commons_notify_node_created-field_target_nodes
 features[field_instance][] = message-commons_notify_node_created_no_groups-field_message_rendered_body
 features[field_instance][] = message-commons_notify_node_created_no_groups-field_message_rendered_subject
-features[field_instance][] = message-commons_notify_node_created_no_groups-field_target_comments
 features[field_instance][] = message-commons_notify_node_created_no_groups-field_target_nodes
 features[field_instance][] = message_type-commons_notify-message_text
 features[field_instance][] = user-user-message_subscribe_email
 features[message_type][] = commons_notify_comment_created
+features[message_type][] = commons_notify_comment_created_no_groups
 features[message_type][] = commons_notify_node_created
 features[message_type][] = commons_notify_node_created_no_groups
 features[message_type_category][] = commons_notify
 features[variable][] = field_bundle_settings_message__commons_notify_comment_created
+features[variable][] = field_bundle_settings_message__commons_notify_comment_created_no_groups
 features[variable][] = field_bundle_settings_message__commons_notify_node_created
 features[variable][] = field_bundle_settings_message__commons_notify_node_created_no_groups
 features[variable][] = message_subscribe_default_notifiers
diff --git a/modules/commons/commons_notify/commons_notify.install b/modules/commons/commons_notify/commons_notify.install
index 0db44df..ba5b31a 100644
--- a/modules/commons/commons_notify/commons_notify.install
+++ b/modules/commons/commons_notify/commons_notify.install
@@ -23,3 +23,11 @@ function commons_notify_update_7303() {
   features_revert(array('commons_notify' => array('message_type')));
   return array();
 }
+
+/**
+ * Add message notify for comments that have no group.
+ */
+function commons_notify_update_7304() {
+  features_revert(array('commons_notify' => array('message_type')));
+  return array();
+}
diff --git a/modules/commons/commons_notify/commons_notify.module b/modules/commons/commons_notify/commons_notify.module
index 7be270c..2cfcc7d 100644
--- a/modules/commons/commons_notify/commons_notify.module
+++ b/modules/commons/commons_notify/commons_notify.module
@@ -12,14 +12,14 @@ include_once 'commons_notify.features.inc';
  * a shutdown function, because node access grants haven not been written
  * by the time hook_node_insert() is invoked. For more background,
  * see https://drupal.org/node/1918666.
- * 
+ *
  */
 function commons_notify_node_insert($node) {
   drupal_register_shutdown_function('commons_notify_send_message_on_shutdown', $node);
 }
 
 /**
- * Send a notification for newly created nodes. 
+ * Send a notification for newly created nodes.
  * This function is registered as a shutdown function
  * in commons_notify_node_insert.
  * Note that shutdown functions run after drupal_set_message() messages are
@@ -38,7 +38,6 @@ function commons_notify_send_message_on_shutdown($node) {
   // the realm to the user, since if no realms are provided then the message
   // is automatically assigned to the user passed in the function, or if no
   // user object is provided, then to the acting user.
-
   $message_type = 'commons_notify_node_created';
   // We need to clear the static loading cache so that the node body will be
   // ready in time for token replacement for the  message.
@@ -76,7 +75,7 @@ function commons_notify_comment_insert($comment) {
   $message_type = 'commons_notify_comment_created';
   $hook = 'comment_insert';
   if (!isset($node->og_group_ref[LANGUAGE_NONE][0]['target_id'])) {
-    $message_type = 'commons_notify_node_created_no_groups';
+    $message_type = 'commons_notify_comment_created_no_groups';
   }
   drupal_alter('commons_notify_message_selection', $message_type, $hook, $comment);
   $message = message_create($message_type, array('uid' => $account->uid, 'timestamp' => $comment->created));
@@ -102,65 +101,3 @@ function commons_notify_comment_insert($comment) {
   );
   message_subscribe_send_message('comment', $comment, $message, array('email' => $options));
 }
-
-/**
- * Implements hook_commons_utility_links().
- *
- * Add unread-invitations and unread-messages notifications to utility links.
- */
-function commons_notify_commons_utility_links_alter(&$links) {
-  global $user;
-
-  if (user_is_anonymous()) {
-    // Anonymous user.
-    return;
-  }
-
-  $new_links = array(
-    'name' => $links['name'],
-  );
-
-  $account = $user;
-
-  $unread_invitations = 0;
-  if (module_exists('commons_trusted_contacts')) {
-    $unread_invitations = count(commons_trusted_contacts_get_pending_invitations($account->uid));
-  }
-
-  $unread_messages = 0;
-  if (module_exists('privatemsg')) {
-    $unread_messages = privatemsg_unread_count($account);
-  }
-
-
-  if (empty($unread_invitations) && empty($unread_messages)) {
-    // Provide a default mailbox icon pointing to the private messages UI
-    // when there are no unread messages or invitations.
-    $new_links['no-unread-messages'] = array(
-      'href' => 'user/' . $user->uid . '/contacts',
-      'query' => array('qt-commons_trusted_contacts' => 'messages'),
-      'title' => t('No unread messages'),
-    );
-  }
-
-  if ($unread_invitations) {
-    $new_links['unread-invitations']= array(
-      'href' => 'user/' . $user->uid . '/contacts',
-      'query' => array('qt-commons_trusted_contacts' => 'invitations'),
-      'title' => format_plural($unread_invitations, '1 invitation', '@count invitations'),
-    );
-  }
-
-  if ($unread_messages) {
-    $new_links['unread-messages']= array(
-      'href' => 'user/' . $user->uid . '/contacts',
-      'query' => array('qt-commons_trusted_contacts' => 'messages'),
-      'title' => format_plural($unread_messages, '1 message', '@count messages'),
-    );
-  }
-
-  $new_links['logout'] = $links['logout'];
-  $new_links['settings'] = $links['settings'];
-
-  $links = $new_links;
-}
diff --git a/modules/commons/commons_notify/commons_notify.strongarm.inc b/modules/commons/commons_notify/commons_notify.strongarm.inc
index 7e4f9a6..7908a70 100644
--- a/modules/commons/commons_notify/commons_notify.strongarm.inc
+++ b/modules/commons/commons_notify/commons_notify.strongarm.inc
@@ -47,6 +47,40 @@ function commons_notify_strongarm() {
   $strongarm = new stdClass();
   $strongarm->disabled = FALSE; /* Edit this to true to make a default strongarm disabled initially */
   $strongarm->api_version = 1;
+  $strongarm->name = 'field_bundle_settings_message__commons_notify_comment_created_no_groups';
+  $strongarm->value = array(
+    'view_modes' => array(),
+    'extra_fields' => array(
+      'form' => array(),
+      'display' => array(
+        'message__message_text__0' => array(
+          'message_notify_email_subject' => array(
+            'visible' => TRUE,
+            'weight' => 0,
+          ),
+          'message_notify_email_body' => array(
+            'visible' => FALSE,
+            'weight' => 0,
+          ),
+        ),
+        'message__message_text__1' => array(
+          'message_notify_email_subject' => array(
+            'visible' => FALSE,
+            'weight' => 0,
+          ),
+          'message_notify_email_body' => array(
+            'visible' => TRUE,
+            'weight' => 0,
+          ),
+        ),
+      ),
+    ),
+  );
+  $export['field_bundle_settings_message__commons_notify_comment_created_no_groups'] = $strongarm;
+
+  $strongarm = new stdClass();
+  $strongarm->disabled = FALSE; /* Edit this to true to make a default strongarm disabled initially */
+  $strongarm->api_version = 1;
   $strongarm->name = 'field_bundle_settings_message__commons_notify_node_created';
   $strongarm->value = array(
     'view_modes' => array(),
diff --git a/modules/commons/commons_polls/commons_polls.info b/modules/commons/commons_polls/commons_polls.info
index 65aa041..c049736 100644
--- a/modules/commons/commons_polls/commons_polls.info
+++ b/modules/commons/commons_polls/commons_polls.info
@@ -2,7 +2,6 @@ name = Commons Polls
 description = Commons poll content type
 core = 7.x
 package = Commons - Content types
-project = commons_polls
 dependencies[] = commons_body
 dependencies[] = commons_topics
 dependencies[] = ctools
diff --git a/modules/commons/commons_polls/commons_polls.install b/modules/commons/commons_polls/commons_polls.install
index e3f1d7b..e196d60 100644
--- a/modules/commons/commons_polls/commons_polls.install
+++ b/modules/commons/commons_polls/commons_polls.install
@@ -32,3 +32,25 @@ function commons_polls_update_7002() {
   features_revert($revert);
   return array();
 }
+
+/**
+ * Display sticky content at top of lists.
+ */
+function commons_polls_update_7003() {
+  $revert = array(
+    'commons_polls' => array('views_view'),
+  );
+  features_revert($revert);
+  return array();
+}
+
+/**
+ * Add links to node teasers in the browsing widget.
+ */
+function commons_polls_update_7004() {
+  $revert = array(
+    'commons_polls' => array('views_view'),
+  );
+  features_revert($revert);
+  return array();
+}
diff --git a/modules/commons/commons_polls/commons_polls.module b/modules/commons/commons_polls/commons_polls.module
index 115fd00..bf5f98a 100644
--- a/modules/commons/commons_polls/commons_polls.module
+++ b/modules/commons/commons_polls/commons_polls.module
@@ -23,12 +23,13 @@ function commons_polls_commons_bw_group_widget() {
 }
 
 /**
- * Implements hook_commons_entity_integration.
+ * Implements hook_commons_entity_integration().
  */
 function commons_polls_commons_entity_integration() {
   return array(
     'node' => array(
       'poll' => array(
+        'media' => TRUE,
       ),
     ),
   );
@@ -89,7 +90,7 @@ function commons_polls_form_commons_bw_partial_node_form_alter(&$form, &$form_st
 
   // Prepare the form for collapsing.
   $form['body']['#attributes']['class'][] = 'trigger-field';
-  foreach (array('field_image', 'og_group_ref', 'choice_wrapper', 'actions') as $field) {
+  foreach (array('field_media', 'field_image', 'og_group_ref', 'choice_wrapper', 'actions') as $field) {
     if (isset($form[$field])) {
       $form[$field]['#attributes']['class'][] = 'hideable-field';
     }
diff --git a/modules/commons/commons_polls/commons_polls.views_default.inc b/modules/commons/commons_polls/commons_polls.views_default.inc
index 1bb05b4..ff5609c 100644
--- a/modules/commons/commons_polls/commons_polls.views_default.inc
+++ b/modules/commons/commons_polls/commons_polls.views_default.inc
@@ -36,7 +36,6 @@ function commons_polls_views_default_views() {
   $handler->display->display_options['pager']['options']['quantity'] = '9';
   $handler->display->display_options['style_plugin'] = 'default';
   $handler->display->display_options['row_plugin'] = 'node';
-  $handler->display->display_options['row_options']['links'] = FALSE;
   /* Header: Global: Node partial form */
   $handler->display->display_options['header']['commons_bw_node_partial_form']['id'] = 'commons_bw_node_partial_form';
   $handler->display->display_options['header']['commons_bw_node_partial_form']['table'] = 'views';
@@ -64,6 +63,7 @@ function commons_polls_views_default_views() {
   $handler->display->display_options['sorts']['sticky']['id'] = 'sticky';
   $handler->display->display_options['sorts']['sticky']['table'] = 'node';
   $handler->display->display_options['sorts']['sticky']['field'] = 'sticky';
+  $handler->display->display_options['sorts']['sticky']['order'] = 'DESC';
   /* Sort criterion: Content: Post date */
   $handler->display->display_options['sorts']['created']['id'] = 'created';
   $handler->display->display_options['sorts']['created']['table'] = 'node';
diff --git a/modules/commons/commons_posts/commons_posts.features.inc b/modules/commons/commons_posts/commons_posts.features.inc
index bf03f79..46180d3 100644
--- a/modules/commons/commons_posts/commons_posts.features.inc
+++ b/modules/commons/commons_posts/commons_posts.features.inc
@@ -41,13 +41,13 @@ function commons_posts_default_message_type() {
           "safe_value" : "[message:user:picture:35x35]"
         },
         {
-          "value" : "\\u003Ca href=\\u0022[message:user:url:absolute]\\u0022\\u003E[message:user:name]\\u003C\\/a\\u003E posted \\u003Ca href=\\u0022[message:field-target-nodes:0:url]\\u0022\\u003E[message:field-target-nodes:0:title]\\u003C\\/a\\u003E",
+          "value" : "\\u003Ca href=\\u0022[message:user:url:absolute]\\u0022\\u003E[message:user:name]\\u003C\\/a\\u003E posted \\u003Ca href=\\u0022[message:field-target-nodes:0:url]\\u0022\\u003E[message:field-target-nodes:0:title_field]\\u003C\\/a\\u003E",
           "format" : "full_html",
-          "safe_value" : "\\u003Ca href=\\u0022[message:user:url:absolute]\\u0022\\u003E[message:user:name]\\u003C\\/a\\u003E posted \\u003Ca href=\\u0022[message:field-target-nodes:0:url]\\u0022\\u003E[message:field-target-nodes:0:title]\\u003C\\/a\\u003E"
+          "safe_value" : "\\u003Ca href=\\u0022[message:user:url:absolute]\\u0022\\u003E[message:user:name]\\u003C\\/a\\u003E posted \\u003Ca href=\\u0022[message:field-target-nodes:0:url]\\u0022\\u003E[message:field-target-nodes:0:title_field]\\u003C\\/a\\u003E"
         },
         {
           "value" : "[commons-groups:in-groups-text]",
-          "format" : "full_html",
+          "format" : "filtered_html",
           "safe_value" : "[commons-groups:in-groups-text]"
         }
       ]
diff --git a/modules/commons/commons_posts/commons_posts.info b/modules/commons/commons_posts/commons_posts.info
index dddb5c1..2b84e7c 100644
--- a/modules/commons/commons_posts/commons_posts.info
+++ b/modules/commons/commons_posts/commons_posts.info
@@ -2,7 +2,6 @@ name = Commons Posts
 description = Commons Post content type
 core = 7.x
 package = Commons - Content types
-project = commons_posts
 dependencies[] = commons_body
 dependencies[] = commons_bw
 dependencies[] = commons_topics
diff --git a/modules/commons/commons_posts/commons_posts.install b/modules/commons/commons_posts/commons_posts.install
index 106f277..688c79f 100644
--- a/modules/commons/commons_posts/commons_posts.install
+++ b/modules/commons/commons_posts/commons_posts.install
@@ -43,3 +43,25 @@ function commons_posts_update_7003() {
   features_revert($revert);
   return array();
 }
+
+/**
+ * Display sticky content at top of lists.
+ */
+function commons_posts_update_7004() {
+  $revert = array(
+    'commons_posts' => array('views_view'),
+  );
+  features_revert($revert);
+  return array();
+}
+
+/**
+ * Add links to node teasers in the browsing widget.
+ */
+function commons_posts_update_7005() {
+  $revert = array(
+    'commons_posts' => array('views_view'),
+  );
+  features_revert($revert);
+  return array();
+}
diff --git a/modules/commons/commons_posts/commons_posts.module b/modules/commons/commons_posts/commons_posts.module
index b51edde..1d34611 100644
--- a/modules/commons/commons_posts/commons_posts.module
+++ b/modules/commons/commons_posts/commons_posts.module
@@ -57,7 +57,7 @@ function commons_posts_form_commons_bw_partial_node_form_alter(&$form, &$form_st
 
   // Set fields as hideable so the forms can be compacted.
   $form['body']['#attributes']['class'][] = 'trigger-field';
-  foreach (array('field_image', 'og_group_ref', 'choice_wrapper', 'actions') as $field) {
+  foreach (array('field_media', 'field_image', 'og_group_ref', 'choice_wrapper', 'actions') as $field) {
     if (isset($form[$field])) {
       $form[$field]['#attributes']['class'][] = 'hideable-field';
     }
@@ -92,12 +92,13 @@ function commons_posts_commons_activity_streams_message_selection_alter(&$messag
 }
 
 /**
- * Implements hook_commons_entity_integration.
+ * Implements hook_commons_entity_integration().
  */
 function commons_posts_commons_entity_integration() {
   return array(
     'node' => array(
       'post' => array(
+        'media' => TRUE,
       ),
     ),
   );
diff --git a/modules/commons/commons_posts/commons_posts.views_default.inc b/modules/commons/commons_posts/commons_posts.views_default.inc
index 06e98bb..fb7c0ea 100644
--- a/modules/commons/commons_posts/commons_posts.views_default.inc
+++ b/modules/commons/commons_posts/commons_posts.views_default.inc
@@ -36,7 +36,6 @@ function commons_posts_views_default_views() {
   $handler->display->display_options['pager']['options']['quantity'] = '9';
   $handler->display->display_options['style_plugin'] = 'default';
   $handler->display->display_options['row_plugin'] = 'node';
-  $handler->display->display_options['row_options']['links'] = FALSE;
   /* Header: Global: Node partial form */
   $handler->display->display_options['header']['commons_bw_node_partial_form']['id'] = 'commons_bw_node_partial_form';
   $handler->display->display_options['header']['commons_bw_node_partial_form']['table'] = 'views';
@@ -65,6 +64,7 @@ function commons_posts_views_default_views() {
   $handler->display->display_options['sorts']['sticky']['id'] = 'sticky';
   $handler->display->display_options['sorts']['sticky']['table'] = 'node';
   $handler->display->display_options['sorts']['sticky']['field'] = 'sticky';
+  $handler->display->display_options['sorts']['sticky']['order'] = 'DESC';
   /* Sort criterion: Content: Post date */
   $handler->display->display_options['sorts']['created']['id'] = 'created';
   $handler->display->display_options['sorts']['created']['table'] = 'node';
diff --git a/modules/commons/commons_profile_base/commons_profile_base.info b/modules/commons/commons_profile_base/commons_profile_base.info
index 2a654a1..2d42a37 100644
--- a/modules/commons/commons_profile_base/commons_profile_base.info
+++ b/modules/commons/commons_profile_base/commons_profile_base.info
@@ -2,11 +2,8 @@ name = Commons Profile Base
 description = Provides a base set of profile fields for user profiles.
 core = 7.x
 package = Commons - Building blocks
-php = 5.2.4
-project = commons_profile_base
 dependencies[] = features
 dependencies[] = strongarm
-datestamp = 1346372016
 features[ctools][] = strongarm:strongarm:1
 features[features_api][] = api:1
 features[field_base][] = field_bio
diff --git a/modules/commons/commons_profile_base/commons_profile_base.install b/modules/commons/commons_profile_base/commons_profile_base.install
new file mode 100644
index 0000000..fa0e2c8
--- /dev/null
+++ b/modules/commons/commons_profile_base/commons_profile_base.install
@@ -0,0 +1,12 @@
+<?php
+
+/**
+ * Revert strongarm varibles related to realname recursion error.
+ */
+function commons_profile_base_update_7000() {
+    $revert = array(
+      'commons_profile_base' => array('variable'),
+  );
+  features_revert($revert);
+  return array();
+}
\ No newline at end of file
diff --git a/modules/commons/commons_profile_base/commons_profile_base.strongarm.inc b/modules/commons/commons_profile_base/commons_profile_base.strongarm.inc
index 8475a47..5c24493 100644
--- a/modules/commons/commons_profile_base/commons_profile_base.strongarm.inc
+++ b/modules/commons/commons_profile_base/commons_profile_base.strongarm.inc
@@ -14,7 +14,7 @@ function commons_profile_base_strongarm() {
   $strongarm->disabled = FALSE; /* Edit this to true to make a default strongarm disabled initially */
   $strongarm->api_version = 1;
   $strongarm->name = 'realname_pattern';
-  $strongarm->value = '[user:field_name_first] [user:field_name_last]';
+  $strongarm->value = '[user:field-name-first] [user:field-name-last]';
   $export['realname_pattern'] = $strongarm;
 
   $strongarm = new stdClass();
diff --git a/modules/commons/commons_profile_social/commons_profile_social.info b/modules/commons/commons_profile_social/commons_profile_social.info
index 9558d3b..484a492 100644
--- a/modules/commons/commons_profile_social/commons_profile_social.info
+++ b/modules/commons/commons_profile_social/commons_profile_social.info
@@ -2,7 +2,6 @@ name = Commons Profile (Social fields)
 description = Provides a set of link fields to the user's profile for the user's Facebook, Linkedin and Twitter accounts.
 core = 7.x
 package = Commons - Building blocks
-project = commons_profile_social
 dependencies[] = features
 dependencies[] = field_sql_storage
 dependencies[] = link
diff --git a/modules/commons/commons_q_a/commons_q_a.features.inc b/modules/commons/commons_q_a/commons_q_a.features.inc
index 994358d..f230f42 100644
--- a/modules/commons/commons_q_a/commons_q_a.features.inc
+++ b/modules/commons/commons_q_a/commons_q_a.features.inc
@@ -44,9 +44,9 @@ function commons_q_a_default_message_type() {
           "safe_value" : "[message:user:picture:35x35]"
         },
         {
-          "value" : "\\u003Ca href=\\u0022[message:user:url:absolute]\\u0022\\u003E[message:user:name]\\u003C\\/a\\u003E answered the question \\u003Cem\\u003E[message:field-target-nodes:0:field-related-question:title]\\u003C\\/em\\u003E with \\u0022\\u003Ca href=\\u0022[message:field-target-nodes:0:field-related-question:url]#node-[message:field-target-nodes:0:nid]\\u0022\\u003E[message:field-target-nodes:0:title]\\u003C\\/a\\u003E\\u0022",
+          "value" : "\\u003Ca href=\\u0022[message:user:url:absolute]\\u0022\\u003E[message:user:name]\\u003C\\/a\\u003E answered the question \\u003Cem\\u003E[message:field-target-nodes:0:field-related-question:title]\\u003C\\/em\\u003E with \\u0022\\u003Ca href=\\u0022[message:field-target-nodes:0:field-related-question:url]#node-[message:field-target-nodes:0:nid]\\u0022\\u003E[message:field-target-nodes:0:title_field]\\u003C\\/a\\u003E\\u0022",
           "format" : "full_html",
-          "safe_value" : "\\u003Ca href=\\u0022[message:user:url:absolute]\\u0022\\u003E[message:user:name]\\u003C\\/a\\u003E answered the question \\u003Cem\\u003E[message:field-target-nodes:0:field-related-question:title]\\u003C\\/em\\u003E with \\u0022\\u003Ca href=\\u0022[message:field-target-nodes:0:field-related-question:url]#node-[message:field-target-nodes:0:nid]\\u0022\\u003E[message:field-target-nodes:0:title]\\u003C\\/a\\u003E\\u0022"
+          "safe_value" : "\\u003Ca href=\\u0022[message:user:url:absolute]\\u0022\\u003E[message:user:name]\\u003C\\/a\\u003E answered the question \\u003Cem\\u003E[message:field-target-nodes:0:field-related-question:title]\\u003C\\/em\\u003E with \\u0022\\u003Ca href=\\u0022[message:field-target-nodes:0:field-related-question:url]#node-[message:field-target-nodes:0:nid]\\u0022\\u003E[message:field-target-nodes:0:title_field]\\u003C\\/a\\u003E\\u0022"
         },
         {
           "value" : "[commons-groups:in-groups-text]",
@@ -73,9 +73,9 @@ function commons_q_a_default_message_type() {
           "safe_value" : "[message:user:picture:35x35]"
         },
         {
-          "value" : "\\u003Ca href=\\u0022[message:user:url:absolute]\\u0022\\u003E[message:user:name]\\u003C\\/a\\u003E asked the question \\u003Ca href=\\u0022[message:field-target-nodes:0:url]\\u0022\\u003E[message:field-target-nodes:0:title]\\u003C\\/a\\u003E",
+          "value" : "\\u003Ca href=\\u0022[message:user:url:absolute]\\u0022\\u003E[message:user:name]\\u003C\\/a\\u003E asked the question \\u003Ca href=\\u0022[message:field-target-nodes:0:url]\\u0022\\u003E[message:field-target-nodes:0:title_field]\\u003C\\/a\\u003E",
           "format" : "full_html",
-          "safe_value" : "\\u003Ca href=\\u0022[message:user:url:absolute]\\u0022\\u003E[message:user:name]\\u003C\\/a\\u003E asked the question \\u003Ca href=\\u0022[message:field-target-nodes:0:url]\\u0022\\u003E[message:field-target-nodes:0:title]\\u003C\\/a\\u003E"
+          "safe_value" : "\\u003Ca href=\\u0022[message:user:url:absolute]\\u0022\\u003E[message:user:name]\\u003C\\/a\\u003E asked the question \\u003Ca href=\\u0022[message:field-target-nodes:0:url]\\u0022\\u003E[message:field-target-nodes:0:title_field]\\u003C\\/a\\u003E"
         },
         {
           "value" : "[commons-groups:in-groups-text]",
diff --git a/modules/commons/commons_q_a/commons_q_a.info b/modules/commons/commons_q_a/commons_q_a.info
index 89653e0..6ffb85c 100644
--- a/modules/commons/commons_q_a/commons_q_a.info
+++ b/modules/commons/commons_q_a/commons_q_a.info
@@ -2,7 +2,6 @@ name = Commons Q&A
 description = Allows community members to ask questions and vote for the best answers
 core = 7.x
 package = Commons - Content types
-project = commons_q_a
 dependencies[] = commons_topics
 dependencies[] = ctools
 dependencies[] = entity
diff --git a/modules/commons/commons_q_a/commons_q_a.install b/modules/commons/commons_q_a/commons_q_a.install
index 7cbfea5..fc5fe6a 100644
--- a/modules/commons/commons_q_a/commons_q_a.install
+++ b/modules/commons/commons_q_a/commons_q_a.install
@@ -103,3 +103,14 @@ function commons_q_a_update_3108() {
   features_revert($revert);
   return array();
 }
+
+/**
+ * Display sticky content at top of lists.
+ */
+function commons_q_a_update_3109() {
+  $revert = array(
+    'commons_q_a' => array('views_view'),
+  );
+  features_revert($revert);
+  return array();
+}
diff --git a/modules/commons/commons_q_a/commons_q_a.module b/modules/commons/commons_q_a/commons_q_a.module
index 39067fa..d9a3783 100644
--- a/modules/commons/commons_q_a/commons_q_a.module
+++ b/modules/commons/commons_q_a/commons_q_a.module
@@ -75,7 +75,7 @@ function commons_q_a_form_commons_bw_partial_node_form_alter(&$form, &$form_stat
 
   // Set fields as hideable so the forms can be compacted.
   $form['body']['#attributes']['class'][] = 'trigger-field';
-  foreach (array('field_image', 'og_group_ref', 'choice_wrapper', 'actions') as $field) {
+  foreach (array('field_media', 'field_image', 'og_group_ref', 'choice_wrapper', 'actions') as $field) {
     if (isset($form[$field])) {
       $form[$field]['#attributes']['class'][] = 'hideable-field';
     }
@@ -245,12 +245,14 @@ function commons_q_a_commons_bw_create_all_widget($group) {
 }
 
 /**
- * Implements hook_commons_entity_integration.
+ * Implements hook_commons_entity_integration().
  */
 function commons_q_a_commons_entity_integration() {
   return array(
     'node' => array(
-      'question' => array(),
+      'question' => array(
+        'media' => TRUE,
+      ),
       'answer' => array(
         'exclude_topics' => TRUE,
         'exclude_rate' => TRUE,
diff --git a/modules/commons/commons_q_a/commons_q_a.views_default.inc b/modules/commons/commons_q_a/commons_q_a.views_default.inc
index 1a20238..23814a0 100644
--- a/modules/commons/commons_q_a/commons_q_a.views_default.inc
+++ b/modules/commons/commons_q_a/commons_q_a.views_default.inc
@@ -64,6 +64,7 @@ function commons_q_a_views_default_views() {
   $handler->display->display_options['sorts']['sticky']['id'] = 'sticky';
   $handler->display->display_options['sorts']['sticky']['table'] = 'node';
   $handler->display->display_options['sorts']['sticky']['field'] = 'sticky';
+  $handler->display->display_options['sorts']['sticky']['order'] = 'DESC';
   /* Sort criterion: Content: Post date */
   $handler->display->display_options['sorts']['created']['id'] = 'created';
   $handler->display->display_options['sorts']['created']['table'] = 'node';
diff --git a/modules/commons/commons_radioactivity/commons_radioactivity.info b/modules/commons/commons_radioactivity/commons_radioactivity.info
index 6e31f19..e3f4551 100644
--- a/modules/commons/commons_radioactivity/commons_radioactivity.info
+++ b/modules/commons/commons_radioactivity/commons_radioactivity.info
@@ -2,14 +2,12 @@ name = Commons Radioactivity
 description = Helps to identify interesting content by automatically determining a decaying radioactivity value for individual pieces of conte
 core = 7.x
 package = Commons - Building blocks
-project = commons_radioactivity
 dependencies[] = ctools
 dependencies[] = features
 dependencies[] = field_sql_storage
 dependencies[] = radioactivity
 dependencies[] = strongarm
 dependencies[] = views
-datestamp = 1359684043
 features[ctools][] = radioactivity:radioactivity_decay_profile:1
 features[ctools][] = strongarm:strongarm:1
 features[ctools][] = views:views_default:3.0
diff --git a/modules/commons/commons_radioactivity/commons_radioactivity.module b/modules/commons/commons_radioactivity/commons_radioactivity.module
index 720a40e..7a5cfe4 100644
--- a/modules/commons/commons_radioactivity/commons_radioactivity.module
+++ b/modules/commons/commons_radioactivity/commons_radioactivity.module
@@ -98,7 +98,7 @@ function commons_radioactivity_features_pipe_alter(&$pipe, $data, $export) {
 */
 function commons_radioactivity_get_radioactive_entity_types() {
   // Find all Commons Entity integrations.
-  $commons_entity_integrations = module_invoke_all('commons_entity_integration');
+  $commons_entity_integrations = commons_entity_integration_info();
   if (empty($commons_entity_integrations)) {
     return array();
   }
@@ -125,7 +125,7 @@ function commons_radioactivity_incident_node($node, $value) {
   $profile = radioactivity_get_field_profile('node', $node->type, 'field_radioactivity');
 
   // Return if radioactivity doesn't exist or hasn't been created for the node yet
-  if (!isset($node->field_radioactivity)) {
+  if (empty($node->field_radioactivity)) {
     return;
   }
   // Prevent groups from going negative in energy.
diff --git a/modules/commons/commons_radioactivity/commons_radioactivity_groups/commons_radioactivity_groups.info b/modules/commons/commons_radioactivity/commons_radioactivity_groups/commons_radioactivity_groups.info
index 7c9549f..54e8dd2 100644
--- a/modules/commons/commons_radioactivity/commons_radioactivity_groups/commons_radioactivity_groups.info
+++ b/modules/commons/commons_radioactivity/commons_radioactivity_groups/commons_radioactivity_groups.info
@@ -2,12 +2,10 @@ name = Commons Radioactivity Groups
 description = Views integration for Group radioactivity
 core = 7.x
 package = Commons - Building Blocks
-project = commons_radioactivity
 dependencies[] = commons_radioactivity
 dependencies[] = og
 dependencies[] = views_content
 dependencies[] = views_field_view
-datestamp = 1350676260
 features[ctools][] = views:views_default:3.0
 features[features_api][] = api:2
 features[views_view][] = commons_radioactivity_groups_active_in_group
diff --git a/modules/commons/commons_search/2018929-solr-overidden-3.patch b/modules/commons/commons_search/2018929-solr-overidden-3.patch
deleted file mode 100644
index 378c572..0000000
--- a/modules/commons/commons_search/2018929-solr-overidden-3.patch
+++ /dev/null
@@ -1,36 +0,0 @@
-diff --git a/modules/commons_search_solr/commons_search_solr.features.inc b/modules/commons_search_solr/commons_search_solr.features.inc
-index 3117ccf..f927dab 100644
---- a/modules/commons_search_solr/commons_search_solr.features.inc
-+++ b/modules/commons_search_solr/commons_search_solr.features.inc
-@@ -17,6 +17,10 @@ function commons_search_solr_ctools_plugin_api() {
-     return array("version" => "3");
-   }
-   list($module, $api) = func_get_args();
-+  if ($module == "facetapi" && $api == "facetapi_defaults") {
-+    return array("version" => "1");
-+  }
-+  list($module, $api) = func_get_args();
-   if ($module == "page_manager" && $api == "pages_default") {
-     return array("version" => "1");
-   }
-diff --git a/modules/commons_search_solr/commons_search_solr.info b/modules/commons_search_solr/commons_search_solr.info
-index c2c139a..8e29c77 100644
---- a/modules/commons_search_solr/commons_search_solr.info
-+++ b/modules/commons_search_solr/commons_search_solr.info
-@@ -1,6 +1,7 @@
- name = Commons Search Solr
- description = Site search using Apache Solr server.
- core = 7.x
-+php = 5.2.4
- package = Commons - Search
- dependencies[] = apachesolr
- dependencies[] = apachesolr_proximity
-@@ -18,7 +19,7 @@ features[ctools][] = facetapi:facetapi_defaults:1
- features[ctools][] = page_manager:pages_default:1
- features[ctools][] = pm_existing_pages:pm_existing_pages:1
- features[ctools][] = strongarm:strongarm:1
--features[features_api][] = api:1
-+features[features_api][] = api:2
- features[page_manager_existing_pages][] = solr_search
- features[page_manager_handlers][] = pm_existing_pages_solr_search_panel_context
- features[variable][] = apachesolr_search_default_search_page
diff --git a/modules/commons/commons_search/commons_search.info b/modules/commons/commons_search/commons_search.info
index fa4640a..a1789c7 100644
--- a/modules/commons/commons_search/commons_search.info
+++ b/modules/commons/commons_search/commons_search.info
@@ -2,7 +2,6 @@ name = Commons Search
 description = Provide the global search block.
 core = 7.x
 package = Commons - Search
-project = commons_search
 dependencies[] = ctools
 dependencies[] = custom_search
 dependencies[] = features
diff --git a/modules/commons/commons_search/modules/commons_search_core/commons_search_core.info b/modules/commons/commons_search/modules/commons_search_core/commons_search_core.info
index 08af5d8..e0fc12f 100644
--- a/modules/commons/commons_search/modules/commons_search_core/commons_search_core.info
+++ b/modules/commons/commons_search/modules/commons_search_core/commons_search_core.info
@@ -2,8 +2,6 @@ name = Commons Search Core
 description = Core search with facets.
 core = 7.x
 package = Commons - Search
-php = 5.2.4
-project = commons_search_core
 dependencies[] = commons_search
 dependencies[] = date_facets
 dependencies[] = facetapi
diff --git a/modules/commons/commons_search/modules/commons_search_solr/asd.diff b/modules/commons/commons_search/modules/commons_search_solr/asd.diff
deleted file mode 100644
index 3386377..0000000
--- a/modules/commons/commons_search/modules/commons_search_solr/asd.diff
+++ /dev/null
@@ -1,55 +0,0 @@
-diff --git a/modules/commons_search_solr/commons_search_solr.strongarm.inc b/modules/commons_search_solr/commons_search_solr.strongarm.inc
-index 60f2436..6162040 100644
---- a/modules/commons_search_solr/commons_search_solr.strongarm.inc
-+++ b/modules/commons_search_solr/commons_search_solr.strongarm.inc
-@@ -20,6 +20,16 @@ function commons_search_solr_strongarm() {
-   $strongarm = new stdClass();
-   $strongarm->disabled = FALSE; /* Edit this to true to make a default strongarm disabled initially */
-   $strongarm->api_version = 1;
-+  $strongarm->name = 'custom_search_other';
-+  $strongarm->value = array(
-+    'apachesolr_search' => 'apachesolr_search',
-+    'user' => 'user',
-+  );
-+  $export['custom_search_other'] = $strongarm;
-+
-+  $strongarm = new stdClass();
-+  $strongarm->disabled = FALSE; /* Edit this to true to make a default strongarm disabled initially */
-+  $strongarm->api_version = 1;
-   $strongarm->name = 'page_manager_search_disabled_apachesolr_search';
-   $strongarm->value = TRUE;
-   $export['page_manager_search_disabled_apachesolr_search'] = $strongarm;
-@@ -30,7 +40,7 @@ function commons_search_solr_strongarm() {
-   $strongarm->name = 'pm_existing_pages_disabled_solr_search';
-   $strongarm->value = FALSE;
-   $export['pm_existing_pages_disabled_solr_search'] = $strongarm;
--  
-+
-   $strongarm = new stdClass();
-   $strongarm->disabled = FALSE; /* Edit this to true to make a default strongarm disabled initially */
-   $strongarm->api_version = 1;
-@@ -40,23 +50,13 @@ function commons_search_solr_strongarm() {
-     'user' => 'user',
-   );
-   $export['search_active_modules'] = $strongarm;
--  
-+
-   $strongarm = new stdClass();
-   $strongarm->disabled = FALSE; /* Edit this to true to make a default strongarm disabled initially */
-   $strongarm->api_version = 1;
-   $strongarm->name = 'search_default_module';
-   $strongarm->value = 'apachesolr_search';
-   $export['search_default_module'] = $strongarm;
--  
--  $strongarm = new stdClass();
--  $strongarm->disabled = FALSE; /* Edit this to true to make a default strongarm disabled initially */
--  $strongarm->api_version = 1;
--  $strongarm->name = 'custom_search_other';
--  $strongarm->value = array(
--    'apachesolr_search' => 'apachesolr_search',
--    'user' => 'user',
--  );
--  $export['custom_search_other'] = $strongarm;
- 
-   return $export;
- }
diff --git a/modules/commons/commons_search/modules/commons_search_solr_user/commons_search_solr_user.info b/modules/commons/commons_search/modules/commons_search_solr_user/commons_search_solr_user.info
index 28707fd..b5c8055 100644
--- a/modules/commons/commons_search/modules/commons_search_solr_user/commons_search_solr_user.info
+++ b/modules/commons/commons_search/modules/commons_search_solr_user/commons_search_solr_user.info
@@ -2,8 +2,6 @@ name = Commons Search Solr User
 description = Provides user entity indexing capabilities to Apache Solr, and search functionality
 core = 7.x
 package = Commons - Search
-php = 5.2.4
-project = commons_search_solr_user
 dependencies[] = apachesolr_search
 dependencies[] = apachesolr_user
 dependencies[] = commons_search_solr
diff --git a/modules/commons/commons_site_homepage/commons_site_homepage.info b/modules/commons/commons_site_homepage/commons_site_homepage.info
index 00f2e56..60f9e39 100644
--- a/modules/commons/commons_site_homepage/commons_site_homepage.info
+++ b/modules/commons/commons_site_homepage/commons_site_homepage.info
@@ -2,9 +2,7 @@ name = Commons Site Homepage
 description = Provides a homepage for the site for anonymous and authenticated users
 core = 7.x
 package = Commons - Landing pages
-project = commons_site_homepage
 dependencies[] = commons_activity_streams
-dependencies[] = commons_events
 dependencies[] = commons_featured
 dependencies[] = commons_follow
 dependencies[] = commons_radioactivity_groups
@@ -13,7 +11,6 @@ dependencies[] = page_manager
 dependencies[] = strongarm
 dependencies[] = views
 dependencies[] = views_litepager
-datestamp = 1354747296
 features[ctools][] = page_manager:pages_default:1
 features[ctools][] = strongarm:strongarm:1
 features[ctools][] = views:views_default:3.0
diff --git a/modules/commons/commons_site_homepage/commons_site_homepage.module b/modules/commons/commons_site_homepage/commons_site_homepage.module
index af39500..4b6c52c 100644
--- a/modules/commons/commons_site_homepage/commons_site_homepage.module
+++ b/modules/commons/commons_site_homepage/commons_site_homepage.module
@@ -69,5 +69,40 @@ function commons_site_homepage_default_page_manager_pages_alter(&$items) {
   if (isset($items['commons_home'])) {
     $items['commons_home']->default_handlers['page_commons_home_panel_context_2']->conf['display']->content['new-2ab570f0-8498-44f4-e9d0-9977e3d8d4df']->configuration['title'] = variable_get('commons_anonymous_welcome_title', t('The open-source alternative for enterprise-scale business software'));
     $items['commons_home']->default_handlers['page_commons_home_panel_context_2']->conf['display']->content['new-2ab570f0-8498-44f4-e9d0-9977e3d8d4df']->configuration['body'] = variable_get('commons_anonymous_welcome_body', t('Enable social networking to create productive interactions. Whether your community is public or private, Commons does it!'));
+
+    $pane = new stdClass();
+    $pane->pid = 'new-94106ddd-1278-0954-c5ba-b59ff1b9bf49';
+    $pane->panel = 'three_33_first';
+    $pane->type = 'views';
+    $pane->subtype = 'commons_events_upcoming';
+    $pane->shown = TRUE;
+    $pane->access = array();
+    $pane->configuration = array(
+      'override_pager_settings' => 0,
+      'use_pager' => 0,
+      'nodes_per_page' => '5',
+      'pager_id' => '0',
+      'offset' => '0',
+      'more_link' => 0,
+      'feed_icons' => 0,
+      'panel_args' => 0,
+      'link_to_view' => 0,
+      'args' => '',
+      'url' => '',
+      'display' => 'commons_events_upcoming_global_block',
+      'override_title' => 0,
+      'override_title_text' => '',
+    );
+    $pane->cache = array();
+    $pane->style = array(
+      'settings' => NULL,
+    );
+    $pane->css = array();
+    $pane->extras = array();
+    $pane->position = 1;
+    $pane->locks = array();
+    $pane->uuid = '94106ddd-1278-0954-c5ba-b59ff1b9bf49';
+    $items['commons_home']->default_handlers['page_commons_home_panel_context_2']->conf['display']->content['new-94106ddd-1278-0954-c5ba-b59ff1b9bf49'] = $pane;
+    $items['commons_home']->default_handlers['page_commons_home_panel_context_2']->conf['display']->panels['three_33_first'][1] = 'new-94106ddd-1278-0954-c5ba-b59ff1b9bf49';
   }
 }
diff --git a/modules/commons/commons_site_homepage/commons_site_homepage.pages_default.inc b/modules/commons/commons_site_homepage/commons_site_homepage.pages_default.inc
index 9e5b3f2..213f998 100644
--- a/modules/commons/commons_site_homepage/commons_site_homepage.pages_default.inc
+++ b/modules/commons/commons_site_homepage/commons_site_homepage.pages_default.inc
@@ -242,40 +242,6 @@ function commons_site_homepage_default_page_manager_pages() {
     $display->content['new-0ae8e5a2-44f6-8584-21f2-8be6e340e62f'] = $pane;
     $display->panels['three_33_first'][0] = 'new-0ae8e5a2-44f6-8584-21f2-8be6e340e62f';
     $pane = new stdClass();
-    $pane->pid = 'new-94106ddd-1278-0954-c5ba-b59ff1b9bf49';
-    $pane->panel = 'three_33_first';
-    $pane->type = 'views';
-    $pane->subtype = 'commons_events_upcoming';
-    $pane->shown = TRUE;
-    $pane->access = array();
-    $pane->configuration = array(
-      'override_pager_settings' => 0,
-      'use_pager' => 0,
-      'nodes_per_page' => '5',
-      'pager_id' => '0',
-      'offset' => '0',
-      'more_link' => 0,
-      'feed_icons' => 0,
-      'panel_args' => 0,
-      'link_to_view' => 0,
-      'args' => '',
-      'url' => '',
-      'display' => 'commons_events_upcoming_global_block',
-      'override_title' => 0,
-      'override_title_text' => '',
-    );
-    $pane->cache = array();
-    $pane->style = array(
-      'settings' => NULL,
-    );
-    $pane->css = array();
-    $pane->extras = array();
-    $pane->position = 1;
-    $pane->locks = array();
-    $pane->uuid = '94106ddd-1278-0954-c5ba-b59ff1b9bf49';
-    $display->content['new-94106ddd-1278-0954-c5ba-b59ff1b9bf49'] = $pane;
-    $display->panels['three_33_first'][1] = 'new-94106ddd-1278-0954-c5ba-b59ff1b9bf49';
-    $pane = new stdClass();
     $pane->pid = 'new-b6e290b7-1d2b-5db4-a181-28befdcde628';
     $pane->panel = 'three_33_second';
     $pane->type = 'views_panes';
diff --git a/modules/commons/commons_social_sharing/commons_social_sharing.info b/modules/commons/commons_social_sharing/commons_social_sharing.info
index 5c73212..a16a207 100644
--- a/modules/commons/commons_social_sharing/commons_social_sharing.info
+++ b/modules/commons/commons_social_sharing/commons_social_sharing.info
@@ -2,7 +2,6 @@ name = Commons Social Sharing
 description = Provide links to share content to external social services such as Facebook and Google+
 core = 7.x
 package = Commons - Building blocks
-project = commons_social_sharing
 dependencies[] = ctools
 dependencies[] = sharethis
 dependencies[] = strongarm
diff --git a/modules/commons/commons_social_sharing/commons_social_sharing.module b/modules/commons/commons_social_sharing/commons_social_sharing.module
index db2ac2f..2a0bc9e 100644
--- a/modules/commons/commons_social_sharing/commons_social_sharing.module
+++ b/modules/commons/commons_social_sharing/commons_social_sharing.module
@@ -26,7 +26,7 @@ function commons_social_sharing_features_export_alter(&$export, $module_name) {
   if (!empty($items['rate_widgets']->value)) {
     foreach($items['rate_widgets']->value as $key => $widget) {
       if ($widget->name == 'commons_social_sharing') {
-        $commons_entity_integrations = module_invoke_all('commons_entity_integration');
+        $commons_entity_integrations = commons_entity_integration_info();
         if (!empty($commons_entity_integrations['node'])) {
           foreach ($commons_entity_integrations['node'] as $bundle => $options) {
             if (!isset($options['exclude_rate']) || $options['exclude_rate'] != TRUE) {
diff --git a/modules/commons/commons_topics/commons_topics.info b/modules/commons/commons_topics/commons_topics.info
index 337ca69..7546f1a 100644
--- a/modules/commons/commons_topics/commons_topics.info
+++ b/modules/commons/commons_topics/commons_topics.info
@@ -1,10 +1,8 @@
 name = Commons Topics
 core = 7.x
 package = Commons - Building blocks
-project = commons_topics
 dependencies[] = features
 dependencies[] = taxonomy
-datestamp = 1359684035
 features[features_api][] = api:2
 features[field_base][] = field_topics
 features[taxonomy][] = topics
diff --git a/modules/commons/commons_topics/commons_topics.module b/modules/commons/commons_topics/commons_topics.module
index 0b43123..b4dc6dd 100644
--- a/modules/commons/commons_topics/commons_topics.module
+++ b/modules/commons/commons_topics/commons_topics.module
@@ -51,7 +51,7 @@ function commons_topics_form_node_form_alter(&$form, &$form_state) {
  */
 function commons_topics_get_entity_types_with_topics() {
   // Find all Commons Entity integrations.
-  $commons_entity_integrations = module_invoke_all('commons_entity_integration');
+  $commons_entity_integrations = commons_entity_integration_info();
   if (empty($commons_entity_integrations)) {
     return array();
   }
diff --git a/modules/commons/commons_topics/js/commons_topics.js b/modules/commons/commons_topics/js/commons_topics.js
index 231a94a..8d7c175 100644
--- a/modules/commons/commons_topics/js/commons_topics.js
+++ b/modules/commons/commons_topics/js/commons_topics.js
@@ -3,7 +3,7 @@
     attach: function (context, settings) {
       $(':input[name^="field_topics"]').change(function() {
         if ($(':input[name^="field_topics"]').val() == "") {
-          $("[id^='edit-topics-wrapper'] .summary").text("No topics");
+          $("[id^='edit-topics-wrapper'] .summary").text(Drupal.t("No topics"));
         }
         else {
           $("[id^='edit-topics-wrapper'] .summary").text($(':input[name^="field_topics"]').val());
diff --git a/modules/commons/commons_trusted_contacts/commons_trusted_contacts.commons_utility_links.inc b/modules/commons/commons_trusted_contacts/commons_trusted_contacts.commons_utility_links.inc
new file mode 100644
index 0000000..3ffe7ea
--- /dev/null
+++ b/modules/commons/commons_trusted_contacts/commons_trusted_contacts.commons_utility_links.inc
@@ -0,0 +1,57 @@
+<?php
+
+/**
+ * @file
+ * Commons Utility Links hooks implemented by the Commons Trusted Contacts module.
+ */
+
+/**
+ * Implements hook_commons_utility_links().
+ */
+function commons_trusted_contacts_commons_utility_links() {
+  $links = array();
+
+  if (user_is_logged_in()) {
+    global $user;
+    $account = $user;
+
+    // Check for unread invitations.
+    $unread_invitations = count(commons_trusted_contacts_get_pending_invitations($account->uid));
+
+    // Check for unread messages.
+    $unread_messages = privatemsg_unread_count($account);
+
+    // Provide a default mailbox icon pointing to the private messages UI when
+    // there are no unread messages or invitations.
+    if (empty($unread_invitations) && empty($unread_messages)) {
+      $links['no-unread-messages'] = array(
+        'href' => 'user/' . $user->uid . '/contacts',
+        'query' => array('qt-commons_trusted_contacts' => 'messages'),
+        'title' => t('No unread messages'),
+        'weight' => -9,
+      );
+    }
+
+    // Add a link to the user's invitations.
+    if ($unread_invitations) {
+      $links['unread-invitations']= array(
+        'href' => 'user/' . $user->uid . '/contacts',
+        'query' => array('qt-commons_trusted_contacts' => 'invitations'),
+        'title' => format_plural($unread_invitations, '1 invitation', '@count invitations'),
+        'weight' => -8,
+      );
+    }
+
+    // Add a link to the user's unread messages.
+    if ($unread_messages) {
+      $links['unread-messages']= array(
+        'href' => 'user/' . $user->uid . '/contacts',
+        'query' => array('qt-commons_trusted_contacts' => 'messages'),
+        'title' => format_plural($unread_messages, '1 message', '@count messages'),
+        'weight' => -7,
+      );
+    }
+  }
+
+  return $links;
+}
diff --git a/modules/commons/commons_trusted_contacts/commons_trusted_contacts.features.field_base.inc b/modules/commons/commons_trusted_contacts/commons_trusted_contacts.features.field_base.inc
index 559e7bd..3edeb77 100644
--- a/modules/commons/commons_trusted_contacts/commons_trusted_contacts.features.field_base.inc
+++ b/modules/commons/commons_trusted_contacts/commons_trusted_contacts.features.field_base.inc
@@ -319,6 +319,9 @@ function commons_trusted_contacts_field_default_field_bases() {
           ),
         ),
         'membership_type' => 'trusted_contacts',
+        'sort' => array(
+          'type' => 'none',
+        ),
         'target_bundles' => array(),
       ),
       'handler_submit' => 'Change handler',
diff --git a/modules/commons/commons_trusted_contacts/commons_trusted_contacts.features.field_instance.inc b/modules/commons/commons_trusted_contacts/commons_trusted_contacts.features.field_instance.inc
index 25a7342..f5be65e 100644
--- a/modules/commons/commons_trusted_contacts/commons_trusted_contacts.features.field_instance.inc
+++ b/modules/commons/commons_trusted_contacts/commons_trusted_contacts.features.field_instance.inc
@@ -350,7 +350,7 @@ function commons_trusted_contacts_field_default_field_instances() {
             'widget_type' => 'entityreference_autocomplete',
           ),
           'default' => array(
-            'widget_type' => 'options_select',
+            'widget_type' => 'entityreference_autocomplete',
           ),
           'status' => TRUE,
         ),
diff --git a/modules/commons/commons_trusted_contacts/commons_trusted_contacts.info b/modules/commons/commons_trusted_contacts/commons_trusted_contacts.info
index ca4ab89..4c658b6 100644
--- a/modules/commons/commons_trusted_contacts/commons_trusted_contacts.info
+++ b/modules/commons/commons_trusted_contacts/commons_trusted_contacts.info
@@ -2,8 +2,6 @@ name = Commons Trusted Contacts
 description = Commons Trusted Contacts Functionality
 core = 7.x
 package = Commons - Building blocks
-version = 7.x-3.0
-project = commons_trusted_contacts
 dependencies[] = commons_groups
 dependencies[] = ctools
 dependencies[] = date
diff --git a/modules/commons/commons_trusted_contacts/commons_trusted_contacts.install b/modules/commons/commons_trusted_contacts/commons_trusted_contacts.install
index da23dfd..433d419 100644
--- a/modules/commons/commons_trusted_contacts/commons_trusted_contacts.install
+++ b/modules/commons/commons_trusted_contacts/commons_trusted_contacts.install
@@ -10,16 +10,24 @@ function commons_trusted_contacts_requirements($phase) {
 
   if ($phase == 'runtime') {
 
-    // Check if there are users needed to be set as group.
+    // Count the current number of users.
     $query = new EntityFieldQuery;
-    $count = $query->entityCondition('entity_type', 'user')
+    $user_count = $query->entityCondition('entity_type', 'user')
       // Ignore the anonymous user.
       ->propertyCondition('uid', 0, '<>')
       ->count()
       ->execute();
 
+    // Count the current number of user groups.
+    $query = new EntityFieldQuery();
+    $group_count = $query
+      ->entityCondition('entity_type', 'user')
+      ->fieldCondition(OG_GROUP_FIELD, 'value', 1, '=')
+      ->count()
+      ->execute();
+
     // Check if there are more users than "group" users.
-    if ($count > count(og_get_all_group('user'))) {
+    if ($user_count > $group_count) {
       $requirements['commons_trusted_contacts_users_updated']['title'] = t('Trusted contacts');
       $requirements['commons_trusted_contacts_users_updated']['severity'] = REQUIREMENT_ERROR;
       $requirements['commons_trusted_contacts_users_updated']['description'] = t('Some users need an update. !link.', array('!link' => l(t('Upgrade users'), 'admin/people/trusted-contacts-upgrade')));
@@ -49,3 +57,15 @@ function commons_trusted_contacts_update_3100() {
   features_revert($revert);
   return array();
 }
+
+/**
+ * Change the background options widget to use autocomplete instead
+ * See https://drupal.org/node/2151637 for more info
+ */
+function commons_trusted_contacts_update_3101() {
+  $revert = array(
+    'commons_trusted_contacts' => array('field_instance', 'field_base'),
+  );
+  features_revert($revert);
+  return array();
+}
\ No newline at end of file
diff --git a/modules/commons/commons_trusted_contacts/commons_trusted_contacts.module b/modules/commons/commons_trusted_contacts/commons_trusted_contacts.module
index e2afe4e..c9ea858 100644
--- a/modules/commons/commons_trusted_contacts/commons_trusted_contacts.module
+++ b/modules/commons/commons_trusted_contacts/commons_trusted_contacts.module
@@ -25,7 +25,7 @@ function commons_trusted_contacts_system_info_alter(&$info, $file, $type) {
  *
  */
 function commons_trusted_contacts_user_presave(&$edit, $account, $category) {
-  // Ensure that a value is always set for the user's group_access field, 
+  // Ensure that a value is always set for the user's group_access field,
   // so that the user remains public while content shared with the user's
   // trusted contacts group is private. If the value of $user->group_access
   // is not set, og_access.module will throw an exception in
@@ -187,6 +187,11 @@ function commons_trusted_contacts_module_implements_alter(&$implementations, $ho
     unset($implementations['commons_trusted_contacts']);
     $implementations['commons_trusted_contacts'] = $group;
   }
+  if ($hook == 'node_presave') {
+    $group = $implementations['commons_trusted_contacts'];
+    unset($implementations['commons_trusted_contacts']);
+    $implementations['commons_trusted_contacts'] = $group;
+  }
 }
 
 /**
@@ -213,13 +218,6 @@ function commons_trusted_contacts_form_alter(&$form, &$form_state, $form_id) {
       $form['select']['#access'] = FALSE;
     }
   }
-  // Hide internal fields that the user should not be able to edit directly.
-  if ($form_id == 'edit_profile_user_profile_form' || substr($form_id, -10) === '_node_form') {
-    $internal_fields = array('field_unread_invitations', 'field_unread_messages', 'user_trusted_contacts', 'og_user_group_ref');
-    foreach ($internal_fields as $field_name) {
-      $form[$field_name]['#access'] = FALSE;
-    }
-  }
   if ($form_id == 'privatemsg_list') {
     // Load privatemsg.pages.inc and ensure it is automatically reloaded if
     // this form is rebuilt via AJAX or other means.
@@ -702,9 +700,9 @@ function commons_trusted_contacts_approve_trust(OgMembership $og_membership) {
   // Notify.
 
   // Get approving user.
-  $account = user_load($og_membership->etid);
+  $account = user_load($og_membership->gid);
 
-  $message = message_create('trusted_contact_request_approved', array('uid' => $account->uid));
+  $message = message_create('trusted_contact_request_approved', array('uid' => $og_membership->etid));
 
   $wrapper = entity_metadata_wrapper('message', $message);
   $wrapper->field_approving_user->set($account);
@@ -900,7 +898,7 @@ function commons_trusted_contacts_form_add_privacy_toggle(&$form, &$form_state)
     '#default_value' => empty($form[OG_AUDIENCE_FIELD][LANGUAGE_NONE][0]['default']['#default_value']) ? 'private' : 'custom',
     '#options' => array(
       'custom' => t('Post to specific groups'),
-      'private' => t('Post to contacts (private)'),
+      'private' => t('Post privately to all trusted contacts'),
     ),
     '#weight' => 70,
     '#attributes' => array(
@@ -945,9 +943,6 @@ function commons_trusted_contacts_form_node_form_alter(&$form, &$form_state) {
   if (empty($form[OG_AUDIENCE_FIELD])) {
     $form['group_audience_type']['#options']['custom'] = t('Post site-wide');
   }
-  else {
-    $form['#validate'][] = 'commons_trusted_contacts_partial_node_form_validate';
-  }
 }
 
 /**
@@ -956,7 +951,7 @@ function commons_trusted_contacts_form_node_form_alter(&$form, &$form_state) {
  */
 function commons_trusted_contacts_partial_node_form_validate($form, $form_state) {
   if ($form_state['values']['group_audience_type'] == 'custom' && empty($form_state['values'][OG_AUDIENCE_FIELD][LANGUAGE_NONE][0])) {
-    form_set_error(OG_AUDIENCE_FIELD, t('No groups were selected.'));
+    form_set_error(OG_AUDIENCE_FIELD, t('Please enter one more groups where this content will be posted.'));
     return FALSE;
   }
 }
@@ -995,7 +990,7 @@ function commons_trusted_contacts_node_presave($node) {
     $wrapper->{OG_AUDIENCE_FIELD}->set(array());
   }
   // The content is submitted to specific groups.
-  else {
+  else if (!empty($node->{OG_AUDIENCE_FIELD}[LANGUAGE_NONE])) {
     // Extract group IDs from selection.
     $group_ids = array();
     foreach ($node->{OG_AUDIENCE_FIELD}[LANGUAGE_NONE] as $group) {
@@ -1100,7 +1095,7 @@ function commons_trusted_contacts_messages_popup($form, &$form_state, $account)
 }
 
 /**
- * Helper function to get all of the pending invitations for a given 
+ * Helper function to get all of the pending invitations for a given
  * recipient user. Returns an array of OG memberships.
  */
 function commons_trusted_contacts_get_pending_invitations($uid) {
diff --git a/modules/commons/commons_user_profile_pages/commons_user_profile_pages.info b/modules/commons/commons_user_profile_pages/commons_user_profile_pages.info
index 4e474cd..e6b9782 100644
--- a/modules/commons/commons_user_profile_pages/commons_user_profile_pages.info
+++ b/modules/commons/commons_user_profile_pages/commons_user_profile_pages.info
@@ -2,9 +2,7 @@ name = Commons User Profile Pages
 description = Exports a default user profile page, powered by the Panels module.
 core = 7.x
 package = Commons - Landing pages
-project = commons_user_profile_pages
 dependencies[] = commons_activity_streams
-dependencies[] = commons_events
 dependencies[] = commons_follow
 dependencies[] = commons_profile_base
 dependencies[] = commons_profile_social
diff --git a/modules/commons/commons_utility_links/commons_utility_links.api.php b/modules/commons/commons_utility_links/commons_utility_links.api.php
new file mode 100644
index 0000000..ac904e8
--- /dev/null
+++ b/modules/commons/commons_utility_links/commons_utility_links.api.php
@@ -0,0 +1,68 @@
+<?php
+
+/**
+ * @file
+ * Hooks provided by the Commons Utility Links module.
+ */
+
+/**
+ * @addtogroup hooks
+ * @{
+ */
+
+/**
+ * Define utility links.
+ *
+ * This hook allows modules to register utility links for the functionality that
+ * they provide. For example, a social integration module could use it to
+ * register a "Find Friends" utility link which points to a page where the
+ * current user can search for other site users that they have connected with on
+ * social networks such as Twitter or Facebook.
+ *
+ * @return
+ *   An associative array of utility links whose keys are used as its CSS class.
+ *   Each link should be itself an array, with the same elements used in
+ *   theme_links(), except for the addition of a 'weight' element that is used
+ *   for ordering the links.
+ *
+ * For a detailed usage example, see commons_utility_links.module.
+ *
+ * @see theme_links()
+ * @see hook_commons_utility_links_alter()
+ */
+function hook_commons_utility_links() {
+  $links = array();
+
+  if (user_is_logged_in()) {
+    global $user;
+    $account = $user;
+    $links['find_fiends']= array(
+      'href' => 'user/' . $account->uid . '/find_friends',
+      'title' => t('Find friends'),
+    );
+  }
+
+  return $links;
+}
+
+/**
+ * Perform alterations on utility links.
+ *
+ * @param $links
+ *   An associative array of utility links whose keys are used as its CSS class.
+ *   Each link should be itself an array, with the same elements used in
+ *   theme_links(), except for the addition of a 'weight' element that is used
+ *   for ordering the links.
+ *
+ * @see theme_links()
+ * @see hook_commons_utility_links()
+ */
+function hook_commons_utility_links_alter(&$links) {
+  // Change the title of the user account link from the user's name to
+  // 'Account'.
+  $links['name']['title'] = t('Account');
+}
+
+/**
+ * @} End of "addtogroup hooks".
+ */
diff --git a/modules/commons/commons_utility_links/commons_utility_links.commons_utility_links.inc b/modules/commons/commons_utility_links/commons_utility_links.commons_utility_links.inc
new file mode 100644
index 0000000..abe465c
--- /dev/null
+++ b/modules/commons/commons_utility_links/commons_utility_links.commons_utility_links.inc
@@ -0,0 +1,42 @@
+<?php
+
+/**
+ * @file
+ * Commons Utility Links hooks implemented by the Commons Utility Links module.
+ */
+
+/**
+ * Implements hook_commons_utility_links().
+ */
+function commons_utility_links_commons_utility_links() {
+  if (user_is_logged_in()) {
+    global $user;
+    $account = $user;
+    $links['name'] = array(
+      'href' => 'user',
+      'title' => format_username($account),
+      'weight' => -10,
+    );
+    $links['logout'] = array(
+      'href' => 'user/logout',
+      'title' => t('Logout'),
+      'weight' => 9,
+    );
+  }
+  else {
+    if (variable_get('user_register', USER_REGISTER_VISITORS_ADMINISTRATIVE_APPROVAL)) {
+      $links['signup'] = array(
+        'href' => 'user/register',
+        'title' => t('Signup'),
+        'weight' => -10,
+      );
+    }
+    $links['login'] = array(
+      'href' => 'user/login',
+      'title' => t('Login'),
+      'weight' => -9,
+    );
+  }
+
+  return $links;
+}
diff --git a/modules/commons/commons_utility_links/commons_utility_links.module b/modules/commons/commons_utility_links/commons_utility_links.module
index f647c97..e8c2f5c 100644
--- a/modules/commons/commons_utility_links/commons_utility_links.module
+++ b/modules/commons/commons_utility_links/commons_utility_links.module
@@ -1,6 +1,18 @@
 <?php
 
 /**
+ * Implements hook_hook_info().
+ */
+function commons_utility_links_hook_info() {
+  $hooks = array(
+    'commons_utility_links',
+    'commons_utility_links_alter',
+  );
+
+  return array_fill_keys($hooks, array('group' => 'commons_utility_links'));
+}
+
+/**
  * Implements hook_block_info().
  */
 function commons_utility_links_block_info() {
@@ -12,48 +24,33 @@ function commons_utility_links_block_info() {
     'pages' => 0,
     'weight' => 1,
   );
+
   return $blocks;
 }
 
 /**
  * Implements hook_block_view().
  */
-function commons_utility_links_block_view() {
-  $block['subject'] = '';
-  $block['content'] = '';
-  $links = array();
-
-  if (user_is_logged_in()) {
-    global $user;
-    $account = $user;
-    $links['name'] = array(
-      'href' => 'user',
-      'title' => format_username($account),
-    );
-    $links['logout'] = array(
-      'href' => 'user/logout',
-      'title' => t('Logout'),
-    );
-  }
-  else {
-    if (variable_get('user_register', USER_REGISTER_VISITORS_ADMINISTRATIVE_APPROVAL)) {
-      $links['signup'] = array(
-        'href' => 'user/register',
-        'title' => t('Signup'),
-      );
-    }
-    $links['login'] = array(
-      'href' => 'user/login',
-      'title' => t('Login'),
+function commons_utility_links_block_view($delta = '') {
+  $block = array();
+
+  // Gather all of the available utility links.
+  $links = module_invoke_all('commons_utility_links');
+  drupal_alter('commons_utility_links', $links);
+
+  if (!empty($links)) {
+    // Sort the links by weight before rendering them.
+    uasort($links, 'drupal_sort_weight');
+
+    $block['subject'] = NULL;
+    $block['content'] = array(
+      '#theme' => 'links__commons_utility_links',
+      '#links' => $links,
+      '#attributes' => array(
+        'class' => array('commons-utility-links'),
+      ),
     );
   }
-  drupal_alter('commons_utility_links', $links);
-  $block['content'] = array(
-    '#theme' => 'links__commons_utility_links',
-    '#links' => $links,
-    '#attributes' => array(
-      'class' => array('commons-utility-links'),
-    ),
-  );
+
   return $block;
 }
diff --git a/modules/commons/commons_wikis/commons_wikis.features.inc b/modules/commons/commons_wikis/commons_wikis.features.inc
index 66b1e34..13fd5b9 100644
--- a/modules/commons/commons_wikis/commons_wikis.features.inc
+++ b/modules/commons/commons_wikis/commons_wikis.features.inc
@@ -44,9 +44,9 @@ function commons_wikis_default_message_type() {
           "safe_value" : "[message:user:picture:35x35]"
         },
         {
-          "value" : "\\u003Ca href=\\u0022[message:user:url:absolute]\\u0022\\u003E[message:user:name]\\u003C\\/a\\u003E has updated the \\u003Ca href=\\u0022[message:field-target-nodes:0:url]\\u0022\\u003E[message:field-target-nodes:0:title]\\u003C\\/a\\u003E wiki page",
+          "value" : "\\u003Ca href=\\u0022[message:user:url:absolute]\\u0022\\u003E[message:user:name]\\u003C\\/a\\u003E has updated the \\u003Ca href=\\u0022[message:field-target-nodes:0:url]\\u0022\\u003E[message:field-target-nodes:0:title_field]\\u003C\\/a\\u003E wiki page",
           "format" : "full_html",
-          "safe_value" : "\\u003Ca href=\\u0022[message:user:url:absolute]\\u0022\\u003E[message:user:name]\\u003C\\/a\\u003E has updated the \\u003Ca href=\\u0022[message:field-target-nodes:0:url]\\u0022\\u003E[message:field-target-nodes:0:title]\\u003C\\/a\\u003E wiki page"
+          "safe_value" : "\\u003Ca href=\\u0022[message:user:url:absolute]\\u0022\\u003E[message:user:name]\\u003C\\/a\\u003E has updated the \\u003Ca href=\\u0022[message:field-target-nodes:0:url]\\u0022\\u003E[message:field-target-nodes:0:title_field]\\u003C\\/a\\u003E wiki page"
         },
         {
           "value" : "[commons-groups:in-groups-text]",
diff --git a/modules/commons/commons_wikis/commons_wikis.info b/modules/commons/commons_wikis/commons_wikis.info
index 327f34e..f478856 100644
--- a/modules/commons/commons_wikis/commons_wikis.info
+++ b/modules/commons/commons_wikis/commons_wikis.info
@@ -2,7 +2,6 @@ name = Commons Wikis
 description = Provides the wiki functionality for Drupal Commons
 core = 7.x
 package = Commons - Content types
-project = commons_wikis
 dependencies[] = commons_body
 dependencies[] = commons_groups
 dependencies[] = commons_topics
@@ -22,7 +21,6 @@ dependencies[] = text
 dependencies[] = views
 dependencies[] = views_content
 dependencies[] = views_litepager
-datestamp = 1359684042
 features[ctools][] = page_manager:pages_default:1
 features[ctools][] = strongarm:strongarm:1
 features[ctools][] = views:views_default:3.0
diff --git a/modules/commons/commons_wikis/commons_wikis.install b/modules/commons/commons_wikis/commons_wikis.install
index ca392a2..c2bb6df 100644
--- a/modules/commons/commons_wikis/commons_wikis.install
+++ b/modules/commons/commons_wikis/commons_wikis.install
@@ -72,3 +72,14 @@ function commons_wikis_update_7006() {
   features_revert($revert);
   return array();
 }
+
+/**
+ * Display sticky content at top of lists.
+ */
+function commons_wikis_update_7007() {
+  $revert = array(
+    'commons_wikis' => array('views_view'),
+  );
+  features_revert($revert);
+  return array();
+}
diff --git a/modules/commons/commons_wikis/commons_wikis.module b/modules/commons/commons_wikis/commons_wikis.module
index 20cf44b..356bdf7 100644
--- a/modules/commons/commons_wikis/commons_wikis.module
+++ b/modules/commons/commons_wikis/commons_wikis.module
@@ -156,7 +156,7 @@ function commons_wikis_commons_bw_group_widget() {
 }
 
 /**
- * Implements hook_commons_entity_integration.
+ * Implements hook_commons_entity_integration().
  */
 function commons_wikis_commons_entity_integration() {
   return array(
diff --git a/modules/commons/commons_wikis/commons_wikis.views_default.inc b/modules/commons/commons_wikis/commons_wikis.views_default.inc
index 7c69d67..3807929 100644
--- a/modules/commons/commons_wikis/commons_wikis.views_default.inc
+++ b/modules/commons/commons_wikis/commons_wikis.views_default.inc
@@ -85,6 +85,7 @@ function commons_wikis_views_default_views() {
   $handler->display->display_options['sorts']['sticky']['id'] = 'sticky';
   $handler->display->display_options['sorts']['sticky']['table'] = 'node';
   $handler->display->display_options['sorts']['sticky']['field'] = 'sticky';
+  $handler->display->display_options['sorts']['sticky']['order'] = 'DESC';
   /* Sort criterion: Content: Post date */
   $handler->display->display_options['sorts']['created']['id'] = 'created';
   $handler->display->display_options['sorts']['created']['table'] = 'node';
diff --git a/modules/commons/commons_wikis/modules/commons_wikis_pages/commons_wikis_pages.info b/modules/commons/commons_wikis/modules/commons_wikis_pages/commons_wikis_pages.info
index cbbecac..79e7c9a 100644
--- a/modules/commons/commons_wikis/modules/commons_wikis_pages/commons_wikis_pages.info
+++ b/modules/commons/commons_wikis/modules/commons_wikis_pages/commons_wikis_pages.info
@@ -2,7 +2,6 @@ name = Commons Wikis Home
 description = Provides the panelizer feature for Wikis.
 core = 7.x
 package = Commons - Landing pages
-project = commons_wikis_pages
 dependencies[] = commons_wikis
 dependencies[] = ctools
 dependencies[] = panelizer
diff --git a/modules/commons/commons_wysiwyg/commons_wysiwyg.info b/modules/commons/commons_wysiwyg/commons_wysiwyg.info
index 75018f6..a4e5358 100644
--- a/modules/commons/commons_wysiwyg/commons_wysiwyg.info
+++ b/modules/commons/commons_wysiwyg/commons_wysiwyg.info
@@ -2,12 +2,10 @@ name = Commons WYSIWYG
 description = Provides a rich text editor for content creation.
 core = 7.x
 package = Commons - Building blocks
-project = commons_wysiwyg
 dependencies[] = ckeditor
 dependencies[] = features
 dependencies[] = filter
 dependencies[] = strongarm
-datestamp = 1358798210
 features[ckeditor_profile][] = Advanced
 features[features_api][] = api:2
 features[filter][] = filtered_html
diff --git a/scripts/build_distro.sh b/scripts/build_distro.sh
index c0a9aae..193a604 100755
--- a/scripts/build_distro.sh
+++ b/scripts/build_distro.sh
@@ -1,8 +1,8 @@
 #!/bin/bash
-set -e
+#set -e
 
 #modules=(commons_activity_streams commons_featured commons_notices commons_profile_social commons_user_profile_pages commons_body commons_follow commons_notify commons_q_a commons_utility_links commons_bw commons_groups commons_pages commons_radioactivity commons_wikis commons_content_moderation commons_like commons_polls commons_search commons_wysiwyg commons_documents commons_location commons_posts commons_site_homepage commons_events commons_misc commons_profile_base commons_topics commons_social_sharing commons_trusted_contacts)
-themes=(commons_origins)
+#themes=(commons_origins)
 
 merge_repos() {
   cd $BUILD_PATH/commons_profile
@@ -42,17 +42,15 @@ pull_git() {
     git pull origin 7.x-3.x
 
     cd $BUILD_PATH/repos/modules
-    for i in "${modules[@]}"; do
+    for i in `ls | awk -F/ '{print $1}'`; do
       echo $i
       cd $i
       if [[ -n $RESET ]]; then
         git reset --hard HEAD
       fi
-      git pull origin 7.x-3.x
+      git pull origin
       cd ..
     done
-    cd $BUILD_PATH/repos/themes/commons_origins
-    git pull origin 7.x-3.x
 }
 
 release_notes() {
@@ -84,36 +82,89 @@ release_notes() {
 }
 
 build_distro() {
-    if [[ -d $BUILD_PATH ]]; then
-        cd $BUILD_PATH
-        rm -rf ./publish
-        # do we have the profile?
-        if [[ -d $BUILD_PATH/commons_profile ]]; then
-          if [[ -d $BUILD_PATH/repos ]]; then
-            rm -f /tmp/commons.tar.gz
-            drush make --no-cache --no-core --contrib-destination --tar $BUILD_PATH/commons_profile/drupal-org.make /tmp/commons
-            drush make --no-cache --prepare-install --drupal-org=core $BUILD_PATH/commons_profile/drupal-org-core.make ./publish
-          else
-            mkdir $BUILD_PATH/repos
-            mkdir $BUILD_PATH/repos/modules
-            mkdir $BUILD_PATH/repos/themes
-            build_distro $BUILD_PATH
-          fi
-          # symlink the profile to our dev copy
-          chmod -R 777 $BUILD_PATH/publish/sites/default
-          rm -rf publish/profiles/commons
-          ln -s $BUILD_PATH/commons_profile publish/profiles/commons
-          cd publish/profiles
-          tar -zxvf /tmp/commons.tar.gz
-          chmod -R 775 $BUILD_PATH/publish/profiles/commons
+  if [[ -d $BUILD_PATH ]]; then
+      cd $BUILD_PATH
+      #backup the sites directory
+      if [[ -d docroot ]]; then
+        rm -rf ./docroot
+      fi
+      # do we have the profile?
+      if [[ -d $BUILD_PATH/commons_profile ]]; then
+        if [[ -d $BUILD_PATH/repos ]]; then
+          rm -f /tmp/commons.tar.gz
+          drush make --no-cache --prepare-install --drupal-org=core $BUILD_PATH/commons_profile/drupal-org-core.make $BUILD_PATH/docroot
+          drush make --no-cache --no-core --contrib-destination --tar $BUILD_PATH/commons_profile/drupal-org.make /tmp/commons
         else
-          git clone --branch 7.x-3.x-merged ${USERNAME}@git.drupal.org:project/commons.git commons_profile
+          mkdir -p $BUILD_PATH/repos/modules/contrib
+          cd $BUILD_PATH/repos/modules/contrib
+          for i in "${modules[@]}"; do
+            echo "bringing in ${i} for $USERNAME";
+            if [[ -n $USERNAME ]]; then
+              git clone ${USERNAME}@git.drupal.org:project/${i}.git
+            else
+              git clone http://git.drupal.org/project/${i}.git
+            fi
+          done
+          cd $BUILD_PATH/repos
+          mkdir -p $BUILD_PATH/repos/themes/contrib
+          cd $BUILD_PATH/repos/themes
+          for i in "${themes[@]}"; do
+            if [[ -n $USERNAME ]]; then
+              git clone ${USERNAME}@git.drupal.org:project/${i}.git
+            else
+              git clone http://git.drupal.org/project/${i}.git
+            fi
+          done
           build_distro $BUILD_PATH
         fi
-    else
-      mkdir $BUILD_PATH
-      build_distro $BUILD_PATH $USERNAME
-    fi
+        # symlink the profile sites folder to our dev copy
+        cd docroot
+        if [[ -d $BUILD_PATH/sites ]]; then
+          rm -rf $BUILD_PATH/docroot/sites
+          ln -s ../sites $BUILD_PATH/docroot/sites
+        else
+          mv $BUILD_PATH/docroot/sites $BUILD_PATH/sites
+          ln -s ../sites $BUILD_PATH/docroot/sites
+        fi
+        chmod -R 777 $BUILD_PATH/docroot/sites/default
+
+        ## put commons profile and modules into the profile folder
+        rm -rf docroot/profiles/commons
+        if [ -a $BUILD_PATH/repos.txt ]; then
+          UNTAR="tar -zxvf /tmp/commons.tar.gz -X $BUILD_PATH/repos.txt"
+        else
+          cd $BUILD_PATH/repos
+          find * -mindepth 1 -maxdepth 2 -type d -not -path ".*" -not -path "modules/.*" -not -path "themes/.*" -not -path "modules/contrib" -not -path "themes/contrib" > /tmp/repos.txt
+          # exclude repos since we're updating already by linking it to the repos directory.
+          UNTAR="tar -zxvf /tmp/commons.tar.gz -X /tmp/repos.txt"
+        fi
+        cd $BUILD_PATH/docroot/profiles
+        eval $UNTAR
+        cd commons
+        ln -s ../../../commons_profile/* .
+        ln -s ../../../../commons_profile/modules/commons ${BUILD_PATH}/docroot/profiles/commons/modules/
+        ln -s ../../../../commons_profile/themes/commons ${BUILD_PATH}/docroot/profiles/commons/themes/
+        for line in $(cat $BUILD_PATH/repos.txt); do
+          ln -s ../../../../../repos/${line} ${BUILD_PATH}/docroot/profiles/commons/$(echo ${line} | awk -F/ '{print $1}')/contrib/
+        done
+        chmod -R 775 $BUILD_PATH/docroot/profiles/commons
+      else
+        git clone --branch 7.x-3.x ${USERNAME}@git.drupal.org:project/commons.git commons_profile
+        build_distro $BUILD_PATH
+      fi
+  else
+    mkdir $BUILD_PATH
+    build_distro $BUILD_PATH $USERNAME
+  fi
+}
+
+site_install() {
+  read -p "You're about to DESTROY all data for site ${SITE} Are you sure? " -n 1 -r
+  if [[ $REPLY =~ ^[Yy]$ ]]; then
+    cd ${BUILD_PATH}/docroot/sites/${SITE}
+    drush -y sql-drop
+    drush site-install --site-name=${SITE} --account-name=admin --account-pass=${ADMIN_PASS} --account-mail=${ADMIN_EMAIL} --site-mail=commons_site@example.com -v -y commons commons_anonymous_welcome_text_form.commons_install_example_content=${DEMO_CONTENT} commons_anonymous_welcome_text_form.commons_anonymous_welcome_title="Commons Example Site" commons_anonymous_welcome_text_form.commons_anonymous_welcome_body="Using the site-install version of commons." commons_create_first_group.commons_first_group_title="Sales Group" commons_create_first_group.commons_first_group_body="This is the sales group from site-install."
+  fi
 }
 
 # This allows you to test the make file without needing to upload it to drupal.org and run the main make file.
@@ -123,15 +174,16 @@ update() {
     # do we have the profile?
     if [[ -d $DOCROOT/profiles/commons ]]; then
       # do we have an installed commons profile?
-        rm -f /tmp/publish.tar.gz
+        rm -f /tmp/docroot.tar.gz
         rm -f /tmp/commons.tar.gz
-        drush make --tar --drupal-org=core profiles/commons/drupal-org-core.make /tmp/publish
-        drush make --tar --drupal-org profiles/commons/drupal-org.make /tmp/commons
+        drush make --no-cache --tar --drupal-org=core profiles/commons/drupal-org-core.make /tmp/docroot
+        drush make --no-core --no-cache --tar --drupal-org profiles/commons/drupal-org.make /tmp/commons
         cd ..
-        tar -zxvf /tmp/publish.tar.gz
-        cd publish/profiles
+        tar -zxvf /tmp/docroot.tar.gz
+        cd docroot/profiles/commons/modules/contrib
         # remove the symlinks in the repos before we execute
-        find . -mindepth 2 -type l | awk -F/ '{print $5}' | sed '/^$/d' > /tmp/repos.txt
+        find . -type l | awk -F/ '{print $2}' > /tmp/repos.txt
+        cd $DOCROOT/profiles
         # exclude repos since we're updating already by linking it to the repos directory.
         UNTAR="tar -zxvf /tmp/commons.tar.gz -X /tmp/repos.txt"
         eval $UNTAR
@@ -144,6 +196,34 @@ update() {
 }
 
 case $1 in
+  site-install)
+    if [[ -n $2 ]] && [[ -n $3 ]]; then
+      BUILD_PATH=$2
+    else
+      echo "Usage build_distro.sh site-install [build_path] [site] [demo-content] [admin-email] [admin-pass]"
+    fi
+    if [[ -n $3 ]]; then
+      SITE=$3
+    else
+      SITE='default'
+    fi
+    if [[ -n $4 ]]; then
+      DEMO_CONTENT='TRUE'
+    else
+      DEMO_CONTENT='FALSE'
+    fi
+    if [[ -n $5 ]]; then
+      ADMIN_EMAIL=$5
+    else
+      ADMIN_EMAIL='admin@example.com'
+    fi
+    if [[ -n $6 ]]; then
+      ADMIN_PASS=$6
+    else
+      ADMIN_PASS='admin'
+    fi
+
+    site_install $BUILD_PATH $SITE $DEMO_CONTENT $ADMIN_EMAIL $ADMIN_PASS;;
   pull)
     if [[ -n $2 ]]; then
       BUILD_PATH=$2
@@ -181,7 +261,7 @@ case $1 in
     if [[ -n $2 ]]; then
       DOCROOT=$2
     else
-      echo "Usage: build_distro.sh test_makefile [build_path]"
+      echo "Usage: build_distro.sh update [DOCROOT]"
       exit 1
     fi
     if [[ -n $3 ]]; then
diff --git a/themes/commons/commons_origins/.gitignore b/themes/commons/commons_origins/.gitignore
index 6173eab..8b86ab2 100644
--- a/themes/commons/commons_origins/.gitignore
+++ b/themes/commons/commons_origins/.gitignore
@@ -1,2 +1,3 @@
 /.sass-cache/
+.bundle
 .DS_Store
diff --git a/themes/commons/commons_origins/Gemfile b/themes/commons/commons_origins/Gemfile
new file mode 100644
index 0000000..996b525
--- /dev/null
+++ b/themes/commons/commons_origins/Gemfile
@@ -0,0 +1,7 @@
+# A sample Gemfile
+source "https://rubygems.org"
+
+# gem "rails"
+gem 'sass'
+gem 'compass'
+gem 'oily_png'
diff --git a/themes/commons/commons_origins/Gemfile.lock b/themes/commons/commons_origins/Gemfile.lock
new file mode 100644
index 0000000..2f03b5a
--- /dev/null
+++ b/themes/commons/commons_origins/Gemfile.lock
@@ -0,0 +1,20 @@
+GEM
+  remote: https://rubygems.org/
+  specs:
+    chunky_png (1.2.9)
+    compass (0.12.2)
+      chunky_png (~> 1.2)
+      fssm (>= 0.2.7)
+      sass (~> 3.1)
+    fssm (0.2.10)
+    oily_png (1.1.0)
+      chunky_png (~> 1.2.7)
+    sass (3.2.13)
+
+PLATFORMS
+  ruby
+
+DEPENDENCIES
+  compass
+  oily_png
+  sass
diff --git a/themes/commons/commons_origins/commons_origins.info b/themes/commons/commons_origins/commons_origins.info
index 4532f7e..60b5fcd 100644
--- a/themes/commons/commons_origins/commons_origins.info
+++ b/themes/commons/commons_origins/commons_origins.info
@@ -56,6 +56,15 @@
   ; unset_css[sites/all/modules/foobar_module/foobar_module.css] = 1
 
 
+;-----------// Breakpoints
+
+  breakpoints[Commons small portrait] = only screen and (max-width:320px)
+  breakpoints[Commons small landscape] = only screen and (min-width:321px) and (max-width:480px)
+  breakpoints[Commons medium portrait] = only screen and (min-width:481px) and (max-width:768px)
+  breakpoints[Commons medium landscape] = only screen and (min-width:769px) and (max-width:934px
+  breakpoints[Commons large] = only screen and (min-width:935px)
+
+
 ;----------// Scripts
 
   scripts[] = scripts/modernizr.js
diff --git a/themes/commons/commons_origins/css/commons-media.css b/themes/commons/commons_origins/css/commons-media.css
new file mode 100644
index 0000000..5323fb5
--- /dev/null
+++ b/themes/commons/commons_origins/css/commons-media.css
@@ -0,0 +1,84 @@
+/**
+ * @file
+ * Style overrides for the Commons Media feature.
+ */
+.field-name-field-media-form {
+  margin-bottom: 10px;
+}
+
+.field-name-field-media .field-add-more-submit, #quicktabs-container-commons_bw .quicktabs-tabpage .field-name-field-media .field-add-more-submit {
+  margin: 10px 0;
+}
+
+table[id^="field-media-values"],
+table[id^="field-media-values"] thead,
+table[id^="field-media-values"] tbody,
+table[id^="field-media-values"] tr,
+table[id^="field-media-values"] th,
+table[id^="field-media-values"] td {
+  background-color: transparent;
+  border: none;
+}
+table[id^="field-media-values"] th {
+  padding: 0;
+}
+table[id^="field-media-values"] th label {
+  margin: 0;
+}
+table[id^="field-media-values"] td.field-multiple-drag {
+  width: 20px;
+}
+table[id^="field-media-values"] a.tabledrag-handle .handle {
+  margin: 0;
+}
+table[id^="field-media-values"] .form-item {
+  padding-left: 6.875em;
+}
+table[id^="field-media-values"] .preview {
+  float: left;
+  font-size: 1em;
+  margin-left: -6.875em;
+  width: 6.25em;
+  min-height: 6.25em;
+  background: #858585;
+  cursor: pointer;
+}
+@media only screen and (max-width: 480px) {
+  table[id^="field-media-values"] .form-item {
+    padding-left: 0;
+  }
+  table[id^="field-media-values"] .preview {
+    display: block;
+    float: none;
+    margin: 10px auto;
+  }
+}
+table[id^="field-media-values"] .media-item {
+  padding: 0;
+  background-color: transparent;
+  border: none;
+}
+table[id^="field-media-values"] .media-item img {
+  display: block;
+  margin: 0;
+}
+table[id^="field-media-values"] .media-item .label-wrapper {
+  position: static;
+}
+table[id^="field-media-values"] .media-item .label-wrapper label {
+  margin: 0;
+}
+table[id^="field-media-values"] .media-widget .preview .media-item {
+  margin: 0;
+}
+table[id^="field-media-values"] .media-widget .preview .media-item .label-wrapper label {
+  color: white;
+}
+table[id^="field-media-values"] .media-widget .button {
+  display: block;
+}
+@media only screen and (min-width: 769px) {
+  table[id^="field-media-values"] .media-widget .button {
+    max-width: 50%;
+  }
+}
diff --git a/themes/commons/commons_origins/css/global.styles.css b/themes/commons/commons_origins/css/global.styles.css
index 9fa7ba6..2c47c1a 100644
--- a/themes/commons/commons_origins/css/global.styles.css
+++ b/themes/commons/commons_origins/css/global.styles.css
@@ -875,6 +875,7 @@ html.js fieldset.collapsed .fieldset-legend, html.js fieldset.collapsible .field
  * Button styles
  */
 /* Common styles for all buttons. */
+a.button,
 button,
 [type="reset"],
 [type="submit"],
@@ -908,6 +909,7 @@ button,
   outline: 0;
   cursor: pointer;
 }
+a.button:focus,
 button:focus,
 [type="reset"]:focus,
 [type="submit"]:focus,
@@ -921,6 +923,7 @@ button:focus,
 .commons-login:hover, [class*="action-item-large"]:hover {
   text-decoration: none;
 }
+a.button:active,
 button:active,
 [type="reset"]:active,
 [type="submit"]:active,
@@ -932,6 +935,7 @@ button:active,
   box-shadow: inset rgba(0, 0, 0, 0.25) 0 1px 2px 0;
   text-decoration: none;
 }
+a.button::-moz-focus-inner,
 button::-moz-focus-inner,
 [type="reset"]::-moz-focus-inner,
 [type="submit"]::-moz-focus-inner,
@@ -943,6 +947,7 @@ button::-moz-focus-inner,
 }
 
 /* Dimensions for the default button type. */
+a.button,
 button,
 [type="reset"],
 [type="submit"],
@@ -965,6 +970,7 @@ button,
   font-size: 1.2em;
 }
 
+a.button,
 button,
 [type="reset"],
 [type="submit"],
@@ -979,6 +985,7 @@ button,
   border-color: #cbcbcb;
   text-shadow: -1px 1px 2px white, -1px -1px 2px white, 1px -1px 2px white, 1px 1px 2px white;
 }
+a.button,
 button,
 [type="reset"],
 [type="submit"],
@@ -994,6 +1001,7 @@ button,
 [class*="action-item"]:visited, .commons-login:visited {
   color: #323232;
 }
+a.button:hover,
 button:hover,
 [type="reset"]:hover,
 [type="submit"]:hover,
@@ -1007,8 +1015,10 @@ button:hover,
   background: -o-linear-gradient(#fefefe, #e5e5e5);
   background: linear-gradient(#fefefe, #e5e5e5);
   border-color: #b2b2b2;
+  text-decoration: none;
   text-shadow: -1px 1px 2px #fefefe, -1px -1px 2px #fefefe, 1px -1px 2px #fefefe, 1px 1px 2px #fefefe;
 }
+a.button:focus,
 button:focus,
 [type="reset"]:focus,
 [type="submit"]:focus,
@@ -1027,6 +1037,7 @@ button:focus,
   border-color: #cbcbcb;
   text-shadow: -1px 1px 2px white, -1px -1px 2px white, 1px -1px 2px white, 1px 1px 2px white;
 }
+a.button[disabled],
 button[disabled],
 [disabled][type="reset"],
 [disabled][type="submit"],
@@ -1049,7 +1060,7 @@ button[disabled],
 .action-item-large-active,
 .action-item-large-active[type="reset"],
 .action-item-large-active[type="submit"],
-.action-item-large-active[type="button"], [class*="flag-commons-follow-"] .unflag-action {
+.action-item-large-active[type="button"], [class*="flag-commons-follow-"] a.unflag-action {
   background-color: #f3f3f3;
   -webkit-box-shadow: inset 0.1em 0.1em 0.2em #a6a6a6;
   -moz-box-shadow: inset 0.1em 0.1em 0.2em #a6a6a6;
@@ -1065,16 +1076,16 @@ button[disabled],
 .action-item-large-active,
 .action-item-large-active[type="reset"],
 .action-item-large-active[type="submit"],
-.action-item-large-active[type="button"], [class*="flag-commons-follow-"] .unflag-action, .action-item-active:link,
+.action-item-large-active[type="button"], [class*="flag-commons-follow-"] a.unflag-action, .action-item-active:link,
 .action-item-small-active:link,
-.action-item-large-active:link, [class*="flag-commons-follow-"] .unflag-action:link, .action-item-active:visited,
+.action-item-large-active:link, [class*="flag-commons-follow-"] a.unflag-action:link, .action-item-active:visited,
 .action-item-small-active:visited,
-.action-item-large-active:visited, [class*="flag-commons-follow-"] .unflag-action:visited {
+.action-item-large-active:visited, [class*="flag-commons-follow-"] a.unflag-action:visited {
   color: #272727;
 }
 .action-item-active:hover,
 .action-item-small-active:hover,
-.action-item-large-active:hover, [class*="flag-commons-follow-"] .unflag-action:hover {
+.action-item-large-active:hover, [class*="flag-commons-follow-"] a.unflag-action:hover {
   color: #343434;
   background-color: #e6e6e6;
   -webkit-box-shadow: inset 0.1em 0.1em 0.2em #9a9a9a;
@@ -1085,9 +1096,9 @@ button[disabled],
 }
 .action-item-active:focus,
 .action-item-small-active:focus,
-.action-item-large-active:focus, [class*="flag-commons-follow-"] .unflag-action:focus, .action-item-active:active,
+.action-item-large-active:focus, [class*="flag-commons-follow-"] a.unflag-action:focus, .action-item-active:active,
 .action-item-small-active:active,
-.action-item-large-active:active, [class*="flag-commons-follow-"] .unflag-action:active {
+.action-item-large-active:active, [class*="flag-commons-follow-"] a.unflag-action:active {
   background: #f3f3f3;
   -webkit-box-shadow: inset 0.1em 0.1em 0.2em #a6a6a6;
   -moz-box-shadow: inset 0.1em 0.1em 0.2em #a6a6a6;
@@ -1395,6 +1406,12 @@ button,
 }
 
 /* Report as inappropriate */
+.flag-inappropriate-node,
+.flag-inappropriate-comment {
+  display: block;
+  clear: both;
+  margin: 1em 0 0;
+}
 .flag-inappropriate-node .flag-action:before,
 .flag-inappropriate-comment .flag-action:before {
   content: "";
@@ -2256,6 +2273,13 @@ h1.node-title a:hover {
   margin-bottom: .2em;
 }
 
+ul.comment-links {
+  margin: .7em 0;
+}
+ul.comment-links li {
+  padding-left: 0;
+}
+
 .comment-reply {
   float: right;
 }
@@ -4382,7 +4406,11 @@ body.front.logged-in .view-commons-homepage-content .article.node.node-page .lin
 #quicktabs-commons_follow_ui .flag-email-group a span,
 #quicktabs-commons_follow_ui .flag-email-node a span,
 #quicktabs-commons_follow_ui .flag-email-user a span,
-#quicktabs-commons_follow_ui .flag-email-term a span {
+#quicktabs-commons_follow_ui .flag-email-term a span,
+#quicktabs-commons_follow_ui .flag-email-group span span,
+#quicktabs-commons_follow_ui .flag-email-node span span,
+#quicktabs-commons_follow_ui .flag-email-user span span,
+#quicktabs-commons_follow_ui .flag-email-term span span {
   display: none;
 }
 
diff --git a/themes/commons/commons_origins/css/responsive.desktop.css b/themes/commons/commons_origins/css/responsive.desktop.css
index 295f711..3c4eb6a 100644
--- a/themes/commons/commons_origins/css/responsive.desktop.css
+++ b/themes/commons/commons_origins/css/responsive.desktop.css
@@ -7,19 +7,3 @@
  *
  * - Read the _README file in this directory, it contains useful help and other information.
  */
-.flag-inappropriate-node {
-  position: absolute;
-  margin: 0;
-  right: 0;
-  bottom: 0;
-  filter: progid:DXImageTransform.Microsoft.Alpha(Opacity=0);
-  opacity: 0;
-  -webkit-transition: opacity 0.5s;
-  -moz-transition: opacity 0.5s;
-  -o-transition: opacity 0.5s;
-  transition: opacity 0.5s;
-}
-.node:hover .flag-inappropriate-node {
-  filter: progid:DXImageTransform.Microsoft.Alpha(Opacity=100);
-  opacity: 1;
-}
diff --git a/themes/commons/commons_origins/sass/commons-media.scss b/themes/commons/commons_origins/sass/commons-media.scss
new file mode 100644
index 0000000..3742746
--- /dev/null
+++ b/themes/commons/commons_origins/sass/commons-media.scss
@@ -0,0 +1,114 @@
+/**
+ * @file
+ * Style overrides for the Commons Media feature.
+ */
+
+@import "base";
+
+.field-name-field-media-form {
+  margin-bottom: $gutter-width;
+}
+
+.field-name-field-media .field-add-more-submit {
+  &,
+  #quicktabs-container-commons_bw .quicktabs-tabpage & {
+    margin: $gutter-width 0;
+  }
+}
+
+table[id^="field-media-values"] {
+  &,
+  thead,
+  tbody,
+  tr,
+  th,
+  td {
+    background-color: transparent;
+    border: none;
+  }
+
+  th {
+    padding: 0;
+
+    label {
+      margin: 0;
+    }
+  }
+
+  td {
+    &.field-multiple-drag {
+      width: 20px;
+    }
+  }
+
+  a.tabledrag-handle .handle {
+    margin: 0;
+  }
+
+  .form-item {
+    padding-left: px-to-em(100px + $gutter-width);
+  }
+
+  .preview {
+    float: left;
+    font-size: 1em;
+    margin-left: -(px-to-em(100px + $gutter-width));
+    width: px-to-em(100px);
+    min-height: px-to-em(100px);
+    background: $light_gray;
+    cursor: pointer;
+  }
+
+  @include respond(only-small) {
+    .form-item {
+      padding-left: 0;
+    }
+
+    .preview {
+      display: block;
+      float: none;
+      margin: $gutter-width auto;
+    }
+  }
+
+  .media-item {
+    padding: 0;
+    background-color: transparent;
+    border: none;
+
+    img {
+      display: block;
+      margin: 0;
+    }
+
+    .label-wrapper {
+      position: static;
+
+      label {
+        margin: 0;
+      }
+    }
+  }
+
+  .media-widget {
+    .preview {
+      .media-item {
+        margin: 0;
+
+        .label-wrapper {
+          label {
+            color: $white;
+          }
+        }
+      }
+    }
+
+    .button {
+      display: block;
+
+      @include respond(large) {
+        max-width: 50%;
+      }
+    }
+  }
+}
diff --git a/themes/commons/commons_origins/sass/global.styles.scss b/themes/commons/commons_origins/sass/global.styles.scss
index b904a44..ca98417 100755
--- a/themes/commons/commons_origins/sass/global.styles.scss
+++ b/themes/commons/commons_origins/sass/global.styles.scss
@@ -1027,6 +1027,10 @@ button,
 /* Report as inappropriate */
 .flag-inappropriate-node,
 .flag-inappropriate-comment, {
+  display: block;
+  clear: both;
+  margin: 1em 0 0;
+
   .flag-action {
     &:before {
       content: "";
@@ -1745,6 +1749,14 @@ h1.node-title {
   margin-bottom: .2em;
 }
 
+ul.comment-links {
+  margin: .7em 0;
+
+  li {
+    padding-left: 0;
+  }
+}
+
 .comment-reply {
   float: right;
 
diff --git a/themes/commons/commons_origins/sass/responsive.desktop.scss b/themes/commons/commons_origins/sass/responsive.desktop.scss
index 5d4f619..75eb2e7 100755
--- a/themes/commons/commons_origins/sass/responsive.desktop.scss
+++ b/themes/commons/commons_origins/sass/responsive.desktop.scss
@@ -11,16 +11,3 @@
  *
  * - Read the _README file in this directory, it contains useful help and other information.
  */
-
-.flag-inappropriate-node {
-  position: absolute;
-  margin: 0;
-  right: 0;
-  bottom: 0;
-  @include opacity(0);
-  @include transition(opacity 0.5s);
-
-  .node:hover & {
-    @include opacity(1);
-  }
-}
diff --git a/themes/commons/commons_origins/scripts/commons_origins.js b/themes/commons/commons_origins/scripts/commons_origins.js
index 43f28eb..2e05894 100644
--- a/themes/commons/commons_origins/scripts/commons_origins.js
+++ b/themes/commons/commons_origins/scripts/commons_origins.js
@@ -20,6 +20,22 @@ jQuery(document).ready(function($){
     });
   };
 
+  var set_disabled_checkboxes = function(){
+    $('#quicktabs-commons_follow_ui .flag-email-group span, #quicktabs-commons_follow_ui .flag-email-node span, #quicktabs-commons_follow_ui .flag-email-user span, #quicktabs-commons_follow_ui .flag-email-term span').each(function(){
+      var a_target = $(this).addClass('formatted-as-checkbox').removeClass('action-item-small action-item-small-active');
+
+      if (a_target.children('span').length === 0) {
+        a_target.wrapInner('<span></span>');
+      }
+
+      if (a_target.hasClass('flag-action') && a_target.children('input').length === 0) {
+        a_target.prepend('<input type="checkbox" disabled="disabled">');
+      } else if (a_target.children('input').length === 0) {
+        a_target.prepend('<input type="checkbox" disabled="disabled" checked>');
+      }
+    });
+  };
+
   $(document).delegate('.views-exposed-widgets .form-select', 'change', function() {
     $('.views-exposed-widgets').addClass('widget-changed');
   });
@@ -28,11 +44,15 @@ jQuery(document).ready(function($){
     $('.views-exposed-widgets').addClass('widgets-active');
   });
 
-  set_follow_checkboxes();
+  if($('#quicktabs-commons_follow_ui a.flag').length > 0) {
+      set_follow_checkboxes();
 
-  $(document).ajaxComplete(function(){
-    set_follow_checkboxes();
-  });
+      $(document).ajaxComplete(function(){
+        set_follow_checkboxes();
+      });
+  } else {
+      set_disabled_checkboxes();
+  }
 });
 
 (function ($) {
@@ -78,7 +98,7 @@ jQuery(document).ready(function($){
         });
       }
     }
-  }
+  };
 
   /**
    * Define a variable height on fieldsets to accommodate multi-line layouts.
@@ -94,12 +114,12 @@ jQuery(document).ready(function($){
 
         // Adjust the height on window resize.
         $(window).resize(function () {
-          var minHeight = $fieldset.find('legend').height();
+          var minHeight = fieldset.find('legend').height();
           fieldset.css('min-height', minHeight + 'px');
         });
       });
     }
-  }
+  };
 
   /**
    * Make an item follow the page when an item is in view.
@@ -133,7 +153,7 @@ jQuery(document).ready(function($){
         var filters = $(this),
             filterTrigger = $('<a/>', {'href': '#filter-drawer', 'class': 'filter-trigger', 'id': 'filter-drawer'}).text(Drupal.t('Filter results')),
             filterOverlay = $('<div/>', {'class': 'filter-overlay'}),
-            results = $('.search-results-content, .pane-search-result');
+            results = $('.search-results-content, .pane-search-result'),
             size = $(window).width(),
             triggerWidth = '';
 
@@ -199,5 +219,5 @@ jQuery(document).ready(function($){
         }
       });
     }
-  }
+  };
 })(jQuery);
diff --git a/themes/commons/commons_origins/template.php b/themes/commons/commons_origins/template.php
index 672c0af..ce26a21 100755
--- a/themes/commons/commons_origins/template.php
+++ b/themes/commons/commons_origins/template.php
@@ -123,7 +123,6 @@ function commons_origins_preprocess_html(&$variables, $hook) {
   // Browser/platform sniff - adds body classes such as ipad, webkit, chrome
   // etc.
   $variables['classes_array'][] = css_browser_selector();
-
 }
 
 /**
@@ -263,6 +262,11 @@ function commons_origins_preprocess_page(&$variables, $hook) {
 
   $cf_pos = in_array('clearfix', $variables['branding_attributes_array']['class']);
   unset($variables['branding_attributes_array']['class'][$cf_pos]);
+
+  // Only load the media styles if Commons Media is enabled.
+  if (module_exists('commons_media')) {
+    drupal_add_css(drupal_get_path('theme', 'commons_origins') . '/css/commons-media.css', array('media' => 'screen', 'group' => CSS_THEME));
+  }
 }
 
 /**
@@ -461,6 +465,19 @@ function commons_origins_process_comment_wrapper(&$variables, $hook) {
 }
 
 /**
+ * Implements hook_preprocess_comment().
+ */
+function commons_origins_preprocess_comment(&$variables, $hook) {
+  $variables['content']['links']['#attributes']['class'][] = 'comment-links';
+
+  // Push the reporting link to the end.
+  if (!empty($variables['content']['links']['flag']['#links']['flag-inappropriate_comment'])) {
+    $variables['content']['report_link'] = array('#markup' => $variables['content']['links']['flag']['#links']['flag-inappropriate_comment']['title']);
+    $variables['content']['links']['flag']['#links']['flag-inappropriate_comment']['#access'] = FALSE;
+  }
+}
+
+/**
  * Implements hook_preprocess_flag().
  */
 function commons_origins_preprocess_flag(&$variables, $hook) {
diff --git a/themes/commons/commons_origins/templates/comment/comment.tpl.php b/themes/commons/commons_origins/templates/comment/comment.tpl.php
index 9aa8b26..9c4c7d8 100644
--- a/themes/commons/commons_origins/templates/comment/comment.tpl.php
+++ b/themes/commons/commons_origins/templates/comment/comment.tpl.php
@@ -58,6 +58,8 @@
  *
  * @ingroup themeable
  */
+
+hide($content['report_link']);
 ?>
 <div class="<?php print $classes; ?> clearfix"<?php print $attributes; ?>>
   <h3 class="comment-title"><?php print $title; ?></h3>
@@ -77,5 +79,5 @@
     ?>
   </div>
   <?php print render($content['links']) ?>
-
+  <?php print render($content['report_link']); ?>
 </div>
