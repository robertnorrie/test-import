diff --git a/CHANGELOG.txt b/CHANGELOG.txt
index d0e6d64..fa1fd02 100644
--- a/CHANGELOG.txt
+++ b/CHANGELOG.txt
@@ -1,4 +1,12 @@
 
+Drupal 6.28, 2013-01-16
+----------------------
+- Fixed security issues (multiple vulnerabilities), see SA-CORE-2013-001.
+
+Drupal 6.27, 2012-12-19
+----------------------
+- Fixed security issues (multiple vulnerabilities), see SA-CORE-2012-004.
+
 Drupal 6.26, 2012-05-02
 ----------------------
 - Fixed a small number of bugs.
diff --git a/COPYRIGHT.txt b/COPYRIGHT.txt
index 94bfd61..89cc880 100644
--- a/COPYRIGHT.txt
+++ b/COPYRIGHT.txt
@@ -1,5 +1,4 @@
-
-All Drupal code is Copyright 2001 - 2010 by the original authors.
+All Drupal code is Copyright 2001 - 2012 by the original authors.
 
 This program is free software; you can redistribute it and/or modify
 it under the terms of the GNU General Public License as published by
@@ -20,5 +19,11 @@ Drupal includes works under other copyright notices and distributed
 according to the terms of the GNU General Public License or a compatible
 license, including:
 
-  jQuery - Copyright (c) 2008 - 2009 John Resig
+Javascript
+
+  Farbtastic - Copyright (c) 2007 Matt Farina
+
+  jQuery - Copyright (c) 2008 John Resig
+
+  jQuery Form - Copyright (c) 2007 Mike Alsup
 
diff --git a/MAINTAINERS.txt b/MAINTAINERS.txt
index 9c09f88..da831f9 100644
--- a/MAINTAINERS.txt
+++ b/MAINTAINERS.txt
@@ -57,7 +57,7 @@ M: Sammy Spets <sammys-drupal@synerger.com>
 S: maintained
 
 SECURITY COORDINATOR
-M: Heine Deelstra <hdeelstra@gmail.com>
+M: Greg Knaddison <http://drupal.org/user/36762>
 S: maintained
 
 STATISTICS MODULE
diff --git a/includes/bootstrap.inc b/includes/bootstrap.inc
index bc6af1f..3c53a96 100644
--- a/includes/bootstrap.inc
+++ b/includes/bootstrap.inc
@@ -403,7 +403,7 @@ function conf_init() {
     include_once './'. conf_path() .'/settings.php';
   }
 
-  // Ignore the placeholder url from default.settings.php.
+  // Ignore the placeholder URL from default.settings.php.
   if (isset($db_url) && $db_url == 'mysql://username:password@localhost/databasename') {
     $db_url = '';
   }
@@ -442,7 +442,7 @@ function conf_init() {
   }
   else {
     // Otherwise use $base_url as session name, without the protocol
-    // to use the same session identifiers across http and https.
+    // to use the same session identifiers across HTTP and HTTPS.
     list( , $session_name) = explode('://', $base_url, 2);
     // We escape the hostname because it can be modified by a visitor.
     if (!empty($_SERVER['HTTP_HOST'])) {
diff --git a/includes/common.inc b/includes/common.inc
index b86f2d2..2abf198 100644
--- a/includes/common.inc
+++ b/includes/common.inc
@@ -176,7 +176,7 @@ function drupal_final_markup($content) {
  * Add a feed URL for the current page.
  *
  * @param $url
- *   A url for the feed.
+ *   A URL for the feed.
  * @param $title
  *   The title of the feed.
  */
@@ -296,14 +296,16 @@ function drupal_get_destination() {
  * statement in your menu callback.
  *
  * @param $path
- *   A Drupal path or a full URL.
+ *   (optional) A Drupal path or a full URL, which will be passed to url() to
+ *   compute the redirect for the URL.
  * @param $query
- *   A URL-encoded query string to append to the link, or an array of query
- *   key/value-pairs without any URL-encoding. Passed to url().
+ *   (optional) A URL-encoded query string to append to the link, or an array of
+ *   query key/value-pairs without any URL-encoding. Passed to url().
  * @param $fragment
- *   A destination fragment identifier (named anchor).
+ *   (optional) A destination fragment identifier (named anchor).
  * @param $http_response_code
- *   Valid values for an actual "goto" as per RFC 2616 section 10.3 are:
+ *   (optional) The HTTP status code to use for the redirection, defaults to
+ *   302. Valid values for an actual "goto" as per RFC 2616 section 10.3 are:
  *   - 301 Moved Permanently (the recommended value for most redirects)
  *   - 302 Found (default in Drupal and PHP, sometimes used for spamming search
  *         engines)
@@ -531,7 +533,7 @@ function drupal_http_request($url, $headers = array(), $method = 'GET', $data =
     $defaults['Content-Length'] = 'Content-Length: '. $content_length;
   }
 
-  // If the server url has a user then attempt to use basic authentication
+  // If the server URL has a user then attempt to use basic authentication
   if (isset($uri['user'])) {
     $defaults['Authorization'] = 'Authorization: Basic '. base64_encode($uri['user'] . (!empty($uri['pass']) ? ":". $uri['pass'] : ''));
   }
@@ -1423,8 +1425,9 @@ function format_date($timestamp, $type = 'medium', $format = '', $timezone = NUL
  * alternative than url().
  *
  * @param $path
- *   The internal path or external URL being linked to, such as "node/34" or
- *   "http://example.com/foo". A few notes:
+ *   (optional) The internal path or external URL being linked to, such as
+ *   "node/34" or "http://example.com/foo". The default value is equivalent to
+ *   passing in '<front>'. A few notes:
  *   - If you provide a full URL, it will be considered an external URL.
  *   - If you provide only the path (e.g. "node/34"), it will be
  *     considered an internal link. In this case, it should be a system URL,
@@ -1440,7 +1443,8 @@ function format_date($timestamp, $type = 'medium', $format = '', $timezone = NUL
  *     include them in $path, or use $options['query'] to let this function
  *     URL encode them.
  * @param $options
- *   An associative array of additional options, with the following elements:
+ *   (optional) An associative array of additional options, with the following
+ *   elements:
  *   - 'query': A URL-encoded query string to append to the link, or an array of
  *     query key/value-pairs without any URL-encoding.
  *   - 'fragment': A fragment identifier (named anchor) to append to the URL.
@@ -1592,6 +1596,14 @@ function drupal_attributes($attributes = array()) {
  * internal links output by modules should be generated by this function if
  * possible.
  *
+ * However, for links enclosed in translatable text you should use t() and
+ * embed the HTML anchor tag directly in the translated string. For example:
+ * @code
+ * t('Visit the <a href="@url">settings</a> page', array('@url' => url('admin')));
+ * @endcode
+ * This keeps the context of the link title ('settings' in the example) for
+ * translators.
+ *
  * @param $text
  *   The link text for the anchor tag.
  * @param $path
@@ -3825,7 +3837,7 @@ function drupal_flush_all_caches() {
  * Changes the character added to all css/js files as dummy query-string,
  * so that all browsers are forced to reload fresh files. We keep
  * 20 characters history (FIFO) to avoid repeats, but only the first
- * (newest) character is actually used on urls, to keep them short.
+ * (newest) character is actually used on URLs, to keep them short.
  * This is also called from update.php.
  */
 function _drupal_flush_css_js() {
diff --git a/includes/database.mysql.inc b/includes/database.mysql.inc
index 37e4ae5..5ad5f3e 100644
--- a/includes/database.mysql.inc
+++ b/includes/database.mysql.inc
@@ -55,9 +55,9 @@ function db_connect($url) {
     _db_error_page('Unable to use the MySQL database because the MySQL extension for PHP is not installed. Check your <code>php.ini</code> to see how you can enable it.');
   }
 
-  // Decode url-encoded information in the db connection string
+  // Decode urlencoded information in the db connection string
   $url['user'] = urldecode($url['user']);
-  // Test if database url has a password.
+  // Test if database URL has a password.
   $url['pass'] = isset($url['pass']) ? urldecode($url['pass']) : '';
   $url['host'] = urldecode($url['host']);
   $url['path'] = urldecode($url['path']);
diff --git a/includes/database.mysqli.inc b/includes/database.mysqli.inc
index c984c10..c6297b7 100644
--- a/includes/database.mysqli.inc
+++ b/includes/database.mysqli.inc
@@ -61,9 +61,9 @@ function db_connect($url) {
 
   $url = parse_url($url);
 
-  // Decode url-encoded information in the db connection string
+  // Decode urlencoded information in the db connection string
   $url['user'] = urldecode($url['user']);
-  // Test if database url has a password.
+  // Test if database URL has a password.
   $url['pass'] = isset($url['pass']) ? urldecode($url['pass']) : '';
   $url['host'] = urldecode($url['host']);
   $url['path'] = urldecode($url['path']);
diff --git a/includes/database.pgsql.inc b/includes/database.pgsql.inc
index 00ba095..01f2c6b 100644
--- a/includes/database.pgsql.inc
+++ b/includes/database.pgsql.inc
@@ -52,7 +52,7 @@ function db_connect($url) {
   $url = parse_url($url);
   $conn_string = '';
 
-  // Decode url-encoded information in the db connection string
+  // Decode urlencoded information in the db connection string
   if (isset($url['user'])) {
     $conn_string .= ' user='. urldecode($url['user']);
   }
diff --git a/includes/file.inc b/includes/file.inc
index bbcf9dc..0736f8b 100644
--- a/includes/file.inc
+++ b/includes/file.inc
@@ -38,7 +38,7 @@ define('FILE_STATUS_PERMANENT', 1);
  * @return A string containing a URL that can be used to download the file.
  */
 function file_create_url($path) {
-  // Strip file_directory_path from $path. We only include relative paths in urls.
+  // Strip file_directory_path from $path. We only include relative paths in URLs.
   if (strpos($path, file_directory_path() .'/') === 0) {
     $path = trim(substr($path, strlen(file_directory_path())), '\\/');
   }
@@ -403,6 +403,9 @@ function file_munge_filename($filename, $extensions, $alerts = TRUE) {
 
   // Allow potentially insecure uploads for very savvy users and admin
   if (!variable_get('allow_insecure_uploads', 0)) {
+    // Remove any null bytes. See http://php.net/manual/en/security.filesystem.nullbytes.php
+    $filename = str_replace(chr(0), '', $filename);
+
     $whitelist = array_unique(explode(' ', trim($extensions)));
 
     // Split the filename up by periods. The first part becomes the basename
@@ -862,7 +865,7 @@ function file_transfer($source, $headers) {
   }
   
   // IE cannot download private files because it cannot store files downloaded
-  // over https in the browser cache. The problem can be solved by sending
+  // over HTTPS in the browser cache. The problem can be solved by sending
   // custom headers to IE. See http://support.microsoft.com/kb/323308/en-us
   if (isset($_SERVER['HTTPS']) && ($_SERVER['HTTPS'] == 'on')) {
     drupal_set_header('Cache-Control: private');
diff --git a/includes/form.inc b/includes/form.inc
index e6d2a6a..514641d 100644
--- a/includes/form.inc
+++ b/includes/form.inc
@@ -41,8 +41,8 @@
  *
  * For information on the format of the structured arrays used to define forms,
  * and more detailed explanations of the Form API workflow, see the
- * @link http://api.drupal.org/api/file/developer/topics/forms_api_reference.html/6 reference @endlink
- * and the @link http://drupal.org/node/204270 Form API guide. @endlink
+ * @link forms_api_reference.html reference @endlink and the
+ * @link http://drupal.org/node/204270 Form API guide. @endlink
  */
 
 /**
@@ -1842,7 +1842,7 @@ function form_expand_ahah($element) {
     if (is_string($ahah_binding['progress'])) {
       $ahah_binding['progress'] = array('type' => $ahah_binding['progress']);
     }
-    // Change progress path to a full url.
+    // Change progress path to a full URL.
     if (isset($ahah_binding['progress']['path'])) {
       $ahah_binding['progress']['url'] = url($ahah_binding['progress']['path']);
     }
diff --git a/includes/install.mysql.inc b/includes/install.mysql.inc
index e544294..73aa365 100644
--- a/includes/install.mysql.inc
+++ b/includes/install.mysql.inc
@@ -26,7 +26,7 @@ function drupal_test_mysql($url, &$success) {
 
   $url = parse_url($url);
 
-  // Decode url-encoded information in the db connection string.
+  // Decode urlencoded information in the db connection string.
   $url['user'] = urldecode($url['user']);
   $url['pass'] = isset($url['pass']) ? urldecode($url['pass']) : '';
   $url['host'] = urldecode($url['host']);
diff --git a/includes/install.mysqli.inc b/includes/install.mysqli.inc
index 8920d01..0080804 100644
--- a/includes/install.mysqli.inc
+++ b/includes/install.mysqli.inc
@@ -26,7 +26,7 @@ function drupal_test_mysqli($url, &$success) {
 
   $url = parse_url($url);
 
-  // Decode url-encoded information in the db connection string.
+  // Decode urlencoded information in the db connection string.
   $url['user'] = urldecode($url['user']);
   $url['pass'] = isset($url['pass']) ? urldecode($url['pass']) : '';
   $url['host'] = urldecode($url['host']);
diff --git a/includes/install.pgsql.inc b/includes/install.pgsql.inc
index fde97a3..5c2c21d 100644
--- a/includes/install.pgsql.inc
+++ b/includes/install.pgsql.inc
@@ -27,7 +27,7 @@ function drupal_test_pgsql($url, &$success) {
   $url = parse_url($url);
   $conn_string = '';
 
-  // Decode url-encoded information in the db connection string
+  // Decode urlencoded information in the db connection string
   if (isset($url['user'])) {
     $conn_string .= ' user='. urldecode($url['user']);
   }
diff --git a/includes/theme.inc b/includes/theme.inc
index e1e45e0..fbb4634 100644
--- a/includes/theme.inc
+++ b/includes/theme.inc
@@ -1592,7 +1592,7 @@ function theme_more_help_link($url) {
  *
  * @see theme_feed_icon()
  * @param $url
- *   The url of the feed.
+ *   The URL of the feed.
  */
 function theme_xml_icon($url) {
   if ($image = theme('image', 'misc/xml.png', t('XML feed'), t('XML feed'))) {
@@ -1604,7 +1604,7 @@ function theme_xml_icon($url) {
  * Return code that emits an feed icon.
  *
  * @param $url
- *   The url of the feed.
+ *   The URL of the feed.
  * @param $title
  *   A descriptive title of the feed.
   */
@@ -1618,7 +1618,7 @@ function theme_feed_icon($url, $title) {
  * Returns code that emits the 'more' link used on blocks.
  *
  * @param $url
- *   The url of the main page
+ *   The URL of the main page
  * @param $title
  *   A descriptive verb for the link, like 'Read more'
  */
diff --git a/misc/drupal.js b/misc/drupal.js
index f29e398..a85b8f8 100644
--- a/misc/drupal.js
+++ b/misc/drupal.js
@@ -1,4 +1,27 @@
 
+/**
+ * Override jQuery.fn.init to guard against XSS attacks.
+ *
+ * See http://bugs.jquery.com/ticket/9521
+ */
+(function () {
+  var jquery_init = jQuery.fn.init;
+  jQuery.fn.init = function (selector, context, rootjQuery) {
+    // If the string contains a "#" before a "<", treat it as invalid HTML.
+    if (selector && typeof selector === 'string') {
+      var hash_position = selector.indexOf('#');
+      if (hash_position >= 0) {
+        var bracket_position = selector.indexOf('<');
+        if (bracket_position > hash_position) {
+          throw 'Syntax error, unrecognized expression: ' + selector;
+        }
+      }
+    }
+    return jquery_init.call(this, selector, context, rootjQuery);
+  };
+  jQuery.fn.init.prototype = jquery_init.prototype;
+})();
+
 var Drupal = Drupal || { 'settings': {}, 'behaviors': {}, 'themes': {}, 'locale': {} };
 
 /**
diff --git a/misc/tableheader.js b/misc/tableheader.js
index 9d05e23..9deb18d 100644
--- a/misc/tableheader.js
+++ b/misc/tableheader.js
@@ -69,7 +69,7 @@ Drupal.behaviors.tableHeader = function (context) {
     // Get the height of the header table and scroll up that amount.
     if (prevAnchor != location.hash) {
       if (location.hash != '') {
-        var offset = $('td' + location.hash).offset();
+        var offset = $(document).find('td' + location.hash).offset();
         if (offset) {
           var top = offset.top;
           var scrollLocation = top - $(e).height();
diff --git a/modules/aggregator/aggregator.info b/modules/aggregator/aggregator.info
index 5f9107b..0b8ec66 100644
--- a/modules/aggregator/aggregator.info
+++ b/modules/aggregator/aggregator.info
@@ -4,8 +4,8 @@ package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2012-05-02
-version = "6.26"
+; Information added by drupal.org packaging script on 2013-01-16
+version = "6.28"
 project = "drupal"
-datestamp = "1335977158"
+datestamp = "1358370963"
 
diff --git a/modules/block/block.info b/modules/block/block.info
index 8871d11..d2ac314 100644
--- a/modules/block/block.info
+++ b/modules/block/block.info
@@ -4,8 +4,8 @@ package = Core - required
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2012-05-02
-version = "6.26"
+; Information added by drupal.org packaging script on 2013-01-16
+version = "6.28"
 project = "drupal"
-datestamp = "1335977158"
+datestamp = "1358370963"
 
diff --git a/modules/blog/blog.info b/modules/blog/blog.info
index 32d43b0..6e5ba40 100644
--- a/modules/blog/blog.info
+++ b/modules/blog/blog.info
@@ -4,8 +4,8 @@ package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2012-05-02
-version = "6.26"
+; Information added by drupal.org packaging script on 2013-01-16
+version = "6.28"
 project = "drupal"
-datestamp = "1335977158"
+datestamp = "1358370963"
 
diff --git a/modules/blogapi/blogapi.info b/modules/blogapi/blogapi.info
index 9a510b3..e3f464c 100644
--- a/modules/blogapi/blogapi.info
+++ b/modules/blogapi/blogapi.info
@@ -4,8 +4,8 @@ package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2012-05-02
-version = "6.26"
+; Information added by drupal.org packaging script on 2013-01-16
+version = "6.28"
 project = "drupal"
-datestamp = "1335977158"
+datestamp = "1358370963"
 
diff --git a/modules/blogapi/blogapi.install b/modules/blogapi/blogapi.install
index bd2f67d..c14c390 100644
--- a/modules/blogapi/blogapi.install
+++ b/modules/blogapi/blogapi.install
@@ -58,7 +58,7 @@ function blogapi_schema() {
 }
 
 /**
- * @defgroup updates-5.x-to-6.x Blog API updates from 5.x to 6.x
+ * @addtogroup updates-5.x-to-6.x
  * @{
  */
 
@@ -118,7 +118,7 @@ function blogapi_update_6001() {
 }
 
 /**
- * @} End of "defgroup updates-5.x-to-6.x"
+ * @} End of "addtogroup updates-5.x-to-6.x".
  * The next series of updates should start at 7000.
  */
 
diff --git a/modules/book/book.info b/modules/book/book.info
index ad62ee4..008766c 100644
--- a/modules/book/book.info
+++ b/modules/book/book.info
@@ -4,8 +4,8 @@ package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2012-05-02
-version = "6.26"
+; Information added by drupal.org packaging script on 2013-01-16
+version = "6.28"
 project = "drupal"
-datestamp = "1335977158"
+datestamp = "1358370963"
 
diff --git a/modules/book/book.pages.inc b/modules/book/book.pages.inc
index 46eb86a..e0e3f65 100644
--- a/modules/book/book.pages.inc
+++ b/modules/book/book.pages.inc
@@ -39,6 +39,14 @@ function book_render() {
  *   in a format determined by the $type parameter.
  */
 function book_export($type, $nid) {
+  // Check that the node exists and that the current user has access to it.
+  $node = node_load($nid);
+  if (!$node) {
+    return MENU_NOT_FOUND;
+  }
+  if (!node_access('view', $node)) {
+    return MENU_ACCESS_DENIED;
+  }
 
   $type = drupal_strtolower($type);
 
diff --git a/modules/color/color.info b/modules/color/color.info
index 4177448..6b87d79 100644
--- a/modules/color/color.info
+++ b/modules/color/color.info
@@ -4,8 +4,8 @@ package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2012-05-02
-version = "6.26"
+; Information added by drupal.org packaging script on 2013-01-16
+version = "6.28"
 project = "drupal"
-datestamp = "1335977158"
+datestamp = "1358370963"
 
diff --git a/modules/comment/comment-wrapper.tpl.php b/modules/comment/comment-wrapper.tpl.php
index 6b6defc..d6471c6 100644
--- a/modules/comment/comment-wrapper.tpl.php
+++ b/modules/comment/comment-wrapper.tpl.php
@@ -27,7 +27,6 @@
  *   - COMMENT_CONTROLS_HIDDEN
  *
  * @see template_preprocess_comment_wrapper()
- * @see theme_comment_wrapper()
  */
 ?>
 <div id="comments">
diff --git a/modules/comment/comment.info b/modules/comment/comment.info
index 8ec478a..6e29230 100644
--- a/modules/comment/comment.info
+++ b/modules/comment/comment.info
@@ -4,8 +4,8 @@ package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2012-05-02
-version = "6.26"
+; Information added by drupal.org packaging script on 2013-01-16
+version = "6.28"
 project = "drupal"
-datestamp = "1335977158"
+datestamp = "1358370963"
 
diff --git a/modules/comment/comment.install b/modules/comment/comment.install
index b129299..aa696e2 100644
--- a/modules/comment/comment.install
+++ b/modules/comment/comment.install
@@ -67,7 +67,7 @@ function comment_update_6003() {
 }
 
 /**
- * @defgroup updates-6.x-extra Extra system updates for 6.x
+ * @addtogroup updates-6.x-extra
  * @{
  */
 
@@ -91,7 +91,7 @@ function comment_update_6005() {
 }
 
 /**
- * @} End of "defgroup updates-6.x-extra"
+ * @} End of "addtogroup updates-6.x-extra".
  * The next series of updates should start at 7000.
  */
 
diff --git a/modules/comment/comment.module b/modules/comment/comment.module
index 58e9ce6..34c6deb 100644
--- a/modules/comment/comment.module
+++ b/modules/comment/comment.module
@@ -1819,7 +1819,6 @@ function theme_comment_post_forbidden($node) {
  * Process variables for comment-wrapper.tpl.php.
  *
  * @see comment-wrapper.tpl.php
- * @see theme_comment_wrapper()
  */
 function template_preprocess_comment_wrapper(&$variables) {
   // Provide contextual information.
diff --git a/modules/contact/contact.info b/modules/contact/contact.info
index cbc64c4..0062988 100644
--- a/modules/contact/contact.info
+++ b/modules/contact/contact.info
@@ -4,8 +4,8 @@ package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2012-05-02
-version = "6.26"
+; Information added by drupal.org packaging script on 2013-01-16
+version = "6.28"
 project = "drupal"
-datestamp = "1335977158"
+datestamp = "1358370963"
 
diff --git a/modules/dblog/dblog.info b/modules/dblog/dblog.info
index 546934f..5ba8b48 100644
--- a/modules/dblog/dblog.info
+++ b/modules/dblog/dblog.info
@@ -4,8 +4,8 @@ package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2012-05-02
-version = "6.26"
+; Information added by drupal.org packaging script on 2013-01-16
+version = "6.28"
 project = "drupal"
-datestamp = "1335977158"
+datestamp = "1358370963"
 
diff --git a/modules/dblog/dblog.install b/modules/dblog/dblog.install
index 80c4584..f350e51 100644
--- a/modules/dblog/dblog.install
+++ b/modules/dblog/dblog.install
@@ -100,7 +100,7 @@ function dblog_schema() {
 }
 
 /**
- * @defgroup updates-6.x-extra Extra database logging updates for 6.x
+ * @addtogroup updates-6.x-extra
  * @{
  */
 
@@ -114,6 +114,6 @@ function dblog_update_6000() {
 }
 
 /**
- * @} End of "defgroup updates-6.x-extra"
+ * @} End of "addtogroup updates-6.x-extra".
  * The next series of updates should start at 7000.
  */
diff --git a/modules/dblog/dblog.module b/modules/dblog/dblog.module
index 4a1326c..149b3ed 100644
--- a/modules/dblog/dblog.module
+++ b/modules/dblog/dblog.module
@@ -97,7 +97,7 @@ function dblog_init() {
 /**
  * Implementation of hook_cron().
  *
- * Remove expired log messages and flood control events.
+ * Remove expired log messages.
  */
 function dblog_cron() {
   // Cleanup the watchdog table
diff --git a/modules/filter/filter.info b/modules/filter/filter.info
index 6749eac..e2083c4 100644
--- a/modules/filter/filter.info
+++ b/modules/filter/filter.info
@@ -4,8 +4,8 @@ package = Core - required
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2012-05-02
-version = "6.26"
+; Information added by drupal.org packaging script on 2013-01-16
+version = "6.28"
 project = "drupal"
-datestamp = "1335977158"
+datestamp = "1358370963"
 
diff --git a/modules/filter/filter.module b/modules/filter/filter.module
index 49702fe..6ea0537 100644
--- a/modules/filter/filter.module
+++ b/modules/filter/filter.module
@@ -746,7 +746,7 @@ function _filter_url_settings($format) {
 
 /**
  * URL filter. Automatically converts text web addresses (URLs, e-mail addresses,
- * ftp links, etc.) into hyperlinks.
+ * FTP links, etc.) into hyperlinks.
  */
 function _filter_url($text, $format) {
   // Pass length to regexp callback
diff --git a/modules/forum/forum.info b/modules/forum/forum.info
index 7e9066f..d564907 100644
--- a/modules/forum/forum.info
+++ b/modules/forum/forum.info
@@ -6,8 +6,8 @@ package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2012-05-02
-version = "6.26"
+; Information added by drupal.org packaging script on 2013-01-16
+version = "6.28"
 project = "drupal"
-datestamp = "1335977158"
+datestamp = "1358370963"
 
diff --git a/modules/forum/forum.module b/modules/forum/forum.module
index 1b027f3..d656f10 100644
--- a/modules/forum/forum.module
+++ b/modules/forum/forum.module
@@ -690,7 +690,7 @@ function template_preprocess_forums(&$variables) {
       // Check if the current user has the 'create' permission for this node type.
       if (node_access('create', $type)) {
         // Fetch the "General" name of the content type;
-        // Push the link with title and url to the array.
+        // Push the link with title and URL to the array.
         $forum_types[$type] = array('title' => t('Post new @node_type', array('@node_type' => node_get_types('name', $type))), 'href' => 'node/add/'. str_replace('_', '-', $type) .'/'. $variables['tid']);
       }
     }
diff --git a/modules/help/help.info b/modules/help/help.info
index 8a40d64..6c7a908 100644
--- a/modules/help/help.info
+++ b/modules/help/help.info
@@ -4,8 +4,8 @@ package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2012-05-02
-version = "6.26"
+; Information added by drupal.org packaging script on 2013-01-16
+version = "6.28"
 project = "drupal"
-datestamp = "1335977158"
+datestamp = "1358370963"
 
diff --git a/modules/locale/locale.info b/modules/locale/locale.info
index 18854f8..a23a53a 100644
--- a/modules/locale/locale.info
+++ b/modules/locale/locale.info
@@ -4,8 +4,8 @@ package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2012-05-02
-version = "6.26"
+; Information added by drupal.org packaging script on 2013-01-16
+version = "6.28"
 project = "drupal"
-datestamp = "1335977158"
+datestamp = "1358370963"
 
diff --git a/modules/locale/locale.install b/modules/locale/locale.install
index 6bd1fa0..6c04538 100644
--- a/modules/locale/locale.install
+++ b/modules/locale/locale.install
@@ -15,7 +15,7 @@ function locale_install() {
 }
 
 /**
- * @defgroup updates-5.x-to-6.x Locale updates from 5.x to 6.x
+ * @addtogroup updates-5.x-to-6.x
  * @{
  */
 
@@ -221,11 +221,11 @@ function locale_update_6006() {
 }
 
 /**
- * @} End of "defgroup updates-5.x-to-6.x"
+ * @} End of "addtogroup updates-5.x-to-6.x".
  */
 
 /**
- * @defgroup updates-6.x-extra Locale updates for 6.x
+ * @addtogroup updates-6.x-extra
  * @{
  */
 
@@ -239,7 +239,7 @@ function locale_update_6007() {
 }
 
 /**
- * @} End of "defgroup updates-6.x-extra"
+ * @} End of "addtogroup updates-6.x-extra".
  * The next series of updates should start at 7000.
  */
 
diff --git a/modules/menu/menu.info b/modules/menu/menu.info
index ac65620..733dcc9 100644
--- a/modules/menu/menu.info
+++ b/modules/menu/menu.info
@@ -4,8 +4,8 @@ package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2012-05-02
-version = "6.26"
+; Information added by drupal.org packaging script on 2013-01-16
+version = "6.28"
 project = "drupal"
-datestamp = "1335977158"
+datestamp = "1358370963"
 
diff --git a/modules/menu/menu.module b/modules/menu/menu.module
index cfe17b1..ff804d9 100644
--- a/modules/menu/menu.module
+++ b/modules/menu/menu.module
@@ -273,7 +273,6 @@ function menu_block($op = 'list', $delta = 0) {
   if ($op == 'list') {
     $blocks = array();
     foreach ($menus as $name => $title) {
-      // Default "Navigation" block is handled by user.module.
       $blocks[$name]['info'] = check_plain($title);
       // Menu blocks can't be cached because each menu item can have
       // a custom access callback. menu.inc manages its own caching.
diff --git a/modules/node/node.info b/modules/node/node.info
index 067939f..0eedd09 100644
--- a/modules/node/node.info
+++ b/modules/node/node.info
@@ -4,8 +4,8 @@ package = Core - required
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2012-05-02
-version = "6.26"
+; Information added by drupal.org packaging script on 2013-01-16
+version = "6.28"
 project = "drupal"
-datestamp = "1335977158"
+datestamp = "1358370963"
 
diff --git a/modules/node/node.pages.inc b/modules/node/node.pages.inc
index f5bbdfc..5b20004 100644
--- a/modules/node/node.pages.inc
+++ b/modules/node/node.pages.inc
@@ -14,6 +14,9 @@ function node_page_edit($node) {
   return drupal_get_form($node->type .'_node_form', $node);
 }
 
+/**
+ * Page callback: Displays add content links for available content types.
+ */
 function node_add_page() {
   $item = menu_get_item();
   $content = system_admin_menu_block($item);
diff --git a/modules/node/node.tpl.php b/modules/node/node.tpl.php
index 0ae6fd9..0db067c 100644
--- a/modules/node/node.tpl.php
+++ b/modules/node/node.tpl.php
@@ -15,7 +15,7 @@
  * - $links: Themed links like "Read more", "Add new comment", etc. output
  *   from theme_links().
  * - $name: Themed username of node author output from theme_username().
- * - $node_url: Direct url of the current node.
+ * - $node_url: Direct URL of the current node.
  * - $terms: the themed list of taxonomy term links output from theme_links().
  * - $submitted: themed submission information output from
  *   theme_node_submitted().
diff --git a/modules/openid/openid.info b/modules/openid/openid.info
index bd3325d..e5782a3 100644
--- a/modules/openid/openid.info
+++ b/modules/openid/openid.info
@@ -4,8 +4,8 @@ version = VERSION
 package = Core - optional
 core = 6.x
 
-; Information added by drupal.org packaging script on 2012-05-02
-version = "6.26"
+; Information added by drupal.org packaging script on 2013-01-16
+version = "6.28"
 project = "drupal"
-datestamp = "1335977158"
+datestamp = "1358370963"
 
diff --git a/modules/openid/openid.install b/modules/openid/openid.install
index 595310b..0abc24f 100644
--- a/modules/openid/openid.install
+++ b/modules/openid/openid.install
@@ -95,7 +95,7 @@ function openid_schema() {
 }
 
 /**
- * @defgroup updates-6.x-extra Extra openid updates for 6.x
+ * @addtogroup updates-6.x-extra
  * @{
  */
 
@@ -139,6 +139,6 @@ function openid_update_6000() {
 }
 
 /**
- * @} End of "defgroup updates-6.x-extra"
+ * @} End of "addtogroup updates-6.x-extra".
  * The next series of updates should start at 7000.
  */
diff --git a/modules/path/path.info b/modules/path/path.info
index 5af2044..fea1da9 100644
--- a/modules/path/path.info
+++ b/modules/path/path.info
@@ -4,8 +4,8 @@ package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2012-05-02
-version = "6.26"
+; Information added by drupal.org packaging script on 2013-01-16
+version = "6.28"
 project = "drupal"
-datestamp = "1335977158"
+datestamp = "1358370963"
 
diff --git a/modules/php/php.info b/modules/php/php.info
index 419f4b1..608b72a 100644
--- a/modules/php/php.info
+++ b/modules/php/php.info
@@ -4,8 +4,8 @@ package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2012-05-02
-version = "6.26"
+; Information added by drupal.org packaging script on 2013-01-16
+version = "6.28"
 project = "drupal"
-datestamp = "1335977158"
+datestamp = "1358370963"
 
diff --git a/modules/ping/ping.info b/modules/ping/ping.info
index e78f8b7..161828e 100644
--- a/modules/ping/ping.info
+++ b/modules/ping/ping.info
@@ -4,8 +4,8 @@ package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2012-05-02
-version = "6.26"
+; Information added by drupal.org packaging script on 2013-01-16
+version = "6.28"
 project = "drupal"
-datestamp = "1335977158"
+datestamp = "1358370963"
 
diff --git a/modules/poll/poll.info b/modules/poll/poll.info
index 8fa412b..182af0d 100644
--- a/modules/poll/poll.info
+++ b/modules/poll/poll.info
@@ -4,8 +4,8 @@ package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2012-05-02
-version = "6.26"
+; Information added by drupal.org packaging script on 2013-01-16
+version = "6.28"
 project = "drupal"
-datestamp = "1335977158"
+datestamp = "1358370963"
 
diff --git a/modules/profile/profile-wrapper.tpl.php b/modules/profile/profile-wrapper.tpl.php
index 5b10d47..4601b59 100644
--- a/modules/profile/profile-wrapper.tpl.php
+++ b/modules/profile/profile-wrapper.tpl.php
@@ -6,7 +6,7 @@
  * profiles.
  *
  * This template is used when viewing a list of users. It can be a general
- * list for viewing all users with the url of "example.com/profile" or when
+ * list for viewing all users with the URL of "example.com/profile" or when
  * viewing a set of users who share a specific value for a profile such
  * as "example.com/profile/country/belgium".
  *
diff --git a/modules/profile/profile.info b/modules/profile/profile.info
index 8739cd3..1a0e6e2 100644
--- a/modules/profile/profile.info
+++ b/modules/profile/profile.info
@@ -4,8 +4,8 @@ package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2012-05-02
-version = "6.26"
+; Information added by drupal.org packaging script on 2013-01-16
+version = "6.28"
 project = "drupal"
-datestamp = "1335977158"
+datestamp = "1358370963"
 
diff --git a/modules/search/search.info b/modules/search/search.info
index 7712e8a..3363a2a 100644
--- a/modules/search/search.info
+++ b/modules/search/search.info
@@ -4,8 +4,8 @@ package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2012-05-02
-version = "6.26"
+; Information added by drupal.org packaging script on 2013-01-16
+version = "6.28"
 project = "drupal"
-datestamp = "1335977158"
+datestamp = "1358370963"
 
diff --git a/modules/statistics/statistics.info b/modules/statistics/statistics.info
index f7e4b09..53eb7a5 100644
--- a/modules/statistics/statistics.info
+++ b/modules/statistics/statistics.info
@@ -4,8 +4,8 @@ package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2012-05-02
-version = "6.26"
+; Information added by drupal.org packaging script on 2013-01-16
+version = "6.28"
 project = "drupal"
-datestamp = "1335977158"
+datestamp = "1358370963"
 
diff --git a/modules/statistics/statistics.install b/modules/statistics/statistics.install
index 515796a..9103588 100644
--- a/modules/statistics/statistics.install
+++ b/modules/statistics/statistics.install
@@ -118,7 +118,7 @@ function statistics_schema() {
 }
 
 /**
- * @defgroup updates-6.x-extra Extra statistics updates for 6.x
+ * @addtogroup updates-6.x-extra
  * @{
  */
 
@@ -132,6 +132,6 @@ function statistics_update_6000() {
 }
 
 /**
- * @} End of "defgroup updates-6.x-extra"
+ * @} End of "addtogroup updates-6.x-extra".
  * The next series of updates should start at 7000.
  */
diff --git a/modules/syslog/syslog.info b/modules/syslog/syslog.info
index 34f259f..b0f9d0b 100644
--- a/modules/syslog/syslog.info
+++ b/modules/syslog/syslog.info
@@ -4,8 +4,8 @@ package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2012-05-02
-version = "6.26"
+; Information added by drupal.org packaging script on 2013-01-16
+version = "6.28"
 project = "drupal"
-datestamp = "1335977158"
+datestamp = "1358370963"
 
diff --git a/modules/system/system.info b/modules/system/system.info
index c93d07e..dea0e4d 100644
--- a/modules/system/system.info
+++ b/modules/system/system.info
@@ -4,8 +4,8 @@ package = Core - required
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2012-05-02
-version = "6.26"
+; Information added by drupal.org packaging script on 2013-01-16
+version = "6.28"
 project = "drupal"
-datestamp = "1335977158"
+datestamp = "1358370963"
 
diff --git a/modules/system/system.install b/modules/system/system.install
index 9263daa..2421dcb 100644
--- a/modules/system/system.install
+++ b/modules/system/system.install
@@ -1174,7 +1174,7 @@ function system_update_1022() {
 }
 
 /**
- * @} End of "defgroup updates-5.x-extra"
+ * @} End of "defgroup updates-5.x-extra".
  */
 
 /**
@@ -2576,7 +2576,7 @@ function system_update_6047() {
 }
 
 /**
- * @} End of "defgroup updates-5.x-to-6.x"
+ * @} End of "defgroup updates-5.x-to-6.x".
  */
 
 /**
@@ -2713,7 +2713,7 @@ function system_update_6055() {
 }
 
 /**
- * @} End of "defgroup updates-6.x-extra"
+ * @} End of "defgroup updates-6.x-extra".
  * The next series of updates should start at 7000.
  */
 
diff --git a/modules/system/system.module b/modules/system/system.module
index 31e6302..320f51f 100644
--- a/modules/system/system.module
+++ b/modules/system/system.module
@@ -8,7 +8,7 @@
 /**
  * The current system version.
  */
-define('VERSION', '6.26');
+define('VERSION', '6.28');
 
 /**
  * Core API compatibility.
@@ -1208,8 +1208,6 @@ function system_node_type($op, $info) {
  *   - A string containing a Drupal path.
  *   - An associative array with a 'path' key. Additional array values are
  *     passed as the $options parameter to l().
- *   If the 'destination' query parameter is set in the URL when viewing a
- *   confirmation form, that value will be used instead of $path.
  * @param $description
  *   Additional text to display. Defaults to t('This action cannot be undone.').
  * @param $yes
@@ -1959,8 +1957,8 @@ function _system_zonelist() {
 function system_check_http_request() {
   // Try to get the content of the front page via drupal_http_request().
   $result = drupal_http_request(url('', array('absolute' => TRUE)), array(), 'GET', NULL, 0);
-  // We only care that we get a http response - this means that Drupal
-  // can make a http request.
+  // We only care that we get a HTTP response - this means that Drupal
+  // can make a HTTP request.
   $works = isset($result->code) && ($result->code >= 100) && ($result->code < 600);
   variable_set('drupal_http_request_fails', !$works);
   return $works;
diff --git a/modules/taxonomy/taxonomy.info b/modules/taxonomy/taxonomy.info
index bf03a0b..093f279 100644
--- a/modules/taxonomy/taxonomy.info
+++ b/modules/taxonomy/taxonomy.info
@@ -4,8 +4,8 @@ package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2012-05-02
-version = "6.26"
+; Information added by drupal.org packaging script on 2013-01-16
+version = "6.28"
 project = "drupal"
-datestamp = "1335977158"
+datestamp = "1358370963"
 
diff --git a/modules/throttle/throttle.info b/modules/throttle/throttle.info
index f3b9de7..4008f98 100644
--- a/modules/throttle/throttle.info
+++ b/modules/throttle/throttle.info
@@ -4,8 +4,8 @@ package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2012-05-02
-version = "6.26"
+; Information added by drupal.org packaging script on 2013-01-16
+version = "6.28"
 project = "drupal"
-datestamp = "1335977158"
+datestamp = "1358370963"
 
diff --git a/modules/tracker/tracker.info b/modules/tracker/tracker.info
index 8ff8393..5c566ac 100644
--- a/modules/tracker/tracker.info
+++ b/modules/tracker/tracker.info
@@ -5,8 +5,8 @@ package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2012-05-02
-version = "6.26"
+; Information added by drupal.org packaging script on 2013-01-16
+version = "6.28"
 project = "drupal"
-datestamp = "1335977158"
+datestamp = "1358370963"
 
diff --git a/modules/translation/translation.info b/modules/translation/translation.info
index 4fee0e0..bb20257 100644
--- a/modules/translation/translation.info
+++ b/modules/translation/translation.info
@@ -5,8 +5,8 @@ package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2012-05-02
-version = "6.26"
+; Information added by drupal.org packaging script on 2013-01-16
+version = "6.28"
 project = "drupal"
-datestamp = "1335977158"
+datestamp = "1358370963"
 
diff --git a/modules/trigger/trigger.info b/modules/trigger/trigger.info
index 5bdf5e8..caa029a 100644
--- a/modules/trigger/trigger.info
+++ b/modules/trigger/trigger.info
@@ -4,8 +4,8 @@ package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2012-05-02
-version = "6.26"
+; Information added by drupal.org packaging script on 2013-01-16
+version = "6.28"
 project = "drupal"
-datestamp = "1335977158"
+datestamp = "1358370963"
 
diff --git a/modules/update/update.info b/modules/update/update.info
index 55104b5..3e2c815 100644
--- a/modules/update/update.info
+++ b/modules/update/update.info
@@ -4,8 +4,8 @@ version = VERSION
 package = Core - optional
 core = 6.x
 
-; Information added by drupal.org packaging script on 2012-05-02
-version = "6.26"
+; Information added by drupal.org packaging script on 2013-01-16
+version = "6.28"
 project = "drupal"
-datestamp = "1335977158"
+datestamp = "1358370963"
 
diff --git a/modules/upload/upload.info b/modules/upload/upload.info
index 8bb0e44..fca3c62 100644
--- a/modules/upload/upload.info
+++ b/modules/upload/upload.info
@@ -4,8 +4,8 @@ package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2012-05-02
-version = "6.26"
+; Information added by drupal.org packaging script on 2013-01-16
+version = "6.28"
 project = "drupal"
-datestamp = "1335977158"
+datestamp = "1358370963"
 
diff --git a/modules/upload/upload.module b/modules/upload/upload.module
index 3a9e973..ee5b127 100644
--- a/modules/upload/upload.module
+++ b/modules/upload/upload.module
@@ -314,10 +314,10 @@ function upload_nodeapi(&$node, $op, $teaser = NULL) {
       break;
 
     case 'search result':
-      return isset($node->files) && is_array($node->files) ? format_plural(count($node->files), '1 attachment', '@count attachments') : NULL;
+      return isset($node->files) && is_array($node->files) && user_access('view uploaded files') ? format_plural(count($node->files), '1 attachment', '@count attachments') : NULL;
 
     case 'rss item':
-      if (is_array($node->files)) {
+      if (is_array($node->files) && user_access('view uploaded files')) {
         $files = array();
         foreach ($node->files as $file) {
           if ($file->list) {
diff --git a/modules/user/user.admin.inc b/modules/user/user.admin.inc
index eac39df..c84fdbc 100644
--- a/modules/user/user.admin.inc
+++ b/modules/user/user.admin.inc
@@ -5,6 +5,21 @@
  * Admin page callback file for the user module.
  */
 
+/**
+ * Page callback: Generates the appropriate user administration form.
+ *
+ * This function generates the user registration, multiple user cancellation,
+ * or filtered user list admin form, depending on the argument and the POST
+ * form values.
+ *
+ * @param string $callback_arg
+ *   (optional) Indicates which form to build. Defaults to '', which will
+ *   trigger the user filter form. If the POST value 'op' is present, this
+ *   function uses that value as the callback argument.
+ *
+ * @return string
+ *   A renderable form array for the respective request.
+ */
 function user_admin($callback_arg = '') {
   $op = isset($_POST['op']) ? $_POST['op'] : $callback_arg;
 
diff --git a/modules/user/user.info b/modules/user/user.info
index e4b5b8f..2d87a4f 100644
--- a/modules/user/user.info
+++ b/modules/user/user.info
@@ -4,8 +4,8 @@ package = Core - required
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2012-05-02
-version = "6.26"
+; Information added by drupal.org packaging script on 2013-01-16
+version = "6.28"
 project = "drupal"
-datestamp = "1335977158"
+datestamp = "1358370963"
 
diff --git a/modules/user/user.module b/modules/user/user.module
index 406a669..9339c44 100644
--- a/modules/user/user.module
+++ b/modules/user/user.module
@@ -540,7 +540,12 @@ function user_access($string, $account = NULL, $reset = FALSE) {
 /**
  * Checks for usernames blocked by user administration.
  *
- * @return boolean TRUE for blocked users, FALSE for active.
+ * @param $name
+ *   A string containing a name of the user.
+ *
+ * @return
+ *   Object with property 'name' (the user name), if the user is blocked;
+ *   FALSE if the user is not blocked.
  */
 function user_is_blocked($name) {
   $deny = db_fetch_object(db_query("SELECT name FROM {users} WHERE status = 0 AND name = LOWER('%s')", $name));
@@ -599,14 +604,17 @@ function user_search($op = 'search', $keys = NULL, $skip_access_check = FALSE) {
         // Replace wildcards with MySQL/PostgreSQL wildcards.
         $keys = preg_replace('!\*+!', '%', $keys);
         if (user_access('administer users')) {
-          // Administrators can also search in the otherwise private email field.
+          // Administrators can also search in the otherwise private email
+          // field, and they don't need to be restricted to only active users.
           $result = pager_query("SELECT name, uid, mail FROM {users} WHERE LOWER(name) LIKE LOWER('%%%s%%') OR LOWER(mail) LIKE LOWER('%%%s%%')", 15, 0, NULL, $keys, $keys);
           while ($account = db_fetch_object($result)) {
             $find[] = array('title' => $account->name .' ('. $account->mail .')', 'link' => url('user/'. $account->uid, array('absolute' => TRUE)));
           }
         }
         else {
-          $result = pager_query("SELECT name, uid FROM {users} WHERE LOWER(name) LIKE LOWER('%%%s%%')", 15, 0, NULL, $keys);
+          // Regular users can only search via user names, and we do not show
+          // them blocked accounts.
+          $result = pager_query("SELECT name, uid FROM {users} WHERE status = 1 AND LOWER(name) LIKE LOWER('%%%s%%')", 15, 0, NULL, $keys);
           while ($account = db_fetch_object($result)) {
             $find[] = array('title' => $account->name, 'link' => url('user/'. $account->uid, array('absolute' => TRUE)));
           }
diff --git a/profiles/openatrium/build-openatrium.make b/profiles/openatrium/build-openatrium.make
index 20e4275..f8ff707 100644
--- a/profiles/openatrium/build-openatrium.make
+++ b/profiles/openatrium/build-openatrium.make
@@ -8,4 +8,4 @@ includes[] = drupal-org-core.make
 projects[openatrium][type] = "profile"
 projects[openatrium][download][type] = "git"
 projects[openatrium][download][url] = "http://git.drupal.org/project/openatrium.git"
-projects[openatrium][download][tag] = "6.x-1.5"
+projects[openatrium][download][tag] = "6.x-1.7"
diff --git a/profiles/openatrium/drupal-org-core.make b/profiles/openatrium/drupal-org-core.make
index 0f613b0..b033cf8 100644
--- a/profiles/openatrium/drupal-org-core.make
+++ b/profiles/openatrium/drupal-org-core.make
@@ -2,5 +2,5 @@ api = 2
 core = 6.x
 
 projects[drupal][type] = "core"
-projects[drupal][version] = "6.26"
+projects[drupal][version] = "6.28"
 projects[drupal][patch][] = "http://drupal.org/files/robots_txt_rollback.patch"
diff --git a/profiles/openatrium/drupal-org.make b/profiles/openatrium/drupal-org.make
index 3ebb039..75c361d 100644
--- a/profiles/openatrium/drupal-org.make
+++ b/profiles/openatrium/drupal-org.make
@@ -25,13 +25,13 @@ projects[content_profile][subdir] = "contrib"
 projects[content_profile][version] = "1.0"
 
 projects[context][subdir] = "contrib"
-projects[context][version] = "3.0"
+projects[context][version] = "3.1"
 
 projects[crayon][subdir] = "contrib"
 projects[crayon][version] = "1.0-beta3"
 
 projects[ctools][subdir] = "contrib"
-projects[ctools][version] = "1.9"
+projects[ctools][version] = "1.10"
 
 projects[date][subdir] = "contrib"
 projects[date][version] = "2.9"
@@ -46,7 +46,7 @@ projects[features][subdir] = "contrib"
 projects[features][version = "1.1"
 
 projects[feeds][subdir] = "contrib"
-projects[feeds][version] = "1.0-beta12"
+projects[feeds][version] = "1.0-beta13"
 
 projects[data][subdir] = "contrib"
 projects[data][version] = "1.1"
@@ -85,7 +85,7 @@ projects[mailhandler][subdir] = "contrib"
 projects[mailhandler][version] = "1.11"
 
 projects[markdown][subdir] = "contrib"
-projects[markdown][version] = "1.2"
+projects[markdown][version] = "1.3"
 
 projects[messaging][subdir] = "contrib"
 projects[messaging][version] = "2.4"
diff --git a/profiles/openatrium/modules/contrib/context/API.txt b/profiles/openatrium/modules/contrib/context/API.txt
index 8eb9d7c..8b47852 100644
--- a/profiles/openatrium/modules/contrib/context/API.txt
+++ b/profiles/openatrium/modules/contrib/context/API.txt
@@ -1,4 +1,3 @@
-$Id: API.txt,v 1.1.2.2 2010/07/29 14:31:36 yhahn Exp $
 
 Context 3.x API
 ---------------
diff --git a/profiles/openatrium/modules/contrib/context/LICENSE.txt b/profiles/openatrium/modules/contrib/context/LICENSE.txt
index 2c095c8..d159169 100644
--- a/profiles/openatrium/modules/contrib/context/LICENSE.txt
+++ b/profiles/openatrium/modules/contrib/context/LICENSE.txt
@@ -1,274 +1,339 @@
-GNU GENERAL PUBLIC LICENSE
-
-              Version 2, June 1991
-
-Copyright (C) 1989, 1991 Free Software Foundation, Inc. 675 Mass Ave,
-Cambridge, MA 02139, USA. Everyone is permitted to copy and distribute
-verbatim copies of this license document, but changing it is not allowed.
-
-                  Preamble
-
-The licenses for most software are designed to take away your freedom to
-share and change it. By contrast, the GNU General Public License is
-intended to guarantee your freedom to share and change free software--to
-make sure the software is free for all its users. This General Public License
-applies to most of the Free Software Foundation's software and to any other
-program whose authors commit to using it. (Some other Free Software
-Foundation software is covered by the GNU Library General Public License
-instead.) You can apply it to your programs, too.
-
-When we speak of free software, we are referring to freedom, not price. Our
-General Public Licenses are designed to make sure that you have the
-freedom to distribute copies of free software (and charge for this service if
-you wish), that you receive source code or can get it if you want it, that you
-can change the software or use pieces of it in new free programs; and that
-you know you can do these things.
-
-To protect your rights, we need to make restrictions that forbid anyone to
-deny you these rights or to ask you to surrender the rights. These restrictions
-translate to certain responsibilities for you if you distribute copies of the
-software, or if you modify it.
-
-For example, if you distribute copies of such a program, whether gratis or for
-a fee, you must give the recipients all the rights that you have. You must make
-sure that they, too, receive or can get the source code. And you must show
-them these terms so they know their rights.
-
-We protect your rights with two steps: (1) copyright the software, and (2)
-offer you this license which gives you legal permission to copy, distribute
-and/or modify the software.
-
-Also, for each author's protection and ours, we want to make certain that
-everyone understands that there is no warranty for this free software. If the
-software is modified by someone else and passed on, we want its recipients
-to know that what they have is not the original, so that any problems
-introduced by others will not reflect on the original authors' reputations.
-
-Finally, any free program is threatened constantly by software patents. We
-wish to avoid the danger that redistributors of a free program will individually
-obtain patent licenses, in effect making the program proprietary. To prevent
-this, we have made it clear that any patent must be licensed for everyone's
-free use or not licensed at all.
-
-The precise terms and conditions for copying, distribution and modification
-follow.
-
-           GNU GENERAL PUBLIC LICENSE
- TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND
-               MODIFICATION
-
-0. This License applies to any program or other work which contains a notice
-placed by the copyright holder saying it may be distributed under the terms
-of this General Public License. The "Program", below, refers to any such
-program or work, and a "work based on the Program" means either the
-Program or any derivative work under copyright law: that is to say, a work
-containing the Program or a portion of it, either verbatim or with
-modifications and/or translated into another language. (Hereinafter, translation
-is included without limitation in the term "modification".) Each licensee is
-addressed as "you".
-
-Activities other than copying, distribution and modification are not covered
-by this License; they are outside its scope. The act of running the Program is
-not restricted, and the output from the Program is covered only if its contents
-constitute a work based on the Program (independent of having been made
-by running the Program). Whether that is true depends on what the Program
-does.
-
-1. You may copy and distribute verbatim copies of the Program's source
-code as you receive it, in any medium, provided that you conspicuously and
-appropriately publish on each copy an appropriate copyright notice and
-disclaimer of warranty; keep intact all the notices that refer to this License
-and to the absence of any warranty; and give any other recipients of the
-Program a copy of this License along with the Program.
-
-You may charge a fee for the physical act of transferring a copy, and you
-may at your option offer warranty protection in exchange for a fee.
-
-2. You may modify your copy or copies of the Program or any portion of it,
-thus forming a work based on the Program, and copy and distribute such
-modifications or work under the terms of Section 1 above, provided that you
-also meet all of these conditions:
-
-a) You must cause the modified files to carry prominent notices stating that
-you changed the files and the date of any change.
-
-b) You must cause any work that you distribute or publish, that in whole or in
-part contains or is derived from the Program or any part thereof, to be
-licensed as a whole at no charge to all third parties under the terms of this
-License.
-
-c) If the modified program normally reads commands interactively when run,
-you must cause it, when started running for such interactive use in the most
-ordinary way, to print or display an announcement including an appropriate
-copyright notice and a notice that there is no warranty (or else, saying that
-you provide a warranty) and that users may redistribute the program under
-these conditions, and telling the user how to view a copy of this License.
-(Exception: if the Program itself is interactive but does not normally print such
-an announcement, your work based on the Program is not required to print
-an announcement.)
-
-These requirements apply to the modified work as a whole. If identifiable
-sections of that work are not derived from the Program, and can be
-reasonably considered independent and separate works in themselves, then
-this License, and its terms, do not apply to those sections when you distribute
-them as separate works. But when you distribute the same sections as part
-of a whole which is a work based on the Program, the distribution of the
-whole must be on the terms of this License, whose permissions for other
-licensees extend to the entire whole, and thus to each and every part
-regardless of who wrote it.
-
-Thus, it is not the intent of this section to claim rights or contest your rights to
-work written entirely by you; rather, the intent is to exercise the right to
-control the distribution of derivative or collective works based on the
-Program.
+                    GNU GENERAL PUBLIC LICENSE
+                       Version 2, June 1991
+
+ Copyright (C) 1989, 1991 Free Software Foundation, Inc.,
+ 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
+ Everyone is permitted to copy and distribute verbatim copies
+ of this license document, but changing it is not allowed.
+
+                            Preamble
+
+  The licenses for most software are designed to take away your
+freedom to share and change it.  By contrast, the GNU General Public
+License is intended to guarantee your freedom to share and change free
+software--to make sure the software is free for all its users.  This
+General Public License applies to most of the Free Software
+Foundation's software and to any other program whose authors commit to
+using it.  (Some other Free Software Foundation software is covered by
+the GNU Lesser General Public License instead.)  You can apply it to
+your programs, too.
+
+  When we speak of free software, we are referring to freedom, not
+price.  Our General Public Licenses are designed to make sure that you
+have the freedom to distribute copies of free software (and charge for
+this service if you wish), that you receive source code or can get it
+if you want it, that you can change the software or use pieces of it
+in new free programs; and that you know you can do these things.
+
+  To protect your rights, we need to make restrictions that forbid
+anyone to deny you these rights or to ask you to surrender the rights.
+These restrictions translate to certain responsibilities for you if you
+distribute copies of the software, or if you modify it.
+
+  For example, if you distribute copies of such a program, whether
+gratis or for a fee, you must give the recipients all the rights that
+you have.  You must make sure that they, too, receive or can get the
+source code.  And you must show them these terms so they know their
+rights.
+
+  We protect your rights with two steps: (1) copyright the software, and
+(2) offer you this license which gives you legal permission to copy,
+distribute and/or modify the software.
+
+  Also, for each author's protection and ours, we want to make certain
+that everyone understands that there is no warranty for this free
+software.  If the software is modified by someone else and passed on, we
+want its recipients to know that what they have is not the original, so
+that any problems introduced by others will not reflect on the original
+authors' reputations.
+
+  Finally, any free program is threatened constantly by software
+patents.  We wish to avoid the danger that redistributors of a free
+program will individually obtain patent licenses, in effect making the
+program proprietary.  To prevent this, we have made it clear that any
+patent must be licensed for everyone's free use or not licensed at all.
+
+  The precise terms and conditions for copying, distribution and
+modification follow.
+
+                    GNU GENERAL PUBLIC LICENSE
+   TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION
+
+  0. This License applies to any program or other work which contains
+a notice placed by the copyright holder saying it may be distributed
+under the terms of this General Public License.  The "Program", below,
+refers to any such program or work, and a "work based on the Program"
+means either the Program or any derivative work under copyright law:
+that is to say, a work containing the Program or a portion of it,
+either verbatim or with modifications and/or translated into another
+language.  (Hereinafter, translation is included without limitation in
+the term "modification".)  Each licensee is addressed as "you".
+
+Activities other than copying, distribution and modification are not
+covered by this License; they are outside its scope.  The act of
+running the Program is not restricted, and the output from the Program
+is covered only if its contents constitute a work based on the
+Program (independent of having been made by running the Program).
+Whether that is true depends on what the Program does.
+
+  1. You may copy and distribute verbatim copies of the Program's
+source code as you receive it, in any medium, provided that you
+conspicuously and appropriately publish on each copy an appropriate
+copyright notice and disclaimer of warranty; keep intact all the
+notices that refer to this License and to the absence of any warranty;
+and give any other recipients of the Program a copy of this License
+along with the Program.
+
+You may charge a fee for the physical act of transferring a copy, and
+you may at your option offer warranty protection in exchange for a fee.
+
+  2. You may modify your copy or copies of the Program or any portion
+of it, thus forming a work based on the Program, and copy and
+distribute such modifications or work under the terms of Section 1
+above, provided that you also meet all of these conditions:
+
+    a) You must cause the modified files to carry prominent notices
+    stating that you changed the files and the date of any change.
+
+    b) You must cause any work that you distribute or publish, that in
+    whole or in part contains or is derived from the Program or any
+    part thereof, to be licensed as a whole at no charge to all third
+    parties under the terms of this License.
+
+    c) If the modified program normally reads commands interactively
+    when run, you must cause it, when started running for such
+    interactive use in the most ordinary way, to print or display an
+    announcement including an appropriate copyright notice and a
+    notice that there is no warranty (or else, saying that you provide
+    a warranty) and that users may redistribute the program under
+    these conditions, and telling the user how to view a copy of this
+    License.  (Exception: if the Program itself is interactive but
+    does not normally print such an announcement, your work based on
+    the Program is not required to print an announcement.)
+
+These requirements apply to the modified work as a whole.  If
+identifiable sections of that work are not derived from the Program,
+and can be reasonably considered independent and separate works in
+themselves, then this License, and its terms, do not apply to those
+sections when you distribute them as separate works.  But when you
+distribute the same sections as part of a whole which is a work based
+on the Program, the distribution of the whole must be on the terms of
+this License, whose permissions for other licensees extend to the
+entire whole, and thus to each and every part regardless of who wrote it.
+
+Thus, it is not the intent of this section to claim rights or contest
+your rights to work written entirely by you; rather, the intent is to
+exercise the right to control the distribution of derivative or
+collective works based on the Program.
 
 In addition, mere aggregation of another work not based on the Program
-with the Program (or with a work based on the Program) on a volume of a
-storage or distribution medium does not bring the other work under the scope
-of this License.
-
-3. You may copy and distribute the Program (or a work based on it, under
-Section 2) in object code or executable form under the terms of Sections 1
-and 2 above provided that you also do one of the following:
-
-a) Accompany it with the complete corresponding machine-readable source
-code, which must be distributed under the terms of Sections 1 and 2 above
-on a medium customarily used for software interchange; or,
-
-b) Accompany it with a written offer, valid for at least three years, to give
-any third party, for a charge no more than your cost of physically performing
-source distribution, a complete machine-readable copy of the corresponding
-source code, to be distributed under the terms of Sections 1 and 2 above on
-a medium customarily used for software interchange; or,
-
-c) Accompany it with the information you received as to the offer to distribute
-corresponding source code. (This alternative is allowed only for
-noncommercial distribution and only if you received the program in object
-code or executable form with such an offer, in accord with Subsection b
-above.)
+with the Program (or with a work based on the Program) on a volume of
+a storage or distribution medium does not bring the other work under
+the scope of this License.
+
+  3. You may copy and distribute the Program (or a work based on it,
+under Section 2) in object code or executable form under the terms of
+Sections 1 and 2 above provided that you also do one of the following:
+
+    a) Accompany it with the complete corresponding machine-readable
+    source code, which must be distributed under the terms of Sections
+    1 and 2 above on a medium customarily used for software interchange; or,
+
+    b) Accompany it with a written offer, valid for at least three
+    years, to give any third party, for a charge no more than your
+    cost of physically performing source distribution, a complete
+    machine-readable copy of the corresponding source code, to be
+    distributed under the terms of Sections 1 and 2 above on a medium
+    customarily used for software interchange; or,
+
+    c) Accompany it with the information you received as to the offer
+    to distribute corresponding source code.  (This alternative is
+    allowed only for noncommercial distribution and only if you
+    received the program in object code or executable form with such
+    an offer, in accord with Subsection b above.)
 
 The source code for a work means the preferred form of the work for
-making modifications to it. For an executable work, complete source code
-means all the source code for all modules it contains, plus any associated
-interface definition files, plus the scripts used to control compilation and
-installation of the executable. However, as a special exception, the source
-code distributed need not include anything that is normally distributed (in
-either source or binary form) with the major components (compiler, kernel,
-and so on) of the operating system on which the executable runs, unless that
-component itself accompanies the executable.
-
-If distribution of executable or object code is made by offering access to
-copy from a designated place, then offering equivalent access to copy the
-source code from the same place counts as distribution of the source code,
-even though third parties are not compelled to copy the source along with the
-object code.
-
-4. You may not copy, modify, sublicense, or distribute the Program except as
-expressly provided under this License. Any attempt otherwise to copy,
-modify, sublicense or distribute the Program is void, and will automatically
-terminate your rights under this License. However, parties who have received
-copies, or rights, from you under this License will not have their licenses
-terminated so long as such parties remain in full compliance.
-
-5. You are not required to accept this License, since you have not signed it.
-However, nothing else grants you permission to modify or distribute the
-Program or its derivative works. These actions are prohibited by law if you
-do not accept this License. Therefore, by modifying or distributing the
-Program (or any work based on the Program), you indicate your acceptance
-of this License to do so, and all its terms and conditions for copying,
-distributing or modifying the Program or works based on it.
-
-6. Each time you redistribute the Program (or any work based on the
-Program), the recipient automatically receives a license from the original
-licensor to copy, distribute or modify the Program subject to these terms and
-conditions. You may not impose any further restrictions on the recipients'
-exercise of the rights granted herein. You are not responsible for enforcing
-compliance by third parties to this License.
-
-7. If, as a consequence of a court judgment or allegation of patent
-infringement or for any other reason (not limited to patent issues), conditions
-are imposed on you (whether by court order, agreement or otherwise) that
-contradict the conditions of this License, they do not excuse you from the
-conditions of this License. If you cannot distribute so as to satisfy
-simultaneously your obligations under this License and any other pertinent
-obligations, then as a consequence you may not distribute the Program at all.
-For example, if a patent license would not permit royalty-free redistribution
-of the Program by all those who receive copies directly or indirectly through
-you, then the only way you could satisfy both it and this License would be to
+making modifications to it.  For an executable work, complete source
+code means all the source code for all modules it contains, plus any
+associated interface definition files, plus the scripts used to
+control compilation and installation of the executable.  However, as a
+special exception, the source code distributed need not include
+anything that is normally distributed (in either source or binary
+form) with the major components (compiler, kernel, and so on) of the
+operating system on which the executable runs, unless that component
+itself accompanies the executable.
+
+If distribution of executable or object code is made by offering
+access to copy from a designated place, then offering equivalent
+access to copy the source code from the same place counts as
+distribution of the source code, even though third parties are not
+compelled to copy the source along with the object code.
+
+  4. You may not copy, modify, sublicense, or distribute the Program
+except as expressly provided under this License.  Any attempt
+otherwise to copy, modify, sublicense or distribute the Program is
+void, and will automatically terminate your rights under this License.
+However, parties who have received copies, or rights, from you under
+this License will not have their licenses terminated so long as such
+parties remain in full compliance.
+
+  5. You are not required to accept this License, since you have not
+signed it.  However, nothing else grants you permission to modify or
+distribute the Program or its derivative works.  These actions are
+prohibited by law if you do not accept this License.  Therefore, by
+modifying or distributing the Program (or any work based on the
+Program), you indicate your acceptance of this License to do so, and
+all its terms and conditions for copying, distributing or modifying
+the Program or works based on it.
+
+  6. Each time you redistribute the Program (or any work based on the
+Program), the recipient automatically receives a license from the
+original licensor to copy, distribute or modify the Program subject to
+these terms and conditions.  You may not impose any further
+restrictions on the recipients' exercise of the rights granted herein.
+You are not responsible for enforcing compliance by third parties to
+this License.
+
+  7. If, as a consequence of a court judgment or allegation of patent
+infringement or for any other reason (not limited to patent issues),
+conditions are imposed on you (whether by court order, agreement or
+otherwise) that contradict the conditions of this License, they do not
+excuse you from the conditions of this License.  If you cannot
+distribute so as to satisfy simultaneously your obligations under this
+License and any other pertinent obligations, then as a consequence you
+may not distribute the Program at all.  For example, if a patent
+license would not permit royalty-free redistribution of the Program by
+all those who receive copies directly or indirectly through you, then
+the only way you could satisfy both it and this License would be to
 refrain entirely from distribution of the Program.
 
-If any portion of this section is held invalid or unenforceable under any
-particular circumstance, the balance of the section is intended to apply and
-the section as a whole is intended to apply in other circumstances.
-
-It is not the purpose of this section to induce you to infringe any patents or
-other property right claims or to contest validity of any such claims; this
-section has the sole purpose of protecting the integrity of the free software
-distribution system, which is implemented by public license practices. Many
-people have made generous contributions to the wide range of software
-distributed through that system in reliance on consistent application of that
-system; it is up to the author/donor to decide if he or she is willing to
-distribute software through any other system and a licensee cannot impose
-that choice.
-
-This section is intended to make thoroughly clear what is believed to be a
-consequence of the rest of this License.
-
-8. If the distribution and/or use of the Program is restricted in certain
-countries either by patents or by copyrighted interfaces, the original copyright
-holder who places the Program under this License may add an explicit
-geographical distribution limitation excluding those countries, so that
-distribution is permitted only in or among countries not thus excluded. In such
-case, this License incorporates the limitation as if written in the body of this
-License.
-
-9. The Free Software Foundation may publish revised and/or new versions
-of the General Public License from time to time. Such new versions will be
-similar in spirit to the present version, but may differ in detail to address new
-problems or concerns.
-
-Each version is given a distinguishing version number. If the Program specifies
-a version number of this License which applies to it and "any later version",
-you have the option of following the terms and conditions either of that
-version or of any later version published by the Free Software Foundation. If
-the Program does not specify a version number of this License, you may
-choose any version ever published by the Free Software Foundation.
-
-10. If you wish to incorporate parts of the Program into other free programs
-whose distribution conditions are different, write to the author to ask for
-permission. For software which is copyrighted by the Free Software
-Foundation, write to the Free Software Foundation; we sometimes make
-exceptions for this. Our decision will be guided by the two goals of
-preserving the free status of all derivatives of our free software and of
-promoting the sharing and reuse of software generally.
-
-               NO WARRANTY
-
-11. BECAUSE THE PROGRAM IS LICENSED FREE OF CHARGE,
-THERE IS NO WARRANTY FOR THE PROGRAM, TO THE EXTENT
-PERMITTED BY APPLICABLE LAW. EXCEPT WHEN OTHERWISE
-STATED IN WRITING THE COPYRIGHT HOLDERS AND/OR
-OTHER PARTIES PROVIDE THE PROGRAM "AS IS" WITHOUT
-WARRANTY OF ANY KIND, EITHER EXPRESSED OR IMPLIED,
-INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
-OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
-PURPOSE. THE ENTIRE RISK AS TO THE QUALITY AND
-PERFORMANCE OF THE PROGRAM IS WITH YOU. SHOULD THE
-PROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF ALL
-NECESSARY SERVICING, REPAIR OR CORRECTION.
-
-12. IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR
-AGREED TO IN WRITING WILL ANY COPYRIGHT HOLDER, OR
-ANY OTHER PARTY WHO MAY MODIFY AND/OR
-REDISTRIBUTE THE PROGRAM AS PERMITTED ABOVE, BE
-LIABLE TO YOU FOR DAMAGES, INCLUDING ANY GENERAL,
-SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES
-ARISING OUT OF THE USE OR INABILITY TO USE THE
-PROGRAM (INCLUDING BUT NOT LIMITED TO LOSS OF DATA
-OR DATA BEING RENDERED INACCURATE OR LOSSES
-SUSTAINED BY YOU OR THIRD PARTIES OR A FAILURE OF THE
-PROGRAM TO OPERATE WITH ANY OTHER PROGRAMS), EVEN
-IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF
-THE POSSIBILITY OF SUCH DAMAGES.
-
-          END OF TERMS AND CONDITIONS
+If any portion of this section is held invalid or unenforceable under
+any particular circumstance, the balance of the section is intended to
+apply and the section as a whole is intended to apply in other
+circumstances.
+
+It is not the purpose of this section to induce you to infringe any
+patents or other property right claims or to contest validity of any
+such claims; this section has the sole purpose of protecting the
+integrity of the free software distribution system, which is
+implemented by public license practices.  Many people have made
+generous contributions to the wide range of software distributed
+through that system in reliance on consistent application of that
+system; it is up to the author/donor to decide if he or she is willing
+to distribute software through any other system and a licensee cannot
+impose that choice.
+
+This section is intended to make thoroughly clear what is believed to
+be a consequence of the rest of this License.
+
+  8. If the distribution and/or use of the Program is restricted in
+certain countries either by patents or by copyrighted interfaces, the
+original copyright holder who places the Program under this License
+may add an explicit geographical distribution limitation excluding
+those countries, so that distribution is permitted only in or among
+countries not thus excluded.  In such case, this License incorporates
+the limitation as if written in the body of this License.
+
+  9. The Free Software Foundation may publish revised and/or new versions
+of the General Public License from time to time.  Such new versions will
+be similar in spirit to the present version, but may differ in detail to
+address new problems or concerns.
+
+Each version is given a distinguishing version number.  If the Program
+specifies a version number of this License which applies to it and "any
+later version", you have the option of following the terms and conditions
+either of that version or of any later version published by the Free
+Software Foundation.  If the Program does not specify a version number of
+this License, you may choose any version ever published by the Free Software
+Foundation.
+
+  10. If you wish to incorporate parts of the Program into other free
+programs whose distribution conditions are different, write to the author
+to ask for permission.  For software which is copyrighted by the Free
+Software Foundation, write to the Free Software Foundation; we sometimes
+make exceptions for this.  Our decision will be guided by the two goals
+of preserving the free status of all derivatives of our free software and
+of promoting the sharing and reuse of software generally.
+
+                            NO WARRANTY
+
+  11. BECAUSE THE PROGRAM IS LICENSED FREE OF CHARGE, THERE IS NO WARRANTY
+FOR THE PROGRAM, TO THE EXTENT PERMITTED BY APPLICABLE LAW.  EXCEPT WHEN
+OTHERWISE STATED IN WRITING THE COPYRIGHT HOLDERS AND/OR OTHER PARTIES
+PROVIDE THE PROGRAM "AS IS" WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED
+OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  THE ENTIRE RISK AS
+TO THE QUALITY AND PERFORMANCE OF THE PROGRAM IS WITH YOU.  SHOULD THE
+PROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF ALL NECESSARY SERVICING,
+REPAIR OR CORRECTION.
+
+  12. IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING
+WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MAY MODIFY AND/OR
+REDISTRIBUTE THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES,
+INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES ARISING
+OUT OF THE USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT NOT LIMITED
+TO LOSS OF DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY
+YOU OR THIRD PARTIES OR A FAILURE OF THE PROGRAM TO OPERATE WITH ANY OTHER
+PROGRAMS), EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE
+POSSIBILITY OF SUCH DAMAGES.
+
+                     END OF TERMS AND CONDITIONS
+
+            How to Apply These Terms to Your New Programs
+
+  If you develop a new program, and you want it to be of the greatest
+possible use to the public, the best way to achieve this is to make it
+free software which everyone can redistribute and change under these terms.
+
+  To do so, attach the following notices to the program.  It is safest
+to attach them to the start of each source file to most effectively
+convey the exclusion of warranty; and each file should have at least
+the "copyright" line and a pointer to where the full notice is found.
+
+    <one line to give the program's name and a brief idea of what it does.>
+    Copyright (C) <year>  <name of author>
+
+    This program is free software; you can redistribute it and/or modify
+    it under the terms of the GNU General Public License as published by
+    the Free Software Foundation; either version 2 of the License, or
+    (at your option) any later version.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License along
+    with this program; if not, write to the Free Software Foundation, Inc.,
+    51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
+
+Also add information on how to contact you by electronic and paper mail.
+
+If the program is interactive, make it output a short notice like this
+when it starts in an interactive mode:
+
+    Gnomovision version 69, Copyright (C) year name of author
+    Gnomovision comes with ABSOLUTELY NO WARRANTY; for details type `show w'.
+    This is free software, and you are welcome to redistribute it
+    under certain conditions; type `show c' for details.
+
+The hypothetical commands `show w' and `show c' should show the appropriate
+parts of the General Public License.  Of course, the commands you use may
+be called something other than `show w' and `show c'; they could even be
+mouse-clicks or menu items--whatever suits your program.
+
+You should also get your employer (if you work as a programmer) or your
+school, if any, to sign a "copyright disclaimer" for the program, if
+necessary.  Here is a sample; alter the names:
+
+  Yoyodyne, Inc., hereby disclaims all copyright interest in the program
+  `Gnomovision' (which makes passes at compilers) written by James Hacker.
+
+  <signature of Ty Coon>, 1 April 1989
+  Ty Coon, President of Vice
+
+This General Public License does not permit incorporating your program into
+proprietary programs.  If your program is a subroutine library, you may
+consider it more useful to permit linking proprietary applications with the
+library.  If this is what you want to do, use the GNU Lesser General
+Public License instead of this License.
diff --git a/profiles/openatrium/modules/contrib/context/README.txt b/profiles/openatrium/modules/contrib/context/README.txt
index 85eefe4..3d8cb15 100644
--- a/profiles/openatrium/modules/contrib/context/README.txt
+++ b/profiles/openatrium/modules/contrib/context/README.txt
@@ -1,4 +1,3 @@
-$Id: README.txt,v 1.1.4.2.2.7 2010/08/23 17:15:00 yhahn Exp $
 
 Context 3.x for Drupal 6.x
 --------------------------
diff --git a/profiles/openatrium/modules/contrib/context/context.api.php b/profiles/openatrium/modules/contrib/context/context.api.php
index 8fe0502..03f0563 100644
--- a/profiles/openatrium/modules/contrib/context/context.api.php
+++ b/profiles/openatrium/modules/contrib/context/context.api.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: context.api.php,v 1.1.2.4 2010/07/29 16:24:04 yhahn Exp $
 
 /**
  * @file
diff --git a/profiles/openatrium/modules/contrib/context/context.core.inc b/profiles/openatrium/modules/contrib/context/context.core.inc
index 62b1a25..f169b6f 100644
--- a/profiles/openatrium/modules/contrib/context/context.core.inc
+++ b/profiles/openatrium/modules/contrib/context/context.core.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: context.core.inc,v 1.1.2.3.2.20.2.29 2010/08/05 08:03:29 yhahn Exp $
 
 /**
  * Implementation of hook_help().
@@ -145,6 +144,7 @@ function context_form_alter(&$form, $form_state, $form_id) {
   // Prevent this from firing on admin pages... damn form driven apis...
   if ($form['#id'] === 'node-form' && arg(0) != 'admin') {
     context_node_condition($form['#node'], 'form');
+    $form['#validate'][] = 'context_form_alter_node_validate';
   }
   else if ($form_id == 'system_modules') {
     context_invalidate_cache();
@@ -183,6 +183,16 @@ function context_node_condition(&$node, $op) {
 }
 
 /**
+ * Node form validation callback.
+ *
+ * Set context also on validate, otherwise forms that don't validate drop out
+ * of context.
+ */
+function context_form_alter_node_validate($form, &$form_state) {
+  context_node_condition($form['#node'], 'form');
+}
+
+/**
  * Implementation of hook_form_alter() for comment_form.
  */
 function context_form_comment_form_alter(&$form, $form_state) {
diff --git a/profiles/openatrium/modules/contrib/context/context.info b/profiles/openatrium/modules/contrib/context/context.info
index d48816e..8b624a5 100644
--- a/profiles/openatrium/modules/contrib/context/context.info
+++ b/profiles/openatrium/modules/contrib/context/context.info
@@ -1,13 +1,12 @@
-; $Id: context.info,v 1.4.6.1 2009/12/14 22:34:04 yhahn Exp $
 name = "Context"
 dependencies[] = "ctools"
 description = "Provide modules with a cache that lasts for a single page request."
 package = "Context"
 core = "6.x"
 
-; Information added by drupal.org packaging script on 2010-08-23
-version = "6.x-3.0"
+; Information added by drupal.org packaging script on 2012-12-19
+version = "6.x-3.1"
 core = "6.x"
 project = "context"
-datestamp = "1282588006"
+datestamp = "1355940699"
 
diff --git a/profiles/openatrium/modules/contrib/context/context.install b/profiles/openatrium/modules/contrib/context/context.install
index 8811c75..b1af4b1 100644
--- a/profiles/openatrium/modules/contrib/context/context.install
+++ b/profiles/openatrium/modules/contrib/context/context.install
@@ -1,5 +1,4 @@
 <?php
-// $Id: context.install,v 1.1.2.1.2.6.2.9 2010/08/23 18:19:17 yhahn Exp $
 
 /**
  * Implementation of hook_install().
diff --git a/profiles/openatrium/modules/contrib/context/context.module b/profiles/openatrium/modules/contrib/context/context.module
index a94cd8e..0d31b80 100644
--- a/profiles/openatrium/modules/contrib/context/context.module
+++ b/profiles/openatrium/modules/contrib/context/context.module
@@ -1,5 +1,4 @@
 <?php
-// $Id: context.module,v 1.6.2.6.2.6.2.25 2010/08/06 17:56:50 yhahn Exp $
 
 require('context.core.inc');
 
@@ -388,6 +387,7 @@ function context_condition_map($reset = FALSE) {
       $condition_map = $cache;
     }
     else {
+      $condition_map = array();
       foreach (array_keys(context_conditions()) as $condition) {
         if ($plugin = context_get_plugin('condition', $condition)) {
           foreach (context_enabled_contexts() as $context) {
diff --git a/profiles/openatrium/modules/contrib/context/context.plugins.inc b/profiles/openatrium/modules/contrib/context/context.plugins.inc
index 5089681..54763f5 100644
--- a/profiles/openatrium/modules/contrib/context/context.plugins.inc
+++ b/profiles/openatrium/modules/contrib/context/context.plugins.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: context.plugins.inc,v 1.1.2.8 2010/07/30 18:15:36 yhahn Exp $
 
 /**
  * Context registry.
@@ -37,12 +36,14 @@ function _context_context_registry() {
       'description' => t('Set this context when viewing a user page.'),
       'plugin' => 'context_condition_user_page',
     ),
-    'menu' => array(
+  );
+  if (module_exists('menu')) {
+    $registry['conditions']['menu'] = array(
       'title' => t('Menu'),
       'description' => t('Set this context when any of the selected menu items belong to the current active menu trail.'),
       'plugin' => 'context_condition_menu',
-    ),
-  );
+    );
+  }
   if (module_exists('views')) {
     $registry['conditions']['views'] = array(
       'title' => t('Views'),
@@ -87,11 +88,6 @@ function _context_context_registry() {
       'description' => t('Set the breadcrumb trail to the selected menu item.'),
       'plugin' => 'context_reaction_breadcrumb',
     ),
-    'menu' => array(
-      'title' => t('Menu'),
-      'description' => t('Control menu active class using context.'),
-      'plugin' => 'context_reaction_menu',
-    ),
     'theme' => array(
       'title' => t('Theme'),
       'description' => t('Control theme variables using context.'),
@@ -103,6 +99,13 @@ function _context_context_registry() {
       'plugin' => 'context_reaction_debug',
     ),
   );
+  if (module_exists('menu')) {
+    $registry['reactions']['menu'] = array(
+      'title' => t('Menu'),
+      'description' => t('Control menu active class using context.'),
+      'plugin' => 'context_reaction_menu',
+    );
+  }
   if (module_exists('css_injector')) {
     $registry['reactions']['css_injector'] = array(
       'title' => t('CSS Injector'),
diff --git a/profiles/openatrium/modules/contrib/context/context_layouts/README.txt b/profiles/openatrium/modules/contrib/context/context_layouts/README.txt
index a302211..4b3c694 100644
--- a/profiles/openatrium/modules/contrib/context/context_layouts/README.txt
+++ b/profiles/openatrium/modules/contrib/context/context_layouts/README.txt
@@ -1,4 +1,3 @@
-$Id: README.txt,v 1.1.2.1 2010/02/09 19:02:59 yhahn Exp $
 
 Context layouts
 ---------------
diff --git a/profiles/openatrium/modules/contrib/context/context_layouts/context_layouts.info b/profiles/openatrium/modules/contrib/context/context_layouts/context_layouts.info
index ad18486..6d54b6b 100644
--- a/profiles/openatrium/modules/contrib/context/context_layouts/context_layouts.info
+++ b/profiles/openatrium/modules/contrib/context/context_layouts/context_layouts.info
@@ -1,13 +1,12 @@
-; $Id: context_layouts.info,v 1.1.2.1 2009/12/14 22:34:04 yhahn Exp $
 name = "Context layouts"
 description = "Allow theme layer to provide multiple region layouts and integrate with context."
 dependencies[] = "context"
 package = "Context"
 core = "6.x"
 
-; Information added by drupal.org packaging script on 2010-08-23
-version = "6.x-3.0"
+; Information added by drupal.org packaging script on 2012-12-19
+version = "6.x-3.1"
 core = "6.x"
 project = "context"
-datestamp = "1282588006"
+datestamp = "1355940699"
 
diff --git a/profiles/openatrium/modules/contrib/context/context_layouts/context_layouts.module b/profiles/openatrium/modules/contrib/context/context_layouts/context_layouts.module
index b171539..ad24f7a 100644
--- a/profiles/openatrium/modules/contrib/context/context_layouts/context_layouts.module
+++ b/profiles/openatrium/modules/contrib/context/context_layouts/context_layouts.module
@@ -1,5 +1,4 @@
 <?php
-// $Id: context_layouts.module,v 1.1.2.6 2010/08/05 08:03:29 yhahn Exp $ 
 
 /**
  * Implementation of hook_help().
@@ -53,7 +52,7 @@ function context_layouts_context_page_reaction() {
  */
 function context_layouts_preprocess_page(&$vars) {
   $plugin = context_get_plugin('reaction', 'block');
-  if ($plugin && method_exists($plugin, 'add_layout_stylesheet')) {
+  if ($plugin && method_exists($plugin, 'add_layout_template')) {
     $plugin->add_layout_template($vars);
   }
 }
@@ -103,7 +102,7 @@ function context_layouts_get_layouts($theme = NULL, $reset = FALSE) {
  */
 function context_layouts_get_active_layout($info = TRUE) {
   $plugin = context_get_plugin('reaction', 'block');
-  if ($plugin && method_exists($plugin, 'add_layout_stylesheet')) {
+  if ($plugin && method_exists($plugin, 'get_active_layout')) {
     return $plugin->get_active_layout($info);
   }
 }
diff --git a/profiles/openatrium/modules/contrib/context/context_layouts/plugins/context_layouts_reaction_block.inc b/profiles/openatrium/modules/contrib/context/context_layouts/plugins/context_layouts_reaction_block.inc
index 216a74c..000ea32 100644
--- a/profiles/openatrium/modules/contrib/context/context_layouts/plugins/context_layouts_reaction_block.inc
+++ b/profiles/openatrium/modules/contrib/context/context_layouts/plugins/context_layouts_reaction_block.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: context_layouts_reaction_block.inc,v 1.1.2.5 2010/07/28 22:56:06 yhahn Exp $
 
 class context_layouts_reaction_block extends context_reaction_block {
   /**
diff --git a/profiles/openatrium/modules/contrib/context/context_layouts/plugins/context_layouts_reaction_block.js b/profiles/openatrium/modules/contrib/context/context_layouts/plugins/context_layouts_reaction_block.js
index fc55fe5..2361d58 100644
--- a/profiles/openatrium/modules/contrib/context/context_layouts/plugins/context_layouts_reaction_block.js
+++ b/profiles/openatrium/modules/contrib/context/context_layouts/plugins/context_layouts_reaction_block.js
@@ -1,4 +1,3 @@
-// $Id: context_layouts_reaction_block.js,v 1.1.2.1 2009/12/14 22:36:12 yhahn Exp $
 
 Drupal.behaviors.contextLayoutsReactionBlock = function(context) {
   // ContextBlockForm: Init.
diff --git a/profiles/openatrium/modules/contrib/context/context_ui/README.txt b/profiles/openatrium/modules/contrib/context/context_ui/README.txt
index 5033b7b..fa1795d 100644
--- a/profiles/openatrium/modules/contrib/context/context_ui/README.txt
+++ b/profiles/openatrium/modules/contrib/context/context_ui/README.txt
@@ -1,4 +1,3 @@
-$Id: README.txt,v 1.1.4.3 2010/02/09 20:20:19 yhahn Exp $
 
 Context UI
 ----------
diff --git a/profiles/openatrium/modules/contrib/context/context_ui/context_ui.info b/profiles/openatrium/modules/contrib/context/context_ui/context_ui.info
index 62e12d5..2d24abc 100644
--- a/profiles/openatrium/modules/contrib/context/context_ui/context_ui.info
+++ b/profiles/openatrium/modules/contrib/context/context_ui/context_ui.info
@@ -1,12 +1,11 @@
-; $Id: context_ui.info,v 1.3 2008/07/17 16:57:19 jmiccolis Exp $
 name = Context UI
 description = "Provides a simple UI for settings up a site structure using Context."
 dependencies[] = context
 package = Context
 core = "6.x"
-; Information added by drupal.org packaging script on 2010-08-23
-version = "6.x-3.0"
+; Information added by drupal.org packaging script on 2012-12-19
+version = "6.x-3.1"
 core = "6.x"
 project = "context"
-datestamp = "1282588006"
+datestamp = "1355940699"
 
diff --git a/profiles/openatrium/modules/contrib/context/context_ui/context_ui.install b/profiles/openatrium/modules/contrib/context/context_ui/context_ui.install
index dc685c0..8e22dc4 100644
--- a/profiles/openatrium/modules/contrib/context/context_ui/context_ui.install
+++ b/profiles/openatrium/modules/contrib/context/context_ui/context_ui.install
@@ -1,5 +1,4 @@
 <?php
-// $Id: context_ui.install,v 1.4.2.10.2.3 2009/09/01 02:34:31 yhahn Exp $
 
 /**
  * Update 6004: Placeholder update to ensure migrations from older versions
diff --git a/profiles/openatrium/modules/contrib/context/context_ui/context_ui.js b/profiles/openatrium/modules/contrib/context/context_ui/context_ui.js
index 6ef7bb6..f1f785f 100644
--- a/profiles/openatrium/modules/contrib/context/context_ui/context_ui.js
+++ b/profiles/openatrium/modules/contrib/context/context_ui/context_ui.js
@@ -1,4 +1,3 @@
-// $Id: context_ui.js,v 1.3.2.5.2.2.2.3 2010/01/08 23:54:14 yhahn Exp $
 
 /**
  * Context plugin form.
diff --git a/profiles/openatrium/modules/contrib/context/context_ui/context_ui.module b/profiles/openatrium/modules/contrib/context/context_ui/context_ui.module
index 75077b5..d6b0a48 100644
--- a/profiles/openatrium/modules/contrib/context/context_ui/context_ui.module
+++ b/profiles/openatrium/modules/contrib/context/context_ui/context_ui.module
@@ -1,5 +1,4 @@
 <?php
-// $Id: context_ui.module,v 1.13.2.48.2.1.2.19 2010/08/23 16:40:56 yhahn Exp $
 
 /**
  * Implementation of hook_ctools_plugin_directory().
diff --git a/profiles/openatrium/modules/contrib/context/context_ui/export_ui/context.inc b/profiles/openatrium/modules/contrib/context/context_ui/export_ui/context.inc
index c2f02d5..1912a58 100644
--- a/profiles/openatrium/modules/contrib/context/context_ui/export_ui/context.inc
+++ b/profiles/openatrium/modules/contrib/context/context_ui/export_ui/context.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: context.inc,v 1.1.2.1 2010/08/05 16:46:26 yhahn Exp $
 
 $plugin = array(
   'schema' => 'context',
diff --git a/profiles/openatrium/modules/contrib/context/context_ui/export_ui/context_export_ui.class.php b/profiles/openatrium/modules/contrib/context/context_ui/export_ui/context_export_ui.class.php
index 6ad60c7..5fdd1cd 100644
--- a/profiles/openatrium/modules/contrib/context/context_ui/export_ui/context_export_ui.class.php
+++ b/profiles/openatrium/modules/contrib/context/context_ui/export_ui/context_export_ui.class.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: context_export_ui.class.php,v 1.1.2.5 2010/08/11 15:57:28 yhahn Exp $
 
 /**
  * CTools export UI extending class. Slightly customized for Context.
diff --git a/profiles/openatrium/modules/contrib/context/context_ui/jquery.pageEditor.js b/profiles/openatrium/modules/contrib/context/context_ui/jquery.pageEditor.js
index cdb4d4b..9b1392e 100644
--- a/profiles/openatrium/modules/contrib/context/context_ui/jquery.pageEditor.js
+++ b/profiles/openatrium/modules/contrib/context/context_ui/jquery.pageEditor.js
@@ -1,4 +1,3 @@
-// $Id: jquery.pageEditor.js,v 1.1.2.1 2010/01/08 20:48:22 yhahn Exp $
 
 /**
  * Generic pageEditor plugin. Allows an editor DOM object to trigger
diff --git a/profiles/openatrium/modules/contrib/context/context_ui/tests/context_ui.test b/profiles/openatrium/modules/contrib/context/context_ui/tests/context_ui.test
index 57de1b2..990fd83 100644
--- a/profiles/openatrium/modules/contrib/context/context_ui/tests/context_ui.test
+++ b/profiles/openatrium/modules/contrib/context/context_ui/tests/context_ui.test
@@ -1,5 +1,4 @@
 <?php
-// $Id: context_ui.test,v 1.4.4.1.2.2 2010/08/05 16:46:26 yhahn Exp $
 
 /**
  * Functional Test for Context UI
diff --git a/profiles/openatrium/modules/contrib/context/plugins/context_condition.inc b/profiles/openatrium/modules/contrib/context/plugins/context_condition.inc
index 838a2d2..95951d9 100644
--- a/profiles/openatrium/modules/contrib/context/plugins/context_condition.inc
+++ b/profiles/openatrium/modules/contrib/context/plugins/context_condition.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: context_condition.inc,v 1.1.2.9 2010/08/05 07:15:22 yhahn Exp $
 
 /**
  * Base class for a context condition.
@@ -90,7 +89,7 @@ class context_condition {
   /**
    * Context editor form for conditions.
    */
-  function editor_form($context) {
+  function editor_form($context = NULL) {
     $form = array();
     if (!empty($this->values)) {
       $options = $this->condition_values();
diff --git a/profiles/openatrium/modules/contrib/context/plugins/context_condition_book.inc b/profiles/openatrium/modules/contrib/context/plugins/context_condition_book.inc
index 0d24b40..24fe769 100644
--- a/profiles/openatrium/modules/contrib/context/plugins/context_condition_book.inc
+++ b/profiles/openatrium/modules/contrib/context/plugins/context_condition_book.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: context_condition_book.inc,v 1.1.2.4 2010/08/03 03:25:23 yhahn Exp $
 
 /**
  * Expose book properties as a context condition.
diff --git a/profiles/openatrium/modules/contrib/context/plugins/context_condition_bookroot.inc b/profiles/openatrium/modules/contrib/context/plugins/context_condition_bookroot.inc
index 6a28aa5..613abfa 100644
--- a/profiles/openatrium/modules/contrib/context/plugins/context_condition_bookroot.inc
+++ b/profiles/openatrium/modules/contrib/context/plugins/context_condition_bookroot.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: context_condition_bookroot.inc,v 1.1.2.2 2010/06/14 17:53:08 yhahn Exp $
 
 /**
  * Set the context on the basis of the node type of page's book root.
diff --git a/profiles/openatrium/modules/contrib/context/plugins/context_condition_context.inc b/profiles/openatrium/modules/contrib/context/plugins/context_condition_context.inc
index e62ccb9..b914070 100644
--- a/profiles/openatrium/modules/contrib/context/plugins/context_condition_context.inc
+++ b/profiles/openatrium/modules/contrib/context/plugins/context_condition_context.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: context_condition_context.inc,v 1.1.2.1 2010/07/30 14:39:06 yhahn Exp $
 
 /**
  * Expose active contexts as a context condition.
diff --git a/profiles/openatrium/modules/contrib/context/plugins/context_condition_language.inc b/profiles/openatrium/modules/contrib/context/plugins/context_condition_language.inc
index 0b68e34..2d9cc43 100644
--- a/profiles/openatrium/modules/contrib/context/plugins/context_condition_language.inc
+++ b/profiles/openatrium/modules/contrib/context/plugins/context_condition_language.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: context_condition_language.inc,v 1.1.2.2 2010/08/02 19:54:03 yhahn Exp $
 
 /**
  * Expose current language as a context condition.
diff --git a/profiles/openatrium/modules/contrib/context/plugins/context_condition_menu.inc b/profiles/openatrium/modules/contrib/context/plugins/context_condition_menu.inc
index 368771c..548f109 100644
--- a/profiles/openatrium/modules/contrib/context/plugins/context_condition_menu.inc
+++ b/profiles/openatrium/modules/contrib/context/plugins/context_condition_menu.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: context_condition_menu.inc,v 1.1.2.5 2010/07/30 06:28:43 yhahn Exp $
 
 /**
  * Expose menu items as a context condition.
@@ -9,7 +8,8 @@ class context_condition_menu extends context_condition {
    * Override of condition_values().
    */
   function condition_values() {
-    $menus = menu_parent_options(array_reverse(menu_get_menus()), NULL);
+    $menu_names = variable_get('context_condition_menu_selections', menu_get_menus());
+    $menus = menu_parent_options(array_reverse($menu_names), NULL);
     $root_menus = array();
     foreach ($menus as $key => $name) {
       $id = explode(':', $key);
@@ -57,6 +57,29 @@ class context_condition_menu extends context_condition {
   }
 
   /**
+   * Settings form for variables.
+   */
+  function settings_form() {
+    // Get the list of menus in the system.
+    $menus = array_values(menu_get_menus());
+
+    // Convert the list to the format menu_name => menu_name.
+    $options = array_combine($menus, $menus);
+
+    $form = array();
+    $form['context_condition_menu_selections'] = array(
+      '#title' => t('Menus'),
+      '#type' => 'select',
+      '#multiple' => TRUE,
+      '#options' => $options,
+      '#required' => TRUE,
+      '#default_value' => variable_get('context_condition_menu_selections', $options),
+      '#description' => t('Select one or more Drupal menus to use during Menu Context condition checks. If none are selected, all of the menus are used.')
+    );
+    return $form;
+  }
+
+  /**
    * Override of execute().
    */
   function execute() {
@@ -67,7 +90,15 @@ class context_condition_menu extends context_condition {
       // helper code below.
       if (menu_get_active_menu_name() === 'navigation') {
         $item = menu_get_item();
-        if ($menu_name = db_result(db_query("SELECT menu_name FROM {menu_links} WHERE link_path = '%s'", $item['href']))) {
+        $menus = variable_get('context_condition_menu_selections', menu_get_menus());
+
+        $params = array_values($menus);
+        $params[] = $item['href'];
+
+        $in_clause = implode(', ', array_fill(0, count($menus), "'%s'"));
+        $query = "SELECT menu_name FROM {menu_links} WHERE menu_name IN ($in_clause) AND link_path = '%s' ORDER BY mlid ASC";
+
+        if ($menu_name = db_result(db_query($query, $params))) {
           menu_set_active_menu_name($menu_name);
         }
       }
diff --git a/profiles/openatrium/modules/contrib/context/plugins/context_condition_node.inc b/profiles/openatrium/modules/contrib/context/plugins/context_condition_node.inc
index b999629..ddff12f 100644
--- a/profiles/openatrium/modules/contrib/context/plugins/context_condition_node.inc
+++ b/profiles/openatrium/modules/contrib/context/plugins/context_condition_node.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: context_condition_node.inc,v 1.1.2.4 2010/08/03 03:25:23 yhahn Exp $
 
 /**
  * Trigger context on node view only.
diff --git a/profiles/openatrium/modules/contrib/context/plugins/context_condition_node_taxonomy.inc b/profiles/openatrium/modules/contrib/context/plugins/context_condition_node_taxonomy.inc
index 3d96586..0f1bf6c 100644
--- a/profiles/openatrium/modules/contrib/context/plugins/context_condition_node_taxonomy.inc
+++ b/profiles/openatrium/modules/contrib/context/plugins/context_condition_node_taxonomy.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: context_condition_node_taxonomy.inc,v 1.1.2.3 2010/08/03 03:25:23 yhahn Exp $
 
 /**
  * Expose node taxonomy terms as a context condition.
diff --git a/profiles/openatrium/modules/contrib/context/plugins/context_condition_path.inc b/profiles/openatrium/modules/contrib/context/plugins/context_condition_path.inc
index a86c3ac..0babde9 100644
--- a/profiles/openatrium/modules/contrib/context/plugins/context_condition_path.inc
+++ b/profiles/openatrium/modules/contrib/context/plugins/context_condition_path.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: context_condition_path.inc,v 1.1.2.6 2010/07/30 14:39:06 yhahn Exp $
 
 /**
  * Expose paths as a context condition.
diff --git a/profiles/openatrium/modules/contrib/context/plugins/context_condition_sitewide.inc b/profiles/openatrium/modules/contrib/context/plugins/context_condition_sitewide.inc
index 1e3c42e..11e64c1 100644
--- a/profiles/openatrium/modules/contrib/context/plugins/context_condition_sitewide.inc
+++ b/profiles/openatrium/modules/contrib/context/plugins/context_condition_sitewide.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: context_condition_sitewide.inc,v 1.1.2.2 2010/08/02 19:54:03 yhahn Exp $
 
 /**
  * Simple sitewide context, always present.
diff --git a/profiles/openatrium/modules/contrib/context/plugins/context_condition_user.inc b/profiles/openatrium/modules/contrib/context/plugins/context_condition_user.inc
index f6118e1..f7184f0 100644
--- a/profiles/openatrium/modules/contrib/context/plugins/context_condition_user.inc
+++ b/profiles/openatrium/modules/contrib/context/plugins/context_condition_user.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: context_condition_user.inc,v 1.1.2.7 2010/08/03 03:25:23 yhahn Exp $
 
 /**
  * Expose current user role as a context condition.
diff --git a/profiles/openatrium/modules/contrib/context/plugins/context_condition_views.inc b/profiles/openatrium/modules/contrib/context/plugins/context_condition_views.inc
index 181abbd..939a472 100644
--- a/profiles/openatrium/modules/contrib/context/plugins/context_condition_views.inc
+++ b/profiles/openatrium/modules/contrib/context/plugins/context_condition_views.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: context_condition_views.inc,v 1.1.2.6 2010/08/03 03:25:23 yhahn Exp $
 
 class context_condition_views extends context_condition {
 
diff --git a/profiles/openatrium/modules/contrib/context/plugins/context_reaction.inc b/profiles/openatrium/modules/contrib/context/plugins/context_reaction.inc
index 3374f76..5c291da 100644
--- a/profiles/openatrium/modules/contrib/context/plugins/context_reaction.inc
+++ b/profiles/openatrium/modules/contrib/context/plugins/context_reaction.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: context_reaction.inc,v 1.1.2.6 2010/08/05 07:15:22 yhahn Exp $
 
 /**
  * Base class for a context reaction.
diff --git a/profiles/openatrium/modules/contrib/context/plugins/context_reaction_block.inc b/profiles/openatrium/modules/contrib/context/plugins/context_reaction_block.inc
index cecdf6c..6293210 100644
--- a/profiles/openatrium/modules/contrib/context/plugins/context_reaction_block.inc
+++ b/profiles/openatrium/modules/contrib/context/plugins/context_reaction_block.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: context_reaction_block.inc,v 1.1.2.35 2010/08/06 16:13:32 jmiccolis Exp $
 
 /**
  * Expose blocks as context reactions.
@@ -555,8 +554,14 @@ class context_reaction_block extends context_reaction {
   function render_ajax($param) {
     // Besure the page isn't a 404 or 403.
     $headers = drupal_set_header();
-    foreach (explode("\n", $headers) as $header) {
-      if ($header == "HTTP/1.1 404 Not Found" || $header == "HTTP/1.1 403 Forbidden") {
+
+    // Support for Pressflow drupal_set_header.
+    if (!is_array($headers)) {
+      $headers = explode("\n", $headers);
+    }
+
+    foreach ($headers as $header) {
+      if (strpos($header, "404 Not Found") !== FALSE || strpos($header, "403 Forbidden") !== FALSE) {
         return;
       }
     }
@@ -567,6 +572,11 @@ class context_reaction_block extends context_reaction {
     if (strpos($param, ',') !== FALSE) {
       list($bid, $context) = explode(',', $param);
       list($module, $delta) = explode('-', $bid, 2);
+      // Check token to make sure user has access to block.
+      if (empty($_GET['context_token']) || $_GET['context_token'] != drupal_get_token($bid)) {
+        echo drupal_to_js(array('status' => 0));
+        exit;
+      }
 
       // Ensure $bid is valid.
       $info = $this->get_blocks();
diff --git a/profiles/openatrium/modules/contrib/context/plugins/context_reaction_block.js b/profiles/openatrium/modules/contrib/context/plugins/context_reaction_block.js
index 56d2cfc..8a937e2 100644
--- a/profiles/openatrium/modules/contrib/context/plugins/context_reaction_block.js
+++ b/profiles/openatrium/modules/contrib/context/plugins/context_reaction_block.js
@@ -1,4 +1,3 @@
-// $Id: context_reaction_block.js,v 1.1.2.23 2010/08/05 20:09:11 yhahn Exp $
 
 Drupal.behaviors.contextReactionBlock = function(context) {
   $('form.context-editor:not(.context-block-processed)')
@@ -191,7 +190,7 @@ DrupalContextBlockEditor.prototype.updateBlocks = function() {
 
   // Mark empty regions.
   $(this.regions).each(function() {
-    if ($('div.block:has(a.context-block)', this).size() > 0) {
+    if ($('div.block:not(.context-block-hidden):has(a.context-block)', this).size() > 0) {
       $(this).removeClass('context-block-region-empty');
     }
     else {
@@ -210,9 +209,9 @@ DrupalContextBlockEditor.prototype.updateRegion = function(event, ui, region, op
       break;
     case 'out':
       if (
-        $('div.draggable-placeholder', region).size() === 0 &&
-        $('div.block:has(a.context-block)', region).size() == 1 &&
-        $('div.block:has(a.context-block)', region).attr('id') == ui.item.attr('id')
+        $('div.block:not(.context-block-hidden):has(a.context-block)', region).size() == 0 || 
+        ($('div.block:not(.context-block-hidden):has(a.context-block)', region).size() == 1 &&
+        $('div.block:not(.context-block-hidden):has(a.context-block)', region).attr('id') == ui.item.attr('id'))
       ) {
         $(region).addClass('context-block-region-empty');
       }
@@ -243,6 +242,11 @@ DrupalContextBlockEditor.prototype.addBlock = function(event, ui, editor, contex
     // Construct query params for our AJAX block request.
     var params = Drupal.settings.contextBlockEditor.params;
     params.context_block = bid + ',' + context;
+    if (!Drupal.settings.contextBlockEditor.block_tokens || !Drupal.settings.contextBlockEditor.block_tokens[bid]) {
+      alert(Drupal.t('An error occurred trying to retrieve block content. Please contact a site administer.'));
+      return;
+    }
+    params.context_token = Drupal.settings.contextBlockEditor.block_tokens[bid];
 
     // Replace item with loading block.
     var blockLoading = $('<div class="context-block-item context-block-loading"><span class="icon"></span></div>');
diff --git a/profiles/openatrium/modules/contrib/context/plugins/context_reaction_breadcrumb.inc b/profiles/openatrium/modules/contrib/context/plugins/context_reaction_breadcrumb.inc
index 57c16ab..ef5b86d 100644
--- a/profiles/openatrium/modules/contrib/context/plugins/context_reaction_breadcrumb.inc
+++ b/profiles/openatrium/modules/contrib/context/plugins/context_reaction_breadcrumb.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: context_reaction_breadcrumb.inc,v 1.1.2.3 2010/08/19 14:14:12 yhahn Exp $
 
 /**
  * Set the breadcrumb using a context reaction.
diff --git a/profiles/openatrium/modules/contrib/context/plugins/context_reaction_css_injector.inc b/profiles/openatrium/modules/contrib/context/plugins/context_reaction_css_injector.inc
index 0006f5d..5fedb79 100644
--- a/profiles/openatrium/modules/contrib/context/plugins/context_reaction_css_injector.inc
+++ b/profiles/openatrium/modules/contrib/context/plugins/context_reaction_css_injector.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: context_reaction_css_injector.inc,v 1.1.2.1 2009/12/14 22:34:05 yhahn Exp $
 
 class context_reaction_css_injector extends context_reaction {
 
diff --git a/profiles/openatrium/modules/contrib/context/plugins/context_reaction_debug.inc b/profiles/openatrium/modules/contrib/context/plugins/context_reaction_debug.inc
index a7b19a3..27b3448 100644
--- a/profiles/openatrium/modules/contrib/context/plugins/context_reaction_debug.inc
+++ b/profiles/openatrium/modules/contrib/context/plugins/context_reaction_debug.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: context_reaction_debug.inc,v 1.1.2.3 2010/08/04 23:43:04 yhahn Exp $
 
 /**
  * Output context debug information.
diff --git a/profiles/openatrium/modules/contrib/context/plugins/context_reaction_menu.inc b/profiles/openatrium/modules/contrib/context/plugins/context_reaction_menu.inc
index 980341a..7a2336c 100644
--- a/profiles/openatrium/modules/contrib/context/plugins/context_reaction_menu.inc
+++ b/profiles/openatrium/modules/contrib/context/plugins/context_reaction_menu.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: context_reaction_menu.inc,v 1.1.2.6 2010/07/30 17:25:28 yhahn Exp $
 
 /**
  * Expose menu items as context reactions.
@@ -49,7 +48,7 @@ class context_reaction_menu extends context_reaction {
    * If primary + secondary links are pointed at the same menu, provide
    * contextual trailing by default.
    */
-  function execute(&$vars) {
+  function execute(&$vars = NULL) {
     if (variable_get('menu_primary_links_source', 'primary-links') == variable_get('menu_secondary_links_source', 'secondary-links')) {
       $vars['primary_links'] = theme_get_setting('toggle_primary_links') ? $this->menu_navigation_links(variable_get('menu_primary_links_source', 'primary-links')) : $vars['primary_links'];
       $vars['secondary_links'] = theme_get_setting('toggle_secondary_links') ? $this->menu_navigation_links(variable_get('menu_secondary_links_source', 'secondary-links'), 1) : $vars['secondary_links'];
diff --git a/profiles/openatrium/modules/contrib/context/plugins/context_reaction_theme.inc b/profiles/openatrium/modules/contrib/context/plugins/context_reaction_theme.inc
index f274939..02a35dc 100644
--- a/profiles/openatrium/modules/contrib/context/plugins/context_reaction_theme.inc
+++ b/profiles/openatrium/modules/contrib/context/plugins/context_reaction_theme.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: context_reaction_theme.inc,v 1.1.2.3 2010/08/09 15:13:03 yhahn Exp $
 
 /**
  * Expose themes as context reactions.
@@ -66,15 +65,15 @@ class context_reaction_theme extends context_reaction {
     $classes = array();
     foreach ($this->get_contexts() as $k => $v) {
       if (!empty($v->reactions[$this->plugin]['title']) && !isset($vars['section_title'])) {
-        $vars['section_title'] = t($v->reactions[$this->plugin]['title']);
+        $vars['section_title'] = check_plain(t($v->reactions[$this->plugin]['title']));
       }
       if (!empty($v->reactions[$this->plugin]['subtitle']) && !isset($vars['section_subtitle'])) {
-        $vars['section_subtitle'] = t($v->reactions[$this->plugin]['subtitle']);
+        $vars['section_subtitle'] = check_plain(t($v->reactions[$this->plugin]['subtitle']));
       }
       if (!empty($v->reactions[$this->plugin]['class'])) {
         $classes[$v->reactions[$this->plugin]['class']] = $v->reactions[$this->plugin]['class'];
       }
     }
-    $vars['body_classes'] .= !empty($classes) ? ' '. implode(' ', $classes) : '';
+    $vars['body_classes'] .= !empty($classes) ? ' '. check_plain(implode(' ', $classes)) : '';
   }
 }
diff --git a/profiles/openatrium/modules/contrib/context/tests/context.conditions.test b/profiles/openatrium/modules/contrib/context/tests/context.conditions.test
index 2653595..fefe5f8 100644
--- a/profiles/openatrium/modules/contrib/context/tests/context.conditions.test
+++ b/profiles/openatrium/modules/contrib/context/tests/context.conditions.test
@@ -1,5 +1,4 @@
 <?php
-// $Id: context.conditions.test,v 1.1.2.7 2010/07/30 16:42:15 yhahn Exp $
 
 class ContextConditionUserTest extends DrupalWebTestCase {
   function getInfo() {
diff --git a/profiles/openatrium/modules/contrib/context/tests/context.reactions.test b/profiles/openatrium/modules/contrib/context/tests/context.reactions.test
index b4ae313..974a694 100644
--- a/profiles/openatrium/modules/contrib/context/tests/context.reactions.test
+++ b/profiles/openatrium/modules/contrib/context/tests/context.reactions.test
@@ -1,5 +1,4 @@
 <?php
-// $Id: context.reactions.test,v 1.1.2.3 2010/08/04 18:40:56 jmiccolis Exp $
 
 class ContextReactionBlockTest extends DrupalWebTestCase {
   function getInfo() {
diff --git a/profiles/openatrium/modules/contrib/context/tests/context.test b/profiles/openatrium/modules/contrib/context/tests/context.test
index 5cc4746..0aaada4 100644
--- a/profiles/openatrium/modules/contrib/context/tests/context.test
+++ b/profiles/openatrium/modules/contrib/context/tests/context.test
@@ -1,5 +1,4 @@
 <?php
-// $Id: context.test,v 1.3.4.1.2.1 2009/12/14 22:34:05 yhahn Exp $
 
 class ContextUnitTest extends DrupalWebTestCase {
   public function getInfo() {
diff --git a/profiles/openatrium/modules/contrib/context/theme/context_reaction_block.theme.inc b/profiles/openatrium/modules/contrib/context/theme/context_reaction_block.theme.inc
index ee925a0..b5c2813 100644
--- a/profiles/openatrium/modules/contrib/context/theme/context_reaction_block.theme.inc
+++ b/profiles/openatrium/modules/contrib/context/theme/context_reaction_block.theme.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: context_reaction_block.theme.inc,v 1.1.2.13 2010/08/23 14:29:09 yhahn Exp $
 
 /**
  * Block form.
@@ -92,8 +91,13 @@ function template_preprocess_context_block_browser(&$vars) {
  * Preprocessor for theme('context_block_browser_item').
  */
 function template_preprocess_context_block_browser_item(&$vars) {
+  static $added = array();
   $vars['bid'] = $vars['block']->bid;
   $vars['info'] = check_plain($vars['block']->info);
+  if (empty($added[$vars['bid']])) {
+    drupal_add_js(array('contextBlockEditor' => array('block_tokens' => array($vars['bid'] => drupal_get_token($vars['bid'])))), 'setting');
+    $added[$vars['bid']] = TRUE;
+  }
 }
 
 /**
diff --git a/profiles/openatrium/modules/contrib/ctools/bulk_export/bulk_export.info b/profiles/openatrium/modules/contrib/ctools/bulk_export/bulk_export.info
index 82c8683..d13bc3b 100644
--- a/profiles/openatrium/modules/contrib/ctools/bulk_export/bulk_export.info
+++ b/profiles/openatrium/modules/contrib/ctools/bulk_export/bulk_export.info
@@ -3,9 +3,9 @@ description = Performs bulk exporting of data objects known about by Chaos tools
 core = 6.x
 dependencies[] = ctools
 package = Chaos tool suite
-; Information added by drupal.org packaging script on 2012-08-08
-version = "6.x-1.9"
+; Information added by drupal.org packaging script on 2012-11-14
+version = "6.x-1.10"
 core = "6.x"
 project = "ctools"
-datestamp = "1344463009"
+datestamp = "1352927156"
 
diff --git a/profiles/openatrium/modules/contrib/ctools/ctools.info b/profiles/openatrium/modules/contrib/ctools/ctools.info
index 328a58f..2655b45 100644
--- a/profiles/openatrium/modules/contrib/ctools/ctools.info
+++ b/profiles/openatrium/modules/contrib/ctools/ctools.info
@@ -2,9 +2,9 @@ name = Chaos tools
 description = A library of helpful tools by Merlin of Chaos.
 core = 6.x
 package = Chaos tool suite
-; Information added by drupal.org packaging script on 2012-08-08
-version = "6.x-1.9"
+; Information added by drupal.org packaging script on 2012-11-14
+version = "6.x-1.10"
 core = "6.x"
 project = "ctools"
-datestamp = "1344463009"
+datestamp = "1352927156"
 
diff --git a/profiles/openatrium/modules/contrib/ctools/ctools_access_ruleset/ctools_access_ruleset.info b/profiles/openatrium/modules/contrib/ctools/ctools_access_ruleset/ctools_access_ruleset.info
index 2282cb7..288d33c 100644
--- a/profiles/openatrium/modules/contrib/ctools/ctools_access_ruleset/ctools_access_ruleset.info
+++ b/profiles/openatrium/modules/contrib/ctools/ctools_access_ruleset/ctools_access_ruleset.info
@@ -4,9 +4,9 @@ core = 6.x
 package = Chaos tool suite
 dependencies[] = ctools
 
-; Information added by drupal.org packaging script on 2012-08-08
-version = "6.x-1.9"
+; Information added by drupal.org packaging script on 2012-11-14
+version = "6.x-1.10"
 core = "6.x"
 project = "ctools"
-datestamp = "1344463009"
+datestamp = "1352927156"
 
diff --git a/profiles/openatrium/modules/contrib/ctools/ctools_ajax_sample/ctools_ajax_sample.info b/profiles/openatrium/modules/contrib/ctools/ctools_ajax_sample/ctools_ajax_sample.info
index 50d0bca..52346c5 100644
--- a/profiles/openatrium/modules/contrib/ctools/ctools_ajax_sample/ctools_ajax_sample.info
+++ b/profiles/openatrium/modules/contrib/ctools/ctools_ajax_sample/ctools_ajax_sample.info
@@ -4,9 +4,9 @@ package = Chaos tool suite
 dependencies[] = ctools
 version = "6.x-1.0"
 core = "6.x"
-; Information added by drupal.org packaging script on 2012-08-08
-version = "6.x-1.9"
+; Information added by drupal.org packaging script on 2012-11-14
+version = "6.x-1.10"
 core = "6.x"
 project = "ctools"
-datestamp = "1344463009"
+datestamp = "1352927156"
 
diff --git a/profiles/openatrium/modules/contrib/ctools/ctools_custom_content/ctools_custom_content.info b/profiles/openatrium/modules/contrib/ctools/ctools_custom_content/ctools_custom_content.info
index 51c692f..5bc2b98 100644
--- a/profiles/openatrium/modules/contrib/ctools/ctools_custom_content/ctools_custom_content.info
+++ b/profiles/openatrium/modules/contrib/ctools/ctools_custom_content/ctools_custom_content.info
@@ -4,9 +4,9 @@ core = 6.x
 package = Chaos tool suite
 dependencies[] = ctools
 
-; Information added by drupal.org packaging script on 2012-08-08
-version = "6.x-1.9"
+; Information added by drupal.org packaging script on 2012-11-14
+version = "6.x-1.10"
 core = "6.x"
 project = "ctools"
-datestamp = "1344463009"
+datestamp = "1352927156"
 
diff --git a/profiles/openatrium/modules/contrib/ctools/ctools_plugin_example/ctools_plugin_example.info b/profiles/openatrium/modules/contrib/ctools/ctools_plugin_example/ctools_plugin_example.info
index 2065302..bc48c2c 100644
--- a/profiles/openatrium/modules/contrib/ctools/ctools_plugin_example/ctools_plugin_example.info
+++ b/profiles/openatrium/modules/contrib/ctools/ctools_plugin_example/ctools_plugin_example.info
@@ -7,9 +7,9 @@ dependencies[] = page_manager
 dependencies[] = advanced_help
 core = 6.x
 
-; Information added by drupal.org packaging script on 2012-08-08
-version = "6.x-1.9"
+; Information added by drupal.org packaging script on 2012-11-14
+version = "6.x-1.10"
 core = "6.x"
 project = "ctools"
-datestamp = "1344463009"
+datestamp = "1352927156"
 
diff --git a/profiles/openatrium/modules/contrib/ctools/page_manager/page_manager.info b/profiles/openatrium/modules/contrib/ctools/page_manager/page_manager.info
index 0cace9c..ef57f43 100644
--- a/profiles/openatrium/modules/contrib/ctools/page_manager/page_manager.info
+++ b/profiles/openatrium/modules/contrib/ctools/page_manager/page_manager.info
@@ -4,9 +4,9 @@ core = 6.x
 dependencies[] = ctools
 package = Chaos tool suite
 
-; Information added by drupal.org packaging script on 2012-08-08
-version = "6.x-1.9"
+; Information added by drupal.org packaging script on 2012-11-14
+version = "6.x-1.10"
 core = "6.x"
 project = "ctools"
-datestamp = "1344463009"
+datestamp = "1352927156"
 
diff --git a/profiles/openatrium/modules/contrib/ctools/page_manager/plugins/tasks/node_view.inc b/profiles/openatrium/modules/contrib/ctools/page_manager/plugins/tasks/node_view.inc
index b8fc3d7..83ea01e 100644
--- a/profiles/openatrium/modules/contrib/ctools/page_manager/plugins/tasks/node_view.inc
+++ b/profiles/openatrium/modules/contrib/ctools/page_manager/plugins/tasks/node_view.inc
@@ -85,7 +85,7 @@ function page_manager_node_view($node) {
   ctools_include('context-task-handler');
 
   // We need to mimic Drupal's behavior of setting the node title here.
-  drupal_set_title($node->title);
+  drupal_set_title(check_plain($node->title));
   $contexts = ctools_context_handler_get_task_contexts($task, '', array($node));
 
   $output = ctools_context_handler_render($task, '', $contexts, array($node->nid));
diff --git a/profiles/openatrium/modules/contrib/ctools/stylizer/stylizer.info b/profiles/openatrium/modules/contrib/ctools/stylizer/stylizer.info
index dd8d430..27b2ca0 100644
--- a/profiles/openatrium/modules/contrib/ctools/stylizer/stylizer.info
+++ b/profiles/openatrium/modules/contrib/ctools/stylizer/stylizer.info
@@ -4,9 +4,9 @@ core = 6.x
 package = Chaos tool suite
 dependencies[] = ctools
 
-; Information added by drupal.org packaging script on 2012-08-08
-version = "6.x-1.9"
+; Information added by drupal.org packaging script on 2012-11-14
+version = "6.x-1.10"
 core = "6.x"
 project = "ctools"
-datestamp = "1344463009"
+datestamp = "1352927156"
 
diff --git a/profiles/openatrium/modules/contrib/ctools/views_content/views_content.info b/profiles/openatrium/modules/contrib/ctools/views_content/views_content.info
index 7d7c6cb..1b9ddc8 100644
--- a/profiles/openatrium/modules/contrib/ctools/views_content/views_content.info
+++ b/profiles/openatrium/modules/contrib/ctools/views_content/views_content.info
@@ -5,9 +5,9 @@ dependencies[] = ctools
 dependencies[] = views
 core = 6.x
 package = Chaos tool suite
-; Information added by drupal.org packaging script on 2012-08-08
-version = "6.x-1.9"
+; Information added by drupal.org packaging script on 2012-11-14
+version = "6.x-1.10"
 core = "6.x"
 project = "ctools"
-datestamp = "1344463009"
+datestamp = "1352927156"
 
diff --git a/profiles/openatrium/modules/contrib/feeds/CHANGELOG.txt b/profiles/openatrium/modules/contrib/feeds/CHANGELOG.txt
index 54abfd1..3cd593f 100644
--- a/profiles/openatrium/modules/contrib/feeds/CHANGELOG.txt
+++ b/profiles/openatrium/modules/contrib/feeds/CHANGELOG.txt
@@ -1,3 +1,42 @@
+Feeds 6.x 1.0 Beta 13, 2012-12-18
+---------------------------------
+
+- Issue #1017538 by joshuajabbour: Added support for mapping taxonomy term
+  weights.
+- Issue #925716 by tmcw: Fixed Zero values imported as NULL from CSVs using
+  Feeds.
+- Back-port of common_syndication_parser.inc from 7.x to 6.x.
+- Issue #1087622 by Dane Powell | IRuslan: Fixed Notice: Undefined index:
+  processing in FeedsBatch->getTotal().
+- Issue #1567878 by Dane Powell: Fixed Notice: Undefined property: stdClass::.
+- Tests should pass.
+- Issue #1241754 by twistor, Robin Monks | j0e: Added targets for author name
+  and email in node processor.
+- Issue #1372074 by twistor, emackn: Fixed feeds_http_request() does not cache
+  when using drupal_http_request().
+- Issue #1271502 by twistor | oobie11: Fixed Im getting an error when I run
+  cron.
+- Issue #724536 by joshuajabbour, twistor, jeffschuler, milesw, victormoya,
+  alex_b, tauno, Nephele | katsikas: Added Mapper for nodereference field in
+  Drupal 6.
+- Issue #1688294 by twistor | Rob_Feature: Fixed Invalid URL (even though it's
+  valid).
+- Issue #1112876 by chx: Added Support digest auth.
+- Issue #1070604 by Bobk: Added Feed's nid in mappings.
+- Issue #1742740 by Staratel: Fixed Add magic method __isset() to
+  FeedsConfigurable to use default entity wrapping.
+- Issue #1736976 by Chaulky: Added Trim feed urls to remove accidental spaces.
+- Issue #1724200 by balazs.hegedus: Added Support for drupal_http_request()
+  timeout.
+- Issue #1792318 by psynaptic: Fixed Invalid multibyte sequence in
+  tests/feeds.test.
+- Issue #1420360 by anarchocoder: Fixed Common Syndication Parser sometimes
+  creates php warning when feed item title is empty.
+- Issue #1191498 by dooug, twistor: Set drupal_set_message() to not repeat
+  'Missing Feeds plugin...'.
+- Issue #912682 by alex_b, snyderp, dman | dwhogg: Added CSV Parser: Support
+  Mac-style line endings.
+
 Feeds 6.x 1.0 Beta 12, 2012-05-08
 ---------------------------------
 
@@ -6,71 +45,71 @@ Feeds 6.x 1.0 Beta 12, 2012-05-08
 - Issue #996808 by twistor, marcvangend, joshuajabbour: Fixed Update existing
   doesn't reset targets that have real_target set.
 - Issue #712304 by derhasi, twistor, jerdavis, alex_b, rjbrown99, rbayliss |
-  ManyNancy: Fixed Batch import does not continue where it left off, instead 
+  ManyNancy: Fixed Batch import does not continue where it left off, instead
   starts from the beginning.
 - Issue #1035684 by mikejoconnor: Source / Target sort order
-- Issue #1382208 by slcp: Fixed FeedsSource.inc sourceSave() and sourceDelete() 
+- Issue #1382208 by slcp: Fixed FeedsSource.inc sourceSave() and sourceDelete()
   function descriptions are the wrong way round.
-- Issue #1298326 by twistor, Dave Reid, emackn: Fixed Only execute 
+- Issue #1298326 by twistor, Dave Reid, emackn: Fixed Only execute
   rebuild_menu() when necessary.  Port for D6
-- Issue #1248712: Show an empty row result and hide the Save button if no 
+- Issue #1248712: Show an empty row result and hide the Save button if no
   importers are available.
-- Issue #1197646: Skip importer config form validation if a machine name was not 
+- Issue #1197646: Skip importer config form validation if a machine name was not
   provided.
 - Issue #1248682: Fixed failures in scheduler tests.
-- Issue #1248648 by twistor, Dave Reid: Fixed bugs and inconsistencies in 
+- Issue #1248648 by twistor, Dave Reid: Fixed bugs and inconsistencies in
   FeedsRSStoNodesTest.
 - Issue #1203578: Fixed wrong path to test files after test directory rename.
-- Issue #1230538: Removed unnecessary filter_xss() from 
+- Issue #1230538: Removed unnecessary filter_xss() from
   theme_feeds_ui_mapping_form().
-- Issue #1161810: Fixed declaration of FeedsSource::instance() should be 
+- Issue #1161810: Fixed declaration of FeedsSource::instance() should be
   compatible with that of FeedsConfigurable::instance().
 - Fixing PHP strict error in _parser_common_syndication_atom10_parse().
 - Issue #1191554: Fixed failures in FeedsUIUserInterfaceTestCase.
 - Issue #1191564: Use FeedsWebTestCase for FeedsDateTimeTest.
-- Issue #1191494 by twistor, Dave Reid: Fixed link to node type feed importer 
+- Issue #1191494 by twistor, Dave Reid: Fixed link to node type feed importer
   did not use node_access().
-- Fixed coder violations and standards. Fixed possible XSS with field labels in 
+- Fixed coder violations and standards. Fixed possible XSS with field labels in
   Feed importer mapping settings.
-- Fixed strict notice: definition of FeedsFeedNodeProcessor::map() did not match 
+- Fixed strict notice: definition of FeedsFeedNodeProcessor::map() did not match
   FeedsProcessor::map().
-- Issue #963842 by ceardach: Fixed feeds_update_6010() should not enable 
+- Issue #963842 by ceardach: Fixed feeds_update_6010() should not enable
   non-essential modules.
 - Issue #723548: Added support for feed URLs with feed:// and webcal://.
 - Re-exported features with latest code.
-- Fixed error when calling form_set_error() and title field on follow-up to fix 
+- Fixed error when calling form_set_error() and title field on follow-up to fix
   feed node title fields not actually un-required.
-- Issue #1191210: Added feeds_content_extra_fields() so the 'Feed' fieldset can 
+- Issue #1191210: Added feeds_content_extra_fields() so the 'Feed' fieldset can
   be re-ordered through the CCK field UI.
-- Issue #1191194: Fixed test failure in FeedsCSVtoUsersTest due to lack of 
+- Issue #1191194: Fixed test failure in FeedsCSVtoUsersTest due to lack of
   'administer users' permission.
-- Use module_load_include() for test files and fix PHP notice in 
+- Use module_load_include() for test files and fix PHP notice in
   FeedsProcessor.inc.
-- Issue #1066286: Added test to ensure 'Feed items' doesn't display on non-feed 
+- Issue #1066286: Added test to ensure 'Feed items' doesn't display on non-feed
   nodes.
 - Cleanup feeds_form_alter().
-- Simplify FeedsMapperTestCase::createContentType() using 
+- Simplify FeedsMapperTestCase::createContentType() using
   DrupalWebTestCase::drupalCreateContentType().
-- Issue #743528 by Souvent22, Dave Reid: Fixed _feeds_node_delete() fails if the 
+- Issue #743528 by Souvent22, Dave Reid: Fixed _feeds_node_delete() fails if the
   node does not load or exist.
 - Fixed _feeds_node_delete() wasn't exactly a copy of node_delete().
 - Fixes and cleanups to tests.
 - Issue #914210 by jyee, Dave Reid: Added mapper for user raw password.
-- Backports from Drupal 7: Removed t() from feeds_schema(). Cleanups for 
+- Backports from Drupal 7: Removed t() from feeds_schema(). Cleanups for
   documentation and tests.
-- Issue #797228 by alex_b: Fixed records not removed from {feeds_node_item} when 
+- Issue #797228 by alex_b: Fixed records not removed from {feeds_node_item} when
   a feed node is deleted.
-- Issue #769084: Fixed use of isset() rather than !empty() causes import 
+- Issue #769084: Fixed use of isset() rather than !empty() causes import
   problems with _parser_common_syndication_RSS20_parse().
 - Fixed various PHP notices and strict errors.
-- Issue #974494: Fixed PHP notice 'Undefined property: stdClass::$openid in 
+- Issue #974494: Fixed PHP notice 'Undefined property: stdClass::$openid in
   FeedsUserProcessor->entitySave()'.
 - Issue #1170714: Fixed debugging functions left in code.
-- Issue #1055582: Fixed strict notice that FeedsDateTime::setTimezone() is not 
+- Issue #1055582: Fixed strict notice that FeedsDateTime::setTimezone() is not
   compatible with DateTime::setTimezone().
 - Issue #1085194: Not all selected mappings are removed.
 - Issue #1152694: Fixed use of deprecated split() with explode().
-- Issue #1066822: Fixed bugs and inconsistencies with test files and getInfo() 
+- Issue #1066822: Fixed bugs and inconsistencies with test files and getInfo()
   declarations.
 
 Feeds 6.x 1.0 Beta 11, 2011-06-28
diff --git a/profiles/openatrium/modules/contrib/feeds/feeds.info b/profiles/openatrium/modules/contrib/feeds/feeds.info
index a45ffda..6eebfc3 100644
--- a/profiles/openatrium/modules/contrib/feeds/feeds.info
+++ b/profiles/openatrium/modules/contrib/feeds/feeds.info
@@ -7,9 +7,9 @@ php = 5.2
 dependencies[] = ctools
 dependencies[] = job_scheduler
 
-; Information added by drupal.org packaging script on 2012-05-08
-version = "6.x-1.0-beta12"
+; Information added by drupal.org packaging script on 2012-12-18
+version = "6.x-1.0-beta13"
 core = "6.x"
 project = "feeds"
-datestamp = "1336486856"
+datestamp = "1355848351"
 
diff --git a/profiles/openatrium/modules/contrib/feeds/feeds.module b/profiles/openatrium/modules/contrib/feeds/feeds.module
index 06ecbeb..a73e061 100644
--- a/profiles/openatrium/modules/contrib/feeds/feeds.module
+++ b/profiles/openatrium/modules/contrib/feeds/feeds.module
@@ -806,10 +806,10 @@ function feeds_plugin_instance($plugin, $id) {
   $args = array( '%plugin' => $plugin, '@id' => $id);
   if (user_access('administer feeds')) {
     $args['@link'] = url('admin/build/feeds/edit/' . $id);
-    drupal_set_message(t('Missing Feeds plugin %plugin. See <a href="@link">@id</a>. Check whether all required libraries and modules are installed properly.', $args), 'warning');
+    drupal_set_message(t('Missing Feeds plugin %plugin. See <a href="@link">@id</a>. Check whether all required libraries and modules are installed properly.', $args), 'warning', FALSE);
   }
   else {
-    drupal_set_message(t('Missing Feeds plugin %plugin. Please contact your site administrator.', $args), 'warning');
+    drupal_set_message(t('Missing Feeds plugin %plugin. Please contact your site administrator.', $args), 'warning', FALSE);
   }
   $class = ctools_plugin_load_class('feeds', 'plugins', 'FeedsMissingPlugin', 'handler');
   return FeedsConfigurable::instance($class, $id);
@@ -949,7 +949,7 @@ function feeds_library_exists($file, $library) {
  *
  * @see valid_url().
  *
- * @todo Replace with valid_url() when http://drupal.org/node/1191252 is fixed.
+ * @todo Replace with valid_url() when http://drupal.org/node/295021 is fixed.
  */
 function feeds_valid_url($url, $absolute = FALSE) {
   if ($absolute) {
@@ -966,7 +966,7 @@ function feeds_valid_url($url, $absolute = FALSE) {
       )
       (?::[0-9]+)?                                            # Server port number (optional)
       (?:[\/|\?]
-        (?:[\w#!:\.\?\+=&@$'~*,;\/\(\)\[\]\-]|%[0-9a-f]{2})   # The path and query (optional)
+        (?:[|\w#!:\.\?\+=&@$'~*,;\/\(\)\[\]\-]|%[0-9a-f]{2})   # The path and query (optional)
       *)?
     $/xi", $url);
   }
diff --git a/profiles/openatrium/modules/contrib/feeds/feeds_fast_news/feeds_fast_news.info b/profiles/openatrium/modules/contrib/feeds/feeds_fast_news/feeds_fast_news.info
index 5adb0ae..73b5d95 100644
--- a/profiles/openatrium/modules/contrib/feeds/feeds_fast_news/feeds_fast_news.info
+++ b/profiles/openatrium/modules/contrib/feeds/feeds_fast_news/feeds_fast_news.info
@@ -11,9 +11,9 @@ features[node][] = "feed_fast"
 name = "Feeds Fast News"
 package = "Feeds"
 
-; Information added by drupal.org packaging script on 2012-05-08
-version = "6.x-1.0-beta12"
+; Information added by drupal.org packaging script on 2012-12-18
+version = "6.x-1.0-beta13"
 core = "6.x"
 project = "feeds"
-datestamp = "1336486856"
+datestamp = "1355848351"
 
diff --git a/profiles/openatrium/modules/contrib/feeds/feeds_import/feeds_import.info b/profiles/openatrium/modules/contrib/feeds/feeds_import/feeds_import.info
index b8f5529..91716ba 100644
--- a/profiles/openatrium/modules/contrib/feeds/feeds_import/feeds_import.info
+++ b/profiles/openatrium/modules/contrib/feeds/feeds_import/feeds_import.info
@@ -8,9 +8,9 @@ files[] = feeds_import.test
 name = "Feeds Import"
 package = "Feeds"
 
-; Information added by drupal.org packaging script on 2012-05-08
-version = "6.x-1.0-beta12"
+; Information added by drupal.org packaging script on 2012-12-18
+version = "6.x-1.0-beta13"
 core = "6.x"
 project = "feeds"
-datestamp = "1336486856"
+datestamp = "1355848351"
 
diff --git a/profiles/openatrium/modules/contrib/feeds/feeds_news/feeds_news.info b/profiles/openatrium/modules/contrib/feeds/feeds_news/feeds_news.info
index 5227818..4367462 100644
--- a/profiles/openatrium/modules/contrib/feeds/feeds_news/feeds_news.info
+++ b/profiles/openatrium/modules/contrib/feeds/feeds_news/feeds_news.info
@@ -12,9 +12,9 @@ features[views_api][] = "api:2"
 name = "Feeds News"
 package = "Feeds"
 
-; Information added by drupal.org packaging script on 2012-05-08
-version = "6.x-1.0-beta12"
+; Information added by drupal.org packaging script on 2012-12-18
+version = "6.x-1.0-beta13"
 core = "6.x"
 project = "feeds"
-datestamp = "1336486856"
+datestamp = "1355848351"
 
diff --git a/profiles/openatrium/modules/contrib/feeds/feeds_ui/feeds_ui.info b/profiles/openatrium/modules/contrib/feeds/feeds_ui/feeds_ui.info
index 9fc2406..63c4a77 100644
--- a/profiles/openatrium/modules/contrib/feeds/feeds_ui/feeds_ui.info
+++ b/profiles/openatrium/modules/contrib/feeds/feeds_ui/feeds_ui.info
@@ -5,9 +5,9 @@ dependencies[] = feeds
 core = 6.x
 php = 5.2
 
-; Information added by drupal.org packaging script on 2012-05-08
-version = "6.x-1.0-beta12"
+; Information added by drupal.org packaging script on 2012-12-18
+version = "6.x-1.0-beta13"
 core = "6.x"
 project = "feeds"
-datestamp = "1336486856"
+datestamp = "1355848351"
 
diff --git a/profiles/openatrium/modules/contrib/feeds/includes/FeedsBatch.inc b/profiles/openatrium/modules/contrib/feeds/includes/FeedsBatch.inc
index b878c36..4e1a031 100644
--- a/profiles/openatrium/modules/contrib/feeds/includes/FeedsBatch.inc
+++ b/profiles/openatrium/modules/contrib/feeds/includes/FeedsBatch.inc
@@ -78,7 +78,7 @@ class FeedsBatch {
       $total = array_sum($this->total);
     }
     $progress = (1.0 / $total) * $progress;
-    return $progress == FEEDS_BATCH_COMPLETE ? 0.999 : $progress;
+    return $progress >= FEEDS_BATCH_COMPLETE ? 0.999 : $progress;
   }
 }
 
@@ -157,6 +157,11 @@ class FeedsImportBatch extends FeedsBatch {
       FEEDS_PARSING => FEEDS_BATCH_COMPLETE,
       FEEDS_PROCESSING => FEEDS_BATCH_COMPLETE,
     );
+    $this->total = array(
+      FEEDS_FETCHING => 0,
+      FEEDS_PARSING => 0,
+      FEEDS_PROCESSING => 0,
+    );
     $this->title = '';
     $this->description = '';
     $this->link = '';
@@ -353,6 +358,9 @@ class FeedsClearBatch extends FeedsBatch {
     $this->progress = array(
       FEEDS_CLEARING => FEEDS_BATCH_COMPLETE,
     );
+    $this->total = array(
+      FEEDS_CLEARING => 0,
+    );
     $this->deleted = 0;
   }
 }
diff --git a/profiles/openatrium/modules/contrib/feeds/includes/FeedsConfigurable.inc b/profiles/openatrium/modules/contrib/feeds/includes/FeedsConfigurable.inc
index da73994..17723c9 100644
--- a/profiles/openatrium/modules/contrib/feeds/includes/FeedsConfigurable.inc
+++ b/profiles/openatrium/modules/contrib/feeds/includes/FeedsConfigurable.inc
@@ -76,6 +76,13 @@ abstract class FeedsConfigurable {
   }
 
   /**
+   * Override magic method __isset(). This is needed due to overriding __get().
+   */
+  public function __isset($name) {
+    return isset($this->$name) ? TRUE : FALSE;
+  }
+
+  /**
    * Determine whether this object is persistent and enabled. I. e. it is
    * defined either in code or in the database and it is enabled.
    */
diff --git a/profiles/openatrium/modules/contrib/feeds/includes/FeedsSource.inc b/profiles/openatrium/modules/contrib/feeds/includes/FeedsSource.inc
index 1523ffb..380a698 100644
--- a/profiles/openatrium/modules/contrib/feeds/includes/FeedsSource.inc
+++ b/profiles/openatrium/modules/contrib/feeds/includes/FeedsSource.inc
@@ -208,7 +208,7 @@ class FeedsSource extends FeedsConfigurable {
       'type' => $this->id,
       'id' => $this->feed_nid,
       // Schedule as soon as possible if a batch is active.
-      'period' => $this->batch ? 0 : $period,
+      'period' => !empty($this->batch) ? 0 : $period,
       'periodic' => TRUE,
     );
     if ($job['period'] != FEEDS_SCHEDULE_NEVER) {
@@ -313,7 +313,8 @@ class FeedsSource extends FeedsConfigurable {
    *   An array stored for $client.
    */
   public function getConfigFor(FeedsSourceInterface $client) {
-    return $this->config[get_class($client)];
+    $class = get_class($client);
+    return isset($this->config[$class]) ? $this->config[$class] : $client->sourceDefaults();
   }
 
   /**
diff --git a/profiles/openatrium/modules/contrib/feeds/libraries/ParserCSV.inc b/profiles/openatrium/modules/contrib/feeds/libraries/ParserCSV.inc
index 1c13dfe..7b8edeb 100644
--- a/profiles/openatrium/modules/contrib/feeds/libraries/ParserCSV.inc
+++ b/profiles/openatrium/modules/contrib/feeds/libraries/ParserCSV.inc
@@ -81,6 +81,7 @@ class ParserCSV {
     $this->startByte = 0;
     $this->lineLimit = 0;
     $this->lastLinePos = 0;
+    ini_set('auto_detect_line_endings', TRUE);
   }
 
   /**
diff --git a/profiles/openatrium/modules/contrib/feeds/libraries/common_syndication_parser.inc b/profiles/openatrium/modules/contrib/feeds/libraries/common_syndication_parser.inc
index bee2864..5f5e2fe 100644
--- a/profiles/openatrium/modules/contrib/feeds/libraries/common_syndication_parser.inc
+++ b/profiles/openatrium/modules/contrib/feeds/libraries/common_syndication_parser.inc
@@ -47,7 +47,7 @@ function common_syndication_parser_parse($string) {
  * Get the cached version of the <var>$url</var>
  */
 function _parser_common_syndication_cache_get($url) {
-  $cache_file = _parser_common_syndication_sanitize_cache() .'/'. md5($url);
+  $cache_file = _parser_common_syndication_sanitize_cache() . '/' . md5($url);
   if (file_exists($cache_file)) {
     $file_content = file_get_contents($cache_file);
     return unserialize($file_content);
@@ -201,7 +201,19 @@ function _parser_common_syndication_atom10_parse($feed_XML) {
     $item['title'] = _parser_common_syndication_title($title, $body);
     $item['description'] = $body;
     $item['author_name'] = $original_author;
-    $item['timestamp'] = _parser_common_syndication_parse_date(isset($news->published) ? "{$news->published}" : "{$news->issued}");
+
+    // Fall back to updated for timestamp if both published and issued are
+    // empty.
+    if (isset($news->published)) {
+      $item['timestamp'] = _parser_common_syndication_parse_date("{$news->published}");
+    }
+    elseif (isset($news->issued)) {
+       $item['timestamp'] = _parser_common_syndication_parse_date("{$news->issued}");
+    }
+    elseif (isset($news->updated)) {
+      $item['timestamp'] = _parser_common_syndication_parse_date("{$news->updated}");
+    }
+
     $item['url'] = trim($original_url);
     if (valid_url($item['url']) && !valid_url($item['url'], TRUE) && !empty($base)) {
       $item['url'] = $base . $item['url'];
@@ -257,9 +269,9 @@ function _parser_common_syndication_RDF10_parse($feed_XML) {
   // Process the <rss:channel> resource containing feed metadata:
   foreach ($feed_XML->children($canonical_namespaces['rss'])->channel as $rss_channel) {
     $parsed_source = array(
-      'title'       => _parser_common_syndication_title((string)$rss_channel->title),
-      'description' => (string)$rss_channel->description,
-      'link'        => (string)$rss_channel->link,
+      'title'       => _parser_common_syndication_title((string) $rss_channel->title),
+      'description' => (string) $rss_channel->description,
+      'link'        => (string) $rss_channel->link,
       'items'       => array(),
     );
     break;
@@ -279,11 +291,11 @@ function _parser_common_syndication_RDF10_parse($feed_XML) {
       // still be able to correctly handle it.
       foreach ($rss_item->attributes($ns_uri) as $attr_name => $attr_value) {
         $ns_prefix = ($ns_prefix = array_search($ns_uri, $canonical_namespaces)) ? $ns_prefix : $ns;
-        $rdf_data[$ns_prefix .':'. $attr_name][] = (string)$attr_value;
+        $rdf_data[$ns_prefix . ':' . $attr_name][] = (string) $attr_value;
       }
       foreach ($rss_item->children($ns_uri) as $rss_property) {
         $ns_prefix = ($ns_prefix = array_search($ns_uri, $canonical_namespaces)) ? $ns_prefix : $ns;
-        $rdf_data[$ns_prefix .':'. $rss_property->getName()][] = (string)$rss_property;
+        $rdf_data[$ns_prefix . ':' . $rss_property->getName()][] = (string) $rss_property;
       }
     }
 
@@ -292,7 +304,7 @@ function _parser_common_syndication_RDF10_parse($feed_XML) {
       'title'       => array('rss:title', 'dc:title'),
       'description' => array('rss:description', 'dc:description', 'content:encoded'),
       'url'         => array('rss:link', 'rdf:about'),
-      'author_name'      => array('dc:creator', 'dc:publisher'),
+      'author_name' => array('dc:creator', 'dc:publisher'),
       'guid'        => 'rdf:about',
       'timestamp'   => 'dc:date',
       'tags'        => 'dc:subject'
@@ -571,8 +583,8 @@ function _parser_common_syndication_link($links) {
 function _parser_common_syndication_title($title, $body = FALSE) {
   if (empty($title) && !empty($body)) {
     // Explode to words and use the first 3 words.
-    $words = preg_split("/[\s,]+/", strip_tags($body));
-    $title = $words[0] .' '. $words[1] .' '. $words[2];
+    $words = preg_split('/[\s,]+/', strip_tags($body));
+    $title = implode(' ', array_slice($words, 0, 3));
   }
   return $title;
 }
diff --git a/profiles/openatrium/modules/contrib/feeds/libraries/http_request.inc b/profiles/openatrium/modules/contrib/feeds/libraries/http_request.inc
index 3a7b120..3ba7ef5 100644
--- a/profiles/openatrium/modules/contrib/feeds/libraries/http_request.inc
+++ b/profiles/openatrium/modules/contrib/feeds/libraries/http_request.inc
@@ -27,23 +27,19 @@ class HRCurlException extends Exception {}
  * Discover RSS or atom feeds at the given URL. If document in given URL is an
  * HTML document, function attempts to discover RSS or Atom feeds.
  *
- * @return
- *  string - the discovered feed, FALSE - if the URL is not reachable or there
- *    no feeds.
+ * @param string $url
+ *   The url of the feed to retrieve.
+ * @param array $settings
+ *   An optional array of settings. Valid options are: accept_invalid_cert.
+ *
+ * @return bool|string
+ *   The discovered feed, or FALSE if the URL is not reachable or there was an
+ *   error.
  */
 function http_request_get_common_syndication($url, $settings = NULL) {
-  $password = $username = NULL;
-  if (feeds_valid_url($url, TRUE)) {
-    // Handle password protected feeds.
-    $url_parts = parse_url($url);
-    if (!empty($url_parts['user'])) {
-      $password = $url_parts['pass'];
-      $username = $url_parts['user'];
-    }
-  }
 
   $accept_invalid_cert = isset($settings['accept_invalid_cert']) ? $settings['accept_invalid_cert'] : FALSE;
-  $download = http_request_get($url, $username, $password, $accept_invalid_cert);
+  $download = http_request_get($url, NULL, NULL, $accept_invalid_cert);
 
   // Cannot get the feed, return.
   // http_request_get() always returns 200 even if its 304.
@@ -56,7 +52,7 @@ function http_request_get_common_syndication($url, $settings = NULL) {
   // @see http_request_get.
   $downloaded_string = $download->data;
   // If this happens to be a feed then just return the url.
-  if (http_request_is_feed($download->headers['Content-Type'], $downloaded_string)) {
+  if (http_request_is_feed($download->headers['content-type'], $downloaded_string)) {
     return $url;
   }
 
@@ -73,51 +69,62 @@ function http_request_get_common_syndication($url, $settings = NULL) {
 /**
  * Get the content from the given URL.
  *
- * @param $url
- *  A valid URL (not only web URLs).
- * @param $username
- *  If the URL use authentication, here you can supply the username for this.
- * @param $password
- *  If the URL use authentication, here you can supply the password for this.
- * @return
- *  A stdClass object that describes the data downloaded from $url. The object's
- *  data property contains the actual document at the URL.
+ * @param string $url
+ *   A valid URL (not only web URLs).
+ * @param string $username
+ *   If the URL uses authentication, supply the username.
+ * @param string $password
+ *   If the URL uses authentication, supply the password.
+ * @param bool $accept_invalid_cert
+ *   Whether to accept invalid certificates.
+ *
+ * @return stdClass
+ *   An object that describes the data downloaded from $url.
  */
 function http_request_get($url, $username = NULL, $password = NULL, $accept_invalid_cert = FALSE) {
-  // Intra-pagedownload cache, avoid to download the same content twice within one page download (it's possible, compatible and parse calls).
+  // Intra-pagedownload cache, avoid to download the same content twice within
+  // one page download (it's possible, compatible and parse calls).
   static $download_cache = array();
   if (isset($download_cache[$url])) {
     return $download_cache[$url];
   }
-  $has_etag = FALSE;
+
+  if (!$username && valid_url($url, TRUE)) {
+    // Handle password protected feeds.
+    $url_parts = parse_url($url);
+    if (!empty($url_parts['user'])) {
+      $password = $url_parts['pass'];
+      $username = $url_parts['user'];
+    }
+  }
+
   $curl = http_request_use_curl();
 
   // Only download and parse data if really needs refresh.
   // Based on "Last-Modified" and "If-Modified-Since".
   $headers = array();
-  if ($cache = cache_get('feeds_http_download_'. md5($url))) {
+  if ($cache = cache_get('feeds_http_download_' . md5($url))) {
     $last_result = $cache->data;
-    $last_headers = $last_result->headers;
+    $last_headers = array_change_key_case($last_result->headers);
 
-    $has_etag = TRUE;
-    if (!empty($last_headers['ETag'])) {
+    if (!empty($last_headers['etag'])) {
       if ($curl) {
-        $headers[] = 'If-None-Match: '. $last_headers['ETag'];
+        $headers[] = 'If-None-Match: ' . $last_headers['etag'];
       }
       else {
-        $headers['If-None-Match'] = $last_headers['ETag'];
+        $headers['If-None-Match'] = $last_headers['etag'];
       }
     }
-    if (!empty($last_headers['Last-Modified'])) {
+    if (!empty($last_headers['last-modified'])) {
       if ($curl) {
-        $headers[] = 'If-Modified-Since: '. $last_headers['Last-Modified'];
+        $headers[] = 'If-Modified-Since: ' . $last_headers['last-modified'];
       }
       else {
-        $headers['If-Modified-Since'] = $last_headers['Last-Modified'];
+        $headers['If-Modified-Since'] = $last_headers['last-modified'];
       }
     }
     if (!empty($username) && !$curl) {
-      $headers['Authorization'] = 'Basic '. base64_encode("$username:$password");
+      $headers['Authorization'] = 'Basic ' . base64_encode("$username:$password");
     }
   }
 
@@ -155,33 +162,45 @@ function http_request_get($url, $username = NULL, $password = NULL, $accept_inva
       curl_setopt($download, CURLOPT_FOLLOWLOCATION, TRUE);
       if (!empty($username)) {
         curl_setopt($download, CURLOPT_USERPWD, "{$username}:{$password}");
+        curl_setopt($download, CURLOPT_HTTPAUTH, CURLAUTH_ANY);
       }
       curl_setopt($download, CURLOPT_HTTPHEADER, $headers);
       curl_setopt($download, CURLOPT_HEADER, TRUE);
       curl_setopt($download, CURLOPT_RETURNTRANSFER, TRUE);
       curl_setopt($download, CURLOPT_ENCODING, '');
-      curl_setopt($download, CURLOPT_TIMEOUT, variable_get('http_request_timeout', 15));
+      curl_setopt($download, CURLOPT_TIMEOUT, variable_get('http_request_timeout', 30));
       if ($accept_invalid_cert) {
         curl_setopt($download, CURLOPT_SSL_VERIFYPEER, 0);
       }
       $header = '';
       $data = curl_exec($download);
       if (curl_error($download)) {
-        throw new HRCurlException(t('cURL error (@code) @error for @url', array('@code' => curl_errno($download), '@error' => curl_error($download), '@url' => $url)), curl_errno($download));
+        throw new HRCurlException(
+          t('cURL error (@code) @error for @url', array(
+            '@code' => curl_errno($download),
+            '@error' => curl_error($download),
+            '@url' => $url
+          )), curl_errno($download)
+        );
       }
+
       $header_size = curl_getinfo($download, CURLINFO_HEADER_SIZE);
       $header = substr($data, 0, $header_size - 1);
       $result->data = substr($data, $header_size);
-      $header_lines = preg_split("/\r\n|\n|\r/", $header);
-
+      $headers = preg_split("/(\r\n){2}/", $header);
+      $header_lines = preg_split("/\r\n|\n|\r/", end($headers));
       $result->headers = array();
       array_shift($header_lines); // skip HTTP response status
+
       while ($line = trim(array_shift($header_lines))) {
         list($header, $value) = explode(':', $line, 2);
-        if (isset($result->headers[$header]) && $header == 'Set-Cookie') {
+        // Normalize the headers.
+        $header = strtolower($header);
+
+        if (isset($result->headers[$header]) && $header == 'set-cookie') {
           // RFC 2109: the Set-Cookie response header comprises the token Set-
           // Cookie:, followed by a comma-separated list of one or more cookies.
-          $result->headers[$header] .= ','. trim($value);
+          $result->headers[$header] .= ',' . trim($value);
         }
         else {
           $result->headers[$header] = trim($value);
@@ -193,7 +212,7 @@ function http_request_get($url, $username = NULL, $password = NULL, $accept_inva
     }
   }
   else {
-    $result = drupal_http_request($url, $headers);
+    $result = drupal_http_request($url, $headers, 'GET', NULL, 3, variable_get('http_request_timeout', 30));
   }
 
   $result->code = isset($result->code) ? $result->code : 200;
@@ -208,19 +227,13 @@ function http_request_get($url, $username = NULL, $password = NULL, $accept_inva
     else {
       // It's a tragedy, this file must exist and contain good data.
       // In this case, clear cache and repeat.
-      cache_clear_all('feeds_http_download_'. md5($url), 'cache');
+      cache_clear_all('feeds_http_download_' . md5($url), 'cache');
       return http_request_get($url, $username, $password);
     }
   }
 
-  if (!isset($result->headers) || !isset($result->headers['ETag']) || !isset($result->headers['Last-Modified'])) {
-    $result->headers = isset($result->headers) ? $result->headers : array();
-    $result->headers['ETag'] = isset($result->headers['ETag']) ? $result->headers['ETag'] : '';
-    $result->headers['Last-Modified'] = isset($result->headers['Last-Modified']) ? $result->headers['Last-Modified'] : '';
-  }
-
   // Set caches.
-  cache_set('feeds_http_download_'. md5($url), $result);
+  cache_set('feeds_http_download_' . md5($url), $result);
   $download_cache[$url] = $result;
 
   return $result;
@@ -229,7 +242,7 @@ function http_request_get($url, $username = NULL, $password = NULL, $accept_inva
 /**
  * Decides if it's possible to use cURL or not.
  *
- * @return
+ * @return bool
  *   TRUE if curl is available, FALSE otherwise.
  */
 function http_request_use_curl() {
@@ -247,7 +260,7 @@ function http_request_use_curl() {
  * Clear cache for a specific URL.
  */
 function http_request_clear_cache($url) {
-  cache_clear_all('feeds_http_download_'. md5($url), 'cache');
+  cache_clear_all('feeds_http_download_' . md5($url), 'cache');
 }
 
 /**
@@ -259,7 +272,7 @@ function http_request_clear_cache($url) {
  * @param string $data
  *  The actual data from the http request.
  *
- * @return boolean
+ * @return bool
  *  Returns TRUE if this is a parsable feed.
  */
 function http_request_is_feed($content_type, $data) {
@@ -283,14 +296,13 @@ function http_request_is_feed($content_type, $data) {
  * @param string $html
  *  The html string to search.
  *
- * @return array()
+ * @return array
  *  An array of href to feeds.
  */
 function http_request_find_feeds($html) {
   $matches = array();
   preg_match_all(HTTP_REQUEST_PCRE_LINK_TAG, $html, $matches);
   $links = $matches[1];
-  $candidates = array();
   $valid_links = array();
 
   // Build up all the links information.
@@ -324,13 +336,12 @@ function http_request_find_feeds($html) {
  * Create an absolute url.
  *
  * @param string $url
- *  The href to transform.
- *
- * @param $base_url
- *  The url to be used as the base for a relative $url.
+ *   The href to transform.
+ * @param string $base_url
+ *   The url to be used as the base for a relative $url.
  *
  * @return string
- *  an absolute url
+ *   An absolute url
  */
 function http_request_create_absolute_url($url, $base_url) {
   $url = trim($url);
@@ -341,7 +352,8 @@ function http_request_create_absolute_url($url, $base_url) {
 
   // Turn relative url into absolute.
   if (valid_url($url, FALSE)) {
-    // Produces variables $scheme, $host, $user, $pass, $path, $query and $fragment.
+    // Produces variables $scheme, $host, $user, $pass, $path, $query and
+    // $fragment.
     $parsed_url = parse_url($base_url);
 
     $path = dirname($parsed_url['path']);
diff --git a/profiles/openatrium/modules/contrib/feeds/mappers/nodereference.inc b/profiles/openatrium/modules/contrib/feeds/mappers/nodereference.inc
new file mode 100644
index 0000000..27977ef
--- /dev/null
+++ b/profiles/openatrium/modules/contrib/feeds/mappers/nodereference.inc
@@ -0,0 +1,126 @@
+<?php
+
+/**
+ * @file
+ * Implementation of Feeds API for mapping nodereference.module fields (CCK).
+ */
+
+/**
+ * Implementation of hook_feeds_node_processor_targets_alter().
+ *
+ * @see FeedsNodeProcessor::getMappingTargets()
+ */
+function nodereference_feeds_node_processor_targets_alter(&$targets, $content_type) {
+  $info = content_types($content_type);
+  if (isset($info['fields']) && is_array($info['fields'])) {
+    foreach ($info['fields'] as $field_name => $field) {
+      if ($field['type'] == 'nodereference') {
+        $field_label = !empty($field['widget']['label']) ? $field['widget']['label'] : $field_name;
+
+        $targets[$field_name . ':title'] = array(
+          'name' => t('@field_label (by title)', array('@field_label' => $field_label)),
+          'callback' => 'nodereference_feeds_set_target',
+          'description' => t('The CCK node reference @field_label of the node, matched by node title.', array('@field_label' => $field_label)),
+          'real_target' => $field_name,
+        );
+
+        $targets[$field_name . ':nid'] = array(
+          'name' => t('@field_label (by nid)', array('@field_label' => $field_label)),
+          'callback' => 'nodereference_feeds_set_target',
+          'description' => t('The CCK node reference @field_label of the node, matched by node ID.', array('@field_label' => $field_label)),
+          'real_target' => $field_name,
+        );
+
+        $targets[$field_name . ':url'] = array(
+          'name' => t('@field_label (by Feeds URL)', array('@field_label' => $field_label)),
+          'callback' => 'nodereference_feeds_set_target',
+          'description' => t('The CCK node reference @field_label of the node, matched by Feeds URL.', array('@field_label' => $field_label)),
+          'real_target' => $field_name,
+        );
+
+        $targets[$field_name . ':guid'] = array(
+          'name' => t('@field_label (by Feeds GUID)', array('@field_label' => $field_label)),
+          'callback' => 'nodereference_feeds_set_target',
+          'description' => t('The CCK node reference @field_label of the node, matched by Feeds GUID.', array('@field_label' => $field_label)),
+          'real_target' => $field_name,
+        );
+      }
+    }
+  }
+}
+
+/**
+ * Callback for mapping. Here is where the actual mapping happens.
+ *
+ * When the callback is invoked, $target contains the name of the field the
+ * user has decided to map to and $value contains the value of the feed item
+ * element the user has picked as a source.
+ *
+ * @param stdClass $node
+ *   The node to to be created or updated.
+ * @param str $target
+ *   The name of the field on the node to be mapped.
+ * @param str|array $value
+ *   The value(s) of the source feed item element to be mapped.
+ */
+function nodereference_feeds_set_target($node, $target, $value) {
+  // Determine whether we are matching against title, nid, URL, or GUID.
+  list($target, $match_key) = explode(':', $target, 2);
+
+  // Load field definition.
+  $field_info = content_fields($target, $node->type);
+
+  // Allow for multiple-value fields.
+  $value = is_array($value) ? $value : array($value);
+
+  // Allow importing to the same target with multiple mappers.
+  $field = isset($node->{$target}) ? $node->{$target} : array();
+
+  // Match values against nodes and add to field.
+  foreach ($value as $v) {
+    $nids = array();
+    $v = trim($v);
+
+    switch ($match_key) {
+      case 'url':
+      case 'guid':
+        // Lookup node ID by Feeds unique value.
+        $result = db_query("SELECT nid FROM {feeds_node_item} WHERE %s = '%s'", $match_key, $v);
+        // Since GUID and URL are only guaranteed to be unique per feed,
+        // multiple nids from different feeds may result.
+        while ($row = db_fetch_array($result)) {
+          $nids[] = $row['nid'];
+        }
+        // Ensure nids are valid node ids for this field.
+        $nids = !empty($nids) ? array_keys(_nodereference_potential_references($field_info, '', NULL, $nids)) : array();
+        break;
+
+      case 'title':
+        // Validate title.
+        if ((is_string($v) && $v !== '') || is_numeric($v)) {
+          // Lookup potential exact matches for the value.
+          $nids = array_keys(_nodereference_potential_references($field_info, $v, 'equals', array()));
+        }
+        break;
+
+      case 'nid':
+        // Ensure nid is a valid node id for this field.
+        $nids = array_keys(_nodereference_potential_references($field_info, '', NULL, array($v)));
+        break;
+    }
+
+    if (empty($nids)) {
+      // Alert if no matches were found.
+      drupal_set_message(t("'%value' does not match a valid node %key for the '%field' field.", array('%value' => $v, '%key' => $match_key, '%field' => $target)));
+    }
+    else {
+      // Add the reference (ignoring duplicates).
+      foreach ($nids as $nid) {
+        $field[] = array('nid' => $nid);
+      }
+    }
+
+  }
+
+  $node->{$target} = $field;
+}
diff --git a/profiles/openatrium/modules/contrib/feeds/mappers/taxonomy.inc b/profiles/openatrium/modules/contrib/feeds/mappers/taxonomy.inc
index de150ad..a9035c4 100644
--- a/profiles/openatrium/modules/contrib/feeds/mappers/taxonomy.inc
+++ b/profiles/openatrium/modules/contrib/feeds/mappers/taxonomy.inc
@@ -86,24 +86,33 @@ function taxonomy_feeds_set_target(&$node, $key, $terms) {
     $terms = array($terms);
   }
 
+  if (!isset($node->taxonomy)) {
+    $node->taxonomy = array();
+  }
+
   if ($vocabulary->tags) {
+    if (!isset($node->taxonomy['tags'])) {
+      $node->taxonomy['tags'] = array();
+    }
     foreach ($terms as $k => $v) {
       // Make sure there aren't any terms with a comma (=tag delimiter) in it.
       $terms[$k] = preg_replace('/\s*,\s*/', ' ', $v);
     }
     // Simply add a comma separated list to the node for a "tags" vocabulary.
-    $terms = array_merge($terms, drupal_explode_tags($node->taxonomy['tags'][$vocabulary->vid]));
+    if (isset($node->taxonomy['tags'][$vocabulary->vid])) {
+      $terms = array_merge($terms, drupal_explode_tags($node->taxonomy['tags'][$vocabulary->vid]));
+    }
     $node->taxonomy['tags'][$vocabulary->vid] = implode(',', $terms);
   }
   else {
     foreach ($terms as $term) {
       if ($term instanceof FeedsTermElement) {
-        $node->taxonomy[$term->tid] = (object)$term;
+        $node->taxonomy[$term->tid] = (object) $term;
       }
       // Check if a term already exists.
       elseif ($terms_found = taxonomy_get_term_by_name_vid($term, $vocabulary->vid)) {
         // If any terms are found add them to the node's taxonomy by found tid.
-        foreach ($terms_found AS $term_found) {
+        foreach ($terms_found as $term_found) {
           $node->taxonomy[$term_found->tid] = $term_found;
           if (!$vocabulary->multiple) {
             break;
diff --git a/profiles/openatrium/modules/contrib/feeds/plugins/FeedsDataProcessor.inc b/profiles/openatrium/modules/contrib/feeds/plugins/FeedsDataProcessor.inc
index 8a4795b..181bc91 100644
--- a/profiles/openatrium/modules/contrib/feeds/plugins/FeedsDataProcessor.inc
+++ b/profiles/openatrium/modules/contrib/feeds/plugins/FeedsDataProcessor.inc
@@ -174,18 +174,18 @@ class FeedsDataProcessor extends FeedsProcessor {
    * Set target element, bring element in a FeedsDataHandler format.
    */
   public function setTargetElement(&$target_item, $target_element, $value) {
-    if (empty($value)) {
+    if ($value === NULL) {
       return;
     }
     if (strpos($target_element, '.')) {
       /**
-      Add field in FeedsDataHandler format.
-
-      This is the tricky part, FeedsDataHandler expects an *array* of records
-      at #[joined_table_name]. We need to iterate over the $value that has
-      been mapped to this element and create a record array from each of
-      them.
-      */
+       *  Add field in FeedsDataHandler format.
+       *
+       *  This is the tricky part, FeedsDataHandler expects an *array* of records
+       *  at #[joined_table_name]. We need to iterate over the $value that has
+       *  been mapped to this element and create a record array from each of
+       *  them.
+       */
       list($table, $field) = explode('.', $target_element);
 
       $values = array();
@@ -204,7 +204,9 @@ class FeedsDataProcessor extends FeedsProcessor {
       }
     }
     else {
-      if (is_array($target_item[$target_element]) && is_array($value)) {
+      if (isset($target_item[$target_element]) && 
+        is_array($target_item[$target_element]) &&
+        is_array($value)) {
         $target_item[$target_element] = array_merge($target_item[$target_element], $value);
       }
       else {
diff --git a/profiles/openatrium/modules/contrib/feeds/plugins/FeedsFileFetcher.inc b/profiles/openatrium/modules/contrib/feeds/plugins/FeedsFileFetcher.inc
index b345357..b5bf947 100644
--- a/profiles/openatrium/modules/contrib/feeds/plugins/FeedsFileFetcher.inc
+++ b/profiles/openatrium/modules/contrib/feeds/plugins/FeedsFileFetcher.inc
@@ -91,6 +91,8 @@ class FeedsFileFetcher extends FeedsFetcher {
     $feed_dir = file_directory_path() .'/feeds';
     file_check_directory($feed_dir, TRUE);
 
+    $values['source'] = trim($values['source']);
+
     // If there is a file uploaded, save it, otherwise validate input on
     // file.
     if ($file = file_save_upload('feeds', array(), $feed_dir)) {
diff --git a/profiles/openatrium/modules/contrib/feeds/plugins/FeedsHTTPFetcher.inc b/profiles/openatrium/modules/contrib/feeds/plugins/FeedsHTTPFetcher.inc
index a5e88bb..fd39ee6 100644
--- a/profiles/openatrium/modules/contrib/feeds/plugins/FeedsHTTPFetcher.inc
+++ b/profiles/openatrium/modules/contrib/feeds/plugins/FeedsHTTPFetcher.inc
@@ -149,6 +149,8 @@ class FeedsHTTPFetcher extends FeedsFetcher {
    * Override parent::sourceFormValidate().
    */
   public function sourceFormValidate(&$values) {
+    $values['source'] = trim($values['source']);
+
     if (!feeds_valid_url($values['source'], TRUE)) {
       $form_key = 'feeds][' . get_class($this) . '][source';
       form_set_error($form_key, t('The URL %source is invalid.', array('%source' => $values['source'])));
diff --git a/profiles/openatrium/modules/contrib/feeds/plugins/FeedsNodeProcessor.inc b/profiles/openatrium/modules/contrib/feeds/plugins/FeedsNodeProcessor.inc
index bea7921..f7c665a 100644
--- a/profiles/openatrium/modules/contrib/feeds/plugins/FeedsNodeProcessor.inc
+++ b/profiles/openatrium/modules/contrib/feeds/plugins/FeedsNodeProcessor.inc
@@ -26,6 +26,7 @@ class FeedsNodeProcessor extends FeedsProcessor {
 
     // Keep track of processed items in this pass, set total number of items.
     $processed = 0;
+    $batch_size = variable_get('feeds_node_batch_size', FEEDS_NODE_BATCH_SIZE);
     if (!$batch->getTotal(FEEDS_PROCESSING)) {
       $batch->setTotal(FEEDS_PROCESSING, count($batch->items));
     }
@@ -73,8 +74,9 @@ class FeedsNodeProcessor extends FeedsProcessor {
       }
 
       $processed++;
-      if ($processed >= variable_get('feeds_node_batch_size', FEEDS_NODE_BATCH_SIZE)) {
-        $batch->setProgress(FEEDS_PROCESSING, $batch->created + $batch->updated);
+      if ($processed >= $batch_size) {
+        $total = $batch->getTotal(FEEDS_PROCESSING);
+        $batch->setProgress(FEEDS_PROCESSING, $total - count($batch->items));
         return;
       }
     }
@@ -83,10 +85,10 @@ class FeedsNodeProcessor extends FeedsProcessor {
     if ($batch->created) {
       drupal_set_message(format_plural($batch->created, 'Created @number @type node.', 'Created @number @type nodes.', array('@number' => $batch->created, '@type' => node_get_types('name', $this->config['content_type']))));
     }
-    elseif ($batch->updated) {
+    if ($batch->updated) {
       drupal_set_message(format_plural($batch->updated, 'Updated @number @type node.', 'Updated @number @type nodes.', array('@number' => $batch->updated, '@type' => node_get_types('name', $this->config['content_type']))));
     }
-    else {
+    if (!$batch->created && !$batch->updated) {
       drupal_set_message(t('There is no new content.'));
     }
     $batch->setProgress(FEEDS_PROCESSING, FEEDS_BATCH_COMPLETE);
@@ -252,15 +254,32 @@ class FeedsNodeProcessor extends FeedsProcessor {
    * Override setTargetElement to operate on a target item that is a node.
    */
   public function setTargetElement(&$target_node, $target_element, $value) {
-    if (in_array($target_element, array('url', 'guid'))) {
-      $target_node->feeds_node_item->$target_element = $value;
-    }
-    elseif ($target_element == 'body') {
-      $target_node->teaser = node_teaser($value);
-      $target_node->body = $value;
-    }
-    elseif (in_array($target_element, array('title', 'status', 'created', 'nid', 'uid'))) {
-      $target_node->$target_element = $value;
+    switch ($target_element) {
+      case 'url':
+      case 'guid':
+        $target_node->feeds_node_item->$target_element = $value;
+        break;
+      case 'body':
+        $target_node->teaser = node_teaser($value);
+        $target_node->body = $value;
+        break;
+      case 'title':
+      case 'status':
+      case 'created':
+      case 'nid':
+      case 'uid':
+        $target_node->$target_element = $value;
+        break;
+      case 'user_name':
+        if ($user = user_load(array('name' => $value))) {
+          $target_node->uid = $user->uid;
+        }
+        break;
+      case 'user_mail':
+        if ($user = user_load(array('mail' => $value))) {
+          $target_node->uid = $user->uid;
+        }
+        break;
     }
   }
 
@@ -293,6 +312,14 @@ class FeedsNodeProcessor extends FeedsProcessor {
         'name' => t('User ID'),
         'description' => t('The Drupal user ID of the node author.'),
       ),
+      'user_name' => array(
+        'name' => t('Username'),
+        'description' => t('The Drupal username of the node author.'),
+      ),
+      'user_mail' => array(
+        'name' => t('User email'),
+        'description' => t('The email address of the node author.'),
+      ),
       'status' => array(
         'name' => t('Published status'),
         'description' => t('Whether a node is published or not. 1 stands for published, 0 for not published.'),
@@ -352,8 +379,9 @@ class FeedsNodeProcessor extends FeedsProcessor {
    */
   protected function buildNode($nid, $feed_nid) {
     $populate = FALSE;
-    $node = new stdClass();
+
     if (empty($nid)) {
+      $node = new stdClass();
       $node->created = FEEDS_REQUEST_TIME;
       $populate = TRUE;
     }
@@ -362,8 +390,7 @@ class FeedsNodeProcessor extends FeedsProcessor {
         $node = node_load($nid, NULL, TRUE);
       }
       else {
-        $node->nid = $nid;
-        $node->vid = db_result(db_query("SELECT vid FROM {node} WHERE nid = %d", $nid));
+        $node = db_fetch_object(db_query("SELECT created, nid, vid, status FROM {node} WHERE nid = %d", $nid));
         $populate = TRUE;
       }
     }
diff --git a/profiles/openatrium/modules/contrib/feeds/plugins/FeedsParser.inc b/profiles/openatrium/modules/contrib/feeds/plugins/FeedsParser.inc
index 43a6a65..d4b4bba 100644
--- a/profiles/openatrium/modules/contrib/feeds/plugins/FeedsParser.inc
+++ b/profiles/openatrium/modules/contrib/feeds/plugins/FeedsParser.inc
@@ -56,6 +56,10 @@ abstract class FeedsParser extends FeedsPlugin {
       'name' => t('Feed node: User ID'),
       'description' => t('The feed node author uid.'),
     );
+    $sources['parent:nid'] = array(
+      'name' => t('Feed node: Node ID'),
+      'description' => t('The feed node nid.'),
+    );
     return $sources;
   }
 
@@ -81,9 +85,17 @@ abstract class FeedsParser extends FeedsPlugin {
    * @see FeedsCSVParser::getSourceElement().
    */
   public function getSourceElement(FeedsImportBatch $batch, $element_key) {
-    if (($node = node_load($batch->feed_nid)) && $element_key == 'parent:uid') {
-      return $node->uid;
-    }
+
+    switch ($element_key) {
+
+      case 'parent:uid':
+        if ($batch->feed_nid && $node = node_load($batch->feed_nid)) {
+          return $node->uid;
+        }
+        break;
+      case 'parent:nid':
+        return $batch->feed_nid;
+     }
     $item = $batch->currentItem();
     return isset($item[$element_key]) ? $item[$element_key] : '';
   }
diff --git a/profiles/openatrium/modules/contrib/feeds/plugins/FeedsTermProcessor.inc b/profiles/openatrium/modules/contrib/feeds/plugins/FeedsTermProcessor.inc
index af9e84c..51c248e 100644
--- a/profiles/openatrium/modules/contrib/feeds/plugins/FeedsTermProcessor.inc
+++ b/profiles/openatrium/modules/contrib/feeds/plugins/FeedsTermProcessor.inc
@@ -44,6 +44,10 @@ class FeedsTermProcessor extends FeedsProcessor {
           if ($feeds_term_item = db_fetch_array(db_query("SELECT imported, guid, url, feed_nid FROM {feeds_term_item} WHERE tid = %d", $term['tid']))) {
             $term['feeds_term_item'] = $feeds_term_item;
           }
+          // Initialize default values.
+          else {
+            $term['feeds_term_item'] = array();
+          }
 
           // Allow other modules to act.
           // @todo this breaks if hooks don't exist, or hooks don't return the term
@@ -54,12 +58,14 @@ class FeedsTermProcessor extends FeedsProcessor {
 
         // Add feeds_term_item data.
         $term['feeds_term_item']['id'] = $this->id;
-        if (!isset($term['feeds_term_item']['feed_nid'])) {
-          $term['feeds_term_item']['feed_nid'] = $source->feed_nid;
-        }
-        if (!isset($term['feeds_term_item']['imported'])) {
-          $term['feeds_term_item']['imported'] = FEEDS_REQUEST_TIME;
-        }
+
+        // Set some defaults.
+        $term['feeds_term_item'] += array(
+          'feed_nid' => $source->feed_nid,
+          'imported' => FEEDS_REQUEST_TIME,
+          'url' => '',
+          'guid' => '',
+        );
 
         // Map targets.
         $term = $this->map($batch, $term);
@@ -219,11 +225,17 @@ class FeedsTermProcessor extends FeedsProcessor {
    * Override setTargetElement to operate on a target item that is a term.
    */
   public function setTargetElement(&$target_item, $target_element, $value) {
-    if (in_array($target_element, array('url', 'guid'))) {
-      $target_item['feeds_term_item'][$target_element] = $value;
-    }
-    else {
-      parent::setTargetElement($target_item, $target_element, $value);
+    switch ($target_element) {
+      case 'url':
+      case 'guid':
+        $target_item['feeds_term_item'][$target_element] = $value;
+        break;
+      case 'weight':
+        $target_item['weight'] = (int) $value;
+        break;
+      default:
+        parent::setTargetElement($target_item, $target_element, $value);
+        break;
     }
   }
 
@@ -245,6 +257,10 @@ class FeedsTermProcessor extends FeedsProcessor {
         'name' => t('Term synonyms'),
         'description' => t('One synonym or an array of synonyms of the taxonomy term.'),
       ),
+      'weight' => array(
+        'name' => t('Term weight'),
+        'description' => t('Weight of the taxonomy term.'),
+      ),
       'url' => array(
         'name' => t('URL'),
         'description' => t('The external URL of the term. E. g. the feed item URL in the case of a syndication feed. May be unique.'),
@@ -258,7 +274,9 @@ class FeedsTermProcessor extends FeedsProcessor {
     );
     // Let implementers of hook_feeds_term_processor_targets() add their targets.
     $vocabulary = $this->vocabulary();
-    drupal_alter('feeds_term_processor_targets', $targets, $vocabulary->vid);
+    if ($vocabulary) {
+      drupal_alter('feeds_term_processor_targets', $targets, $vocabulary->vid);
+    }
     return $targets;
   }
 
@@ -295,8 +313,12 @@ class FeedsTermProcessor extends FeedsProcessor {
    * vocabularies exportable.
    */
   public function vocabulary() {
+    // The default value is 0.
+    if (!$this->config['vocabulary']) {
+      return;
+    }
     $vocabularies = taxonomy_get_vocabularies();
-    if (is_numeric($this->config['vocabulary'])) {
+    if ($this->config['vocabulary'] && is_numeric($this->config['vocabulary'])) {
       return $vocabularies[$this->config['vocabulary']];
     }
     else {
diff --git a/profiles/openatrium/modules/contrib/feeds/tests/feeds.test b/profiles/openatrium/modules/contrib/feeds/tests/feeds.test
index 4bdf73d..45ee2df 100644
--- a/profiles/openatrium/modules/contrib/feeds/tests/feeds.test
+++ b/profiles/openatrium/modules/contrib/feeds/tests/feeds.test
@@ -92,7 +92,7 @@ class FeedsWebTestCase extends DrupalWebTestCase {
 <body>
   <outline text="Feeds test group" >
        <outline title="Development Seed - Technological Solutions for Progressive Organizations" text="" xmlUrl="'. $path .'developmentseed.rss2" type="rss" />
-       <outline title="Magyar Nemzet Online - Hrek" text="" xmlUrl="'. $path .'feed_without_guid.rss2" type="rss" />
+       <outline title="Magyar Nemzet Online - H\'rek" text="" xmlUrl="'. $path .'feed_without_guid.rss2" type="rss" />
        <outline title="Drupal planet" text="" type="rss" xmlUrl="'. $path .'drupalplanet.rss2" />
     </outline>
 </body>
@@ -407,6 +407,7 @@ class FeedsUnitTestCase extends FeedsUnitTestHelper {
       'example.org/~,$\'*;',
       'caf%C3%A9.example.org',
       '[FEDC:BA98:7654:3210:FEDC:BA98:7654:3210]:80/index.html',
+      'graph.asfdasdfasdf.com/blarg/feed?access_token=133283760145143|tGew8jbxi1ctfVlYh35CPYij1eE',
     );
 
     foreach ($url_schemes as $scheme) {
diff --git a/profiles/openatrium/modules/contrib/feeds/tests/feeds/nodereference.csv b/profiles/openatrium/modules/contrib/feeds/tests/feeds/nodereference.csv
new file mode 100644
index 0000000..c336126
--- /dev/null
+++ b/profiles/openatrium/modules/contrib/feeds/tests/feeds/nodereference.csv
@@ -0,0 +1,4 @@
+title,ref
+title a,10
+title b,20
+title c,30
diff --git a/profiles/openatrium/modules/contrib/feeds/tests/feeds_mapper_locale.test b/profiles/openatrium/modules/contrib/feeds/tests/feeds_mapper_locale.test
index 69d8a27..67c7b9c 100644
--- a/profiles/openatrium/modules/contrib/feeds/tests/feeds_mapper_locale.test
+++ b/profiles/openatrium/modules/contrib/feeds/tests/feeds_mapper_locale.test
@@ -92,7 +92,7 @@ class FeedsMapperLocaleTestCase extends FeedsMapperTestCase {
     );
     $this->drupalPost("node/$nid/edit", $edit, t('Save'));
     $this->drupalPost('node/'. $nid .'/import', array(), 'Import');
-    $count = db_result(db_query("SELECT COUNT(*) FROM {node} WHERE language = 'zh-hans'", $nid));
+    $count = db_result(db_query("SELECT COUNT(*) FROM {node} WHERE language = 'zh-hans'"));
     $this->assertEqual(11, $count, 'Found correct number of nodes.');
   }
 }
diff --git a/profiles/openatrium/modules/contrib/feeds/tests/feeds_mapper_nodereference.test b/profiles/openatrium/modules/contrib/feeds/tests/feeds_mapper_nodereference.test
new file mode 100644
index 0000000..d9fc039
--- /dev/null
+++ b/profiles/openatrium/modules/contrib/feeds/tests/feeds_mapper_nodereference.test
@@ -0,0 +1,134 @@
+<?php
+
+/**
+ * @file
+ * Test case for CCK field mapper mappers/nodereference.inc.
+ */
+
+require_once(drupal_get_path('module', 'feeds') . '/tests/feeds_mapper.test');
+
+/**
+ * Class for testing Feeds nodereference mapper.
+ */
+class FeedsMapperNodereferenceTestCase extends FeedsMapperTestCase {
+
+  public static function getInfo() {
+    return array(
+      'name' => t('Mapper: Nodereference'),
+      'description' => t('Test Feeds Mapper support for Nodereference CCK fields. <strong>Requires CCK module</strong>.'),
+      'group' => t('Feeds'),
+      'dependencies' => array('cck'),
+    );
+  }
+
+  /**
+   * Set up the test.
+   */
+  function setUp() {
+    // Call parent setup with required modules.
+    parent::setUp('content', 'text', 'optionwidgets', 'nodereference');
+
+    // Create user and login.
+    $this->drupalLogin($this->drupalCreateUser(
+      array(
+        'administer content types',
+        'administer feeds',
+        'administer nodes',
+        'administer site configuration',
+      )
+    ));
+  }
+
+  /**
+   * Basic test loading an rss file.
+   */
+  function test() {
+
+    // Create content type.
+    $typename = $this->createContentType(array(), array(
+      'ref' => array(
+        'type' => 'nodereference',
+        'settings' => array(
+          'multiple' => 1,  // Sets to unlimited.
+          'referenceable_types[story]' => TRUE,
+        ),
+      ),
+    ));
+
+    $rss = simplexml_load_file($this->absolutePath() . '/tests/feeds/developmentseed_changes.rss2');
+    $categories = $rss->xpath('//category');
+
+    foreach ($categories as &$category) {
+      $category = (string) $category;
+    }
+    $categories = array_unique($categories);
+    foreach ($categories as $category) {
+      $this->drupalPost('node/add/story', array('title' => $category), t('Save'));
+    }
+
+    // Create and configure importer.
+    $this->createImporterConfiguration('Nodereference', 'ref_test_title');
+    $this->setSettings('ref_test_title', NULL, array('content_type' => '','import_period' => FEEDS_SCHEDULE_NEVER));
+    $this->setPlugin('ref_test_title', 'FeedsFileFetcher');
+    $this->setSettings('ref_test_title', 'FeedsNodeProcessor', array('content_type' => $typename));
+    $this->addMappings('ref_test_title', array(
+      array(
+        'source' => 'title',
+        'target' => 'title',
+      ),
+      array(
+        'source' => 'tags',
+        'target' => 'field_ref:title',
+      ),
+    ));
+
+    // Import file.
+    $this->importFile('ref_test_title', $this->absolutePath() . '/tests/feeds/developmentseed_changes.rss2');
+    $this->assertText('Created 10 '. $typename .' nodes.');
+
+    foreach ($rss->xpath('//item') as $item) {
+      $feed_item = node_load(array('title' => $item->title));
+      $this->drupalGet('node/' . $feed_item->nid);
+      foreach ($item->category as $category) {
+        $this->assertText((string) $category);
+      }
+    }
+
+    // Delete everything and start over for nid test
+    $this->drupalPost('import/ref_test_title/delete-items', array(), 'Delete');
+
+    // Create and configure importer.
+    $this->createImporterConfiguration('Nodereference', 'ref_test_nid');
+    $this->setSettings('ref_test_nid', NULL, array('content_type' => '','import_period' => FEEDS_SCHEDULE_NEVER));
+    $this->setPlugin('ref_test_nid', 'FeedsFileFetcher');
+    $this->setPlugin('ref_test_nid', 'FeedsCSVParser');
+    $this->setSettings('ref_test_nid', 'FeedsNodeProcessor', array('content_type' => $typename));
+    $this->addMappings('ref_test_nid', array(
+      array(
+        'source' => 'title',
+        'target' => 'title',
+      ),
+      array(
+        'source' => 'ref',
+        'target' => 'field_ref:nid',
+      ),
+    ));
+
+    // Import file.
+    $this->importFile('ref_test_nid', $this->absolutePath() . '/tests/feeds/nodereference.csv');
+    $this->assertText('Created 3 '. $typename .' nodes.');
+    $this->drupalGet('node/' . node_load(array('title' => 'title a'))->nid);
+    $this->assertText('custom mapping');
+    $this->drupalGet('node/' . node_load(array('title' => 'title b'))->nid);
+    $this->assertText('MIX Market');
+    $this->drupalGet('node/' . node_load(array('title' => 'title c'))->nid);
+    $this->assertText('usability');
+  }
+
+  /**
+   * Override parent::getFormFieldsNames().
+   */
+  protected function getFormFieldsNames($field_name, $index) {
+    return array("field_{$field_name}[{$index}][nid]");
+  }
+}
diff --git a/profiles/openatrium/modules/contrib/feeds/tests/feeds_mapper_taxonomy.test b/profiles/openatrium/modules/contrib/feeds/tests/feeds_mapper_taxonomy.test
index 71faf81..6ac768c 100644
--- a/profiles/openatrium/modules/contrib/feeds/tests/feeds_mapper_taxonomy.test
+++ b/profiles/openatrium/modules/contrib/feeds/tests/feeds_mapper_taxonomy.test
@@ -31,6 +31,7 @@ class FeedsMapperTaxonomyTestCase extends FeedsMapperTestCase {
     $this->drupalPost('admin/content/taxonomy/add/vocabulary', $edit, 'Save');
     // Create an importer configuration with basic mapping.
     $this->createImporterConfiguration('Syndication', 'syndication');
+
     $this->addMappings('syndication',
       array(
         array(
@@ -208,6 +209,6 @@ class FeedsMapperTaxonomyTestCase extends FeedsMapperTestCase {
    */
   public function assertTaxonomyTerm($term) {
     $term = check_plain($term);
-    $this->assertPattern('/<a href="(.*?)\/taxonomy\/term\/([0-9]*?)"(.*)>'. $term .'<\/a>/', 'Found '. $term);
+    $this->assertPattern('/<a href="\/.*taxonomy\/term\/[0-9]+"[^>].*>' . $term . '<\/a>/', 'Found ' . $term);
   }
 }
diff --git a/profiles/openatrium/modules/contrib/feeds/tests/feeds_processor_term.test b/profiles/openatrium/modules/contrib/feeds/tests/feeds_processor_term.test
index abfa1dd..9b5bf85 100644
--- a/profiles/openatrium/modules/contrib/feeds/tests/feeds_processor_term.test
+++ b/profiles/openatrium/modules/contrib/feeds/tests/feeds_processor_term.test
@@ -59,10 +59,11 @@ class FeedsCSVtoTermsTest extends FeedsWebTestCase {
     $this->importFile('term_import', $this->absolutePath() .'/tests/feeds/users.csv');
     $this->assertText('Created 5 terms in Addams vocabulary.');
     $this->drupalGet('admin/content/taxonomy/1');
-    $this->assertText('Morticia');
     $this->assertText('Fester');
     $this->assertText('Gomez');
+    $this->assertText('Morticia');
     $this->assertText('Pugsley');
+    $this->assertText('Wednesday');
 
     // Import again.
     $this->importFile('term_import', $this->absolutePath() .'/tests/feeds/users.csv');
@@ -80,5 +81,6 @@ class FeedsCSVtoTermsTest extends FeedsWebTestCase {
     $this->assertNoText('Fester');
     $this->assertNoText('Gomez');
     $this->assertNoText('Pugsley');
+    $this->assertNoText('Wednesday');
   }
 }
diff --git a/profiles/openatrium/modules/contrib/feeds/tests/feeds_scheduler.test b/profiles/openatrium/modules/contrib/feeds/tests/feeds_scheduler.test
index 34af69f..3d92b02 100644
--- a/profiles/openatrium/modules/contrib/feeds/tests/feeds_scheduler.test
+++ b/profiles/openatrium/modules/contrib/feeds/tests/feeds_scheduler.test
@@ -225,11 +225,11 @@ class FeedsSchedulerTestCase extends FeedsWebTestCase {
     // Set next time to 0 to simulate updates.
     db_query("UPDATE {job_schedule} SET next = 0");
     // Hit cron 3 times, assert correct number of story nodes.
-    for ($i = 0; $i < 3; $i++) {
+    for ($i = 1; $i <= 3; $i++) {
       $this->cronRun();
       sleep(1);
       // 50 == FEEDS_NODE_BATCH_SIZE
-      $this->assertEqual(50 * ($i + 1), db_result(db_query("SELECT COUNT(*) FROM {node} WHERE type = 'story'")));
+      $this->assertEqual(50 * $i, db_result(db_query("SELECT COUNT(*) FROM {node} WHERE type = 'story'")));
       $this->assertEqual(0, db_result(db_query("SELECT period FROM {job_schedule} WHERE type = 'syndication' AND id = %d", $nid)));
     }
     // Run one more time to cause the batch to reset, check period back to 1800.
diff --git a/profiles/openatrium/modules/contrib/markdown/LICENSE.txt b/profiles/openatrium/modules/contrib/markdown/LICENSE.txt
index 2c095c8..d159169 100644
--- a/profiles/openatrium/modules/contrib/markdown/LICENSE.txt
+++ b/profiles/openatrium/modules/contrib/markdown/LICENSE.txt
@@ -1,274 +1,339 @@
-GNU GENERAL PUBLIC LICENSE
-
-              Version 2, June 1991
-
-Copyright (C) 1989, 1991 Free Software Foundation, Inc. 675 Mass Ave,
-Cambridge, MA 02139, USA. Everyone is permitted to copy and distribute
-verbatim copies of this license document, but changing it is not allowed.
-
-                  Preamble
-
-The licenses for most software are designed to take away your freedom to
-share and change it. By contrast, the GNU General Public License is
-intended to guarantee your freedom to share and change free software--to
-make sure the software is free for all its users. This General Public License
-applies to most of the Free Software Foundation's software and to any other
-program whose authors commit to using it. (Some other Free Software
-Foundation software is covered by the GNU Library General Public License
-instead.) You can apply it to your programs, too.
-
-When we speak of free software, we are referring to freedom, not price. Our
-General Public Licenses are designed to make sure that you have the
-freedom to distribute copies of free software (and charge for this service if
-you wish), that you receive source code or can get it if you want it, that you
-can change the software or use pieces of it in new free programs; and that
-you know you can do these things.
-
-To protect your rights, we need to make restrictions that forbid anyone to
-deny you these rights or to ask you to surrender the rights. These restrictions
-translate to certain responsibilities for you if you distribute copies of the
-software, or if you modify it.
-
-For example, if you distribute copies of such a program, whether gratis or for
-a fee, you must give the recipients all the rights that you have. You must make
-sure that they, too, receive or can get the source code. And you must show
-them these terms so they know their rights.
-
-We protect your rights with two steps: (1) copyright the software, and (2)
-offer you this license which gives you legal permission to copy, distribute
-and/or modify the software.
-
-Also, for each author's protection and ours, we want to make certain that
-everyone understands that there is no warranty for this free software. If the
-software is modified by someone else and passed on, we want its recipients
-to know that what they have is not the original, so that any problems
-introduced by others will not reflect on the original authors' reputations.
-
-Finally, any free program is threatened constantly by software patents. We
-wish to avoid the danger that redistributors of a free program will individually
-obtain patent licenses, in effect making the program proprietary. To prevent
-this, we have made it clear that any patent must be licensed for everyone's
-free use or not licensed at all.
-
-The precise terms and conditions for copying, distribution and modification
-follow.
-
-           GNU GENERAL PUBLIC LICENSE
- TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND
-               MODIFICATION
-
-0. This License applies to any program or other work which contains a notice
-placed by the copyright holder saying it may be distributed under the terms
-of this General Public License. The "Program", below, refers to any such
-program or work, and a "work based on the Program" means either the
-Program or any derivative work under copyright law: that is to say, a work
-containing the Program or a portion of it, either verbatim or with
-modifications and/or translated into another language. (Hereinafter, translation
-is included without limitation in the term "modification".) Each licensee is
-addressed as "you".
-
-Activities other than copying, distribution and modification are not covered
-by this License; they are outside its scope. The act of running the Program is
-not restricted, and the output from the Program is covered only if its contents
-constitute a work based on the Program (independent of having been made
-by running the Program). Whether that is true depends on what the Program
-does.
-
-1. You may copy and distribute verbatim copies of the Program's source
-code as you receive it, in any medium, provided that you conspicuously and
-appropriately publish on each copy an appropriate copyright notice and
-disclaimer of warranty; keep intact all the notices that refer to this License
-and to the absence of any warranty; and give any other recipients of the
-Program a copy of this License along with the Program.
-
-You may charge a fee for the physical act of transferring a copy, and you
-may at your option offer warranty protection in exchange for a fee.
-
-2. You may modify your copy or copies of the Program or any portion of it,
-thus forming a work based on the Program, and copy and distribute such
-modifications or work under the terms of Section 1 above, provided that you
-also meet all of these conditions:
-
-a) You must cause the modified files to carry prominent notices stating that
-you changed the files and the date of any change.
-
-b) You must cause any work that you distribute or publish, that in whole or in
-part contains or is derived from the Program or any part thereof, to be
-licensed as a whole at no charge to all third parties under the terms of this
-License.
-
-c) If the modified program normally reads commands interactively when run,
-you must cause it, when started running for such interactive use in the most
-ordinary way, to print or display an announcement including an appropriate
-copyright notice and a notice that there is no warranty (or else, saying that
-you provide a warranty) and that users may redistribute the program under
-these conditions, and telling the user how to view a copy of this License.
-(Exception: if the Program itself is interactive but does not normally print such
-an announcement, your work based on the Program is not required to print
-an announcement.)
-
-These requirements apply to the modified work as a whole. If identifiable
-sections of that work are not derived from the Program, and can be
-reasonably considered independent and separate works in themselves, then
-this License, and its terms, do not apply to those sections when you distribute
-them as separate works. But when you distribute the same sections as part
-of a whole which is a work based on the Program, the distribution of the
-whole must be on the terms of this License, whose permissions for other
-licensees extend to the entire whole, and thus to each and every part
-regardless of who wrote it.
-
-Thus, it is not the intent of this section to claim rights or contest your rights to
-work written entirely by you; rather, the intent is to exercise the right to
-control the distribution of derivative or collective works based on the
-Program.
+                    GNU GENERAL PUBLIC LICENSE
+                       Version 2, June 1991
+
+ Copyright (C) 1989, 1991 Free Software Foundation, Inc.,
+ 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
+ Everyone is permitted to copy and distribute verbatim copies
+ of this license document, but changing it is not allowed.
+
+                            Preamble
+
+  The licenses for most software are designed to take away your
+freedom to share and change it.  By contrast, the GNU General Public
+License is intended to guarantee your freedom to share and change free
+software--to make sure the software is free for all its users.  This
+General Public License applies to most of the Free Software
+Foundation's software and to any other program whose authors commit to
+using it.  (Some other Free Software Foundation software is covered by
+the GNU Lesser General Public License instead.)  You can apply it to
+your programs, too.
+
+  When we speak of free software, we are referring to freedom, not
+price.  Our General Public Licenses are designed to make sure that you
+have the freedom to distribute copies of free software (and charge for
+this service if you wish), that you receive source code or can get it
+if you want it, that you can change the software or use pieces of it
+in new free programs; and that you know you can do these things.
+
+  To protect your rights, we need to make restrictions that forbid
+anyone to deny you these rights or to ask you to surrender the rights.
+These restrictions translate to certain responsibilities for you if you
+distribute copies of the software, or if you modify it.
+
+  For example, if you distribute copies of such a program, whether
+gratis or for a fee, you must give the recipients all the rights that
+you have.  You must make sure that they, too, receive or can get the
+source code.  And you must show them these terms so they know their
+rights.
+
+  We protect your rights with two steps: (1) copyright the software, and
+(2) offer you this license which gives you legal permission to copy,
+distribute and/or modify the software.
+
+  Also, for each author's protection and ours, we want to make certain
+that everyone understands that there is no warranty for this free
+software.  If the software is modified by someone else and passed on, we
+want its recipients to know that what they have is not the original, so
+that any problems introduced by others will not reflect on the original
+authors' reputations.
+
+  Finally, any free program is threatened constantly by software
+patents.  We wish to avoid the danger that redistributors of a free
+program will individually obtain patent licenses, in effect making the
+program proprietary.  To prevent this, we have made it clear that any
+patent must be licensed for everyone's free use or not licensed at all.
+
+  The precise terms and conditions for copying, distribution and
+modification follow.
+
+                    GNU GENERAL PUBLIC LICENSE
+   TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION
+
+  0. This License applies to any program or other work which contains
+a notice placed by the copyright holder saying it may be distributed
+under the terms of this General Public License.  The "Program", below,
+refers to any such program or work, and a "work based on the Program"
+means either the Program or any derivative work under copyright law:
+that is to say, a work containing the Program or a portion of it,
+either verbatim or with modifications and/or translated into another
+language.  (Hereinafter, translation is included without limitation in
+the term "modification".)  Each licensee is addressed as "you".
+
+Activities other than copying, distribution and modification are not
+covered by this License; they are outside its scope.  The act of
+running the Program is not restricted, and the output from the Program
+is covered only if its contents constitute a work based on the
+Program (independent of having been made by running the Program).
+Whether that is true depends on what the Program does.
+
+  1. You may copy and distribute verbatim copies of the Program's
+source code as you receive it, in any medium, provided that you
+conspicuously and appropriately publish on each copy an appropriate
+copyright notice and disclaimer of warranty; keep intact all the
+notices that refer to this License and to the absence of any warranty;
+and give any other recipients of the Program a copy of this License
+along with the Program.
+
+You may charge a fee for the physical act of transferring a copy, and
+you may at your option offer warranty protection in exchange for a fee.
+
+  2. You may modify your copy or copies of the Program or any portion
+of it, thus forming a work based on the Program, and copy and
+distribute such modifications or work under the terms of Section 1
+above, provided that you also meet all of these conditions:
+
+    a) You must cause the modified files to carry prominent notices
+    stating that you changed the files and the date of any change.
+
+    b) You must cause any work that you distribute or publish, that in
+    whole or in part contains or is derived from the Program or any
+    part thereof, to be licensed as a whole at no charge to all third
+    parties under the terms of this License.
+
+    c) If the modified program normally reads commands interactively
+    when run, you must cause it, when started running for such
+    interactive use in the most ordinary way, to print or display an
+    announcement including an appropriate copyright notice and a
+    notice that there is no warranty (or else, saying that you provide
+    a warranty) and that users may redistribute the program under
+    these conditions, and telling the user how to view a copy of this
+    License.  (Exception: if the Program itself is interactive but
+    does not normally print such an announcement, your work based on
+    the Program is not required to print an announcement.)
+
+These requirements apply to the modified work as a whole.  If
+identifiable sections of that work are not derived from the Program,
+and can be reasonably considered independent and separate works in
+themselves, then this License, and its terms, do not apply to those
+sections when you distribute them as separate works.  But when you
+distribute the same sections as part of a whole which is a work based
+on the Program, the distribution of the whole must be on the terms of
+this License, whose permissions for other licensees extend to the
+entire whole, and thus to each and every part regardless of who wrote it.
+
+Thus, it is not the intent of this section to claim rights or contest
+your rights to work written entirely by you; rather, the intent is to
+exercise the right to control the distribution of derivative or
+collective works based on the Program.
 
 In addition, mere aggregation of another work not based on the Program
-with the Program (or with a work based on the Program) on a volume of a
-storage or distribution medium does not bring the other work under the scope
-of this License.
-
-3. You may copy and distribute the Program (or a work based on it, under
-Section 2) in object code or executable form under the terms of Sections 1
-and 2 above provided that you also do one of the following:
-
-a) Accompany it with the complete corresponding machine-readable source
-code, which must be distributed under the terms of Sections 1 and 2 above
-on a medium customarily used for software interchange; or,
-
-b) Accompany it with a written offer, valid for at least three years, to give
-any third party, for a charge no more than your cost of physically performing
-source distribution, a complete machine-readable copy of the corresponding
-source code, to be distributed under the terms of Sections 1 and 2 above on
-a medium customarily used for software interchange; or,
-
-c) Accompany it with the information you received as to the offer to distribute
-corresponding source code. (This alternative is allowed only for
-noncommercial distribution and only if you received the program in object
-code or executable form with such an offer, in accord with Subsection b
-above.)
+with the Program (or with a work based on the Program) on a volume of
+a storage or distribution medium does not bring the other work under
+the scope of this License.
+
+  3. You may copy and distribute the Program (or a work based on it,
+under Section 2) in object code or executable form under the terms of
+Sections 1 and 2 above provided that you also do one of the following:
+
+    a) Accompany it with the complete corresponding machine-readable
+    source code, which must be distributed under the terms of Sections
+    1 and 2 above on a medium customarily used for software interchange; or,
+
+    b) Accompany it with a written offer, valid for at least three
+    years, to give any third party, for a charge no more than your
+    cost of physically performing source distribution, a complete
+    machine-readable copy of the corresponding source code, to be
+    distributed under the terms of Sections 1 and 2 above on a medium
+    customarily used for software interchange; or,
+
+    c) Accompany it with the information you received as to the offer
+    to distribute corresponding source code.  (This alternative is
+    allowed only for noncommercial distribution and only if you
+    received the program in object code or executable form with such
+    an offer, in accord with Subsection b above.)
 
 The source code for a work means the preferred form of the work for
-making modifications to it. For an executable work, complete source code
-means all the source code for all modules it contains, plus any associated
-interface definition files, plus the scripts used to control compilation and
-installation of the executable. However, as a special exception, the source
-code distributed need not include anything that is normally distributed (in
-either source or binary form) with the major components (compiler, kernel,
-and so on) of the operating system on which the executable runs, unless that
-component itself accompanies the executable.
-
-If distribution of executable or object code is made by offering access to
-copy from a designated place, then offering equivalent access to copy the
-source code from the same place counts as distribution of the source code,
-even though third parties are not compelled to copy the source along with the
-object code.
-
-4. You may not copy, modify, sublicense, or distribute the Program except as
-expressly provided under this License. Any attempt otherwise to copy,
-modify, sublicense or distribute the Program is void, and will automatically
-terminate your rights under this License. However, parties who have received
-copies, or rights, from you under this License will not have their licenses
-terminated so long as such parties remain in full compliance.
-
-5. You are not required to accept this License, since you have not signed it.
-However, nothing else grants you permission to modify or distribute the
-Program or its derivative works. These actions are prohibited by law if you
-do not accept this License. Therefore, by modifying or distributing the
-Program (or any work based on the Program), you indicate your acceptance
-of this License to do so, and all its terms and conditions for copying,
-distributing or modifying the Program or works based on it.
-
-6. Each time you redistribute the Program (or any work based on the
-Program), the recipient automatically receives a license from the original
-licensor to copy, distribute or modify the Program subject to these terms and
-conditions. You may not impose any further restrictions on the recipients'
-exercise of the rights granted herein. You are not responsible for enforcing
-compliance by third parties to this License.
-
-7. If, as a consequence of a court judgment or allegation of patent
-infringement or for any other reason (not limited to patent issues), conditions
-are imposed on you (whether by court order, agreement or otherwise) that
-contradict the conditions of this License, they do not excuse you from the
-conditions of this License. If you cannot distribute so as to satisfy
-simultaneously your obligations under this License and any other pertinent
-obligations, then as a consequence you may not distribute the Program at all.
-For example, if a patent license would not permit royalty-free redistribution
-of the Program by all those who receive copies directly or indirectly through
-you, then the only way you could satisfy both it and this License would be to
+making modifications to it.  For an executable work, complete source
+code means all the source code for all modules it contains, plus any
+associated interface definition files, plus the scripts used to
+control compilation and installation of the executable.  However, as a
+special exception, the source code distributed need not include
+anything that is normally distributed (in either source or binary
+form) with the major components (compiler, kernel, and so on) of the
+operating system on which the executable runs, unless that component
+itself accompanies the executable.
+
+If distribution of executable or object code is made by offering
+access to copy from a designated place, then offering equivalent
+access to copy the source code from the same place counts as
+distribution of the source code, even though third parties are not
+compelled to copy the source along with the object code.
+
+  4. You may not copy, modify, sublicense, or distribute the Program
+except as expressly provided under this License.  Any attempt
+otherwise to copy, modify, sublicense or distribute the Program is
+void, and will automatically terminate your rights under this License.
+However, parties who have received copies, or rights, from you under
+this License will not have their licenses terminated so long as such
+parties remain in full compliance.
+
+  5. You are not required to accept this License, since you have not
+signed it.  However, nothing else grants you permission to modify or
+distribute the Program or its derivative works.  These actions are
+prohibited by law if you do not accept this License.  Therefore, by
+modifying or distributing the Program (or any work based on the
+Program), you indicate your acceptance of this License to do so, and
+all its terms and conditions for copying, distributing or modifying
+the Program or works based on it.
+
+  6. Each time you redistribute the Program (or any work based on the
+Program), the recipient automatically receives a license from the
+original licensor to copy, distribute or modify the Program subject to
+these terms and conditions.  You may not impose any further
+restrictions on the recipients' exercise of the rights granted herein.
+You are not responsible for enforcing compliance by third parties to
+this License.
+
+  7. If, as a consequence of a court judgment or allegation of patent
+infringement or for any other reason (not limited to patent issues),
+conditions are imposed on you (whether by court order, agreement or
+otherwise) that contradict the conditions of this License, they do not
+excuse you from the conditions of this License.  If you cannot
+distribute so as to satisfy simultaneously your obligations under this
+License and any other pertinent obligations, then as a consequence you
+may not distribute the Program at all.  For example, if a patent
+license would not permit royalty-free redistribution of the Program by
+all those who receive copies directly or indirectly through you, then
+the only way you could satisfy both it and this License would be to
 refrain entirely from distribution of the Program.
 
-If any portion of this section is held invalid or unenforceable under any
-particular circumstance, the balance of the section is intended to apply and
-the section as a whole is intended to apply in other circumstances.
-
-It is not the purpose of this section to induce you to infringe any patents or
-other property right claims or to contest validity of any such claims; this
-section has the sole purpose of protecting the integrity of the free software
-distribution system, which is implemented by public license practices. Many
-people have made generous contributions to the wide range of software
-distributed through that system in reliance on consistent application of that
-system; it is up to the author/donor to decide if he or she is willing to
-distribute software through any other system and a licensee cannot impose
-that choice.
-
-This section is intended to make thoroughly clear what is believed to be a
-consequence of the rest of this License.
-
-8. If the distribution and/or use of the Program is restricted in certain
-countries either by patents or by copyrighted interfaces, the original copyright
-holder who places the Program under this License may add an explicit
-geographical distribution limitation excluding those countries, so that
-distribution is permitted only in or among countries not thus excluded. In such
-case, this License incorporates the limitation as if written in the body of this
-License.
-
-9. The Free Software Foundation may publish revised and/or new versions
-of the General Public License from time to time. Such new versions will be
-similar in spirit to the present version, but may differ in detail to address new
-problems or concerns.
-
-Each version is given a distinguishing version number. If the Program specifies
-a version number of this License which applies to it and "any later version",
-you have the option of following the terms and conditions either of that
-version or of any later version published by the Free Software Foundation. If
-the Program does not specify a version number of this License, you may
-choose any version ever published by the Free Software Foundation.
-
-10. If you wish to incorporate parts of the Program into other free programs
-whose distribution conditions are different, write to the author to ask for
-permission. For software which is copyrighted by the Free Software
-Foundation, write to the Free Software Foundation; we sometimes make
-exceptions for this. Our decision will be guided by the two goals of
-preserving the free status of all derivatives of our free software and of
-promoting the sharing and reuse of software generally.
-
-               NO WARRANTY
-
-11. BECAUSE THE PROGRAM IS LICENSED FREE OF CHARGE,
-THERE IS NO WARRANTY FOR THE PROGRAM, TO THE EXTENT
-PERMITTED BY APPLICABLE LAW. EXCEPT WHEN OTHERWISE
-STATED IN WRITING THE COPYRIGHT HOLDERS AND/OR
-OTHER PARTIES PROVIDE THE PROGRAM "AS IS" WITHOUT
-WARRANTY OF ANY KIND, EITHER EXPRESSED OR IMPLIED,
-INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
-OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
-PURPOSE. THE ENTIRE RISK AS TO THE QUALITY AND
-PERFORMANCE OF THE PROGRAM IS WITH YOU. SHOULD THE
-PROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF ALL
-NECESSARY SERVICING, REPAIR OR CORRECTION.
-
-12. IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR
-AGREED TO IN WRITING WILL ANY COPYRIGHT HOLDER, OR
-ANY OTHER PARTY WHO MAY MODIFY AND/OR
-REDISTRIBUTE THE PROGRAM AS PERMITTED ABOVE, BE
-LIABLE TO YOU FOR DAMAGES, INCLUDING ANY GENERAL,
-SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES
-ARISING OUT OF THE USE OR INABILITY TO USE THE
-PROGRAM (INCLUDING BUT NOT LIMITED TO LOSS OF DATA
-OR DATA BEING RENDERED INACCURATE OR LOSSES
-SUSTAINED BY YOU OR THIRD PARTIES OR A FAILURE OF THE
-PROGRAM TO OPERATE WITH ANY OTHER PROGRAMS), EVEN
-IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF
-THE POSSIBILITY OF SUCH DAMAGES.
-
-          END OF TERMS AND CONDITIONS
+If any portion of this section is held invalid or unenforceable under
+any particular circumstance, the balance of the section is intended to
+apply and the section as a whole is intended to apply in other
+circumstances.
+
+It is not the purpose of this section to induce you to infringe any
+patents or other property right claims or to contest validity of any
+such claims; this section has the sole purpose of protecting the
+integrity of the free software distribution system, which is
+implemented by public license practices.  Many people have made
+generous contributions to the wide range of software distributed
+through that system in reliance on consistent application of that
+system; it is up to the author/donor to decide if he or she is willing
+to distribute software through any other system and a licensee cannot
+impose that choice.
+
+This section is intended to make thoroughly clear what is believed to
+be a consequence of the rest of this License.
+
+  8. If the distribution and/or use of the Program is restricted in
+certain countries either by patents or by copyrighted interfaces, the
+original copyright holder who places the Program under this License
+may add an explicit geographical distribution limitation excluding
+those countries, so that distribution is permitted only in or among
+countries not thus excluded.  In such case, this License incorporates
+the limitation as if written in the body of this License.
+
+  9. The Free Software Foundation may publish revised and/or new versions
+of the General Public License from time to time.  Such new versions will
+be similar in spirit to the present version, but may differ in detail to
+address new problems or concerns.
+
+Each version is given a distinguishing version number.  If the Program
+specifies a version number of this License which applies to it and "any
+later version", you have the option of following the terms and conditions
+either of that version or of any later version published by the Free
+Software Foundation.  If the Program does not specify a version number of
+this License, you may choose any version ever published by the Free Software
+Foundation.
+
+  10. If you wish to incorporate parts of the Program into other free
+programs whose distribution conditions are different, write to the author
+to ask for permission.  For software which is copyrighted by the Free
+Software Foundation, write to the Free Software Foundation; we sometimes
+make exceptions for this.  Our decision will be guided by the two goals
+of preserving the free status of all derivatives of our free software and
+of promoting the sharing and reuse of software generally.
+
+                            NO WARRANTY
+
+  11. BECAUSE THE PROGRAM IS LICENSED FREE OF CHARGE, THERE IS NO WARRANTY
+FOR THE PROGRAM, TO THE EXTENT PERMITTED BY APPLICABLE LAW.  EXCEPT WHEN
+OTHERWISE STATED IN WRITING THE COPYRIGHT HOLDERS AND/OR OTHER PARTIES
+PROVIDE THE PROGRAM "AS IS" WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED
+OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  THE ENTIRE RISK AS
+TO THE QUALITY AND PERFORMANCE OF THE PROGRAM IS WITH YOU.  SHOULD THE
+PROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF ALL NECESSARY SERVICING,
+REPAIR OR CORRECTION.
+
+  12. IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING
+WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MAY MODIFY AND/OR
+REDISTRIBUTE THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES,
+INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES ARISING
+OUT OF THE USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT NOT LIMITED
+TO LOSS OF DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY
+YOU OR THIRD PARTIES OR A FAILURE OF THE PROGRAM TO OPERATE WITH ANY OTHER
+PROGRAMS), EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE
+POSSIBILITY OF SUCH DAMAGES.
+
+                     END OF TERMS AND CONDITIONS
+
+            How to Apply These Terms to Your New Programs
+
+  If you develop a new program, and you want it to be of the greatest
+possible use to the public, the best way to achieve this is to make it
+free software which everyone can redistribute and change under these terms.
+
+  To do so, attach the following notices to the program.  It is safest
+to attach them to the start of each source file to most effectively
+convey the exclusion of warranty; and each file should have at least
+the "copyright" line and a pointer to where the full notice is found.
+
+    <one line to give the program's name and a brief idea of what it does.>
+    Copyright (C) <year>  <name of author>
+
+    This program is free software; you can redistribute it and/or modify
+    it under the terms of the GNU General Public License as published by
+    the Free Software Foundation; either version 2 of the License, or
+    (at your option) any later version.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License along
+    with this program; if not, write to the Free Software Foundation, Inc.,
+    51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
+
+Also add information on how to contact you by electronic and paper mail.
+
+If the program is interactive, make it output a short notice like this
+when it starts in an interactive mode:
+
+    Gnomovision version 69, Copyright (C) year name of author
+    Gnomovision comes with ABSOLUTELY NO WARRANTY; for details type `show w'.
+    This is free software, and you are welcome to redistribute it
+    under certain conditions; type `show c' for details.
+
+The hypothetical commands `show w' and `show c' should show the appropriate
+parts of the General Public License.  Of course, the commands you use may
+be called something other than `show w' and `show c'; they could even be
+mouse-clicks or menu items--whatever suits your program.
+
+You should also get your employer (if you work as a programmer) or your
+school, if any, to sign a "copyright disclaimer" for the program, if
+necessary.  Here is a sample; alter the names:
+
+  Yoyodyne, Inc., hereby disclaims all copyright interest in the program
+  `Gnomovision' (which makes passes at compilers) written by James Hacker.
+
+  <signature of Ty Coon>, 1 April 1989
+  Ty Coon, President of Vice
+
+This General Public License does not permit incorporating your program into
+proprietary programs.  If your program is a subroutine library, you may
+consider it more useful to permit linking proprietary applications with the
+library.  If this is what you want to do, use the GNU Lesser General
+Public License instead of this License.
diff --git a/profiles/openatrium/modules/contrib/markdown/markdown.info b/profiles/openatrium/modules/contrib/markdown/markdown.info
index 12e6c9e..0d4d959 100644
--- a/profiles/openatrium/modules/contrib/markdown/markdown.info
+++ b/profiles/openatrium/modules/contrib/markdown/markdown.info
@@ -1,12 +1,11 @@
 name = Markdown filter
 description = Allows content to be submitted using Markdown, a simple plain-text syntax that is transformed into valid XHTML.
 package = "Input filters"
-dependencies[] = filter
 core = 6.x
 
-; Information added by drupal.org packaging script on 2010-04-29
-version = "6.x-1.2"
+; Information added by drupal.org packaging script on 2012-11-26
+version = "6.x-1.3"
 core = "6.x"
 project = "markdown"
-datestamp = "1272513007"
+datestamp = "1353934354"
 
diff --git a/profiles/openatrium/modules/contrib/markdown/markdown.module b/profiles/openatrium/modules/contrib/markdown/markdown.module
index d51c5b5..bd7821d 100644
--- a/profiles/openatrium/modules/contrib/markdown/markdown.module
+++ b/profiles/openatrium/modules/contrib/markdown/markdown.module
@@ -1,5 +1,4 @@
 <?php
-// $Id: markdown.module,v 1.1.2.3 2008/06/02 15:46:45 goba Exp $
 
 // == Core hooks ===============================================================
 
diff --git a/profiles/openatrium/modules/contrib/markdown/markdown.php b/profiles/openatrium/modules/contrib/markdown/markdown.php
old mode 100644
new mode 100755
index ee3dddb..f548fc2
--- a/profiles/openatrium/modules/contrib/markdown/markdown.php
+++ b/profiles/openatrium/modules/contrib/markdown/markdown.php
@@ -3,7 +3,7 @@
 # Markdown Extra  -  A text-to-HTML conversion tool for web writers
 #
 # PHP Markdown & Extra
-# Copyright (c) 2004-2009 Michel Fortin  
+# Copyright (c) 2004-2012 Michel Fortin  
 # <http://michelf.com/projects/php-markdown/>
 #
 # Original Markdown
@@ -12,8 +12,8 @@
 #
 
 
-define( 'MARKDOWN_VERSION',  "1.0.1n" ); # Sat 10 Oct 2009
-define( 'MARKDOWNEXTRA_VERSION',  "1.2.4" ); # Sat 10 Oct 2009
+define( 'MARKDOWN_VERSION',  "1.0.1o" ); # Sun 8 Jan 2012
+define( 'MARKDOWNEXTRA_VERSION',  "1.2.5" ); # Sun 8 Jan 2012
 
 
 #
@@ -71,7 +71,7 @@ function Markdown($text) {
 Plugin Name: Markdown Extra
 Plugin URI: http://michelf.com/projects/php-markdown/
 Description: <a href="http://daringfireball.net/projects/markdown/syntax">Markdown syntax</a> allows you to write using an easy-to-read, easy-to-write plain text format. Based on the original Perl version by <a href="http://daringfireball.net/">John Gruber</a>. <a href="http://michelf.com/projects/php-markdown/">More...</a>
-Version: 1.2.4
+Version: 1.2.5
 Author: Michel Fortin
 Author URI: http://michelf.com/
 */
@@ -950,7 +950,7 @@ class Markdown_Parser {
 
 		# Re-usable patterns to match list item bullets and number markers:
 		$marker_ul_re  = '[*+-]';
-		$marker_ol_re  = '\d+[.]';
+		$marker_ol_re  = '\d+[\.]';
 		$marker_any_re = "(?:$marker_ul_re|$marker_ol_re)";
 
 		$markers_relist = array(
@@ -1011,7 +1011,7 @@ class Markdown_Parser {
 	function _doLists_callback($matches) {
 		# Re-usable patterns to match list item bullets and number markers:
 		$marker_ul_re  = '[*+-]';
-		$marker_ol_re  = '\d+[.]';
+		$marker_ol_re  = '\d+[\.]';
 		$marker_any_re = "(?:$marker_ul_re|$marker_ol_re)";
 		
 		$list = $matches[1];
@@ -1141,17 +1141,17 @@ class Markdown_Parser {
 
 
 	var $em_relist = array(
-		''  => '(?:(?<!\*)\*(?!\*)|(?<!_)_(?!_))(?=\S|$)(?![.,:;]\s)',
+		''  => '(?:(?<!\*)\*(?!\*)|(?<!_)_(?!_))(?=\S|$)(?![\.,:;]\s)',
 		'*' => '(?<=\S|^)(?<!\*)\*(?!\*)',
 		'_' => '(?<=\S|^)(?<!_)_(?!_)',
 		);
 	var $strong_relist = array(
-		''   => '(?:(?<!\*)\*\*(?!\*)|(?<!_)__(?!_))(?=\S|$)(?![.,:;]\s)',
+		''   => '(?:(?<!\*)\*\*(?!\*)|(?<!_)__(?!_))(?=\S|$)(?![\.,:;]\s)',
 		'**' => '(?<=\S|^)(?<!\*)\*\*(?!\*)',
 		'__' => '(?<=\S|^)(?<!_)__(?!_)',
 		);
 	var $em_strong_relist = array(
-		''    => '(?:(?<!\*)\*\*\*(?!\*)|(?<!_)___(?!_))(?=\S|$)(?![.,:;]\s)',
+		''    => '(?:(?<!\*)\*\*\*(?!\*)|(?<!_)___(?!_))(?=\S|$)(?![\.,:;]\s)',
 		'***' => '(?<=\S|^)(?<!\*)\*\*\*(?!\*)',
 		'___' => '(?<=\S|^)(?<!_)___(?!_)',
 		);
@@ -1885,7 +1885,7 @@ class MarkdownExtra_Parser extends Markdown_Parser {
 				|
 					# Fenced code block marker
 					(?> ^ | \n )
-					[ ]{'.($indent).'}~~~+[ ]*\n
+					[ ]{0,'.($indent).'}~~~+[ ]*\n
 				' : '' ). ' # End (if not is span).
 				)
 			}xs';
@@ -1947,20 +1947,12 @@ class MarkdownExtra_Parser extends Markdown_Parser {
 				}
 			}
 			#
-			# Check for: Indented code block.
-			#
-			else if ($tag{0} == "\n" || $tag{0} == " ") {
-				# Indented code block: pass it unchanged, will be handled 
-				# later.
-				$parsed .= $tag;
-			}
-			#
 			# Check for: Fenced code block marker.
 			#
-			else if ($tag{0} == "~") {
+			else if (preg_match('{^\n?[ ]{0,'.($indent+3).'}~}', $tag)) {
 				# Fenced code block marker: find matching end marker.
 				$tag_re = preg_quote(trim($tag));
-				if (preg_match('{^(?>.*\n)+?'.$tag_re.' *\n}', $text, 
+				if (preg_match('{^(?>.*\n)+?[ ]{0,'.($indent).'}'.$tag_re.'[ ]*\n}', $text, 
 					$matches)) 
 				{
 					# End marker found: pass text unchanged until marker.
@@ -1973,6 +1965,14 @@ class MarkdownExtra_Parser extends Markdown_Parser {
 				}
 			}
 			#
+			# Check for: Indented code block.
+			#
+			else if ($tag{0} == "\n" || $tag{0} == " ") {
+				# Indented code block: pass it unchanged, will be handled 
+				# later.
+				$parsed .= $tag;
+			}
+			#
 			# Check for: Opening Block level tag or
 			#            Opening Context Block tag (like ins and del) 
 			#               used as a block tag (tag is alone on it's line).
@@ -2588,17 +2588,17 @@ class MarkdownExtra_Parser extends Markdown_Parser {
 	# work in the middle of a word.
 	#
 	var $em_relist = array(
-		''  => '(?:(?<!\*)\*(?!\*)|(?<![a-zA-Z0-9_])_(?!_))(?=\S|$)(?![.,:;]\s)',
+		''  => '(?:(?<!\*)\*(?!\*)|(?<![a-zA-Z0-9_])_(?!_))(?=\S|$)(?![\.,:;]\s)',
 		'*' => '(?<=\S|^)(?<!\*)\*(?!\*)',
 		'_' => '(?<=\S|^)(?<!_)_(?![a-zA-Z0-9_])',
 		);
 	var $strong_relist = array(
-		''   => '(?:(?<!\*)\*\*(?!\*)|(?<![a-zA-Z0-9_])__(?!_))(?=\S|$)(?![.,:;]\s)',
+		''   => '(?:(?<!\*)\*\*(?!\*)|(?<![a-zA-Z0-9_])__(?!_))(?=\S|$)(?![\.,:;]\s)',
 		'**' => '(?<=\S|^)(?<!\*)\*\*(?!\*)',
 		'__' => '(?<=\S|^)(?<!_)__(?![a-zA-Z0-9_])',
 		);
 	var $em_strong_relist = array(
-		''    => '(?:(?<!\*)\*\*\*(?!\*)|(?<![a-zA-Z0-9_])___(?!_))(?=\S|$)(?![.,:;]\s)',
+		''    => '(?:(?<!\*)\*\*\*(?!\*)|(?<![a-zA-Z0-9_])___(?!_))(?=\S|$)(?![\.,:;]\s)',
 		'***' => '(?<=\S|^)(?<!\*)\*\*\*(?!\*)',
 		'___' => '(?<=\S|^)(?<!_)___(?![a-zA-Z0-9_])',
 		);
diff --git a/profiles/openatrium/modules/contrib/markdown/translations/fr.po b/profiles/openatrium/modules/contrib/markdown/translations/fr.po
deleted file mode 100644
index 15f308a..0000000
--- a/profiles/openatrium/modules/contrib/markdown/translations/fr.po
+++ /dev/null
@@ -1,68 +0,0 @@
-# $Id: fr.po,v 1.1.2.1 2009/04/06 11:11:23 slybud Exp $
-#
-# Traduction en franais du module Markdown filter pour Drupal
-# Copyright 2009 Jean-Philippe Fleury <contact@jpfleury.net>
-# Generated from files:
-#  markdown.module,v 1.1.2.3 2008/06/02 15:46:45 goba
-#  markdown.info: n/a
-#
-msgid ""
-msgstr ""
-"Project-Id-Version: 1.0\n"
-"POT-Creation-Date: 2009-02-23 18:26-0500\n"
-"PO-Revision-Date: 2009-02-23 20:00-0500\n"
-"Last-Translator: Jean-Philippe Fleury <contact@jpfleury.net>\n"
-"Language-Team: \n"
-"MIME-Version: 1.0\n"
-"Content-Type: text/plain; charset=utf-8\n"
-"Content-Transfer-Encoding: 8bit\n"
-"Plural-Forms: nplurals=2; plural=(n>1);\n"
-
-#: markdown.module:9
-msgid "<p>The Markdown filter allows you to enter content using <a href=\"http://daringfireball.net/projects/markdown\">Markdown</a>, a simple plain-text syntax that is transformed into valid XHTML.</p>"
-msgstr "<p>Le module Markdown filter permet d'crire en utilisant la <a href=\"http://michelf.com/projets/php-markdown/\">syntaxe Markdown</a>, un format texte simple qui est transform en XHTML valide.</p>"
-
-#: markdown.module:20;122
-msgid "Markdown"
-msgstr "Markdown"
-
-#: markdown.module:22
-msgid "Allows content to be submitted using Markdown, a simple plain-text syntax that is filtered into valid XHTML."
-msgstr "Permet la soumission de contenu rdig en Markdown, un format texte simple transform en XHTML valide."
-
-#: markdown.module:40;45
-msgid "Markdown filter tips"
-msgstr "Astuces de composition en Markdown"
-
-#: markdown.module:57
-msgid "Quick Tips:<ul>\n      <li>Two or more spaces at a line's end = Line break</li>\n      <li>Double returns = Paragraph</li>\n      <li>*Single asterisks* or _single underscores_ = <em>Emphasis</em></li>\n      <li>**Double** or __double__ = <strong>Strong</strong></li>\n      <li>This is [a link](http://the.link.example.com \"The optional title text\")</li>\n      </ul>For complete details on the Markdown syntax, see the <a href=\"http://daringfireball.net/projects/markdown/syntax\">Markdown documentation</a> and <a href=\"http://michelf.com/projects/php-markdown/extra/\">Markdown Extra documentation</a> for tables, footnotes, and more."
-msgstr "Aide-mmoire:<ul>\n      <li>Deux espaces ou plus  la fin d'une ligne = Saut de ligne</li>\n      <li>Deux sauts de ligne = Paragraphe</li>\n      <li>*Astrisques simples* ou _traits de soulignement simples_ = <em>Emphase</em></li>\n      <li>**Astrisques doubles** ou __traits de soulignement doubles__ = <strong>Emphase forte</strong></li>\n      <li>Ceci est [un lien](http://un.lien.exemple.com \"Titre optionnel\")</li>\n      </ul>Pour une aide dtaille sur la syntaxe Markdown, voir la <a href=\"http://michelf.com/projets/php-markdown/syntaxe/\">documentation Markdown</a> ainsi que la <a href=\"http://michelf.com/projets/php-markdown/extra/\">documentation Markdown Extra</a> pour les tables, notes de bas de page et autres structurations."
-
-#: markdown.module:66
-msgid "You can use <a href=\"@filter_tips\">Markdown syntax</a> to format and style the text. Also see <a href=\"@markdown_extra\">Markdown Extra</a> for tables, footnotes, and more."
-msgstr "Vous pouvez utiliser la <a href=\"@filter_tips\">syntaxe Markdown</a> pour mettre en forme le texte. Voir aussi <a href=\"@markdown_extra\">Markdown Extra</a> pour les tables, notes de bas de page et autres structurations."
-
-#: markdown.module:76
-msgid "\n## Header 2 ##\n### Header 3 ###\n#### Header 4 ####\n##### Header 5 #####\n(Hashes on right are optional)\n\nLink [Drupal](http://drupal.org)\n\nInline markup like _italics_,\n **bold**, and `code()`.\n\n> Blockquote. Like email replies\n>> And, they can be nested\n\n* Bullet lists are easy too\n- Another one\n+ Another one\n\n1. A numbered list\n2. Which is numbered\n3. With periods and a space\n\nAnd now some code:\n    // Code is indented text\n    is_easy() to_remember();"
-msgstr "\n## Titre de niveau 2 ##\n### Titre de niveau 3 ###\n#### Titre de niveau 4 ####\n##### Titre de niveau 5 #####\n(Les dises  la droite sont optionnels)\n\nLien [Drupal en franais](http://drupalfr.org)\n\nlments de texte comme _l'italique_,\n **le gras**, et `du code()`.\n\n> Citation. Comme les rponses dans un courriel\n>> L'imbrication est permise\n\n* Les listes peuvent tre formes  l'aide d'astrisques\n-  l'aide de traits d'union\n+ galement  l'aide de signes plus\n\n1. Une liste numrote\n2. Qui est numrote\n3.  l'aide d'un point et d'une espace\n\nVoici maintenant du code:\n    // Le code est du texte indent\n    facile() de_se_souvenir();"
-
-#: markdown.module:129
-msgid "Versions"
-msgstr "Versions"
-
-#: markdown.module:0
-msgid "markdown"
-msgstr "markdown"
-
-#: markdown.info:0
-msgid "Markdown filter"
-msgstr "Markdown filter"
-
-#: markdown.info:0
-msgid "Allows content to be submitted using Markdown, a simple plain-text syntax that is transformed into valid XHTML."
-msgstr "Permet la soumission de contenu rdig en Markdown, un format texte simple transform en XHTML valide."
-
-#: markdown.info:0
-msgid "Input filters"
-msgstr "Filtres en entre"
-
diff --git a/profiles/openatrium/modules/contrib/markdown/translations/ja.po b/profiles/openatrium/modules/contrib/markdown/translations/ja.po
deleted file mode 100644
index 41cb647..0000000
--- a/profiles/openatrium/modules/contrib/markdown/translations/ja.po
+++ /dev/null
@@ -1,68 +0,0 @@
-# $Id: ja.po,v 1.1.2.1 2009/02/23 03:09:49 pineray Exp $
-#
-# Japanese translation of Drupal (general)
-# Copyright YEAR NAME <EMAIL@ADDRESS>
-# Generated from files:
-#  markdown.module,v 1.1.2.3 2008/06/02 15:46:45 goba
-#  markdown.info: n/a
-#
-msgid ""
-msgstr ""
-"Project-Id-Version: PROJECT VERSION\n"
-"POT-Creation-Date: 2009-01-23 20:41+0900\n"
-"PO-Revision-Date: 2009-01-23 20:41+0900\n"
-"Last-Translator: NAME <EMAIL@ADDRESS>\n"
-"Language-Team: Japanese <EMAIL@ADDRESS>\n"
-"MIME-Version: 1.0\n"
-"Content-Type: text/plain; charset=utf-8\n"
-"Content-Transfer-Encoding: 8bit\n"
-"Plural-Forms: nplurals=2; plural=(n!=1);\n"
-
-#: markdown.module:9
-msgid "<p>The Markdown filter allows you to enter content using <a href=\"http://daringfireball.net/projects/markdown\">Markdown</a>, a simple plain-text syntax that is transformed into valid XHTML.</p>"
-msgstr "<p>Markdown<a href=\"http://daringfireball.net/projects/markdown\">Markdown</a>XHTML</p>"
-
-#: markdown.module:20;122
-msgid "Markdown"
-msgstr "Markdown"
-
-#: markdown.module:22
-msgid "Allows content to be submitted using Markdown, a simple plain-text syntax that is filtered into valid XHTML."
-msgstr "MarkdownXHTML"
-
-#: markdown.module:40;45
-msgid "Markdown filter tips"
-msgstr "Markdowntips"
-
-#: markdown.module:57
-msgid "Quick Tips:<ul>\n      <li>Two or more spaces at a line's end = Line break</li>\n      <li>Double returns = Paragraph</li>\n      <li>*Single asterisks* or _single underscores_ = <em>Emphasis</em></li>\n      <li>**Double** or __double__ = <strong>Strong</strong></li>\n      <li>This is [a link](http://the.link.example.com \"The optional title text\")</li>\n      </ul>For complete details on the Markdown syntax, see the <a href=\"http://daringfireball.net/projects/markdown/syntax\">Markdown documentation</a> and <a href=\"http://michelf.com/projects/php-markdown/extra/\">Markdown Extra documentation</a> for tables, footnotes, and more."
-msgstr "Tips:<ul>\n      <li>2 = </li>\n      <li>(2) = </li>\n      <li>*1*  _1_ = <em>(em)</em></li>\n      <li>**2** or __2__ = <strong>(strong)</strong></li>\n      <li>[](http://the.link.example.com \"\") </li>\n      </ul>Markdown<a href=\"http://daringfireball.net/projects/markdown/syntax\">Markdown</a><a href=\"http://michelf.com/projects/php-markdown/extra/\">Markdown Extra</a>"
-
-#: markdown.module:66
-msgid "You can use <a href=\"@filter_tips\">Markdown syntax</a> to format and style the text. Also see <a href=\"@markdown_extra\">Markdown Extra</a> for tables, footnotes, and more."
-msgstr "<a href=\"@filter_tips\">Markdown</a><a href=\"@markdown_extra\">Markdown Extra</a>"
-
-#: markdown.module:76
-msgid "\n## Header 2 ##\n### Header 3 ###\n#### Header 4 ####\n##### Header 5 #####\n(Hashes on right are optional)\n\nLink [Drupal](http://drupal.org)\n\nInline markup like _italics_,\n **bold**, and `code()`.\n\n> Blockquote. Like email replies\n>> And, they can be nested\n\n* Bullet lists are easy too\n- Another one\n+ Another one\n\n1. A numbered list\n2. Which is numbered\n3. With periods and a space\n\nAnd now some code:\n    // Code is indented text\n    is_easy() to_remember();"
-msgstr "\n##  2 ##\n###  3 ###\n####  4 ####\n#####  5 #####\n()\n\n [Drupal](http://drupal.org)\n\n like __,\n ****, and `()`.\n\n> \n>> \n\n* \n- \n+ \n\n1. \n2. \n3. \n\n:\n    // \n    is_easy() to_remember();"
-
-#: markdown.module:129
-msgid "Versions"
-msgstr ""
-
-#: markdown.module:0
-msgid "markdown"
-msgstr "markdown"
-
-#: markdown.info:0
-msgid "Markdown filter"
-msgstr "Markdown"
-
-#: markdown.info:0
-msgid "Allows content to be submitted using Markdown, a simple plain-text syntax that is transformed into valid XHTML."
-msgstr "MarkdownXHTML"
-
-#: markdown.info:0
-msgid "Input filters"
-msgstr ""
-
diff --git a/profiles/openatrium/modules/contrib/markdown/translations/markdown.pot b/profiles/openatrium/modules/contrib/markdown/translations/markdown.pot
deleted file mode 100644
index fc1d818..0000000
--- a/profiles/openatrium/modules/contrib/markdown/translations/markdown.pot
+++ /dev/null
@@ -1,69 +0,0 @@
-# $Id: markdown.pot,v 1.1.2.1 2009/04/06 11:11:23 slybud Exp $
-#
-# LANGUAGE translation of Drupal (general)
-# Copyright YEAR NAME <EMAIL@ADDRESS>
-# Generated from files:
-#  markdown.module,v 1.1.2.3 2008/06/02 15:46:45 goba
-#  markdown.info: n/a
-#
-#, fuzzy
-msgid ""
-msgstr ""
-"Project-Id-Version: PROJECT VERSION\n"
-"POT-Creation-Date: 2009-02-23 18:26-0500\n"
-"PO-Revision-Date: YYYY-mm-DD HH:MM+ZZZZ\n"
-"Last-Translator: NAME <EMAIL@ADDRESS>\n"
-"Language-Team: LANGUAGE <EMAIL@ADDRESS>\n"
-"MIME-Version: 1.0\n"
-"Content-Type: text/plain; charset=utf-8\n"
-"Content-Transfer-Encoding: 8bit\n"
-"Plural-Forms: nplurals=INTEGER; plural=EXPRESSION;\n"
-
-#: markdown.module:9
-msgid "<p>The Markdown filter allows you to enter content using <a href=\"http://daringfireball.net/projects/markdown\">Markdown</a>, a simple plain-text syntax that is transformed into valid XHTML.</p>"
-msgstr ""
-
-#: markdown.module:20;122
-msgid "Markdown"
-msgstr ""
-
-#: markdown.module:22
-msgid "Allows content to be submitted using Markdown, a simple plain-text syntax that is filtered into valid XHTML."
-msgstr ""
-
-#: markdown.module:40;45
-msgid "Markdown filter tips"
-msgstr ""
-
-#: markdown.module:57
-msgid "Quick Tips:<ul>\n      <li>Two or more spaces at a line's end = Line break</li>\n      <li>Double returns = Paragraph</li>\n      <li>*Single asterisks* or _single underscores_ = <em>Emphasis</em></li>\n      <li>**Double** or __double__ = <strong>Strong</strong></li>\n      <li>This is [a link](http://the.link.example.com \"The optional title text\")</li>\n      </ul>For complete details on the Markdown syntax, see the <a href=\"http://daringfireball.net/projects/markdown/syntax\">Markdown documentation</a> and <a href=\"http://michelf.com/projects/php-markdown/extra/\">Markdown Extra documentation</a> for tables, footnotes, and more."
-msgstr ""
-
-#: markdown.module:66
-msgid "You can use <a href=\"@filter_tips\">Markdown syntax</a> to format and style the text. Also see <a href=\"@markdown_extra\">Markdown Extra</a> for tables, footnotes, and more."
-msgstr ""
-
-#: markdown.module:76
-msgid "\n## Header 2 ##\n### Header 3 ###\n#### Header 4 ####\n##### Header 5 #####\n(Hashes on right are optional)\n\nLink [Drupal](http://drupal.org)\n\nInline markup like _italics_,\n **bold**, and `code()`.\n\n> Blockquote. Like email replies\n>> And, they can be nested\n\n* Bullet lists are easy too\n- Another one\n+ Another one\n\n1. A numbered list\n2. Which is numbered\n3. With periods and a space\n\nAnd now some code:\n    // Code is indented text\n    is_easy() to_remember();"
-msgstr ""
-
-#: markdown.module:129
-msgid "Versions"
-msgstr ""
-
-#: markdown.module:0
-msgid "markdown"
-msgstr ""
-
-#: markdown.info:0
-msgid "Markdown filter"
-msgstr ""
-
-#: markdown.info:0
-msgid "Allows content to be submitted using Markdown, a simple plain-text syntax that is transformed into valid XHTML."
-msgstr ""
-
-#: markdown.info:0
-msgid "Input filters"
-msgstr ""
-
diff --git a/profiles/openatrium/openatrium.make-php-strict b/profiles/openatrium/openatrium.make-php-strict
index f00a2f3..1b6d865 100644
--- a/profiles/openatrium/openatrium.make-php-strict
+++ b/profiles/openatrium/openatrium.make-php-strict
@@ -27,13 +27,13 @@ projects[content_profile][subdir] = "contrib"
 projects[content_profile][version] = "1.0"
 
 projects[context][subdir] = "contrib"
-projects[context][version] = "3.0"
+projects[context][version] = "3.1"
 
 projects[crayon][subdir] = "contrib"
 projects[crayon][version] = "1.0-beta3"
 
 projects[ctools][subdir] = "contrib"
-projects[ctools][version] = "1.9"
+projects[ctools][version] = "1.10"
 
 projects[date][subdir] = "contrib"
 projects[date][version] = "2.8"
@@ -52,7 +52,7 @@ projects[features][subdir] = "contrib"
 projects[features][version = "1.1"
 
 projects[feeds][subdir] = "contrib"
-projects[feeds][version] = "1.0-beta11"
+projects[feeds][version] = "1.0-beta13"
 
 projects[data][subdir] = "contrib"
 projects[data][version] = "1.1"
@@ -91,7 +91,7 @@ projects[mailhandler][subdir] = "contrib"
 projects[mailhandler][version] = "1.11"
 
 projects[markdown][subdir] = "contrib"
-projects[markdown][version] = "1.2"
+projects[markdown][version] = "1.3"
 
 projects[messaging][subdir] = "contrib"
 projects[messaging][version] = "2.4"
diff --git a/scripts/drupal.sh b/scripts/drupal.sh
index 2bf035a..36b1f06 100755
--- a/scripts/drupal.sh
+++ b/scripts/drupal.sh
@@ -112,7 +112,7 @@ while ($param = array_shift($_SERVER['argv'])) {
           $_REQUEST = $_GET;
         }
 
-        // set file to execute or Drupal path (clean urls enabled)
+        // set file to execute or Drupal path (clean URLs enabled)
         if (isset($path['path']) && file_exists(substr($path['path'], 1))) {
           $_SERVER['PHP_SELF'] = $_SERVER['REQUEST_URI'] = $path['path'];
           $cmd = substr($path['path'], 1);
diff --git a/themes/bluemarine/bluemarine.info b/themes/bluemarine/bluemarine.info
index 76e04ee..1f3f849 100644
--- a/themes/bluemarine/bluemarine.info
+++ b/themes/bluemarine/bluemarine.info
@@ -4,8 +4,8 @@ version = VERSION
 core = 6.x
 engine = phptemplate
 
-; Information added by drupal.org packaging script on 2012-05-02
-version = "6.26"
+; Information added by drupal.org packaging script on 2013-01-16
+version = "6.28"
 project = "drupal"
-datestamp = "1335977158"
+datestamp = "1358370963"
 
diff --git a/themes/chameleon/chameleon.info b/themes/chameleon/chameleon.info
index eb3031f..44809a1 100644
--- a/themes/chameleon/chameleon.info
+++ b/themes/chameleon/chameleon.info
@@ -11,8 +11,8 @@ stylesheets[all][] = common.css
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2012-05-02
-version = "6.26"
+; Information added by drupal.org packaging script on 2013-01-16
+version = "6.28"
 project = "drupal"
-datestamp = "1335977158"
+datestamp = "1358370963"
 
diff --git a/themes/chameleon/marvin/marvin.info b/themes/chameleon/marvin/marvin.info
index 3202d9c..ae03857 100644
--- a/themes/chameleon/marvin/marvin.info
+++ b/themes/chameleon/marvin/marvin.info
@@ -6,8 +6,8 @@ version = VERSION
 core = 6.x
 base theme = chameleon
 
-; Information added by drupal.org packaging script on 2012-05-02
-version = "6.26"
+; Information added by drupal.org packaging script on 2013-01-16
+version = "6.28"
 project = "drupal"
-datestamp = "1335977158"
+datestamp = "1358370963"
 
diff --git a/themes/garland/garland.info b/themes/garland/garland.info
index 00b7501..a84f99f 100644
--- a/themes/garland/garland.info
+++ b/themes/garland/garland.info
@@ -6,8 +6,8 @@ engine = phptemplate
 stylesheets[all][] = style.css
 stylesheets[print][] = print.css
 
-; Information added by drupal.org packaging script on 2012-05-02
-version = "6.26"
+; Information added by drupal.org packaging script on 2013-01-16
+version = "6.28"
 project = "drupal"
-datestamp = "1335977158"
+datestamp = "1358370963"
 
diff --git a/themes/garland/minnelli/minnelli.info b/themes/garland/minnelli/minnelli.info
index 32ad963..ed169c2 100644
--- a/themes/garland/minnelli/minnelli.info
+++ b/themes/garland/minnelli/minnelli.info
@@ -5,8 +5,8 @@ core = 6.x
 base theme = garland
 stylesheets[all][] = minnelli.css
 
-; Information added by drupal.org packaging script on 2012-05-02
-version = "6.26"
+; Information added by drupal.org packaging script on 2013-01-16
+version = "6.28"
 project = "drupal"
-datestamp = "1335977158"
+datestamp = "1358370963"
 
diff --git a/themes/pushbutton/pushbutton.info b/themes/pushbutton/pushbutton.info
index 1330ab1..a3f1aea 100644
--- a/themes/pushbutton/pushbutton.info
+++ b/themes/pushbutton/pushbutton.info
@@ -4,8 +4,8 @@ version = VERSION
 core = 6.x
 engine = phptemplate
 
-; Information added by drupal.org packaging script on 2012-05-02
-version = "6.26"
+; Information added by drupal.org packaging script on 2013-01-16
+version = "6.28"
 project = "drupal"
-datestamp = "1335977158"
+datestamp = "1358370963"
 
diff --git a/update.php b/update.php
index 80cb954..9840657 100644
--- a/update.php
+++ b/update.php
@@ -183,6 +183,9 @@ function update_do_one($module, $number, &$context) {
   $context['message'] = 'Updating '. check_plain($module) .' module';
 }
 
+/**
+ * Renders a form with a list of available database updates.
+ */
 function update_selection_page() {
   $output = '<p>The version of Drupal you are updating from has been automatically detected. You can select a different version, but you should not need to.</p>';
   $output .= '<p>Click Update to start the update process.</p>';
